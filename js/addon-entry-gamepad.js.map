{"version":3,"file":"js/addon-entry-gamepad.js","sources":["webpack://GUI/./src/addons/addons/gamepad/gamepadlib.css","webpack://GUI/./src/addons/addons/gamepad/style.css","webpack://GUI/./src/addons/addons/gamepad/active.png","webpack://GUI/./src/addons/addons/gamepad/close.svg","webpack://GUI/./src/addons/addons/gamepad/cursor.png","webpack://GUI/./src/addons/addons/gamepad/dot.svg","webpack://GUI/./src/addons/addons/gamepad/gamepad.svg","webpack://GUI/./src/addons/addons/gamepad/_runtime_entry.js","webpack://GUI/./src/addons/addons/gamepad/dot.svg?2385","webpack://GUI/./src/addons/addons/gamepad/gamepadlib.js","webpack://GUI/./src/addons/addons/gamepad/userscript.js"],"sourcesContent":["var escape = require(\"../../../../node_modules/css-loader/lib/url/escape.js\");\nexports = module.exports = require(\"../../../../node_modules/css-loader/lib/css-base.js\")(false);\n// imports\n\n\n// module\nexports.push([module.id, \".gamepadlib-selector {\\r\\n  width: 100%;\\r\\n  margin-bottom: 3px;\\r\\n}\\r\\n\\r\\n.gamepadlib-content {\\r\\n  display: flex;\\r\\n  flex-direction: row;\\r\\n  flex-wrap: wrap;\\r\\n}\\r\\n.gamepadlib-content-buttons {\\r\\n  padding-right: 10px;\\r\\n}\\r\\n\\r\\n.gamepadlib-mapping {\\r\\n  display: flex;\\r\\n  align-items: center;\\r\\n  margin-bottom: 3px;\\r\\n}\\r\\n.gamepadlib-mapping-label {\\r\\n  width: 100px;\\r\\n  text-align: center;\\r\\n}\\r\\n.gamepadlib-keyinput {\\r\\n  text-align: center;\\r\\n  width: 75px;\\r\\n  height: 25px;\\r\\n  border-radius: 0;\\r\\n  border: 1px solid black;\\r\\n  background: white;\\r\\n  color: black;\\r\\n  box-sizing: border-box;\\r\\n  padding: 0;\\r\\n  margin: 0;\\r\\n}\\r\\n.gamepadlib-mapping[data-value=\\\"1\\\"] .gamepadlib-keyinput {\\r\\n  background: yellow;\\r\\n}\\r\\n.gamepadlib-keyinput[data-accepting-input=\\\"true\\\"] {\\r\\n  background: #d6fff9;\\r\\n}\\r\\n.gamepadlib-keyinput[data-empty=\\\"true\\\"]:not([data-accepting-input=\\\"true\\\"]) {\\r\\n  color: #aaa;\\r\\n  font-style: italic;\\r\\n}\\r\\n\\r\\n.gamepadlib-axis {\\r\\n  margin-bottom: 8px;\\r\\n  text-align: center;\\r\\n}\\r\\n.gamepadlib-axis-circle {\\r\\n  position: relative;\\r\\n  width: 150px;\\r\\n  height: 150px;\\r\\n  border: 1px solid black;\\r\\n  overflow: hidden;\\r\\n}\\r\\n.gamepadlib-axis-dot {\\r\\n  position: absolute;\\r\\n  top: 50%;\\r\\n  left: 50%;\\r\\n  background-image: url(\" + escape(require(\"./dot.svg\")) + \");\\r\\n  width: 8px;\\r\\n  height: 8px;\\r\\n  transform: translate(-50%, -50%);\\r\\n  pointer-events: none;\\r\\n}\\r\\n.gamepadlib-axis-mapping {\\r\\n  width: 100%;\\r\\n}\\r\\n\\r\\n.gamepadlib-axis-circle-overlay {\\r\\n  position: absolute;\\r\\n  top: 0;\\r\\n  left: 0;\\r\\n  width: 100%;\\r\\n  height: 100%;\\r\\n}\\r\\n.gamepadlib-axis-circle-overlay > .gamepadlib-axis-mapper {\\r\\n  position: absolute;\\r\\n}\\r\\n.gamepadlib-axis-circle-overlay > .gamepadlib-axis-mapper:nth-of-type(1) {\\r\\n  left: 50%;\\r\\n  top: 0;\\r\\n  transform: translateX(-50%);\\r\\n}\\r\\n.gamepadlib-axis-circle-overlay > .gamepadlib-axis-mapper:nth-of-type(2) {\\r\\n  left: 0;\\r\\n  top: 50%;\\r\\n  transform: translateY(-50%);\\r\\n}\\r\\n.gamepadlib-axis-circle-overlay > .gamepadlib-axis-mapper:nth-of-type(3) {\\r\\n  right: 0;\\r\\n  top: 50%;\\r\\n  transform: translateY(-50%);\\r\\n}\\r\\n.gamepadlib-axis-circle-overlay > .gamepadlib-axis-mapper:nth-of-type(4) {\\r\\n  left: 50%;\\r\\n  bottom: 0;\\r\\n  transform: translateX(-50%);\\r\\n}\\r\\n\", \"\"]);\n\n// exports\n","exports = module.exports = require(\"../../../../node_modules/css-loader/lib/css-base.js\")(false);\n// imports\n\n\n// module\nexports.push([module.id, \"[dir=\\\"ltr\\\"] .sa-gamepad-container {\\r\\n  margin-right: 0.2rem;\\r\\n}\\r\\n[dir=\\\"rtl\\\"] .sa-gamepad-container {\\r\\n  margin-left: 0.2rem;\\r\\n}\\r\\n\\r\\n.sa-gamepad-popup-outer {\\r\\n  /* above fullscreen */\\r\\n  z-index: 99999;\\r\\n}\\r\\n.sa-gamepad-popup {\\r\\n  box-sizing: border-box;\\r\\n  width: 700px;\\r\\n  max-height: min(800px, 85vh);\\r\\n  height: 100%;\\r\\n  max-width: 85%;\\r\\n  margin: 50px auto;\\r\\n  display: flex;\\r\\n  flex-direction: column;\\r\\n}\\r\\n.sa-gamepad-popup-content {\\r\\n  background-color: white;\\r\\n  padding: 1.5rem 2.25rem;\\r\\n  height: 100%;\\r\\n  overflow-y: auto;\\r\\n}\\r\\n\\r\\n.sa-gamepad-popup [class*=\\\"modal_header-item-title\\\"] {\\r\\n  margin: 0 -20rem 0 0;\\r\\n}\\r\\n\\r\\n.sa-gamepad-cursor {\\r\\n  position: absolute;\\r\\n  top: 0;\\r\\n  left: 0;\\r\\n  z-index: 9999;\\r\\n  user-select: none;\\r\\n  pointer-events: none;\\r\\n  will-change: transform;\\r\\n  image-rendering: optimizeSpeed;\\r\\n  image-rendering: crisp-edges;\\r\\n  image-rendering: pixelated;\\r\\n}\\r\\n.sa-gamepad-cursor-down {\\r\\n  filter: invert(100%);\\r\\n}\\r\\n\\r\\n.sa-gamepad-small .sa-gamepad-container[data-editor-mode=\\\"editor\\\"] {\\r\\n  display: none !important;\\r\\n}\\r\\n\\r\\n.sa-gamepad-hide-cursor [class^=\\\"stage_stage_\\\"] {\\r\\n  cursor: none;\\r\\n}\\r\\n\\r\\n.sa-gamepad-browser-support-warning {\\r\\n  font-weight: bold;\\r\\n  margin-bottom: 10px;\\r\\n}\\r\\n\\r\\n.sa-gamepad-store-settings {\\r\\n  display: none;\\r\\n}\\r\\n.sa-gamepad-store-settings > input {\\r\\n  margin-right: 4px;\\r\\n}\\r\\n.sa-gamepad-has-controller .sa-gamepad-store-settings {\\r\\n  display: block;\\r\\n}\\r\\n\", \"\"]);\n\n// exports\n","export default \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAYAAAAGAQMAAADaAn0LAAAABlBMVEX///8AAABVwtN+AAAADklEQVQI12MAAQMgBAIAAkwAYUis6mUAAAAASUVORK5CYII=\"","export default \"data:image/svg+xml;base64,PHN2ZyBkYXRhLW5hbWU9IkxheWVyIDEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgdmlld0JveD0iMCAwIDcuNDggNy40OCI+PHBhdGggZD0iTTMuNzQgNi40OFYxTTEgMy43NGg1LjQ4IiBzdHlsZT0iZmlsbDpub25lO3N0cm9rZTojZmZmO3N0cm9rZS1saW5lY2FwOnJvdW5kO3N0cm9rZS1saW5lam9pbjpyb3VuZDtzdHJva2Utd2lkdGg6MnB4Ii8+PC9zdmc+\"","export default \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAYAAAAGAQMAAADaAn0LAAAABlBMVEUAAAD///+l2Z/dAAAADklEQVQI12MAAQMgBAIAAkwAYUis6mUAAAAASUVORK5CYII=\"","export default \"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI4IiBoZWlnaHQ9IjgiIHZpZXdCb3g9IjAgMCAyLjExNyAyLjExNyI+PGNpcmNsZSBjeD0iMS4wNTgiIGN5PSIxLjA1OCIgcj0iMS4wNTgiIGZpbGw9InJlZCIvPjwvc3ZnPg==\"","export default \"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGFyaWEtaGlkZGVuPSJ0cnVlIiB3aWR0aD0iMWVtIiBoZWlnaHQ9IjFlbSIgc3R5bGU9Ii1tcy10cmFuc2Zvcm06cm90YXRlKDM2MGRlZyk7LXdlYmtpdC10cmFuc2Zvcm06cm90YXRlKDM2MGRlZyk7dHJhbnNmb3JtOnJvdGF0ZSgzNjBkZWcpIiB2aWV3Qm94PSIwIDAgNTEyIDUxMiI+PHBhdGggZmlsbD0iIzU3NWU3NSIgZD0iTTM2OCAxNjhoLTk2di02NGgxNzZhMjQuMDI3IDI0LjAyNyAwIDAgMCAyNC0yNFYxNmgtMzJ2NTZIMjY0YTI0LjAyNyAyNC4wMjcgMCAwIDAtMjQgMjR2NzJoLTk2QTEyOC4xNDUgMTI4LjE0NSAwIDAgMCAxNiAyOTZ2MTAwLjk1M0E5MS4xNSA5MS4xNSAwIDAgMCAxMDcuMDQ3IDQ4OGgxLjhhOTAuODA3IDkwLjgwNyAwIDAgMCA2OS45NTMtMzIuNzZMMjMxLjUgMzkyaDQ4LjYyOGw1Mi42NjYgNjguNDY1QTkxLjA0NiA5MS4wNDYgMCAwIDAgNDk2IDQwNC45NTNWMjk2YTEyOC4xNDUgMTI4LjE0NSAwIDAgMC0xMjgtMTI4em05NiAyMzYuOTUzYTU5LjA0NyA1OS4wNDcgMCAwIDEtMTA1Ljg0OSAzNkwyOTUuODc4IDM2MGgtNzkuMzcybC02Mi4yOTQgNzQuNzU0QTU4Ljg5MyA1OC44OTMgMCAwIDEgMTA4Ljg1IDQ1NmgtMS44QTU5LjExMyA1OS4xMTMgMCAwIDEgNDggMzk2Ljk1M1YyOTZhOTYuMTA4IDk2LjEwOCAwIDAgMSA5Ni05NmgyMjRhOTYuMTA4IDk2LjEwOCAwIDAgMSA5NiA5NnoiLz48cGF0aCBmaWxsPSIjNTc1ZTc1IiBkPSJNMzYwIDI0OGgzMnYzMmgtMzJ6bTAgODBoMzJ2MzJoLTMyem0tNDAtNDBoMzJ2MzJoLTMyem04MCAwaDMydjMyaC0zMnptLTI0OC00MGgtMzJ2NDBIODB2MzJoNDB2NDBoMzJ2LTQwaDQwdi0zMmgtNDB2LTQweiIvPjwvc3ZnPg==\"","/* generated by pull.js */\nimport _js from \"./userscript.js\";\nimport _css from \"!css-loader!./style.css\";\nimport _css2 from \"!css-loader!./gamepadlib.css\";\nexport const resources = {\n  \"userscript.js\": _js,\n  \"style.css\": _css,\n  \"gamepadlib.css\": _css2,\n};\n","module.exports = __webpack_public_path__ + \"static/assets/88a77444f0bb453209bf1c62becbd37c.svg\";","import EventTarget from \"../../event-target.js\"; /* inserted by pull.js */\n\nlet console = window.console;\r\n\r\n/*\r\nMapping types:\r\n\r\ntype: \"key\" maps a button to a keyboard key\r\nAll key names will be interpreted as a KeyboardEvent.key value (https://developer.mozilla.org/en-US/docs/Web/API/KeyboardEvent/key/Key_Values)\r\nhigh: \"KeyName\" is the name of the key to dispatch when a button reads a HIGH value\r\nlow: \"KeyName\" is the name of the key to dispatch when a button reads a LOW value\r\ndeadZone: 0.5 controls the minimum value necessary to be read in either + or - to trigger either high or low\r\nThe high/low distinction is necessary for axes. Buttons will only use high\r\n\r\ntype: \"mousedown\" maps a button to control whether the mouse is down or not\r\ndeadZone: 0.5 controls the minimum value to trigger a mousedown\r\nbutton: 0, 1, 2, etc. controls which button to press\r\n\r\ntype: \"virtual_cursor\" maps a button to control the \"virtual cursor\"\r\ndeadZone: 0.5 again controls the minimum value to trigger a movement\r\nsensitivity: 10 controls the speed\r\nhigh: \"+y\"/\"-y\"/\"+x\"/\"-x\" defines what happens when an axis reads high\r\nlow: \"+y\"/\"-y\"/\"+x\"/\"-x\" defines what happens when an axis reads low\r\n+y increases y, -y decreases y, +x increases x, -x decreases x.\r\n*/\r\n\r\nconst defaultAxesMappings = {\r\n  arrows: [\r\n    {\r\n      type: \"key\",\r\n      high: \"ArrowRight\",\r\n      low: \"ArrowLeft\",\r\n      deadZone: 0.5,\r\n    },\r\n    {\r\n      type: \"key\",\r\n      high: \"ArrowDown\",\r\n      low: \"ArrowUp\",\r\n      deadZone: 0.5,\r\n    },\r\n  ],\r\n  wasd: [\r\n    {\r\n      type: \"key\",\r\n      high: \"d\",\r\n      low: \"a\",\r\n      deadZone: 0.5,\r\n    },\r\n    {\r\n      type: \"key\",\r\n      high: \"s\",\r\n      low: \"w\",\r\n      deadZone: 0.5,\r\n    },\r\n  ],\r\n  cursor: [\r\n    {\r\n      type: \"virtual_cursor\",\r\n      high: \"+x\",\r\n      low: \"-x\",\r\n      sensitivity: 0.6,\r\n      deadZone: 0.2,\r\n    },\r\n    {\r\n      type: \"virtual_cursor\",\r\n      high: \"-y\",\r\n      low: \"+y\",\r\n      sensitivity: 0.6,\r\n      deadZone: 0.2,\r\n    },\r\n  ],\r\n};\r\n\r\nconst emptyMapping = () => ({\r\n  type: \"key\",\r\n  high: null,\r\n  low: null,\r\n});\r\nconst transformAndCopyMapping = (mapping) => {\r\n  if (typeof mapping !== \"object\" || !mapping) {\r\n    console.warn(\"invalid mapping\", mapping);\r\n    return emptyMapping();\r\n  }\r\n  const copy = Object.assign({}, mapping);\r\n  if (copy.type === \"key\") {\r\n    if (typeof copy.deadZone === \"undefined\") {\r\n      copy.deadZone = 0.5;\r\n    }\r\n    if (typeof copy.high === \"undefined\") {\r\n      copy.high = \"\";\r\n    }\r\n    if (typeof copy.low === \"undefined\") {\r\n      copy.low = \"\";\r\n    }\r\n  } else if (copy.type === \"mousedown\") {\r\n    if (typeof copy.deadZone === \"undefined\") {\r\n      copy.deadZone = 0.5;\r\n    }\r\n    if (typeof copy.button === \"undefined\") {\r\n      copy.button = 0;\r\n    }\r\n  } else if (copy.type === \"virtual_cursor\") {\r\n    if (typeof copy.high === \"undefined\") {\r\n      copy.high = \"\";\r\n    }\r\n    if (typeof copy.low === \"undefined\") {\r\n      copy.low = \"\";\r\n    }\r\n    if (typeof copy.sensitivity === \"undefined\") {\r\n      copy.sensitivity = 10;\r\n    }\r\n    if (typeof copy.deadZone === \"undefined\") {\r\n      copy.deadZone = 0.5;\r\n    }\r\n  } else {\r\n    console.warn(\"unknown mapping type\", copy.type);\r\n    return emptyMapping();\r\n  }\r\n  return copy;\r\n};\r\nconst prepareMappingForExport = (mapping) => Object.assign({}, mapping);\r\nconst prepareAxisMappingForExport = prepareMappingForExport;\r\nconst prepareButtonMappingForExport = (mapping) => {\r\n  const copy = prepareMappingForExport(mapping);\r\n  delete copy.deadZone;\r\n  delete copy.low;\r\n  return copy;\r\n};\r\n\r\nconst padWithEmptyMappings = (array, length) => {\r\n  // Keep adding empty mappings until the list is full\r\n  while (array.length < length) {\r\n    array.push(emptyMapping());\r\n  }\r\n  // In case the input array is longer than the desired length\r\n  array.length = length;\r\n  return array;\r\n};\r\n\r\nconst getMovementConfiguration = (usedKeys) => ({\r\n  usesArrows:\r\n    usedKeys.has(\"ArrowUp\") || usedKeys.has(\"ArrowDown\") || usedKeys.has(\"ArrowRight\") || usedKeys.has(\"ArrowLeft\"),\r\n  usesWASD: (usedKeys.has(\"w\") && usedKeys.has(\"s\")) || (usedKeys.has(\"a\") && usedKeys.has(\"d\")),\r\n});\r\n\r\nconst getGamepadId = (gamepad) => `${gamepad.id} (${gamepad.index})`;\r\n\r\nclass GamepadData {\r\n  /**\r\n   * @param {Gamepad} gamepad Source Gamepad\r\n   * @param {GamepadLib} gamepadLib Parent GamepadLib\r\n   */\r\n  constructor(gamepad, gamepadLib) {\r\n    this.gamepad = gamepad;\r\n    this.gamepadLib = gamepadLib;\r\n    this.resetMappings();\r\n  }\r\n\r\n  resetMappings() {\r\n    this.buttonMappings = this.getDefaultButtonMappings().map(transformAndCopyMapping);\r\n    this.axesMappings = this.getDefaultAxisMappings().map(transformAndCopyMapping);\r\n  }\r\n\r\n  getDefaultButtonMappings() {\r\n    let buttons;\r\n    if (this.gamepadLib.hints.importedSettings) {\r\n      buttons = this.gamepadLib.hints.importedSettings.buttons;\r\n    } else {\r\n      const usedKeys = this.gamepadLib.hints.usedKeys;\r\n      const alreadyUsedKeys = new Set();\r\n      const { usesArrows, usesWASD } = getMovementConfiguration(usedKeys);\r\n      if (usesWASD) {\r\n        alreadyUsedKeys.add(\"w\");\r\n        alreadyUsedKeys.add(\"a\");\r\n        alreadyUsedKeys.add(\"s\");\r\n        alreadyUsedKeys.add(\"d\");\r\n      }\r\n      const possiblePauseKeys = [\r\n        // Restart keys, pause keys, other potentially dangerous keys\r\n        \"p\",\r\n        \"q\",\r\n        \"r\",\r\n      ];\r\n      const possibleActionKeys = [\r\n        \" \",\r\n        \"Enter\",\r\n        \"e\",\r\n        \"f\",\r\n        \"z\",\r\n        \"x\",\r\n        \"c\",\r\n        ...Array.from(usedKeys).filter((i) => i.length === 1 && !possiblePauseKeys.includes(i)),\r\n      ];\r\n\r\n      const findKey = (keys) => {\r\n        for (const key of keys) {\r\n          if (usedKeys.has(key) && !alreadyUsedKeys.has(key)) {\r\n            alreadyUsedKeys.add(key);\r\n            return key;\r\n          }\r\n        }\r\n        return null;\r\n      };\r\n      const getPrimaryAction = () => {\r\n        if (usesArrows && usedKeys.has(\"ArrowUp\")) {\r\n          return \"ArrowUp\";\r\n        }\r\n        if (usesWASD && usedKeys.has(\"w\")) {\r\n          return \"w\";\r\n        }\r\n        return findKey(possibleActionKeys);\r\n      };\r\n      const getSecondaryAction = () => findKey(possibleActionKeys);\r\n      const getPauseKey = () => findKey(possiblePauseKeys);\r\n      const getUp = () => {\r\n        if (usesArrows || !usesWASD) return \"ArrowUp\";\r\n        return \"w\";\r\n      };\r\n      const getDown = () => {\r\n        if (usesArrows || !usesWASD) return \"ArrowDown\";\r\n        return \"s\";\r\n      };\r\n      const getRight = () => {\r\n        if (usesArrows || !usesWASD) return \"ArrowRight\";\r\n        return \"d\";\r\n      };\r\n      const getLeft = () => {\r\n        if (usesArrows || !usesWASD) return \"ArrowLeft\";\r\n        return \"a\";\r\n      };\r\n\r\n      const action1 = getPrimaryAction();\r\n      let action2 = getSecondaryAction();\r\n      let action3 = getSecondaryAction();\r\n      let action4 = getSecondaryAction();\r\n      // When only 1 or 2 action keys are detected, bind the other buttons to the same things.\r\n      if (action1 && !action2 && !action3 && !action4) {\r\n        action2 = action1;\r\n        action3 = action1;\r\n        action4 = action1;\r\n      }\r\n      if (action1 && action2 && !action3 && !action4) {\r\n        action3 = action1;\r\n        action4 = action2;\r\n      }\r\n\r\n      // Set indices \"manually\" because we don't evaluate them in order.\r\n      buttons = [];\r\n      buttons[0] = {\r\n        /*\r\n        Xbox: A\r\n        SNES-like: B\r\n        */\r\n        type: \"key\",\r\n        high: action1,\r\n      };\r\n      buttons[1] = {\r\n        /*\r\n        Xbox: B\r\n        SNES-like: A\r\n        */\r\n        type: \"key\",\r\n        high: action2,\r\n      };\r\n      buttons[2] = {\r\n        /*\r\n        Xbox: X\r\n        SNES-like: Y\r\n        */\r\n        type: \"key\",\r\n        high: action3,\r\n      };\r\n      buttons[3] = {\r\n        /*\r\n        Xbox: Y\r\n        SNES-like: X\r\n        */\r\n        type: \"key\",\r\n        high: action4,\r\n      };\r\n      buttons[4] = {\r\n        /*\r\n        Xbox: LB\r\n        SNES-like: Left trigger\r\n        */\r\n        type: \"mousedown\",\r\n      };\r\n      buttons[5] = {\r\n        /*\r\n        Xbox: RB\r\n        */\r\n        type: \"mousedown\",\r\n      };\r\n      buttons[6] = {\r\n        /*\r\n        Xbox: LT\r\n        */\r\n        type: \"mousedown\",\r\n      };\r\n      buttons[7] = {\r\n        /*\r\n        Xbox: RT\r\n        SNES-like: Right trigger\r\n        */\r\n        type: \"mousedown\",\r\n      };\r\n      buttons[9] = {\r\n        /*\r\n        Xbox: Menu\r\n        SNES-like: Start\r\n        */\r\n        type: \"key\",\r\n        high: getPauseKey(),\r\n      };\r\n      buttons[8] = {\r\n        /*\r\n        Xbox: Change view\r\n        SNES-like: Select\r\n        */\r\n        type: \"key\",\r\n        high: getPauseKey(),\r\n      };\r\n      // Xbox: Left analog press\r\n      buttons[10] = emptyMapping();\r\n      // Xbox: Right analog press\r\n      buttons[11] = emptyMapping();\r\n      buttons[12] = {\r\n        /*\r\n        Xbox: D-pad up\r\n        */\r\n        type: \"key\",\r\n        high: getUp(),\r\n      };\r\n      buttons[13] = {\r\n        /*\r\n        Xbox: D-pad down\r\n        */\r\n        type: \"key\",\r\n        high: getDown(),\r\n      };\r\n      buttons[14] = {\r\n        /*\r\n        Xbox: D-pad left\r\n        */\r\n        type: \"key\",\r\n        high: getLeft(),\r\n      };\r\n      buttons[15] = {\r\n        /*\r\n        Xbox: D-pad right\r\n        */\r\n        type: \"key\",\r\n        high: getRight(),\r\n      };\r\n    }\r\n    return padWithEmptyMappings(buttons, this.gamepad.buttons.length);\r\n  }\r\n\r\n  getDefaultAxisMappings() {\r\n    let axes = [];\r\n    if (this.gamepadLib.hints.importedSettings) {\r\n      axes = this.gamepadLib.hints.importedSettings.axes;\r\n    } else {\r\n      // Only return default axis mappings when there are 4 axes, like an xbox controller\r\n      // If there isn't exactly 4, we can't really predict what the axes mean\r\n      // Some controllers map the dpad to *both* buttons and axes at the same time, which would cause conflicts.\r\n      if (this.gamepad.axes.length === 4) {\r\n        const usedKeys = this.gamepadLib.hints.usedKeys;\r\n        const { usesArrows, usesWASD } = getMovementConfiguration(usedKeys);\r\n        if (usesWASD) {\r\n          axes.push(defaultAxesMappings.wasd[0]);\r\n          axes.push(defaultAxesMappings.wasd[1]);\r\n        } else if (usesArrows) {\r\n          axes.push(defaultAxesMappings.arrows[0]);\r\n          axes.push(defaultAxesMappings.arrows[1]);\r\n        } else {\r\n          axes.push(defaultAxesMappings.cursor[0]);\r\n          axes.push(defaultAxesMappings.cursor[1]);\r\n        }\r\n        axes.push(defaultAxesMappings.cursor[0]);\r\n        axes.push(defaultAxesMappings.cursor[1]);\r\n      }\r\n    }\r\n    return padWithEmptyMappings(axes, this.gamepad.axes.length);\r\n  }\r\n}\r\n\r\nconst defaultHints = () => ({\r\n  usedKeys: new Set(),\r\n  importedSettings: null,\r\n  generated: false,\r\n});\r\n\r\nclass GamepadLib extends EventTarget {\r\n  constructor() {\r\n    super();\r\n\r\n    /** @type {Map<string, GamepadData>} */\r\n    this.gamepads = new Map();\r\n\r\n    this.handleConnect = this.handleConnect.bind(this);\r\n    this.handleDisconnect = this.handleDisconnect.bind(this);\r\n    this.update = this.update.bind(this);\r\n\r\n    this.animationFrame = null;\r\n    this.currentTime = null;\r\n    this.deltaTime = 0;\r\n\r\n    this.virtualCursor = {\r\n      x: 0,\r\n      y: 0,\r\n      maxX: Infinity,\r\n      minX: -Infinity,\r\n      maxY: Infinity,\r\n      minY: -Infinity,\r\n      modified: false,\r\n    };\r\n\r\n    this._editor = null;\r\n\r\n    this.connectCallbacks = [];\r\n\r\n    this.hints = defaultHints();\r\n\r\n    this.keysPressedThisFrame = new Set();\r\n    this.oldKeysPressed = new Set();\r\n\r\n    this.mouseButtonsPressedThisFrame = new Set();\r\n    this.oldMouseDown = new Set();\r\n\r\n    this.addEventHandlers();\r\n  }\r\n\r\n  addEventHandlers() {\r\n    window.addEventListener(\"gamepadconnected\", this.handleConnect);\r\n    window.addEventListener(\"gamepaddisconnected\", this.handleDisconnect);\r\n  }\r\n\r\n  removeEventHandlers() {\r\n    window.removeEventListener(\"gamepadconnected\", this.handleConnect);\r\n    window.removeEventListener(\"gamepaddisconnected\", this.handleDisconnect);\r\n  }\r\n\r\n  gamepadConnected() {\r\n    if (this.gamepads.size > 0) {\r\n      return Promise.resolve();\r\n    }\r\n    return new Promise((resolve) => {\r\n      this.connectCallbacks.push(resolve);\r\n    });\r\n  }\r\n\r\n  ensureHintsGenerated() {\r\n    if (this.hints.generated) {\r\n      return;\r\n    }\r\n    if (this.getHintsLazily) {\r\n      Object.assign(this.hints, this.getHintsLazily());\r\n    }\r\n    this.hints.generated = true;\r\n  }\r\n\r\n  resetControls() {\r\n    this.hints = defaultHints();\r\n    this.ensureHintsGenerated();\r\n    for (const gamepad of this.gamepads.values()) {\r\n      gamepad.resetMappings();\r\n    }\r\n  }\r\n\r\n  handleConnect(e) {\r\n    this.ensureHintsGenerated();\r\n    for (const callback of this.connectCallbacks) {\r\n      callback();\r\n    }\r\n    this.connectCallbacks = [];\r\n    const gamepad = e.gamepad;\r\n    const id = getGamepadId(gamepad);\r\n    console.log(\"connected\", gamepad);\r\n    const gamepadData = new GamepadData(gamepad, this);\r\n    this.gamepads.set(id, gamepadData);\r\n    if (this.animationFrame === null) {\r\n      this.animationFrame = requestAnimationFrame(this.update);\r\n    }\r\n    this.dispatchEvent(new CustomEvent(\"gamepadconnected\", { detail: gamepadData }));\r\n  }\r\n\r\n  handleDisconnect(e) {\r\n    const gamepad = e.gamepad;\r\n    const id = getGamepadId(gamepad);\r\n    console.log(\"disconnected\", gamepad);\r\n    const gamepadData = this.gamepads.get(id);\r\n    this.gamepads.delete(id);\r\n    this.dispatchEvent(new CustomEvent(\"gamepaddisconnected\", { detail: gamepadData }));\r\n    if (this.gamepads.size === 0) {\r\n      cancelAnimationFrame(this.animationFrame);\r\n      this.animationFrame = null;\r\n      this.currentTime = null;\r\n    }\r\n  }\r\n\r\n  dispatchKey(key, pressed) {\r\n    if (pressed) {\r\n      this.dispatchEvent(new CustomEvent(\"keydown\", { detail: key }));\r\n    } else {\r\n      this.dispatchEvent(new CustomEvent(\"keyup\", { detail: key }));\r\n    }\r\n  }\r\n\r\n  dispatchMouse(button, down) {\r\n    if (down) {\r\n      this.dispatchEvent(new CustomEvent(\"mousedown\", { detail: button }));\r\n    } else {\r\n      this.dispatchEvent(new CustomEvent(\"mouseup\", { detail: button }));\r\n    }\r\n  }\r\n\r\n  dispatchMouseMove(x, y) {\r\n    this.dispatchEvent(new CustomEvent(\"mousemove\", { detail: { x, y } }));\r\n  }\r\n\r\n  updateButton(value, mapping) {\r\n    if (mapping.type === \"key\") {\r\n      if (value >= mapping.deadZone) {\r\n        if (mapping.high) {\r\n          this.keysPressedThisFrame.add(mapping.high);\r\n        }\r\n      } else if (value <= -mapping.deadZone) {\r\n        if (mapping.low) {\r\n          this.keysPressedThisFrame.add(mapping.low);\r\n        }\r\n      }\r\n    } else if (mapping.type === \"mousedown\") {\r\n      const isDown = Math.abs(value) >= mapping.deadZone;\r\n      if (isDown) {\r\n        this.mouseButtonsPressedThisFrame.add(mapping.button);\r\n      }\r\n    } else if (mapping.type === \"virtual_cursor\") {\r\n      const deadZone = mapping.deadZone;\r\n      let action;\r\n      if (value >= deadZone) action = mapping.high;\r\n      if (value <= -deadZone) action = mapping.low;\r\n      if (action) {\r\n        // an axis value just beyond the deadzone should have a multiplier near 0, a high value should have a multiplier of 1\r\n        const multiplier = (Math.abs(value) - deadZone) / (1 - deadZone);\r\n        const speed = multiplier * multiplier * mapping.sensitivity * this.deltaTime;\r\n        if (action === \"+x\") {\r\n          this.virtualCursor.x += speed;\r\n        } else if (action === \"-x\") {\r\n          this.virtualCursor.x -= speed;\r\n        } else if (action === \"+y\") {\r\n          this.virtualCursor.y += speed;\r\n        } else if (action === \"-y\") {\r\n          this.virtualCursor.y -= speed;\r\n        }\r\n        this.virtualCursor.modified = true;\r\n      }\r\n    }\r\n  }\r\n\r\n  update(time) {\r\n    this.oldKeysPressed = this.keysPressedThisFrame;\r\n    this.oldMouseButtonsPressed = this.mouseButtonsPressedThisFrame;\r\n    this.keysPressedThisFrame = new Set();\r\n    this.mouseButtonsPressedThisFrame = new Set();\r\n\r\n    if (this.currentTime === null) {\r\n      this.deltaTime = 0; // doesn't matter what this is, it's just the first frame\r\n    } else {\r\n      this.deltaTime = time - this.currentTime;\r\n    }\r\n    this.deltaTime = Math.max(Math.min(this.deltaTime, 1000), 0);\r\n    this.currentTime = time;\r\n\r\n    this.animationFrame = requestAnimationFrame(this.update);\r\n\r\n    const gamepads = navigator.getGamepads();\r\n    for (const gamepad of gamepads) {\r\n      if (gamepad === null) {\r\n        continue;\r\n      }\r\n\r\n      const id = getGamepadId(gamepad);\r\n      const data = this.gamepads.get(id);\r\n\r\n      for (let i = 0; i < gamepad.buttons.length; i++) {\r\n        const button = gamepad.buttons[i];\r\n        const value = button.value;\r\n        const mapping = data.buttonMappings[i];\r\n        this.updateButton(value, mapping);\r\n      }\r\n\r\n      for (let i = 0; i < gamepad.axes.length; i++) {\r\n        const axis = gamepad.axes[i];\r\n        const mapping = data.axesMappings[i];\r\n        this.updateButton(axis, mapping);\r\n      }\r\n    }\r\n\r\n    if (this._editor) {\r\n      this._editor.update(gamepads);\r\n    }\r\n\r\n    for (const key of this.keysPressedThisFrame) {\r\n      if (!this.oldKeysPressed.has(key)) {\r\n        this.dispatchKey(key, true);\r\n      }\r\n    }\r\n    for (const key of this.oldKeysPressed) {\r\n      if (!this.keysPressedThisFrame.has(key)) {\r\n        this.dispatchKey(key, false);\r\n      }\r\n    }\r\n\r\n    for (const button of this.mouseButtonsPressedThisFrame) {\r\n      if (!this.oldMouseButtonsPressed.has(button)) {\r\n        this.dispatchMouse(button, true);\r\n      }\r\n    }\r\n    for (const button of this.oldMouseButtonsPressed) {\r\n      if (!this.mouseButtonsPressedThisFrame.has(button)) {\r\n        this.dispatchMouse(button, false);\r\n      }\r\n    }\r\n\r\n    if (this.virtualCursor.modified) {\r\n      this.virtualCursor.modified = false;\r\n      if (this.virtualCursor.x > this.virtualCursor.maxX) {\r\n        this.virtualCursor.x = this.virtualCursor.maxX;\r\n      }\r\n      if (this.virtualCursor.x < this.virtualCursor.minX) {\r\n        this.virtualCursor.x = this.virtualCursor.minX;\r\n      }\r\n      if (this.virtualCursor.y > this.virtualCursor.maxY) {\r\n        this.virtualCursor.y = this.virtualCursor.maxY;\r\n      }\r\n      if (this.virtualCursor.y < this.virtualCursor.minY) {\r\n        this.virtualCursor.y = this.virtualCursor.minY;\r\n      }\r\n      this.dispatchMouseMove(this.virtualCursor.x, this.virtualCursor.y);\r\n    }\r\n  }\r\n\r\n  editor() {\r\n    if (!this._editor) {\r\n      this._editor = new GamepadEditor(this);\r\n    }\r\n    return this._editor;\r\n  }\r\n}\r\n\r\nGamepadLib.browserHasBrokenGamepadAPI = () => {\r\n  // Check that the gamepad API is supported at all\r\n  if (!navigator.getGamepads) {\r\n    return true;\r\n  }\r\n  // Firefox on Linux has a broken gamepad API implementation that results in strange and sometimes unusable mappings\r\n  // https://bugzilla.mozilla.org/show_bug.cgi?id=1643358\r\n  // https://bugzilla.mozilla.org/show_bug.cgi?id=1643835\r\n  if (navigator.userAgent.includes(\"Firefox\") && navigator.userAgent.includes(\"Linux\")) {\r\n    return true;\r\n  }\r\n  // Firefox on macOS has other bugs that result in strange and unusable mappings\r\n  // eg. https://bugzilla.mozilla.org/show_bug.cgi?id=1434408\r\n  if (navigator.userAgent.includes(\"Firefox\") && navigator.userAgent.includes(\"Mac OS\")) {\r\n    return true;\r\n  }\r\n  return false;\r\n};\r\n\r\nGamepadLib.setConsole = (n) => (console = n);\r\n\r\nconst removeAllChildren = (el) => {\r\n  while (el.firstChild) {\r\n    el.removeChild(el.firstChild);\r\n  }\r\n};\r\nconst buttonHtmlId = (index) => `gamepadlib-button-${index}`;\r\nconst axisHtmlId = (n) => `gamepadlib-axis-${n}`;\r\n\r\nclass GamepadEditor extends EventTarget {\r\n  constructor(gamepadLib) {\r\n    super();\r\n\r\n    /** @type {GamepadLib} */\r\n    this.gamepadLib = gamepadLib;\r\n\r\n    this.root = Object.assign(document.createElement(\"div\"), {\r\n      className: \"gamepadlib-root\",\r\n    });\r\n    this.selector = Object.assign(document.createElement(\"select\"), {\r\n      className: \"gamepadlib-selector\",\r\n    });\r\n    this.content = Object.assign(document.createElement(\"div\"), {\r\n      className: \"gamepadlib-content\",\r\n    });\r\n\r\n    this.root.appendChild(this.selector);\r\n    this.root.appendChild(this.content);\r\n\r\n    this.onSelectorChange = this.onSelectorChange.bind(this);\r\n    this.onGamepadsChange = this.onGamepadsChange.bind(this);\r\n\r\n    this.selector.onchange = this.onSelectorChange;\r\n    this.gamepadLib.addEventListener(\"gamepadconnected\", this.onGamepadsChange);\r\n    this.gamepadLib.addEventListener(\"gamepaddisconnected\", this.onGamepadsChange);\r\n\r\n    this.buttonIdToElement = new Map();\r\n    this.axisIdToElement = new Map();\r\n\r\n    this.hidden = false;\r\n\r\n    // should be overridden later\r\n    this.msg = (id, opts) => id;\r\n  }\r\n\r\n  onSelectorChange() {\r\n    this.updateContent();\r\n    this.dispatchEvent(new CustomEvent(\"gamepad-changed\"));\r\n  }\r\n\r\n  onGamepadsChange() {\r\n    this.updateAllContent();\r\n    this.dispatchEvent(new CustomEvent(\"gamepad-changed\"));\r\n  }\r\n\r\n  updateAllContent() {\r\n    this.updateDropdown();\r\n    this.updateContent();\r\n    this.focus();\r\n  }\r\n\r\n  updateDropdown() {\r\n    removeAllChildren(this.selector);\r\n\r\n    const gamepads = Array.from(this.gamepadLib.gamepads.entries());\r\n    if (gamepads.length === 0) {\r\n      this.selector.hidden = true;\r\n      return;\r\n    }\r\n    this.selector.hidden = false;\r\n    for (const [id, _] of gamepads) {\r\n      const option = document.createElement(\"option\");\r\n      option.textContent = id;\r\n      option.value = id;\r\n      this.selector.appendChild(option);\r\n    }\r\n  }\r\n\r\n  keyToString(key) {\r\n    if (key === \" \") return this.msg(\"key-space\");\r\n    if (key === \"ArrowUp\") return this.msg(\"key-up\");\r\n    if (key === \"ArrowDown\") return this.msg(\"key-down\");\r\n    if (key === \"ArrowLeft\") return this.msg(\"key-left\");\r\n    if (key === \"ArrowRight\") return this.msg(\"key-right\");\r\n    if (key === \"Enter\") return this.msg(\"key-enter\");\r\n    return key.toUpperCase();\r\n  }\r\n\r\n  createButtonMapping(mappingList, index, { property = \"high\", allowClick = true } = {}) {\r\n    const input = document.createElement(\"input\");\r\n    input.readOnly = true;\r\n    input.className = \"gamepadlib-keyinput\";\r\n    input.title = this.msg(\"keyinput-title\");\r\n    input.dataset.index = index;\r\n\r\n    const update = () => {\r\n      const mapping = mappingList[index];\r\n      input.dataset.empty = false;\r\n      if (mapping.type === \"key\") {\r\n        if (mapping[property] === null) {\r\n          input.value = this.msg(\"key-none\");\r\n          input.dataset.empty = true;\r\n        } else {\r\n          input.value = this.keyToString(mapping[property]);\r\n        }\r\n      } else if (mapping.type === \"mousedown\") {\r\n        let value = this.msg(\"key-click\");\r\n        if (mapping.button !== 0) {\r\n          value += ` (${mapping.button})`;\r\n        }\r\n        input.value = value;\r\n      } else {\r\n        // should never happen\r\n        input.value = `??? ${mapping.type}`;\r\n      }\r\n    };\r\n\r\n    const changedMapping = () => {\r\n      mappingList[index] = transformAndCopyMapping(mappingList[index]);\r\n      isAcceptingInput = false;\r\n      input.blur();\r\n      update();\r\n      input.dispatchEvent(new CustomEvent(\"mapping-changed\"));\r\n      this.changed();\r\n    };\r\n\r\n    let isAcceptingInput = false;\r\n\r\n    const handleClick = (e) => {\r\n      e.preventDefault();\r\n      if (isAcceptingInput) {\r\n        if (allowClick) {\r\n          const mapping = mappingList[index];\r\n          mapping.type = \"mousedown\";\r\n          mapping.button = e.button;\r\n          changedMapping();\r\n        } else {\r\n          handleBlur();\r\n        }\r\n      } else {\r\n        input.value = \"...\";\r\n        input.dataset.acceptingInput = true;\r\n        isAcceptingInput = true;\r\n      }\r\n    };\r\n\r\n    const handleKeyDown = (e) => {\r\n      if (isAcceptingInput) {\r\n        e.preventDefault();\r\n        const key = e.key;\r\n        if ([\"Alt\", \"Shift\", \"Control\"].includes(key)) {\r\n          return;\r\n        }\r\n        const mapping = mappingList[index];\r\n        if (key.length === 1 || [\"ArrowUp\", \"ArrowDown\", \"ArrowRight\", \"ArrowLeft\", \"Enter\"].includes(key)) {\r\n          mapping.type = \"key\";\r\n          mapping[property] = key;\r\n        } else if (key !== \"Escape\") {\r\n          mapping.type = \"key\";\r\n          mapping[property] = null;\r\n        }\r\n        changedMapping();\r\n      } else if (e.key === \"Enter\") {\r\n        e.preventDefault();\r\n        e.target.click();\r\n      }\r\n    };\r\n\r\n    const handleBlur = () => {\r\n      input.dataset.acceptingInput = false;\r\n      if (isAcceptingInput) {\r\n        isAcceptingInput = false;\r\n        update();\r\n      }\r\n    };\r\n\r\n    input.addEventListener(\"contextmenu\", (e) => {\r\n      e.preventDefault();\r\n    });\r\n\r\n    input.addEventListener(\"mouseup\", handleClick);\r\n    input.addEventListener(\"keydown\", handleKeyDown);\r\n    input.addEventListener(\"blur\", handleBlur);\r\n    update();\r\n\r\n    return input;\r\n  }\r\n\r\n  createAxisMapping(mappingList, index) {\r\n    const selector = document.createElement(\"select\");\r\n    selector.className = \"gamepadlib-axis-mapping\";\r\n    selector.id = axisHtmlId(index);\r\n    selector.appendChild(\r\n      Object.assign(document.createElement(\"option\"), {\r\n        textContent: this.msg(\"axis-none\"),\r\n        value: \"none\",\r\n      })\r\n    );\r\n    selector.appendChild(\r\n      Object.assign(document.createElement(\"option\"), {\r\n        textContent: this.msg(\"axis-cursor\"),\r\n        value: \"cursor\",\r\n      })\r\n    );\r\n    selector.appendChild(\r\n      Object.assign(document.createElement(\"option\"), {\r\n        // doesn't really make sense to translate\r\n        textContent: \"WASD\",\r\n        value: \"wasd\",\r\n      })\r\n    );\r\n    selector.appendChild(\r\n      Object.assign(document.createElement(\"option\"), {\r\n        textContent: this.msg(\"axis-arrows\"),\r\n        value: \"arrows\",\r\n      })\r\n    );\r\n    selector.appendChild(\r\n      Object.assign(document.createElement(\"option\"), {\r\n        textContent: this.msg(\"axis-custom\"),\r\n        value: \"custom\",\r\n      })\r\n    );\r\n\r\n    const updateDropdownValue = () => {\r\n      if (mappingList[index].type === \"key\" || mappingList[index].type === \"mousedown\") {\r\n        if (\r\n          mappingList[index].high === null &&\r\n          mappingList[index].low === null &&\r\n          mappingList[index + 1].high === null &&\r\n          mappingList[index + 1].low === null\r\n        ) {\r\n          selector.value = \"none\";\r\n        } else if (\r\n          mappingList[index].high === defaultAxesMappings.wasd[0].high &&\r\n          mappingList[index].low === defaultAxesMappings.wasd[0].low &&\r\n          mappingList[index + 1].high === defaultAxesMappings.wasd[1].high &&\r\n          mappingList[index + 1].low === defaultAxesMappings.wasd[1].low\r\n        ) {\r\n          selector.value = \"wasd\";\r\n        } else if (\r\n          mappingList[index].high === defaultAxesMappings.arrows[0].high &&\r\n          mappingList[index].low === defaultAxesMappings.arrows[0].low &&\r\n          mappingList[index + 1].high === defaultAxesMappings.arrows[1].high &&\r\n          mappingList[index + 1].low === defaultAxesMappings.arrows[1].low\r\n        ) {\r\n          selector.value = \"arrows\";\r\n        } else {\r\n          selector.value = \"custom\";\r\n        }\r\n      } else if (mappingList[index].type === \"virtual_cursor\") {\r\n        selector.value = \"cursor\";\r\n      } else {\r\n        // should never happen\r\n        selector.value = \"none\";\r\n      }\r\n    };\r\n    updateDropdownValue();\r\n\r\n    const circleOverlay = document.createElement(\"div\");\r\n    circleOverlay.className = \"gamepadlib-axis-circle-overlay\";\r\n    const updateOverlay = () => {\r\n      removeAllChildren(circleOverlay);\r\n      if (mappingList[index].type === \"key\") {\r\n        const buttons = [\r\n          this.createButtonMapping(mappingList, index + 1, { property: \"low\", allowClick: false }),\r\n          this.createButtonMapping(mappingList, index, { property: \"low\", allowClick: false }),\r\n          this.createButtonMapping(mappingList, index, { property: \"high\", allowClick: false }),\r\n          this.createButtonMapping(mappingList, index + 1, { property: \"high\", allowClick: false }),\r\n        ];\r\n        for (const button of buttons) {\r\n          button.classList.add(\"gamepadlib-axis-mapper\");\r\n          button.addEventListener(\"mapping-changed\", updateDropdownValue);\r\n          circleOverlay.appendChild(button);\r\n        }\r\n      }\r\n    };\r\n    updateOverlay();\r\n\r\n    selector.addEventListener(\"change\", () => {\r\n      if (selector.value === \"custom\") {\r\n        // If key mappings already exist, leave them as-is\r\n        if (mappingList[index].type !== \"key\") {\r\n          mappingList[index] = transformAndCopyMapping(defaultAxesMappings.arrows[0]);\r\n          mappingList[index + 1] = transformAndCopyMapping(defaultAxesMappings.arrows[1]);\r\n        }\r\n      } else if (selector.value === \"arrows\") {\r\n        mappingList[index] = transformAndCopyMapping(defaultAxesMappings.arrows[0]);\r\n        mappingList[index + 1] = transformAndCopyMapping(defaultAxesMappings.arrows[1]);\r\n      } else if (selector.value === \"wasd\") {\r\n        mappingList[index] = transformAndCopyMapping(defaultAxesMappings.wasd[0]);\r\n        mappingList[index + 1] = transformAndCopyMapping(defaultAxesMappings.wasd[1]);\r\n      } else if (selector.value === \"cursor\") {\r\n        mappingList[index] = transformAndCopyMapping(defaultAxesMappings.cursor[0]);\r\n        mappingList[index + 1] = transformAndCopyMapping(defaultAxesMappings.cursor[1]);\r\n      } else {\r\n        mappingList[index] = transformAndCopyMapping(emptyMapping());\r\n        mappingList[index + 1] = transformAndCopyMapping(emptyMapping());\r\n      }\r\n      updateOverlay();\r\n      this.changed();\r\n    });\r\n\r\n    return {\r\n      circleOverlay,\r\n      selector,\r\n    };\r\n  }\r\n\r\n  hasControllerSelected() {\r\n    return !!this.selector.value;\r\n  }\r\n\r\n  updateContent() {\r\n    removeAllChildren(this.content);\r\n\r\n    if (this.hidden) {\r\n      return;\r\n    }\r\n\r\n    const selectedId = this.selector.value;\r\n    if (!selectedId) {\r\n      const message = document.createElement(\"div\");\r\n      message.textContent = this.msg(\"no-controllers\");\r\n      this.content.appendChild(message);\r\n      return;\r\n    }\r\n\r\n    const gamepadData = this.gamepadLib.gamepads.get(selectedId);\r\n    if (!gamepadData) {\r\n      // Users should never be able to see this\r\n      const message = document.createElement(\"div\");\r\n      message.textContent = `Cannot find controller: ${selectedId}`;\r\n      this.content.appendChild(message);\r\n      return;\r\n    }\r\n\r\n    this.buttonIdToElement.clear();\r\n    this.axisIdToElement.clear();\r\n\r\n    const mappingsContainer = document.createElement(\"div\");\r\n    mappingsContainer.className = \"gamepadlib-content-buttons\";\r\n    const buttonMappings = gamepadData.buttonMappings;\r\n    for (let i = 0; i < buttonMappings.length; i++) {\r\n      const container = document.createElement(\"div\");\r\n      container.className = \"gamepadlib-mapping\";\r\n      container.dataset.id = i;\r\n      const label = document.createElement(\"label\");\r\n      label.className = \"gamepadlib-mapping-label\";\r\n      label.textContent = this.msg(\"button-n\", { n: i });\r\n      const id = buttonHtmlId(i);\r\n      label.htmlFor = id;\r\n      const options = document.createElement(\"div\");\r\n      options.className = \"gamepadlib-mapping-options\";\r\n      const mappingInput = this.createButtonMapping(buttonMappings, i);\r\n      mappingInput.id = id;\r\n      options.appendChild(mappingInput);\r\n      container.appendChild(label);\r\n      container.appendChild(options);\r\n      mappingsContainer.appendChild(container);\r\n      this.buttonIdToElement.set(i, container);\r\n    }\r\n\r\n    const axesContainer = document.createElement(\"div\");\r\n    axesContainer.className = \"gamepadlib-content-axes\";\r\n    const axesMappings = gamepadData.axesMappings;\r\n    for (let i = 0; i < axesMappings.length; i += 2) {\r\n      const container = document.createElement(\"div\");\r\n      container.className = \"gamepadlib-axis\";\r\n      const label = document.createElement(\"label\");\r\n      label.textContent = this.msg(\"axes-a-b\", { a: i, b: i + 1 });\r\n      label.htmlFor = axisHtmlId(i);\r\n      const circle = document.createElement(\"div\");\r\n      circle.className = \"gamepadlib-axis-circle\";\r\n      const { circleOverlay, selector } = this.createAxisMapping(axesMappings, i);\r\n      circle.appendChild(circleOverlay);\r\n      const dot = document.createElement(\"div\");\r\n      dot.className = \"gamepadlib-axis-dot\";\r\n      circle.appendChild(dot);\r\n      container.appendChild(label);\r\n      container.appendChild(circle);\r\n      container.appendChild(selector);\r\n      axesContainer.appendChild(container);\r\n      this.axisIdToElement.set(i, dot);\r\n    }\r\n\r\n    this.content.appendChild(mappingsContainer);\r\n    this.content.appendChild(axesContainer);\r\n  }\r\n\r\n  update(gamepads) {\r\n    if (this.hidden) {\r\n      return;\r\n    }\r\n    const selectedId = this.selector.value;\r\n    if (!selectedId) {\r\n      return;\r\n    }\r\n    const gamepad = Array.from(gamepads).find((i) => i && getGamepadId(i) === this.selector.value);\r\n    if (!gamepad) {\r\n      return;\r\n    }\r\n    for (let i = 0; i < gamepad.buttons.length; i++) {\r\n      const element = this.buttonIdToElement.get(i);\r\n      if (element) {\r\n        const button = gamepad.buttons[i];\r\n        const value = button.value.toString();\r\n        if (value !== element.dataset.value) {\r\n          element.dataset.value = value;\r\n        }\r\n      }\r\n    }\r\n    for (let i = 0; i < gamepad.axes.length; i += 2) {\r\n      const element = this.axisIdToElement.get(i);\r\n      if (element) {\r\n        const x = gamepad.axes[i];\r\n        const y = gamepad.axes[i + 1] || 0;\r\n        const size = 150 / 2;\r\n        element.style.transform = `translate(-50%, -50%) translate(${x * size}px, ${y * size}px)`;\r\n      }\r\n    }\r\n  }\r\n\r\n  export() {\r\n    const selectedId = this.selector.value;\r\n    if (!selectedId) {\r\n      return null;\r\n    }\r\n    const gamepadData = this.gamepadLib.gamepads.get(selectedId);\r\n    if (!gamepadData) {\r\n      return null;\r\n    }\r\n    return {\r\n      axes: gamepadData.axesMappings.map(prepareAxisMappingForExport),\r\n      buttons: gamepadData.buttonMappings.map(prepareButtonMappingForExport),\r\n    };\r\n  }\r\n\r\n  changed() {\r\n    this.dispatchEvent(new CustomEvent(\"mapping-changed\"));\r\n  }\r\n\r\n  hide() {\r\n    this.hidden = true;\r\n    this.updateContent();\r\n  }\r\n\r\n  focus() {\r\n    if (this.selector.value) {\r\n      this.selector.focus();\r\n    }\r\n  }\r\n\r\n  generateEditor() {\r\n    this.hidden = false;\r\n    this.updateAllContent();\r\n    return this.root;\r\n  }\r\n}\r\n\r\nexport default GamepadLib;\r\n","/* inserted by pull.js */\nimport _twAsset0 from \"!url-loader!./active.png\";\nimport _twAsset1 from \"!url-loader!./close.svg\";\nimport _twAsset2 from \"!url-loader!./cursor.png\";\nimport _twAsset3 from \"!url-loader!./dot.svg\";\nimport _twAsset4 from \"!url-loader!./gamepad.svg\";\nconst _twGetAsset = (path) => {\n  if (path === \"/active.png\") return _twAsset0;\n  if (path === \"/close.svg\") return _twAsset1;\n  if (path === \"/cursor.png\") return _twAsset2;\n  if (path === \"/dot.svg\") return _twAsset3;\n  if (path === \"/gamepad.svg\") return _twAsset4;\n  throw new Error(`Unknown asset: ${path}`);\n};\n\nimport GamepadLib from \"./gamepadlib.js\";\r\n\r\nexport default async function ({ addon, global, console, msg }) {\r\n  const vm = addon.tab.traps.vm;\r\n\r\n  // Wait for the project to finish loading. Renderer and scripts will not be fully available until this happens.\r\n  await new Promise((resolve) => {\r\n    if (vm.editingTarget) return resolve();\r\n    vm.runtime.once(\"PROJECT_LOADED\", resolve);\r\n  });\r\n\r\n  const vmStarted = () => vm.runtime._steppingInterval !== null;\r\n\r\n  const scratchKeyToKey = (key) => {\r\n    switch (key) {\r\n      case \"right arrow\":\r\n        return \"ArrowRight\";\r\n      case \"up arrow\":\r\n        return \"ArrowUp\";\r\n      case \"left arrow\":\r\n        return \"ArrowLeft\";\r\n      case \"down arrow\":\r\n        return \"ArrowDown\";\r\n      case \"enter\":\r\n        return \"Enter\";\r\n      case \"space\":\r\n        return \" \";\r\n    }\r\n    return key.toLowerCase().charAt(0);\r\n  };\r\n  const getKeysUsedByProject = () => {\r\n    const allBlocks = [vm.runtime.getTargetForStage(), ...vm.runtime.targets]\r\n      .filter((i) => i.isOriginal)\r\n      .map((i) => i.blocks);\r\n    const result = new Set();\r\n    for (const blocks of allBlocks) {\r\n      for (const block of Object.values(blocks._blocks)) {\r\n        if (block.opcode === \"event_whenkeypressed\" || block.opcode === \"sensing_keyoptions\") {\r\n          // For blocks like \"key (my variable) pressed?\", the sensing_keyoptions still exists but has a null parent.\r\n          if (block.opcode === \"sensing_keyoptions\" && !block.parent) {\r\n            continue;\r\n          }\r\n          const key = block.fields.KEY_OPTION.value;\r\n          result.add(scratchKeyToKey(key));\r\n        }\r\n      }\r\n    }\r\n    return result;\r\n  };\r\n\r\n  const GAMEPAD_CONFIG_MAGIC = \" // _gamepad_\";\r\n  const findOptionsComment = () => {\r\n    const target = vm.runtime.getTargetForStage();\r\n    const comments = target.comments;\r\n    for (const comment of Object.values(comments)) {\r\n      if (comment.text.includes(GAMEPAD_CONFIG_MAGIC)) {\r\n        return comment;\r\n      }\r\n    }\r\n    return null;\r\n  };\r\n  const parseOptionsComment = () => {\r\n    const comment = findOptionsComment();\r\n    if (!comment) {\r\n      return null;\r\n    }\r\n    const lineWithMagic = comment.text.split(\"\\n\").find((i) => i.endsWith(GAMEPAD_CONFIG_MAGIC));\r\n    if (!lineWithMagic) {\r\n      console.warn(\"Gamepad comment does not contain valid line\");\r\n      return null;\r\n    }\r\n    const jsonText = lineWithMagic.substr(0, lineWithMagic.length - GAMEPAD_CONFIG_MAGIC.length);\r\n    let parsed;\r\n    try {\r\n      parsed = JSON.parse(jsonText);\r\n      if (!parsed || typeof parsed !== \"object\" || !Array.isArray(parsed.buttons) || !Array.isArray(parsed.axes)) {\r\n        throw new Error(\"Invalid data\");\r\n      }\r\n    } catch (e) {\r\n      console.warn(\"Gamepad comment has invalid JSON\", e);\r\n      return null;\r\n    }\r\n    return parsed;\r\n  };\r\n\r\n  GamepadLib.setConsole(console);\r\n  const gamepad = new GamepadLib();\r\n\r\n  gamepad.getHintsLazily = () => {\r\n    const parsedOptions = parseOptionsComment();\r\n    if (parsedOptions) {\r\n      return {\r\n        importedSettings: parsedOptions,\r\n      };\r\n    }\r\n    return {\r\n      usedKeys: getKeysUsedByProject(),\r\n    };\r\n  };\r\n  vm.runtime.on(\"PROJECT_LOADED\", () => {\r\n    gamepad.resetControls();\r\n  });\r\n\r\n  if (addon.settings.get(\"hide\")) {\r\n    await new Promise((resolve) => {\r\n      const end = () => {\r\n        addon.settings.removeEventListener(\"change\", listener);\r\n        resolve();\r\n      };\r\n      const listener = () => {\r\n        if (!addon.settings.get(\"hide\")) {\r\n          end();\r\n        }\r\n      };\r\n      gamepad.gamepadConnected().then(end);\r\n      addon.settings.addEventListener(\"change\", listener);\r\n    });\r\n  }\r\n\r\n  const renderer = vm.runtime.renderer;\r\n  const width = renderer._xRight - renderer._xLeft;\r\n  const height = renderer._yTop - renderer._yBottom;\r\n  const canvas = renderer.canvas;\r\n\r\n  const container = document.createElement(\"div\");\r\n  container.className = \"sa-gamepad-container\";\r\n  addon.tab.displayNoneWhileDisabled(container, { display: \"flex\" });\r\n  const buttonContainer = document.createElement(\"span\");\r\n  buttonContainer.className = addon.tab.scratchClass(\"button_outlined-button\", \"stage-header_stage-button\");\r\n  const buttonContent = document.createElement(\"div\");\r\n  buttonContent.className = addon.tab.scratchClass(\"button_content\");\r\n  const buttonImage = document.createElement(\"img\");\r\n  buttonImage.className = addon.tab.scratchClass(\"stage-header_stage-button-icon\");\r\n  buttonImage.draggable = false;\r\n  buttonImage.src = _twGetAsset(\"/gamepad.svg\");\r\n  buttonContent.appendChild(buttonImage);\r\n  buttonContainer.appendChild(buttonContent);\r\n  container.appendChild(buttonContainer);\r\n\r\n  let editor;\r\n  let shouldStoreSettingsInProject = false;\r\n  const didChangeProject = () => {\r\n    vm.runtime.emitProjectChanged();\r\n    if (vm.editingTarget === vm.runtime.getTargetForStage()) {\r\n      vm.emitWorkspaceUpdate();\r\n    }\r\n  };\r\n  const storeMappings = () => {\r\n    const exported = editor.export();\r\n    if (!exported) {\r\n      console.warn(\"Could not export gamepad settings\");\r\n      return;\r\n    }\r\n    const text = `${msg(\"config-header\")}\\n${JSON.stringify(exported)}${GAMEPAD_CONFIG_MAGIC}`;\r\n    const existingComment = findOptionsComment();\r\n    if (existingComment) {\r\n      existingComment.text = text;\r\n    } else {\r\n      const target = vm.runtime.getTargetForStage();\r\n      target.createComment(\r\n        // comment ID, just has to be a random string\r\n        Math.random() + \"\",\r\n        // block ID\r\n        null,\r\n        // text\r\n        text,\r\n        // x, y, width, height\r\n        50,\r\n        50,\r\n        350,\r\n        150,\r\n        // minimized\r\n        false\r\n      );\r\n    }\r\n    didChangeProject();\r\n  };\r\n  const removeMappings = () => {\r\n    const comment = findOptionsComment();\r\n    if (comment) {\r\n      const target = vm.runtime.getTargetForStage();\r\n      delete target.comments[comment.id];\r\n      didChangeProject();\r\n    }\r\n  };\r\n  const handleEditorChanged = () => {\r\n    if (shouldStoreSettingsInProject) {\r\n      storeMappings();\r\n    }\r\n  };\r\n  const handleStoreSettingsCheckboxChanged = (e) => {\r\n    shouldStoreSettingsInProject = !!e.target.checked;\r\n    if (shouldStoreSettingsInProject) {\r\n      storeMappings();\r\n    } else {\r\n      removeMappings();\r\n    }\r\n  };\r\n  const handleEditorControllerChanged = () => {\r\n    document.body.classList.toggle(\"sa-gamepad-has-controller\", editor.hasControllerSelected());\r\n    handleEditorChanged();\r\n  };\r\n  buttonContainer.addEventListener(\"click\", () => {\r\n    if (!editor) {\r\n      editor = gamepad.editor();\r\n      editor.msg = msg;\r\n      editor.addEventListener(\"mapping-changed\", handleEditorChanged);\r\n      editor.addEventListener(\"gamepad-changed\", handleEditorControllerChanged);\r\n    }\r\n    const editorEl = editor.generateEditor();\r\n    handleEditorControllerChanged();\r\n\r\n    const close = () => {\r\n      modalOverlay.remove();\r\n      document.body.removeEventListener(\"click\", handleClickOutside, true);\r\n      window.removeEventListener(\"keydown\", handleKeyDown);\r\n      addon.self.removeEventListener(\"disabled\", close);\r\n      editor.hide();\r\n    };\r\n    const handleClickOutside = (e) => {\r\n      if (!modalContentContainer.contains(e.target)) {\r\n        close();\r\n      }\r\n    };\r\n    const handleKeyDown = (e) => {\r\n      if (e.key === \"Escape\" && !e.target.closest(\"[data-accepting-input]\")) {\r\n        close();\r\n      }\r\n    };\r\n    document.body.addEventListener(\"click\", handleClickOutside, true);\r\n    window.addEventListener(\"keydown\", handleKeyDown);\r\n    addon.self.addEventListener(\"disabled\", close);\r\n\r\n    const modalOverlay = document.createElement(\"div\");\r\n    modalOverlay.className = addon.tab.scratchClass(\"modal_modal-overlay\", { others: \"sa-gamepad-popup-outer\" });\r\n    const modalContentContainer = document.createElement(\"div\");\r\n    modalContentContainer.className = addon.tab.scratchClass(\"modal_modal-content\", { others: \"sa-gamepad-popup\" });\r\n\r\n    const modalHeaderContainer = document.createElement(\"div\");\r\n    modalHeaderContainer.className = addon.tab.scratchClass(\"modal_header\");\r\n    const modalHeaderText = document.createElement(\"div\");\r\n    modalHeaderText.className = addon.tab.scratchClass(\"modal_header-item\", \"modal_header-item-title\");\r\n    modalHeaderText.textContent = msg(\"settings\");\r\n    modalHeaderContainer.appendChild(modalHeaderText);\r\n\r\n    const closeContainer = document.createElement(\"div\");\r\n    closeContainer.className = addon.tab.scratchClass(\"modal_header-item\", \"modal_header-item-close\");\r\n    const closeButton = document.createElement(\"div\");\r\n    closeButton.className = addon.tab.scratchClass(\"close-button_close-button\", \"close-button_large\");\r\n    closeButton.tabIndex = \"0\";\r\n    closeButton.setAttribute(\"role\", \"button\");\r\n    const closeImage = document.createElement(\"img\");\r\n    closeImage.className = addon.tab.scratchClass(\"close-button_close-icon\");\r\n    closeImage.src = _twGetAsset(\"/close.svg\");\r\n    closeButton.appendChild(closeImage);\r\n    closeContainer.appendChild(closeButton);\r\n    modalHeaderContainer.appendChild(closeContainer);\r\n    closeButton.addEventListener(\"click\", close);\r\n\r\n    const modalContent = document.createElement(\"div\");\r\n    modalContent.className = \"sa-gamepad-popup-content\";\r\n    if (GamepadLib.browserHasBrokenGamepadAPI()) {\r\n      const warning = document.createElement(\"div\");\r\n      warning.textContent = msg(\"browser-support\");\r\n      warning.className = \"sa-gamepad-browser-support-warning\";\r\n      modalContent.appendChild(warning);\r\n    }\r\n    modalContent.appendChild(editorEl);\r\n\r\n    const storeSettingsLabel = document.createElement(\"label\");\r\n    storeSettingsLabel.className = \"sa-gamepad-store-settings\";\r\n    storeSettingsLabel.textContent = msg(\"store-in-project\");\r\n    const storeSettingsCheckbox = document.createElement(\"input\");\r\n    storeSettingsCheckbox.type = \"checkbox\";\r\n    storeSettingsCheckbox.checked = shouldStoreSettingsInProject;\r\n    storeSettingsCheckbox.addEventListener(\"change\", handleStoreSettingsCheckboxChanged);\r\n    storeSettingsLabel.prepend(storeSettingsCheckbox);\r\n    modalContent.appendChild(storeSettingsLabel);\r\n\r\n    modalContentContainer.appendChild(modalHeaderContainer);\r\n    modalContentContainer.appendChild(modalContent);\r\n    modalOverlay.appendChild(modalContentContainer);\r\n    document.body.appendChild(modalOverlay);\r\n\r\n    editor.focus();\r\n  });\r\n\r\n  if (addon.tab.redux.state && addon.tab.redux.state.scratchGui.stageSize.stageSize === \"small\") {\r\n    document.body.classList.add(\"sa-gamepad-small\");\r\n  }\r\n  document.addEventListener(\r\n    \"click\",\r\n    (e) => {\r\n      if (e.target.closest(\"[class*='stage-header_stage-button-first']\")) {\r\n        document.body.classList.add(\"sa-gamepad-small\");\r\n      } else if (e.target.closest(\"[class*='stage-header_stage-button-last']\")) {\r\n        document.body.classList.remove(\"sa-gamepad-small\");\r\n      }\r\n    },\r\n    { capture: true }\r\n  );\r\n\r\n  const virtualCursorElement = document.createElement(\"img\");\r\n  virtualCursorElement.hidden = true;\r\n  virtualCursorElement.className = \"sa-gamepad-cursor\";\r\n  virtualCursorElement.src = _twGetAsset(\"/cursor.png\");\r\n  addon.self.addEventListener(\"disabled\", () => {\r\n    virtualCursorElement.hidden = true;\r\n  });\r\n\r\n  let hideCursorTimeout;\r\n\r\n  const hideRealCursor = () => {\r\n    document.body.classList.add(\"sa-gamepad-hide-cursor\");\r\n  };\r\n  const showRealCursor = () => {\r\n    document.body.classList.remove(\"sa-gamepad-hide-cursor\");\r\n  };\r\n  const virtualCursorSetVisible = (visible) => {\r\n    virtualCursorElement.hidden = !visible;\r\n    clearTimeout(hideCursorTimeout);\r\n    if (visible) {\r\n      hideRealCursor();\r\n      hideCursorTimeout = setTimeout(virtualCursorHide, 8000);\r\n    }\r\n  };\r\n  const virtualCursorHide = () => {\r\n    virtualCursorSetVisible(false);\r\n  };\r\n  const virtualCursorSetDown = (down) => {\r\n    virtualCursorSetVisible(true);\r\n    virtualCursorElement.classList.toggle(\"sa-gamepad-cursor-down\", down);\r\n  };\r\n  const virtualCursorSetPosition = (x, y) => {\r\n    virtualCursorSetVisible(true);\r\n    const CURSOR_SIZE = 6;\r\n    const stageX = width / 2 + x - CURSOR_SIZE / 2;\r\n    const stageY = height / 2 - y - CURSOR_SIZE / 2;\r\n    virtualCursorElement.style.transform = `translate(${stageX}px, ${stageY}px)`;\r\n  };\r\n\r\n  document.addEventListener(\"mousemove\", () => {\r\n    virtualCursorSetVisible(false);\r\n    showRealCursor();\r\n  });\r\n\r\n  let getCanvasSize;\r\n  // Support modern ResizeObserver and slow getBoundingClientRect version for improved browser support (matters for TurboWarp)\r\n  if (window.ResizeObserver) {\r\n    let canvasWidth = width;\r\n    let canvasHeight = height;\r\n    const resizeObserver = new ResizeObserver((entries) => {\r\n      for (const entry of entries) {\r\n        canvasWidth = entry.contentRect.width;\r\n        canvasHeight = entry.contentRect.height;\r\n      }\r\n    });\r\n    resizeObserver.observe(canvas);\r\n    getCanvasSize = () => [canvasWidth, canvasHeight];\r\n  } else {\r\n    getCanvasSize = () => {\r\n      const rect = canvas.getBoundingClientRect();\r\n      return [rect.width, rect.height];\r\n    };\r\n  }\r\n\r\n  // Both in Scratch space\r\n  let virtualX = 0;\r\n  let virtualY = 0;\r\n  const postMouseData = (data) => {\r\n    if (addon.self.disabled || !vmStarted()) return;\r\n    const [rectWidth, rectHeight] = getCanvasSize();\r\n    vm.postIOData(\"mouse\", {\r\n      ...data,\r\n      canvasWidth: rectWidth,\r\n      canvasHeight: rectHeight,\r\n      x: (virtualX + width / 2) * (rectWidth / width),\r\n      y: (height / 2 - virtualY) * (rectHeight / height),\r\n    });\r\n  };\r\n  const postKeyboardData = (key, isDown) => {\r\n    if (addon.self.disabled || !vmStarted()) return;\r\n    vm.postIOData(\"keyboard\", {\r\n      key,\r\n      isDown,\r\n    });\r\n  };\r\n  const handleGamepadButtonDown = (e) => postKeyboardData(e.detail, true);\r\n  const handleGamepadButtonUp = (e) => postKeyboardData(e.detail, false);\r\n  const handleGamepadMouseDown = (e) => {\r\n    virtualCursorSetDown(true);\r\n    postMouseData({\r\n      isDown: true,\r\n      button: e.detail,\r\n    });\r\n  };\r\n  const handleGamepadMouseUp = (e) => {\r\n    virtualCursorSetDown(false);\r\n    postMouseData({\r\n      isDown: false,\r\n      button: e.detail,\r\n    });\r\n  };\r\n  const handleGamepadMouseMove = (e) => {\r\n    virtualX = e.detail.x;\r\n    virtualY = e.detail.y;\r\n    virtualCursorSetPosition(virtualX, virtualY);\r\n    postMouseData({});\r\n  };\r\n\r\n  gamepad.virtualCursor.maxX = renderer._xRight;\r\n  gamepad.virtualCursor.minX = renderer._xLeft;\r\n  gamepad.virtualCursor.maxY = renderer._yTop;\r\n  gamepad.virtualCursor.minY = renderer._yBottom;\r\n  gamepad.addEventListener(\"keydown\", handleGamepadButtonDown);\r\n  gamepad.addEventListener(\"keyup\", handleGamepadButtonUp);\r\n  gamepad.addEventListener(\"mousedown\", handleGamepadMouseDown);\r\n  gamepad.addEventListener(\"mouseup\", handleGamepadMouseUp);\r\n  gamepad.addEventListener(\"mousemove\", handleGamepadMouseMove);\r\n\r\n  while (true) {\r\n    const target = await addon.tab.waitForElement(\r\n      '[class^=\"stage-header_stage-size-row\"], [class^=\"stage-header_stage-menu-wrapper\"] > [class^=\"button_outlined-button\"]',\r\n      {\r\n        markAsSeen: true,\r\n        reduxEvents: [\r\n          \"scratch-gui/mode/SET_PLAYER\",\r\n          \"scratch-gui/mode/SET_FULL_SCREEN\",\r\n          \"fontsLoaded/SET_FONTS_LOADED\",\r\n          \"scratch-gui/locales/SELECT_LOCALE\",\r\n        ],\r\n      }\r\n    );\r\n    container.dataset.editorMode = addon.tab.editorMode;\r\n    if (target.className.includes(\"stage-size-row\")) {\r\n      addon.tab.appendToSharedSpace({ space: \"stageHeader\", element: container, order: 1 });\r\n    } else {\r\n      addon.tab.appendToSharedSpace({ space: \"fullscreenStageHeader\", element: container, order: 0 });\r\n    }\r\n\r\n    const monitorListScaler = document.querySelector(\"[class^='monitor-list_monitor-list-scaler']\");\r\n    monitorListScaler.appendChild(virtualCursorElement);\r\n  }\r\n}\r\n"],"mappings":";;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;ACRA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACPA;AAAA;;;;;;;;;;;;ACAA;AAAA;;;;;;;;;;;;ACAA;AAAA;;;;;;;;;;;;ACAA;AAAA;;;;;;;;;;;;ACAA;AAAA;;;;;;;;;;;;ACAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAHA;;;;;;;;;;;ACJA;;;;;;;;;;;;ACAA;AAAA;AAAA;AAAA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAJA;AAOA;AACA;AACA;AACA;AAJA;AAOA;AAEA;AACA;AACA;AACA;AAJA;AAOA;AACA;AACA;AACA;AAJA;AAOA;AAEA;AACA;AACA;AACA;AACA;AALA;AAQA;AACA;AACA;AACA;AACA;AALA;AArCA;AACA;AA8CA;AACA;AACA;AACA;AAHA;AACA;AAIA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAEA;AAHA;AACA;AAKA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAEA;AAIA;AACA;AAUA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AANA;AAQA;AACA;AACA;AACA;AACA;AACA;AACA;AANA;AAQA;AACA;AACA;AACA;AACA;AACA;AACA;AANA;AAQA;AACA;AACA;AACA;AACA;AACA;AACA;AANA;AAQA;AACA;AACA;AACA;AACA;AACA;AALA;AAOA;AACA;AACA;AACA;AACA;AAJA;AAMA;AACA;AACA;AACA;AACA;AAJA;AAMA;AACA;AACA;AACA;AACA;AACA;AALA;AAOA;AACA;AACA;AACA;AACA;AACA;AACA;AANA;AAQA;AACA;AACA;AACA;AACA;AACA;AACA;AANA;AACA;AAQA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AALA;AAOA;AACA;AACA;AACA;AACA;AACA;AALA;AAOA;AACA;AACA;AACA;AACA;AACA;AALA;AAOA;AACA;AACA;AACA;AACA;AACA;AALA;AAOA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AA9OA;AACA;AA+OA;AACA;AACA;AACA;AAHA;AACA;AAKA;AACA;AACA;AAEA;AACA;AAAA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAPA;AAUA;AAEA;AAEA;AAEA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AACA;AACA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AACA;AACA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AAEA;AAEA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAhQA;AACA;AAiQA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AADA;AACA;AACA;AAEA;AACA;AACA;AADA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AAEA;AACA;AAAA;AAEA;AACA;AADA;AAGA;AACA;AADA;AAGA;AACA;AADA;AAIA;AACA;AAEA;AACA;AAEA;AACA;AACA;AAEA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAFA;AAKA;AAEA;AACA;AAFA;AAKA;AAEA;AACA;AACA;AAHA;AAMA;AAEA;AACA;AAFA;AAKA;AAEA;AACA;AAFA;AACA;AAKA;AACA;AACA;AAMA;AACA;AAMA;AACA;AAMA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAEA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAEA;AACA;AACA;AAFA;AAIA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AAFA;AAIA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAjcA;AACA;AAkcA;;;;;;;;;;;;;;;;;;;;;;;;;AC3mCA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AAZA;AACA;AAaA;AACA;AACA;AAAA;AACA;AAGA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AADA;AAGA;AACA;AAAA;AACA;AADA;AAGA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAEA;AAEA;AAEA;AAEA;AAKA;AAEA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAEA;AACA;AAAA;AAAA;AACA;AACA;AAAA;AAAA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AALA;AAOA;AACA;AAAA;AACA;AACA;AACA;AACA;AAFA;AAIA;AACA;AAAA;AACA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AAFA;AAIA;AACA;AAAA;AACA;AACA;AACA;AACA;AAFA;AAIA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAGA;AACA;AAFA;AAUA;AACA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;;;;A","sourceRoot":""}