{"version":3,"file":"js/addon-default-entry.js","sources":["webpack://GUI/./src/addons/addons/color-picker/style.css","webpack://GUI/./src/addons/addons/editor-comment-previews/userstyle.css","webpack://GUI/./src/addons/addons/editor-devtools/userscript.css","webpack://GUI/./src/addons/addons/editor-searchable-dropdowns/userscript.css","webpack://GUI/./src/addons/addons/folders/style.css","webpack://GUI/./src/addons/addons/onion-skinning/style.css","webpack://GUI/./src/addons/addons/editor-devtools/icon--close.svg","webpack://GUI/./src/addons/addons/folders/folder.svg","webpack://GUI/./src/addons/addons/onion-skinning/decrement.svg","webpack://GUI/./src/addons/addons/onion-skinning/increment.svg","webpack://GUI/./src/addons/addons/onion-skinning/settings.svg","webpack://GUI/./src/addons/addons/onion-skinning/toggle.svg","webpack://GUI/./src/addons/addons/bitmap-copy/_runtime_entry.js","webpack://GUI/./src/addons/addons/bitmap-copy/userscript.js","webpack://GUI/./src/addons/addons/block-cherry-picking/_runtime_entry.js","webpack://GUI/./src/addons/addons/block-cherry-picking/userscript.js","webpack://GUI/./src/addons/addons/block-duplicate/_runtime_entry.js","webpack://GUI/./src/addons/addons/block-duplicate/userscript.js","webpack://GUI/./src/addons/addons/block-switching/_runtime_entry.js","webpack://GUI/./src/addons/addons/block-switching/blockToDom.js","webpack://GUI/./src/addons/addons/block-switching/userscript.js","webpack://GUI/./src/addons/addons/color-picker/_runtime_entry.js","webpack://GUI/./src/addons/addons/color-picker/code-editor.js","webpack://GUI/./src/addons/addons/color-picker/userscript.js","webpack://GUI/./src/addons/addons/editor-comment-previews/_runtime_entry.js","webpack://GUI/./src/addons/addons/editor-comment-previews/userscript.js","webpack://GUI/./src/addons/addons/editor-devtools/BlockInstance.js","webpack://GUI/./src/addons/addons/editor-devtools/BlockItem.js","webpack://GUI/./src/addons/addons/editor-devtools/DevTools.js","webpack://GUI/./src/addons/addons/editor-devtools/DomHelpers.js","webpack://GUI/./src/addons/addons/editor-devtools/XML.js","webpack://GUI/./src/addons/addons/editor-devtools/_runtime_entry.js","webpack://GUI/./src/addons/addons/editor-devtools/blockly/BlockFlasher.js","webpack://GUI/./src/addons/addons/editor-devtools/blockly/UndoGroup.js","webpack://GUI/./src/addons/addons/editor-devtools/blockly/Utils.js","webpack://GUI/./src/addons/addons/editor-devtools/userscript.js","webpack://GUI/./src/addons/addons/editor-searchable-dropdowns/_runtime_entry.js","webpack://GUI/./src/addons/addons/editor-searchable-dropdowns/userscript.js","webpack://GUI/./src/addons/addons/folders/_runtime_entry.js","webpack://GUI/./src/addons/addons/folders/userscript.js","webpack://GUI/./src/addons/addons/move-to-top-bottom/_runtime_entry.js","webpack://GUI/./src/addons/addons/move-to-top-bottom/userscript.js","webpack://GUI/./src/addons/addons/onion-skinning/_runtime_entry.js","webpack://GUI/./src/addons/addons/onion-skinning/userscript.js","webpack://GUI/./src/addons/libraries/common/cs/normalize-color.js","webpack://GUI/./src/addons/libraries/common/cs/rate-limiter.js","webpack://GUI/./src/addons/libraries/thirdparty/cs/tinycolor-min.js"],"sourcesContent":["exports = module.exports = require(\"../../../../node_modules/css-loader/lib/css-base.js\")(false);\n// imports\n\n\n// module\nexports.push([module.id, \".sa-color-picker {\\r\\n  display: flex;\\r\\n}\\r\\n\\r\\n.sa-color-picker-code {\\r\\n  margin: 8px 0;\\r\\n}\\r\\n\\r\\n.sa-color-picker-paint {\\r\\n  margin-top: 16px;\\r\\n  margin-bottom: 4px;\\r\\n}\\r\\n\\r\\n.sa-color-picker > .sa-color-picker-color {\\r\\n  border: none;\\r\\n  border-top-left-radius: 1rem;\\r\\n  border-bottom-left-radius: 1rem;\\r\\n  padding: 0;\\r\\n  padding-left: 0.6rem;\\r\\n  padding-right: 0.4rem;\\r\\n  margin-left: 0.5rem;\\r\\n  outline: none;\\r\\n  box-sizing: border-box;\\r\\n  width: 3rem;\\r\\n  height: 2rem;\\r\\n}\\r\\n[theme=\\\"dark\\\"] .sa-color-picker > .sa-color-picker-color {\\r\\n  background: var(--ui-secondary);\\r\\n}\\r\\n\\r\\n.sa-color-picker > .sa-color-picker-text {\\r\\n  box-sizing: border-box;\\r\\n  width: calc(150px - 3rem);\\r\\n  border-top-left-radius: 0;\\r\\n  border-bottom-left-radius: 0;\\r\\n}\\r\\n\\r\\n[dir=\\\"rtl\\\"] .sa-color-picker > .sa-color-picker-color {\\r\\n  border-top-left-radius: 0;\\r\\n  border-bottom-left-radius: 0;\\r\\n  border-top-right-radius: 1rem;\\r\\n  border-bottom-right-radius: 1rem;\\r\\n  margin-left: 0;\\r\\n  margin-right: 0.5rem;\\r\\n}\\r\\n\\r\\n[dir=\\\"rtl\\\"] .sa-color-picker > .sa-color-picker-text {\\r\\n  border-top-left-radius: 1rem;\\r\\n  border-bottom-left-radius: 1rem;\\r\\n  border-top-right-radius: 0;\\r\\n  border-bottom-right-radius: 0;\\r\\n}\\r\\n\\r\\nbody.sa-hide-eye-dropper-background div[class*=\\\"stage_color-picker-background\\\"] {\\r\\n  /* Do not show eye dropper background if the color picker is \\\"fake\\\" */\\r\\n  display: none;\\r\\n}\\r\\n\", \"\"]);\n\n// exports\n","exports = module.exports = require(\"../../../../node_modules/css-loader/lib/css-base.js\")(false);\n// imports\n\n\n// module\nexports.push([module.id, \".sa-comment-preview-outer {\\r\\n  position: fixed;\\r\\n  top: 0;\\r\\n  left: 0;\\r\\n  z-index: 100000000;\\r\\n  pointer-events: none;\\r\\n}\\r\\n\\r\\n.sa-comment-preview-inner {\\r\\n  width: calc(200px - 16px);\\r\\n  max-height: calc(132px - 8px);\\r\\n  padding: 8px;\\r\\n  overflow: hidden;\\r\\n\\r\\n  font-size: 12px;\\r\\n  white-space: pre-wrap;\\r\\n  pointer-events: none;\\r\\n\\r\\n  color: rgb(87, 94, 117);\\r\\n  background-color: rgb(255 255 255 / 90%);\\r\\n  border-style: none;\\r\\n  border-radius: 8px;\\r\\n  filter: drop-shadow(0px 5px 5px rgb(0 0 0 / 10%));\\r\\n\\r\\n  transform: perspective(200px);\\r\\n}\\r\\n\\r\\n@supports (backdrop-filter: blur(16px)) {\\r\\n  .sa-comment-preview-inner {\\r\\n    background-color: rgb(255 255 255 / 75%);\\r\\n    backdrop-filter: blur(16px);\\r\\n  }\\r\\n}\\r\\n\\r\\n.sa-comment-preview-fade {\\r\\n  transition: opacity 0.1s, filter 0.1s, transform 0.1s linear;\\r\\n}\\r\\n\\r\\n.sa-comment-preview-hidden {\\r\\n  opacity: 0;\\r\\n  filter: none;\\r\\n  transform: perspective(200px) translateZ(-20px);\\r\\n}\\r\\n\\r\\n.sa-comment-preview-reduce-transparency {\\r\\n  background-color: rgb(255 255 255);\\r\\n  backdrop-filter: none;\\r\\n}\\r\\n\", \"\"]);\n\n// exports\n","exports = module.exports = require(\"../../../../node_modules/css-loader/lib/css-base.js\")(false);\n// imports\n\n\n// module\nexports.push([module.id, \"#s3devToolBar {\\r\\n  display: flex;\\r\\n  white-space: nowrap;\\r\\n  font-family: \\\"Helvetica Neue\\\", Helvetica, Arial, sans-serif;\\r\\n}\\r\\n\\r\\n.s3devLabel {\\r\\n  display: flex;\\r\\n  padding-right: 2em;\\r\\n}\\r\\n\\r\\n[dir=\\\"rtl\\\"] .s3devLabel {\\r\\n  padding-right: 0;\\r\\n  padding-left: 2em;\\r\\n}\\r\\n\\r\\n.s3devLabel > span:first-child {\\r\\n  margin-left: 1.5em;\\r\\n  margin-right: 1em;\\r\\n  font-weight: bold;\\r\\n  font-size: 0.625rem;\\r\\n  user-select: none;\\r\\n  cursor: default;\\r\\n  white-space: nowrap;\\r\\n  padding-top: 2px;\\r\\n}\\r\\n\\r\\n[dir=\\\"rtl\\\"] .s3devLabel > span:first-child {\\r\\n  margin-right: 1.5em;\\r\\n  margin-left: 1em;\\r\\n}\\r\\n\\r\\n.s3devAction {\\r\\n  transition: opacity 200ms ease-in;\\r\\n  /*font-weight: bold;*/\\r\\n  opacity: 0;\\r\\n}\\r\\n\\r\\n.s3devLabel:hover .s3devAction {\\r\\n  opacity: 0.7;\\r\\n}\\r\\n\\r\\n/* Wrapper around find button and drop down */\\r\\n.s3devWrap {\\r\\n  overflow: visible;\\r\\n  /*margin-left:3em;*/\\r\\n  position: relative;\\r\\n}\\r\\n\\r\\n#s3devFind {\\r\\n  height: 2rem;\\r\\n}\\r\\n\\r\\n/* Find Input Box */\\r\\ninput.s3devInp {\\r\\n  min-width: 100%;\\r\\n  box-sizing: border-box !important;\\r\\n  /* !important required for extension, because CSS injection method (and hence order) differs from addon */\\r\\n  height: 1.5rem;\\r\\n\\r\\n  /* Change Scratch default styles */\\r\\n  border-radius: 0.25rem;\\r\\n  font-size: 0.75rem;\\r\\n  padding-left: 0.4em;\\r\\n}\\r\\n[theme=\\\"dark\\\"] input.s3devInp {\\r\\n  color: #eee;\\r\\n  background: #3333;\\r\\n}\\r\\n[theme=\\\"dark\\\"] input.s3devInp:hover {\\r\\n  background: #333;\\r\\n}\\r\\n\\r\\ninput.s3devInp:focus {\\r\\n  /* Change Scratch default styles */\\r\\n  box-shadow: none;\\r\\n}\\r\\n\\r\\n/* Drop down from find button */\\r\\n#s3devDDOut {\\r\\n  top: -6px;\\r\\n}\\r\\n\\r\\n/* Drop down from find button */\\r\\ndiv.s3devDDOut {\\r\\n  z-index: 100;\\r\\n  left: 0;\\r\\n  width: 16em;\\r\\n  position: relative;\\r\\n  /*padding: 2.2em 0 0;*/\\r\\n  /*background-color: white;*/\\r\\n  padding: 4px;\\r\\n}\\r\\n\\r\\n/* Drop down from find button */\\r\\nul.s3devDD {\\r\\n  display: none;\\r\\n  position: relative;\\r\\n  padding: 0.2em 0;\\r\\n  font-size: 0.75rem;\\r\\n  line-height: 1;\\r\\n  overflow-y: auto;\\r\\n  min-height: 128px;\\r\\n  max-height: 65vh;\\r\\n  user-select: none;\\r\\n  max-width: 100%;\\r\\n}\\r\\n\\r\\ndiv.s3devDDOut.vis {\\r\\n  /*box-shadow: 0 2px 3px rgba(0,0,0,0.3), 0 5px 8px rgba(0,0,0,0.2);*/\\r\\n  box-shadow: 0px 0px 8px 1px rgba(0, 0, 0, 0.3);\\r\\n  background-color: white;\\r\\n  border: none;\\r\\n  border-radius: 4px;\\r\\n}\\r\\n[theme=\\\"dark\\\"] div.s3devDDOut.vis {\\r\\n  background-color: #111;\\r\\n}\\r\\n\\r\\ndiv.s3devDDOut.vis ul.s3devDD {\\r\\n  display: block;\\r\\n  border: none;\\r\\n}\\r\\n\\r\\n/* Drop down items */\\r\\n.s3devDD > li {\\r\\n  display: block;\\r\\n  padding: 0.5em 0.3em;\\r\\n  white-space: nowrap;\\r\\n  margin: 0;\\r\\n  font-weight: bold;\\r\\n  text-overflow: ellipsis;\\r\\n  overflow: hidden;\\r\\n}\\r\\n\\r\\n.s3devDD > li > b {\\r\\n  background-color: #aaffaa;\\r\\n  color: black;\\r\\n}\\r\\n\\r\\n/* Drop down items */\\r\\n.s3devDD > li:hover,\\r\\n.s3devDD > li.sel {\\r\\n  color: white;\\r\\n  cursor: pointer;\\r\\n}\\r\\n\\r\\n#s3devDD > li::before {\\r\\n  content: \\\"\\\\25CF   \\\"; /* ● */\\r\\n}\\r\\n\\r\\n.define {\\r\\n  color: rgb(255, 102, 128);\\r\\n}\\r\\n.define:hover,\\r\\n.define.sel {\\r\\n  background-color: rgb(255, 102, 128);\\r\\n}\\r\\n\\r\\n.flag {\\r\\n  color: #4cbf56;\\r\\n}\\r\\n.flag:hover,\\r\\n.flag.sel {\\r\\n  background-color: #4cbf56;\\r\\n}\\r\\n\\r\\n.receive {\\r\\n  color: rgb(255, 191, 0);\\r\\n}\\r\\n.receive:hover,\\r\\n.receive.sel {\\r\\n  background-color: rgb(255, 191, 0);\\r\\n}\\r\\n\\r\\n.event {\\r\\n  color: rgb(255, 191, 0);\\r\\n}\\r\\n.event:hover,\\r\\n.event.sel {\\r\\n  background-color: rgb(255, 191, 0);\\r\\n}\\r\\n\\r\\n.var,\\r\\n.VAR {\\r\\n  color: rgb(255, 120, 26);\\r\\n}\\r\\n.var:hover,\\r\\n.var.sel,\\r\\n.VAR:hover,\\r\\n.VAR.sel {\\r\\n  background-color: rgb(255, 120, 26);\\r\\n}\\r\\n\\r\\n.list,\\r\\n.LIST {\\r\\n  color: rgb(255, 102, 26);\\r\\n}\\r\\n.list:hover,\\r\\n.list.sel,\\r\\n.LIST:hover,\\r\\n.LIST.sel {\\r\\n  background-color: rgb(255, 102, 26);\\r\\n}\\r\\n\\r\\n.costume {\\r\\n  color: rgb(26, 66, 255);\\r\\n}\\r\\n.costume:hover,\\r\\n.costume.sel {\\r\\n  background-color: rgb(26, 66, 255);\\r\\n}\\r\\n\\r\\n.operators {\\r\\n  background-color: rgb(64, 191, 74);\\r\\n  color: rgb(56, 148, 56);\\r\\n}\\r\\n.operators:hover,\\r\\n.operators.sel {\\r\\n  background-color: rgb(56, 148, 56);\\r\\n}\\r\\n\\r\\n.data {\\r\\n  background-color: rgb(255, 140, 26);\\r\\n  color: rgb(219, 110, 0);\\r\\n}\\r\\n.data:hover,\\r\\n.data.sel {\\r\\n  background-color: rgb(219, 110, 0);\\r\\n}\\r\\n\\r\\n.data-lists {\\r\\n  background-color: rgb(255, 102, 26);\\r\\n  color: rgb(255, 102, 26);\\r\\n}\\r\\n.data-lists:hover,\\r\\n.data-lists.sel {\\r\\n  background-color: rgb(207, 81, 20);\\r\\n}\\r\\n\\r\\n.sensing {\\r\\n  background-color: rgb(76, 191, 230);\\r\\n  color: rgb(46, 142, 184);\\r\\n}\\r\\n.sensing:hover,\\r\\n.sensing.sel {\\r\\n  background-color: rgb(46, 142, 184);\\r\\n}\\r\\n\\r\\n.looks {\\r\\n  background-color: rgb(153, 102, 255);\\r\\n  color: rgb(119, 77, 203);\\r\\n}\\r\\n.looks:hover,\\r\\n.looks.sel {\\r\\n  background-color: rgb(119, 77, 203);\\r\\n}\\r\\n\\r\\n.sounds {\\r\\n  background-color: rgb(214, 92, 214);\\r\\n  color: rgb(189, 66, 189);\\r\\n}\\r\\n.sounds:hover,\\r\\n.sounds.sel {\\r\\n  background-color: rgb(189, 66, 189);\\r\\n}\\r\\n\\r\\n.motion {\\r\\n  background-color: rgb(76, 151, 255);\\r\\n  color: rgb(51, 115, 204);\\r\\n}\\r\\n.motion:hover,\\r\\n.motion.sel {\\r\\n  background-color: rgb(51, 115, 204);\\r\\n}\\r\\n\\r\\n.events {\\r\\n  background-color: rgb(255, 213, 0);\\r\\n  color: rgb(204, 153, 0);\\r\\n}\\r\\n.events:hover,\\r\\n.events.sel {\\r\\n  background-color: rgb(204, 153, 0);\\r\\n}\\r\\n\\r\\n.control {\\r\\n  background-color: rgb(255, 171, 25);\\r\\n  color: rgb(207, 139, 23);\\r\\n}\\r\\n.control:hover,\\r\\n.control.sel {\\r\\n  background-color: rgb(207, 139, 23);\\r\\n}\\r\\n\\r\\n.TurboWarp {\\r\\n  background-color: #ff4c4c;\\r\\n  color: rgb(207, 139, 23);\\r\\n}\\r\\n.TurboWarp:hover,\\r\\n.TurboWarp.sel {\\r\\n  background-color: #e64444;\\r\\n}\\r\\n\\r\\n.null {\\r\\n  background-color: rgb(255, 102, 128);\\r\\n  color: rgb(255, 77, 106);\\r\\n}\\r\\n.null:hover,\\r\\n.null.sel {\\r\\n  background-color: rgb(255, 77, 106);\\r\\n}\\r\\n\\r\\n.extension {\\r\\n  background-color: rgb(15 189 140);\\r\\n}\\r\\n.extension:hover,\\r\\n.extension.sel {\\r\\n  background-color: rgb(11 158 117);\\r\\n}\\r\\n\\r\\n/*.s3devDD>li.hat::before {                           content: '◠ ';}*/\\r\\n/*.s3devDD>li.hat::before {                           content: '▲ ';}*/\\r\\n/*.s3devDD>li.block::before {                         content: '■ ';}*/\\r\\n/*.s3devDD>li.reporter::before {                      content: '● ';}*/\\r\\n/*.s3devDD>li.boolean::before {                       content: '◆ ';}*/\\r\\n\\r\\n#s3devIDD > li {\\r\\n  height: 19px;\\r\\n  padding: 3px 8px;\\r\\n  margin: 2px 0.3em;\\r\\n  box-sizing: border-box;\\r\\n  position: relative;\\r\\n  color: white;\\r\\n  font-weight: bold;\\r\\n  width: min-content;\\r\\n}\\r\\n\\r\\n.s3devDD > li.hat {\\r\\n  border-radius: 14px 14px 3px 3px;\\r\\n}\\r\\n.s3devDD > li.block {\\r\\n  border-radius: 3px;\\r\\n}\\r\\n.s3devDD > li.reporter {\\r\\n  border-radius: 10px;\\r\\n}\\r\\n\\r\\n.s3devDD > li.boolean {\\r\\n  width: min-content;\\r\\n}\\r\\n.s3devDD > li.boolean::before {\\r\\n  content: \\\"\\\";\\r\\n  position: absolute;\\r\\n  left: 0;\\r\\n  top: 0;\\r\\n  width: 0;\\r\\n  height: 0;\\r\\n  border-right: 9px solid transparent;\\r\\n  border-top: 9px solid white;\\r\\n  border-bottom: 10px solid white;\\r\\n}\\r\\n.s3devDD > li.boolean::after {\\r\\n  content: \\\"\\\";\\r\\n  position: absolute;\\r\\n  right: 0;\\r\\n  top: 0;\\r\\n  width: 0;\\r\\n  height: 0;\\r\\n  border-left: 9px solid transparent;\\r\\n  border-top: 9px solid white;\\r\\n  border-bottom: 10px solid white;\\r\\n}\\r\\n[theme=\\\"dark\\\"] .s3devDD > li.boolean::before {\\r\\n  border-top-color: #111;\\r\\n  border-bottom-color: #111;\\r\\n}\\r\\n[theme=\\\"dark\\\"] .s3devDD > li.boolean::after {\\r\\n  border-top-color: #111;\\r\\n  border-bottom-color: #111;\\r\\n}\\r\\n\\r\\n#s3devOverlay {\\r\\n  position: fixed;\\r\\n  top: 0;\\r\\n  left: 0;\\r\\n  right: 0;\\r\\n  bottom: 0;\\r\\n  background-color: rgba(80, 80, 80, 0.5);\\r\\n  z-index: 9999;\\r\\n  padding: 10em;\\r\\n  color: white;\\r\\n  font-weight: bold;\\r\\n}\\r\\n\\r\\n.s3devMulti {\\r\\n  font-weight: normal;\\r\\n  position: absolute;\\r\\n  right: 0;\\r\\n  white-space: nowrap;\\r\\n  background-color: inherit;\\r\\n  z-index: 1;\\r\\n  padding: 0;\\r\\n}\\r\\n\\r\\n.s3devNav {\\r\\n  padding: 0 6px;\\r\\n}\\r\\n\\r\\n.s3devNav:hover {\\r\\n  color: #ffff80;\\r\\n}\\r\\n\\r\\n.s3devAction {\\r\\n  margin-left: 2em;\\r\\n  font-size: 12px;\\r\\n  font-weight: bold;\\r\\n  line-height: 2;\\r\\n}\\r\\n\\r\\n@media screen and (max-width: 1180px) {\\r\\n  .s3devAction {\\r\\n    display: none;\\r\\n  }\\r\\n}\\r\\n\\r\\n.s3devHide {\\r\\n  display: none;\\r\\n}\\r\\n\\r\\n.s3dev-mi:hover {\\r\\n  background-color: #d6e9f8;\\r\\n}\\r\\n[theme=\\\"dark\\\"] .s3dev-mi:hover {\\r\\n  background-color: var(--ui-tertiary);\\r\\n}\\r\\n\\r\\n#s3devHelpPop > div {\\r\\n  box-sizing: border-box;\\r\\n  width: 800px;\\r\\n  height: 60vh;\\r\\n  max-height: 800px;\\r\\n  max-width: 85%;\\r\\n  margin: auto;\\r\\n  margin-top: 20vh;\\r\\n}\\r\\n\\r\\n#s3devHelpPop [class*=\\\"modal_header-item-title\\\"] {\\r\\n  margin: 0 -20rem 0 0;\\r\\n}\\r\\n#s3devHelpPop[dir=\\\"rtl\\\"] [class*=\\\"modal_header-item-title\\\"] {\\r\\n  margin: 0 0 0 -20rem;\\r\\n}\\r\\n\\r\\n#s3devHelpContent {\\r\\n  height: calc(100% - 3.125rem);\\r\\n  overflow-y: auto;\\r\\n  padding: 1em 2em 4em;\\r\\n  background-color: white;\\r\\n  user-select: text;\\r\\n}\\r\\n[theme=\\\"dark\\\"] #s3devHelpPop > div {\\r\\n  background: #111;\\r\\n}\\r\\n\\r\\n#s3devFloatingBar {\\r\\n  display: flex;\\r\\n  white-space: nowrap;\\r\\n  font-family: \\\"Helvetica Neue\\\", Helvetica, Arial, sans-serif;\\r\\n\\r\\n  position: absolute;\\r\\n  min-width: 128px;\\r\\n  background-color: white;\\r\\n  border-radius: 4px;\\r\\n  box-shadow: rgba(0, 0, 0, 0.3) 0 0 3px, rgba(0, 0, 0, 0.2) 0 3px 10px;\\r\\n\\r\\n  z-index: 999;\\r\\n}\\r\\n[theme=\\\"dark\\\"] #s3devFloatingBar {\\r\\n  background-color: #111;\\r\\n}\\r\\n\\r\\n#s3devInsertLabel {\\r\\n  padding: 0;\\r\\n  align-items: center;\\r\\n}\\r\\n\\r\\n/* Drop down from find button */\\r\\nul#s3devIDD {\\r\\n  max-height: 200px;\\r\\n  margin-bottom: 0;\\r\\n}\\r\\n\\r\\n#s3devIDD > li > b {\\r\\n  background-color: rgba(0, 0, 0, 0.6);\\r\\n  color: white;\\r\\n}\\r\\n\\r\\n[data-highlighted=\\\"true\\\"] {\\r\\n  background-color: hsla(30, 100%, 55%, 1) !important; /* orange */\\r\\n  color: white !important;\\r\\n}\\r\\n\", \"\"]);\n\n// exports\n","exports = module.exports = require(\"../../../../node_modules/css-loader/lib/css-base.js\")(false);\n// imports\n\n\n// module\nexports.push([module.id, \".u-dropdown-searchbar {\\r\\n  width: 100%;\\r\\n  box-sizing: border-box;\\r\\n  /* based on styles for the title input */\\r\\n  color: white;\\r\\n  background-color: hsla(0, 100%, 100%, 0.25);\\r\\n  border: 1px solid hsla(0, 0%, 0%, 0.15);\\r\\n  padding: 0.5rem;\\r\\n  outline: none;\\r\\n  transition: 0.25s ease-out;\\r\\n  font-size: 13px;\\r\\n  font-weight: bold;\\r\\n  border-radius: 4px;\\r\\n}\\r\\n.u-dropdown-searchbar:hover {\\r\\n  background-color: hsla(0, 100%, 100%, 0.5);\\r\\n}\\r\\n.u-dropdown-searchbar:focus {\\r\\n  background-color: white;\\r\\n  color: black;\\r\\n}\\r\\n.blocklyDropDownDiv .goog-menu {\\r\\n  overflow-x: hidden;\\r\\n}\\r\\n\", \"\"]);\n\n// exports\n","exports = module.exports = require(\"../../../../node_modules/css-loader/lib/css-base.js\")(false);\n// imports\n\n\n// module\nexports.push([module.id, \".sa-folders-contextmenu-item {\\r\\n  max-width: 250px;\\r\\n  overflow: hidden;\\r\\n  text-overflow: ellipsis;\\r\\n}\\r\\n\\r\\n[sa-folders-context-type=\\\"folder\\\"] .react-contextmenu > :not(.sa-ctx-menu) {\\r\\n  display: none;\\r\\n}\\r\\n\", \"\"]);\n\n// exports\n","exports = module.exports = require(\"../../../../node_modules/css-loader/lib/css-base.js\")(false);\n// imports\n\n\n// module\nexports.push([module.id, \".sa-onion-controls-container {\\r\\n  display: flex;\\r\\n  flex-direction: row;\\r\\n  height: calc(1.95rem + 2px);\\r\\n}\\r\\n\\r\\n.sa-onion-button {\\r\\n  position: relative;\\r\\n}\\r\\n.sa-onion-button:focus-within {\\r\\n  background-color: hsla(0, 100%, 65%, 0.2);\\r\\n}\\r\\n.sa-onion-button[data-enabled=\\\"true\\\"] {\\r\\n  background-color: #ff4c4c;\\r\\n}\\r\\n\\r\\n.sa-onion-settings {\\r\\n  position: absolute;\\r\\n  bottom: 0;\\r\\n  right: 16px;\\r\\n  /* based on the styles for the color dropdown */\\r\\n  padding: 4px;\\r\\n  border-radius: 4px;\\r\\n  border: 1px solid #ddd;\\r\\n  box-shadow: 0px 0px 8px 1px rgba(0, 0, 0, 0.3);\\r\\n  transition-property: bottom, opacity;\\r\\n  transition-duration: 500ms;\\r\\n  transition-timing-function: cubic-bezier(0.23, 1, 0.32, 1);\\r\\n  opacity: 0;\\r\\n  pointer-events: none;\\r\\n  background: white;\\r\\n  color: black;\\r\\n}\\r\\n.sa-onion-settings[data-visible=\\\"true\\\"] {\\r\\n  bottom: 16px;\\r\\n  pointer-events: auto;\\r\\n  opacity: 1;\\r\\n}\\r\\n[dir=\\\"rtl\\\"] .sa-onion-settings {\\r\\n  right: initial;\\r\\n  left: 24px;\\r\\n}\\r\\n.sa-onion-settings .sa-onion-button {\\r\\n  border-color: #d9d9d9 !important; /* override dark mode */\\r\\n}\\r\\n\\r\\n.sa-onion-settings-line {\\r\\n  display: flex;\\r\\n  justify-content: flex-end;\\r\\n  align-items: baseline;\\r\\n}\\r\\n\\r\\n.sa-onion-settings-input {\\r\\n  position: absolute;\\r\\n  top: 0;\\r\\n  left: 0;\\r\\n  width: 100%;\\r\\n  height: 100%;\\r\\n  box-sizing: border-box;\\r\\n  text-align: center;\\r\\n  border: 0;\\r\\n  background: transparent;\\r\\n  -moz-appearance: textfield;\\r\\n  border: 0;\\r\\n  outline: 0;\\r\\n}\\r\\n\\r\\n.sa-onion-settings-input::-webkit-outer-spin-button,\\r\\n.sa-onion-settings-input::-webkit-inner-spin-button {\\r\\n  -webkit-appearance: none;\\r\\n  margin: 0;\\r\\n}\\r\\n\\r\\n.sa-onion-settings-tip {\\r\\n  position: absolute;\\r\\n  bottom: 0;\\r\\n  transform: translateY(100%);\\r\\n  right: 138px;\\r\\n}\\r\\n[dir=\\\"rtl\\\"] .sa-onion-settings-tip {\\r\\n  right: 84px;\\r\\n}\\r\\n.sa-onion-settings-polygon {\\r\\n  fill: white;\\r\\n  stroke: #ddd;\\r\\n}\\r\\n\\r\\n[theme=\\\"dark\\\"] .sa-onion-image[data-image=\\\"settings\\\"] {\\r\\n  filter: invert(1);\\r\\n}\\r\\n[theme=\\\"dark\\\"] .sa-onion-image[data-image=\\\"increment\\\"] {\\r\\n  filter: none;\\r\\n}\\r\\n[theme=\\\"dark\\\"] .sa-onion-image[data-image=\\\"decrement\\\"] {\\r\\n  filter: none;\\r\\n}\\r\\n\", \"\"]);\n\n// exports\n","export default \"data:image/svg+xml;base64,PHN2ZyBpZD0iTGF5ZXJfMSIgZGF0YS1uYW1lPSJMYXllciAxIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA3LjQ4IDcuNDgiPjxkZWZzPjxzdHlsZT4uY2xzLTF7ZmlsbDpub25lO3N0cm9rZTojZmZmO3N0cm9rZS1saW5lY2FwOnJvdW5kO3N0cm9rZS1saW5lam9pbjpyb3VuZDtzdHJva2Utd2lkdGg6MnB4O308L3N0eWxlPjwvZGVmcz48dGl0bGU+aWNvbi0tYWRkPC90aXRsZT48bGluZSBjbGFzcz0iY2xzLTEiIHgxPSIzLjc0IiB5MT0iNi40OCIgeDI9IjMuNzQiIHkyPSIxIi8+PGxpbmUgY2xhc3M9ImNscy0xIiB4MT0iMSIgeTE9IjMuNzQiIHgyPSI2LjQ4IiB5Mj0iMy43NCIvPjwvc3ZnPg==\"","export default \"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGhlaWdodD0iMjQiIHdpZHRoPSIyNCI+PHBhdGggZD0iTTAgMGgyNHYyNEgweiIgZmlsbD0ibm9uZSIvPjxwYXRoIGQ9Ik0xMCA0SDRjLTEuMSAwLTEuOTkuOS0xLjk5IDJMMiAxOGMwIDEuMS45IDIgMiAyaDE2YzEuMSAwIDItLjkgMi0yVjhjMC0xLjEtLjktMi0yLTJoLThsLTItMnoiLz48L3N2Zz4=\"","export default \"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCI+PHBhdGggc3R5bGU9ImZpbGw6IzU3NWU3NTtzdHJva2Utd2lkdGg6LjczNDczNiIgZD0iTTMuMjUgMTEuMzU4aDE3LjUwMXYxLjI4NUgzLjI1eiIvPjwvc3ZnPg==\"","export default \"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGhlaWdodD0iMjQiIHdpZHRoPSIyNCI+PHBhdGggc3R5bGU9ImZpbGw6IzU3NWU3NTtzdHJva2Utd2lkdGg6LjczNDczNiIgZD0iTTMuMjUgMTEuMzU4aDE3LjUwMXYxLjI4NUgzLjI1eiIvPjxwYXRoIHRyYW5zZm9ybT0icm90YXRlKDkwKSIgc3R5bGU9ImZpbGw6IzU3NWU3NTtzdHJva2Utd2lkdGg6LjczNDczNiIgZD0iTTMuMjUtMTIuNjQyaDE3LjUwMXYxLjI4NUgzLjI1eiIvPjwvc3ZnPg==\"","export default \"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCI+PHBhdGggc3R5bGU9Im9wYWNpdHk6Ljc1O2ZpbGw6bm9uZTtzdHJva2U6IzAwMDtzdHJva2Utd2lkdGg6NDtzdHJva2UtbGluZWNhcDpyb3VuZDtzdHJva2UtbGluZWpvaW46cm91bmQ7c3Ryb2tlLW1pdGVybGltaXQ6NDtzdHJva2UtZGFzaGFycmF5Om5vbmU7c3Ryb2tlLW9wYWNpdHk6MSIgZD0iTTU2IDE2djk2IiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgtMi4zNzYgLTIuMzc2KSBzY2FsZSguMjI0NjIpIi8+PHBhdGggc3R5bGU9Im9wYWNpdHk6LjU7ZmlsbDpub25lO3N0cm9rZTojMDAwO3N0cm9rZS13aWR0aDo0O3N0cm9rZS1saW5lY2FwOnJvdW5kO3N0cm9rZS1saW5lam9pbjptaXRlcjtzdHJva2UtbWl0ZXJsaW1pdDo0O3N0cm9rZS1kYXNoYXJyYXk6bm9uZTtzdHJva2Utb3BhY2l0eToxIiBkPSJNNDAgMzJ2NjQiIHRyYW5zZm9ybT0idHJhbnNsYXRlKC0yLjM3NiAtMi4zNzYpIHNjYWxlKC4yMjQ2MikiLz48cGF0aCBzdHlsZT0ib3BhY2l0eTouMjU7ZmlsbDpub25lO3N0cm9rZTojMDAwO3N0cm9rZS13aWR0aDo0O3N0cm9rZS1saW5lY2FwOnJvdW5kO3N0cm9rZS1saW5lam9pbjptaXRlcjtzdHJva2UtbWl0ZXJsaW1pdDo0O3N0cm9rZS1kYXNoYXJyYXk6bm9uZTtzdHJva2Utb3BhY2l0eToxIiBkPSJNMjQgNDh2MzIiIHRyYW5zZm9ybT0idHJhbnNsYXRlKC0yLjM3NiAtMi4zNzYpIHNjYWxlKC4yMjQ2MikiLz48cGF0aCBzdHlsZT0ib3BhY2l0eTouNzU7ZmlsbDpub25lO3N0cm9rZTojMDAwO3N0cm9rZS13aWR0aDo0O3N0cm9rZS1saW5lY2FwOnJvdW5kO3N0cm9rZS1saW5lam9pbjpyb3VuZDtzdHJva2UtbWl0ZXJsaW1pdDo0O3N0cm9rZS1kYXNoYXJyYXk6bm9uZTtzdHJva2Utb3BhY2l0eToxIiBkPSJNNzIgMTZ2OTYiIHRyYW5zZm9ybT0idHJhbnNsYXRlKC0yLjM3NiAtMi4zNzYpIHNjYWxlKC4yMjQ2MikiLz48cGF0aCBzdHlsZT0ib3BhY2l0eTouNTtmaWxsOm5vbmU7c3Ryb2tlOiMwMDA7c3Ryb2tlLXdpZHRoOjQ7c3Ryb2tlLWxpbmVjYXA6cm91bmQ7c3Ryb2tlLWxpbmVqb2luOm1pdGVyO3N0cm9rZS1taXRlcmxpbWl0OjQ7c3Ryb2tlLWRhc2hhcnJheTpub25lO3N0cm9rZS1vcGFjaXR5OjEiIGQ9Ik04OCAzMnY2NCIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTIuMzc2IC0yLjM3Nikgc2NhbGUoLjIyNDYyKSIvPjxwYXRoIHN0eWxlPSJvcGFjaXR5Oi4yNTtmaWxsOm5vbmU7c3Ryb2tlOiMwMDA7c3Ryb2tlLXdpZHRoOjQ7c3Ryb2tlLWxpbmVjYXA6cm91bmQ7c3Ryb2tlLWxpbmVqb2luOm1pdGVyO3N0cm9rZS1taXRlcmxpbWl0OjQ7c3Ryb2tlLWRhc2hhcnJheTpub25lO3N0cm9rZS1vcGFjaXR5OjEiIGQ9Ik0xMDQgNDh2MzIiIHRyYW5zZm9ybT0idHJhbnNsYXRlKC0yLjM3NiAtMi4zNzYpIHNjYWxlKC4yMjQ2MikiLz48L3N2Zz4=\"","export default \"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCI+PGcgc3Ryb2tlLXdpZHRoPSIxLjIiIHN0cm9rZT0iIzAwMTAyNiI+PGcgc3R5bGU9Im9wYWNpdHk6LjU7c3Ryb2tlLXdpZHRoOjQ7c3Ryb2tlLW1pdGVybGltaXQ6MTA7c3Ryb2tlLWRhc2hhcnJheTpub25lIj48cGF0aCBzdHlsZT0ibWl4LWJsZW5kLW1vZGU6bm9ybWFsO2ZpbGw6bm9uZTtmaWxsLXJ1bGU6ZXZlbm9kZDtzdHJva2Utd2lkdGg6NDtzdHJva2UtbWl0ZXJsaW1pdDoxMDtzdHJva2UtZGFzaGFycmF5Om5vbmU7c3Ryb2tlLWRhc2hvZmZzZXQ6MCIgZmlsbD0iI2JmYmZiZiIgZD0iTTY4LjQ1IDMyLjQ1N2MuMy0uMi44LS4xLjkuM2wyLjYgMTAuN3M2LjQgNC43IDguMyA4YzMuMiA1LjUgMy4zIDEwIDMuMyAxMHM3LjEgMi4xIDguMyA3LjhjMS4yIDUuNy0zLjIgMTYuNS0yMiAyMC4yLTE4LjggMy43LTMzLjktMS40LTQxLTEyLjgtNy4xLTExLjQgNC4xLTI1IDMuNS0yNC4ybC0yLjEtMTcuOWMtLjEtLjQuNC0uNy44LS41bDEyLjEgNy45czQuNS0xLjcgOS4yLTEuOWMyLjgtLjIgNS4yIDAgNy41LjR6IiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgtNC42NTIgLTQuNjUpIHNjYWxlKC4yMzI5KSIvPjxwYXRoIHN0eWxlPSJtaXgtYmxlbmQtbW9kZTpub3JtYWw7ZmlsbDpub25lO2ZpbGwtcnVsZTpldmVub2RkO3N0cm9rZS13aWR0aDo0O3N0cm9rZS1taXRlcmxpbWl0OjEwO3N0cm9rZS1kYXNoYXJyYXk6bm9uZTtzdHJva2UtZGFzaG9mZnNldDowIiBzdHJva2UtbGluZWpvaW49InJvdW5kIiBzdHJva2UtbGluZWNhcD0icm91bmQiIGZpbGw9Im5vbmUiIGQ9Ik0xMDEuNjUgNjIuOTU3Yy00LjcgMy44LTExLjkgMy45LTExLjkgMy45bTEwLjYgNy4zYy02LjMuNS0xMC4yLTEuNC0xMC4yLTEuNG0tNjguOC0xMC4xczguNiAyLjggMTIuMSA1LjltLjMgMy41Yy00LjMgMS43LTExLjcuNi0xMS43LjYiIHRyYW5zZm9ybT0idHJhbnNsYXRlKC00LjY1MiAtNC42NSkgc2NhbGUoLjIzMjkpIi8+PC9nPjxnIHN0eWxlPSJvcGFjaXR5Oi43NTtzdHJva2Utd2lkdGg6NDtzdHJva2UtbWl0ZXJsaW1pdDoxMDtzdHJva2UtZGFzaGFycmF5Om5vbmUiPjxwYXRoIHN0eWxlPSJtaXgtYmxlbmQtbW9kZTpub3JtYWw7ZmlsbDpub25lO2ZpbGwtcnVsZTpldmVub2RkO3N0cm9rZS13aWR0aDo0O3N0cm9rZS1taXRlcmxpbWl0OjEwO3N0cm9rZS1kYXNoYXJyYXk6bm9uZTtzdHJva2UtZGFzaG9mZnNldDowIiBmaWxsPSIjYmZiZmJmIiBkPSJNNjguNDUgMzIuNDU3Yy4zLS4yLjgtLjEuOS4zbDIuNiAxMC43czYuNCA0LjcgOC4zIDhjMy4yIDUuNSAzLjMgMTAgMy4zIDEwczcuMSAyLjEgOC4zIDcuOGMxLjIgNS43LTMuMiAxNi41LTIyIDIwLjItMTguOCAzLjctMzMuOS0xLjQtNDEtMTIuOC03LjEtMTEuNCA0LjEtMjUgMy41LTI0LjJsLTIuMS0xNy45Yy0uMS0uNC40LS43LjgtLjVsMTIuMSA3LjlzNC41LTEuNyA5LjItMS45YzIuOC0uMiA1LjIgMCA3LjUuNHoiIHRyYW5zZm9ybT0idHJhbnNsYXRlKC0yLjMyMyAtMi4zMjEpIHNjYWxlKC4yMzI5KSIvPjxwYXRoIHN0eWxlPSJtaXgtYmxlbmQtbW9kZTpub3JtYWw7ZmlsbDpub25lO2ZpbGwtcnVsZTpldmVub2RkO3N0cm9rZS13aWR0aDo0O3N0cm9rZS1taXRlcmxpbWl0OjEwO3N0cm9rZS1kYXNoYXJyYXk6bm9uZTtzdHJva2UtZGFzaG9mZnNldDowIiBzdHJva2UtbGluZWpvaW49InJvdW5kIiBzdHJva2UtbGluZWNhcD0icm91bmQiIGZpbGw9Im5vbmUiIGQ9Ik0xMDEuNjUgNjIuOTU3Yy00LjcgMy44LTExLjkgMy45LTExLjkgMy45bTEwLjYgNy4zYy02LjMuNS0xMC4yLTEuNC0xMC4yLTEuNG0tNjguOC0xMC4xczguNiAyLjggMTIuMSA1LjltLjMgMy41Yy00LjMgMS43LTExLjcuNi0xMS43LjYiIHRyYW5zZm9ybT0idHJhbnNsYXRlKC0yLjMyMyAtMi4zMjEpIHNjYWxlKC4yMzI5KSIvPjwvZz48ZyBzdHlsZT0ic3Ryb2tlLXdpZHRoOjQ7c3Ryb2tlLW1pdGVybGltaXQ6MTA7c3Ryb2tlLWRhc2hhcnJheTpub25lIj48cGF0aCBzdHlsZT0ibWl4LWJsZW5kLW1vZGU6bm9ybWFsO2ZpbGw6I2ZmZjtmaWxsLW9wYWNpdHk6MTtmaWxsLXJ1bGU6ZXZlbm9kZDtzdHJva2Utd2lkdGg6NDtzdHJva2UtbWl0ZXJsaW1pdDoxMDtzdHJva2UtZGFzaGFycmF5Om5vbmU7c3Ryb2tlLWRhc2hvZmZzZXQ6MCIgZmlsbD0iI2JmYmZiZiIgZD0iTTczLjQ1IDM3LjQ1N2MuMy0uMi44LS4xLjkuM2wyLjYgMTAuN3M2LjQgNC43IDguMyA4YzMuMiA1LjUgMy4zIDEwIDMuMyAxMHM3LjEgMi4xIDguMyA3LjhjMS4yIDUuNy0zLjIgMTYuNS0yMiAyMC4yLTE4LjggMy43LTMzLjktMS40LTQxLTEyLjgtNy4xLTExLjQgNC4xLTI1IDMuNS0yNC4ybC0yLjEtMTcuOWMtLjEtLjQuNC0uNy44LS41bDEyLjEgNy45czQuNS0xLjcgOS4yLTEuOWMyLjgtLjIgNS4yIDAgNy41LjR6IiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgtMS4xNTkgLTEuMTU3KSBzY2FsZSguMjMyOSkiLz48cGF0aCBzdHlsZT0ibWl4LWJsZW5kLW1vZGU6bm9ybWFsO2ZpbGw6bm9uZTtmaWxsLXJ1bGU6ZXZlbm9kZDtzdHJva2Utd2lkdGg6NDtzdHJva2UtbWl0ZXJsaW1pdDoxMDtzdHJva2UtZGFzaGFycmF5Om5vbmU7c3Ryb2tlLWRhc2hvZmZzZXQ6MCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBmaWxsPSJub25lIiBkPSJNMTA2LjY1IDY3Ljk1N2MtNC43IDMuOC0xMS45IDMuOS0xMS45IDMuOW0xMC42IDcuM2MtNi4zLjUtMTAuMi0xLjQtMTAuMi0xLjRtLTY4LjgtMTAuMXM4LjYgMi44IDEyLjEgNS45bS4zIDMuNWMtNC4zIDEuNy0xMS43LjYtMTEuNy42IiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgtMS4xNTkgLTEuMTU3KSBzY2FsZSguMjMyOSkiLz48L2c+PC9nPjwvc3ZnPg==\"","/* generated by pull.js */\nimport _js from \"./userscript.js\";\nexport const resources = {\n  \"userscript.js\": _js,\n};\n","export default async ({ addon, console }) => {\r\n  if (!addon.tab.redux.state) return console.warn(\"Redux is not available!\");\r\n  addon.tab.redux.initialize();\r\n  addon.tab.redux.addEventListener(\"statechanged\", ({ detail }) => {\r\n    if (addon.self.disabled) return;\r\n    const e = detail;\r\n    if (!e.action || e.action.type !== \"scratch-paint/clipboard/SET\") return;\r\n    const items = e.next.scratchPaint.clipboard.items;\r\n    if (items.length !== 1) return;\r\n    const firstItem = items[0];\r\n    // TODO vector support\r\n    if (!Array.isArray(firstItem) || firstItem[0] !== \"Raster\") return console.log(\"copied element is vector\");\r\n    const dataURL = firstItem[1].source;\r\n    addon.tab\r\n      .copyImage(dataURL)\r\n      .then(() => console.log(\"Image successfully copied\"))\r\n      .catch((e) => console.error(`Image could not be copied: ${e}`));\r\n  });\r\n};\r\n","/* generated by pull.js */\nimport _js from \"./userscript.js\";\nexport const resources = {\n  \"userscript.js\": _js,\n};\n","export default async function ({ addon, global, console }) {\r\n  const ScratchBlocks = await addon.tab.traps.getBlockly();\r\n\r\n  let ctrlKeyPressed = false;\r\n  document.addEventListener(\r\n    \"mousedown\",\r\n    function (e) {\r\n      ctrlKeyPressed = e.ctrlKey || e.metaKey;\r\n    },\r\n    {\r\n      capture: true,\r\n    }\r\n  );\r\n\r\n  // https://github.com/LLK/scratch-blocks/blob/102b33d14b25400c064e9bf6924a7ae1b0dcb2ab/core/block_dragger.js#L160\r\n  const originalStartBlockDrag = ScratchBlocks.BlockDragger.prototype.startBlockDrag;\r\n  ScratchBlocks.BlockDragger.prototype.startBlockDrag = function (...args) {\r\n    if (!addon.self.disabled) {\r\n      const invert = addon.settings.get(\"invertDrag\") && this.draggingBlock_.getParent();\r\n      if (ctrlKeyPressed === !invert) {\r\n        if (!ScratchBlocks.Events.getGroup()) {\r\n          ScratchBlocks.Events.setGroup(true);\r\n        }\r\n        this.draggingBlock_.unplug(true);\r\n        // A separate field has to be updated to avoid dragging comments attached to blocks underneath this block.\r\n        this.dragIconData_ = this.dragIconData_.filter((i) => i.icon.block_ === this.draggingBlock_);\r\n        // And we also have to make sure Scratch will never try to drag a block on top of itself, which crashes the editor.\r\n        // That can happen when you cherry-pick the top block of a script and drop it where it started.\r\n        this.draggedConnectionManager_.availableConnections_ =\r\n          this.draggedConnectionManager_.initAvailableConnections_();\r\n      }\r\n    }\r\n    return originalStartBlockDrag.call(this, ...args);\r\n  };\r\n}\r\n","/* generated by pull.js */\nimport _js from \"./userscript.js\";\nexport const resources = {\n  \"userscript.js\": _js,\n};\n","export default async function ({ addon, global, console }) {\r\n  const ScratchBlocks = await addon.tab.traps.getBlockly();\r\n  const originalStartDraggingBlock = ScratchBlocks.Gesture.prototype.startDraggingBlock_;\r\n  // https://github.com/LLK/scratch-blocks/blob/e86f115457006d1cde83baa23eaaf1ee16d315f5/core/gesture.js#L454\r\n  ScratchBlocks.Gesture.prototype.startDraggingBlock_ = function (...args) {\r\n    if (\r\n      !this.flyout_ &&\r\n      !this.shouldDuplicateOnDrag_ &&\r\n      this.targetBlock_.type !== \"procedures_definition\" &&\r\n      this.mostRecentEvent_.altKey &&\r\n      !addon.self.disabled\r\n    ) {\r\n      // Scratch will reset these when the drag ends\r\n      if (!ScratchBlocks.Events.getGroup()) {\r\n        ScratchBlocks.Events.setGroup(true);\r\n      }\r\n      this.startWorkspace_.setResizesEnabled(false);\r\n      // Based on https://github.com/LLK/scratch-blocks/blob/feda366947432b9d82a4f212f43ff6d4ab6f252f/core/scratch_blocks_utils.js#L171\r\n      // Setting this.shouldDuplicateOnDrag_ = true does NOT work because it doesn't call changeObscuredShadowIds\r\n      ScratchBlocks.Events.disable();\r\n      let newBlock;\r\n      try {\r\n        const xmlBlock = ScratchBlocks.Xml.blockToDom(this.targetBlock_);\r\n        newBlock = ScratchBlocks.Xml.domToBlock(xmlBlock, this.startWorkspace_);\r\n        ScratchBlocks.scratchBlocksUtils.changeObscuredShadowIds(newBlock);\r\n        const xy = this.targetBlock_.getRelativeToSurfaceXY();\r\n        newBlock.moveBy(xy.x, xy.y);\r\n        if (this.mostRecentEvent_.ctrlKey || this.mostRecentEvent_.metaKey) {\r\n          const nextBlock = newBlock.getNextBlock();\r\n          if (nextBlock) {\r\n            nextBlock.dispose();\r\n          }\r\n        }\r\n      } catch (e) {\r\n        console.error(e);\r\n      }\r\n      ScratchBlocks.Events.enable();\r\n      if (newBlock) {\r\n        this.targetBlock_ = newBlock;\r\n        if (ScratchBlocks.Events.isEnabled()) {\r\n          ScratchBlocks.Events.fire(new ScratchBlocks.Events.BlockCreate(newBlock));\r\n        }\r\n      }\r\n    }\r\n    return originalStartDraggingBlock.call(this, ...args);\r\n  };\r\n}\r\n","/* generated by pull.js */\nimport _js from \"./userscript.js\";\nexport const resources = {\n  \"userscript.js\": _js,\n};\n","/**\r\n * This file is imported from https://github.com/LLK/scratch-blocks/\r\n * It has been cleaned up and unnecessary functions have been removed.\r\n * Original license is below.\r\n *\r\n * @license\r\n * Visual Blocks Editor\r\n *\r\n * Copyright 2012 Google Inc.\r\n * https://developers.google.com/blockly/\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n\r\n/* eslint-disable */\r\n\r\nconst INPUT_VALUE = 1;\r\nconst NEXT_STATEMENT = 3;\r\nconst DUMMY_INPUT = 5;\r\n\r\n// Partially implements goog.dom.createDom.\r\nconst createDom = function (tagName, /* unused */ _params, children) {\r\n  const element = document.createElement(tagName);\r\n  if (children !== undefined) {\r\n    if (!Array.isArray(children)) {\r\n      children = [children];\r\n    }\r\n    for (const child of children) {\r\n      if (typeof child === \"string\") {\r\n        element.appendChild(document.createTextNode(child));\r\n      } else {\r\n        element.appendChild(child);\r\n      }\r\n    }\r\n  }\r\n  return element;\r\n};\r\n\r\n// Partially implements goog.dom.removeNode\r\nconst removeNode = (node) => {\r\n  if (node.parentNode) {\r\n    node.parentNode.removeChild(node);\r\n  }\r\n};\r\n\r\nconst fieldToDomVariable_ = function (field) {\r\n  // The field had not been initialized fully before being serialized.\r\n  // This can happen if a block is created directly through a call to\r\n  // workspace.newBlock instead of from XML.\r\n  // The new block will be serialized for the first time when firing a block\r\n  // creation event.\r\n  if (field.getValue() == null) {\r\n    field.initModel();\r\n  }\r\n  // Get the variable directly from the field, instead of doing a lookup.  This\r\n  // will work even if the variable has already been deleted.  This can happen\r\n  // because the flyout defers deleting blocks until the next time the flyout is\r\n  // opened.\r\n  var variable = field.getVariable();\r\n\r\n  if (!variable) {\r\n    throw Error(\"Tried to serialize a variable field with no variable.\");\r\n  }\r\n  var container = createDom(\"field\", null, variable.name);\r\n  container.setAttribute(\"name\", field.name);\r\n  container.setAttribute(\"id\", variable.getId());\r\n  container.setAttribute(\"variabletype\", variable.type);\r\n  return container;\r\n};\r\n\r\nconst fieldToDom_ = function (field) {\r\n  if (field.name && field.SERIALIZABLE) {\r\n    if (field.referencesVariables()) {\r\n      return fieldToDomVariable_(field);\r\n    } else {\r\n      var container = createDom(\"field\", null, field.getValue());\r\n      container.setAttribute(\"name\", field.name);\r\n      return container;\r\n    }\r\n  }\r\n  return null;\r\n};\r\n\r\nconst allFieldsToDom_ = function (block, element) {\r\n  for (var i = 0, input; (input = block.inputList[i]); i++) {\r\n    for (var j = 0, field; (field = input.fieldRow[j]); j++) {\r\n      var fieldDom = fieldToDom_(field);\r\n      if (fieldDom) {\r\n        element.appendChild(fieldDom);\r\n      }\r\n    }\r\n  }\r\n};\r\n\r\nconst blockToDom = function (block, opt_noId) {\r\n  var element = createDom(block.isShadow() ? \"shadow\" : \"block\");\r\n  element.setAttribute(\"type\", block.type);\r\n  if (!opt_noId) {\r\n    element.setAttribute(\"id\", block.id);\r\n  }\r\n  if (block.mutationToDom) {\r\n    // Custom data for an advanced block.\r\n    var mutation = block.mutationToDom();\r\n    if (mutation && (mutation.hasChildNodes() || mutation.hasAttributes())) {\r\n      element.appendChild(mutation);\r\n    }\r\n  }\r\n\r\n  allFieldsToDom_(block, element);\r\n\r\n  scratchCommentToDom_(block, element);\r\n\r\n  if (block.data) {\r\n    var dataElement = createDom(\"data\", null, block.data);\r\n    element.appendChild(dataElement);\r\n  }\r\n\r\n  for (var i = 0, input; (input = block.inputList[i]); i++) {\r\n    var container;\r\n    var empty = true;\r\n    if (input.type == DUMMY_INPUT) {\r\n      continue;\r\n    } else {\r\n      var childBlock = input.connection.targetBlock();\r\n      if (input.type == INPUT_VALUE) {\r\n        container = createDom(\"value\");\r\n      } else if (input.type == NEXT_STATEMENT) {\r\n        container = createDom(\"statement\");\r\n      }\r\n      var shadow = input.connection.getShadowDom();\r\n      if (shadow && (!childBlock || !childBlock.isShadow())) {\r\n        var shadowClone = cloneShadow_(shadow);\r\n        // Remove the ID from the shadow dom clone if opt_noId\r\n        // is specified to true.\r\n        if (opt_noId && shadowClone.getAttribute(\"id\")) {\r\n          shadowClone.removeAttribute(\"id\");\r\n        }\r\n        container.appendChild(shadowClone);\r\n      }\r\n      if (childBlock) {\r\n        container.appendChild(blockToDom(childBlock, opt_noId));\r\n        empty = false;\r\n      }\r\n    }\r\n    container.setAttribute(\"name\", input.name);\r\n    if (!empty) {\r\n      element.appendChild(container);\r\n    }\r\n  }\r\n  if (block.inputsInlineDefault != block.inputsInline) {\r\n    element.setAttribute(\"inline\", block.inputsInline);\r\n  }\r\n  if (block.isCollapsed()) {\r\n    element.setAttribute(\"collapsed\", true);\r\n  }\r\n  if (block.disabled) {\r\n    element.setAttribute(\"disabled\", true);\r\n  }\r\n  if (!block.isDeletable() && !block.isShadow()) {\r\n    element.setAttribute(\"deletable\", false);\r\n  }\r\n  if (!block.isMovable() && !block.isShadow()) {\r\n    element.setAttribute(\"movable\", false);\r\n  }\r\n  if (!block.isEditable()) {\r\n    element.setAttribute(\"editable\", false);\r\n  }\r\n\r\n  var nextBlock = block.getNextBlock();\r\n  if (nextBlock) {\r\n    var container = createDom(\"next\", null, blockToDom(nextBlock, opt_noId));\r\n    element.appendChild(container);\r\n  }\r\n  var shadow = block.nextConnection && block.nextConnection.getShadowDom();\r\n  if (shadow && (!nextBlock || !nextBlock.isShadow())) {\r\n    container.appendChild(cloneShadow_(shadow));\r\n  }\r\n\r\n  return element;\r\n};\r\n\r\nconst scratchCommentToDom_ = function (block, element) {\r\n  var commentText = block.getCommentText();\r\n  if (commentText) {\r\n    var commentElement = createDom(\"comment\", null, commentText);\r\n    if (typeof block.comment == \"object\") {\r\n      commentElement.setAttribute(\"id\", block.comment.id);\r\n      commentElement.setAttribute(\"pinned\", block.comment.isVisible());\r\n      var hw;\r\n      // TODO: scratch-blocks uses `block.comment instanceof Blockly.ScratchBlockComment`\r\n      if (block.comment.getHeightWidth) {\r\n        hw = block.comment.getHeightWidth();\r\n      } else {\r\n        hw = block.comment.getBubbleSize();\r\n      }\r\n      commentElement.setAttribute(\"h\", hw.height);\r\n      commentElement.setAttribute(\"w\", hw.width);\r\n      var xy = block.comment.getXY();\r\n      commentElement.setAttribute(\"x\", xy.x);\r\n      commentElement.setAttribute(\"y\", xy.y);\r\n      commentElement.setAttribute(\"minimized\", block.comment.isMinimized());\r\n    }\r\n    element.appendChild(commentElement);\r\n  }\r\n};\r\n\r\nconst cloneShadow_ = function (shadow) {\r\n  shadow = shadow.cloneNode(true);\r\n  // Walk the tree looking for whitespace.  Don't prune whitespace in a tag.\r\n  var node = shadow;\r\n  var textNode;\r\n  while (node) {\r\n    if (node.firstChild) {\r\n      node = node.firstChild;\r\n    } else {\r\n      while (node && !node.nextSibling) {\r\n        textNode = node;\r\n        node = node.parentNode;\r\n        if (textNode.nodeType == 3 && textNode.data.trim() == \"\" && node.firstChild != textNode) {\r\n          // Prune whitespace after a tag.\r\n          removeNode(textNode);\r\n        }\r\n      }\r\n      if (node) {\r\n        textNode = node;\r\n        node = node.nextSibling;\r\n        if (textNode.nodeType == 3 && textNode.data.trim() == \"\") {\r\n          // Prune whitespace before a tag.\r\n          removeNode(textNode);\r\n        }\r\n      }\r\n    }\r\n  }\r\n  return shadow;\r\n};\r\n\r\nconst blockToDomWithXY = (block) => {\r\n  const xml = blockToDom(block, false);\r\n  const position = block.getRelativeToSurfaceXY();\r\n  xml.setAttribute(\"x\", Math.round(block.workspace.RTL ? -position.x : position.x));\r\n  xml.setAttribute(\"y\", Math.round(position.y));\r\n  return xml;\r\n};\r\n\r\nexport default blockToDomWithXY;\r\n","import blockToDom from \"./blockToDom.js\";\r\n\r\nexport default async function ({ addon, global, console, msg }) {\r\n  const ScratchBlocks = await addon.tab.traps.getBlockly();\r\n  const vm = addon.tab.traps.vm;\r\n\r\n  let blockSwitches = {};\r\n  let procedureSwitches = {};\r\n  const noopSwitch = {\r\n    isNoop: true,\r\n  };\r\n\r\n  const buildSwitches = () => {\r\n    blockSwitches = {};\r\n    procedureSwitches = {};\r\n\r\n    if (addon.settings.get(\"motion\")) {\r\n      blockSwitches[\"motion_turnright\"] = [\r\n        noopSwitch,\r\n        {\r\n          opcode: \"motion_turnleft\",\r\n        },\r\n      ];\r\n      blockSwitches[\"motion_turnleft\"] = [\r\n        {\r\n          opcode: \"motion_turnright\",\r\n        },\r\n        noopSwitch,\r\n      ];\r\n      blockSwitches[\"motion_setx\"] = [\r\n        noopSwitch,\r\n        {\r\n          opcode: \"motion_changexby\",\r\n          remap: { X: \"DX\" },\r\n        },\r\n        {\r\n          opcode: \"motion_sety\",\r\n          remap: { X: \"Y\" },\r\n        },\r\n        {\r\n          opcode: \"motion_changeyby\",\r\n          remap: { X: \"DY\" },\r\n        },\r\n      ];\r\n      blockSwitches[\"motion_changexby\"] = [\r\n        {\r\n          opcode: \"motion_setx\",\r\n          remap: { DX: \"X\" },\r\n        },\r\n        noopSwitch,\r\n        {\r\n          opcode: \"motion_sety\",\r\n          remap: { DX: \"Y\" },\r\n        },\r\n        {\r\n          opcode: \"motion_changeyby\",\r\n          remap: { DX: \"DY\" },\r\n        },\r\n      ];\r\n      blockSwitches[\"motion_sety\"] = [\r\n        {\r\n          opcode: \"motion_setx\",\r\n          remap: { Y: \"X\" },\r\n        },\r\n        {\r\n          opcode: \"motion_changexby\",\r\n          remap: { Y: \"DX\" },\r\n        },\r\n        noopSwitch,\r\n        {\r\n          opcode: \"motion_changeyby\",\r\n          remap: { Y: \"DY\" },\r\n        },\r\n      ];\r\n      blockSwitches[\"motion_changeyby\"] = [\r\n        {\r\n          opcode: \"motion_setx\",\r\n          remap: { DY: \"X\" },\r\n        },\r\n        {\r\n          opcode: \"motion_changexby\",\r\n          remap: { DY: \"DX\" },\r\n        },\r\n        {\r\n          opcode: \"motion_sety\",\r\n          remap: { DY: \"Y\" },\r\n        },\r\n        noopSwitch,\r\n      ];\r\n      blockSwitches[\"motion_xposition\"] = [\r\n        noopSwitch,\r\n        {\r\n          opcode: \"motion_yposition\",\r\n        },\r\n      ];\r\n      blockSwitches[\"motion_yposition\"] = [\r\n        {\r\n          opcode: \"motion_xposition\",\r\n        },\r\n        noopSwitch,\r\n      ];\r\n    }\r\n\r\n    if (addon.settings.get(\"looks\")) {\r\n      blockSwitches[\"looks_seteffectto\"] = [\r\n        noopSwitch,\r\n        {\r\n          opcode: \"looks_changeeffectby\",\r\n          remap: { VALUE: \"CHANGE\" },\r\n        },\r\n      ];\r\n      blockSwitches[\"looks_changeeffectby\"] = [\r\n        {\r\n          opcode: \"looks_seteffectto\",\r\n          remap: { CHANGE: \"VALUE\" },\r\n        },\r\n        noopSwitch,\r\n      ];\r\n      blockSwitches[\"looks_setsizeto\"] = [\r\n        noopSwitch,\r\n        {\r\n          opcode: \"looks_changesizeby\",\r\n          remap: { SIZE: \"CHANGE\" },\r\n        },\r\n      ];\r\n      blockSwitches[\"looks_changesizeby\"] = [\r\n        {\r\n          opcode: \"looks_setsizeto\",\r\n          remap: { CHANGE: \"SIZE\" },\r\n        },\r\n        noopSwitch,\r\n      ];\r\n      blockSwitches[\"looks_costumenumbername\"] = [\r\n        noopSwitch,\r\n        {\r\n          opcode: \"looks_backdropnumbername\",\r\n        },\r\n      ];\r\n      blockSwitches[\"looks_backdropnumbername\"] = [\r\n        {\r\n          opcode: \"looks_costumenumbername\",\r\n        },\r\n        noopSwitch,\r\n      ];\r\n      blockSwitches[\"looks_show\"] = [\r\n        noopSwitch,\r\n        {\r\n          opcode: \"looks_hide\",\r\n        },\r\n      ];\r\n      blockSwitches[\"looks_hide\"] = [\r\n        {\r\n          opcode: \"looks_show\",\r\n        },\r\n        noopSwitch,\r\n      ];\r\n      blockSwitches[\"looks_nextcostume\"] = [\r\n        noopSwitch,\r\n        {\r\n          opcode: \"looks_nextbackdrop\",\r\n        },\r\n      ];\r\n      blockSwitches[\"looks_nextbackdrop\"] = [\r\n        {\r\n          opcode: \"looks_nextcostume\",\r\n        },\r\n        noopSwitch,\r\n      ];\r\n      blockSwitches[\"looks_think\"] = [\r\n        noopSwitch,\r\n        {\r\n          opcode: \"looks_say\",\r\n        },\r\n      ];\r\n      blockSwitches[\"looks_say\"] = [\r\n        {\r\n          opcode: \"looks_think\",\r\n        },\r\n        noopSwitch,\r\n      ];\r\n      blockSwitches[\"looks_thinkforsecs\"] = [\r\n        noopSwitch,\r\n        {\r\n          opcode: \"looks_sayforsecs\",\r\n        },\r\n      ];\r\n      blockSwitches[\"looks_sayforsecs\"] = [\r\n        {\r\n          opcode: \"looks_thinkforsecs\",\r\n        },\r\n        noopSwitch,\r\n      ];\r\n      blockSwitches[\"looks_switchbackdropto\"] = [\r\n        noopSwitch,\r\n        {\r\n          opcode: \"looks_switchbackdroptoandwait\",\r\n        },\r\n      ];\r\n      blockSwitches[\"looks_switchbackdroptoandwait\"] = [\r\n        {\r\n          opcode: \"looks_switchbackdropto\",\r\n        },\r\n        noopSwitch,\r\n      ];\r\n    }\r\n\r\n    if (addon.settings.get(\"sound\")) {\r\n      blockSwitches[\"sound_play\"] = [\r\n        noopSwitch,\r\n        {\r\n          opcode: \"sound_playuntildone\",\r\n        },\r\n      ];\r\n      blockSwitches[\"sound_playuntildone\"] = [\r\n        {\r\n          opcode: \"sound_play\",\r\n        },\r\n        noopSwitch,\r\n      ];\r\n      blockSwitches[\"sound_seteffectto\"] = [\r\n        noopSwitch,\r\n        {\r\n          opcode: \"sound_changeeffectby\",\r\n        },\r\n      ];\r\n      blockSwitches[\"sound_changeeffectby\"] = [\r\n        {\r\n          opcode: \"sound_seteffectto\",\r\n        },\r\n        noopSwitch,\r\n      ];\r\n      blockSwitches[\"sound_setvolumeto\"] = [\r\n        noopSwitch,\r\n        {\r\n          opcode: \"sound_changevolumeby\",\r\n        },\r\n      ];\r\n      blockSwitches[\"sound_changevolumeby\"] = [\r\n        {\r\n          opcode: \"sound_setvolumeto\",\r\n        },\r\n        noopSwitch,\r\n      ];\r\n    }\r\n\r\n    if (addon.settings.get(\"event\")) {\r\n      blockSwitches[\"event_broadcast\"] = [\r\n        noopSwitch,\r\n        {\r\n          opcode: \"event_broadcastandwait\",\r\n        },\r\n      ];\r\n      blockSwitches[\"event_broadcastandwait\"] = [\r\n        {\r\n          opcode: \"event_broadcast\",\r\n        },\r\n        noopSwitch,\r\n      ];\r\n    }\r\n\r\n    if (addon.settings.get(\"control\")) {\r\n      blockSwitches[\"control_if\"] = [\r\n        noopSwitch,\r\n        {\r\n          opcode: \"control_if_else\",\r\n        },\r\n      ];\r\n      blockSwitches[\"control_if_else\"] = [\r\n        {\r\n          opcode: \"control_if\",\r\n          remap: { SUBSTACK2: \"split\" },\r\n        },\r\n        noopSwitch,\r\n      ];\r\n      blockSwitches[\"control_repeat_until\"] = [\r\n        noopSwitch,\r\n        {\r\n          opcode: \"control_wait_until\",\r\n          remap: { SUBSTACK: \"split\" },\r\n        },\r\n        {\r\n          opcode: \"control_forever\",\r\n          remap: { CONDITION: \"split\" },\r\n        },\r\n      ];\r\n      blockSwitches[\"control_forever\"] = [\r\n        {\r\n          opcode: \"control_repeat_until\",\r\n        },\r\n        noopSwitch,\r\n      ];\r\n      blockSwitches[\"control_wait_until\"] = [\r\n        {\r\n          opcode: \"control_repeat_until\",\r\n        },\r\n        noopSwitch,\r\n      ];\r\n    }\r\n\r\n    if (addon.settings.get(\"operator\")) {\r\n      blockSwitches[\"operator_equals\"] = [\r\n        {\r\n          opcode: \"operator_gt\",\r\n        },\r\n        noopSwitch,\r\n        {\r\n          opcode: \"operator_lt\",\r\n        },\r\n      ];\r\n      blockSwitches[\"operator_gt\"] = [\r\n        noopSwitch,\r\n        {\r\n          opcode: \"operator_equals\",\r\n        },\r\n        {\r\n          opcode: \"operator_lt\",\r\n        },\r\n      ];\r\n      blockSwitches[\"operator_lt\"] = [\r\n        {\r\n          opcode: \"operator_gt\",\r\n        },\r\n        {\r\n          opcode: \"operator_equals\",\r\n        },\r\n        noopSwitch,\r\n      ];\r\n      blockSwitches[\"operator_add\"] = [\r\n        noopSwitch,\r\n        {\r\n          opcode: \"operator_subtract\",\r\n        },\r\n        {\r\n          opcode: \"operator_multiply\",\r\n        },\r\n        {\r\n          opcode: \"operator_divide\",\r\n        },\r\n        {\r\n          opcode: \"operator_mod\",\r\n        },\r\n      ];\r\n      blockSwitches[\"operator_subtract\"] = [\r\n        {\r\n          opcode: \"operator_add\",\r\n        },\r\n        noopSwitch,\r\n        {\r\n          opcode: \"operator_multiply\",\r\n        },\r\n        {\r\n          opcode: \"operator_divide\",\r\n        },\r\n        {\r\n          opcode: \"operator_mod\",\r\n        },\r\n      ];\r\n      blockSwitches[\"operator_multiply\"] = [\r\n        {\r\n          opcode: \"operator_add\",\r\n        },\r\n        {\r\n          opcode: \"operator_subtract\",\r\n        },\r\n        noopSwitch,\r\n        {\r\n          opcode: \"operator_divide\",\r\n        },\r\n        {\r\n          opcode: \"operator_mod\",\r\n        },\r\n      ];\r\n      blockSwitches[\"operator_divide\"] = [\r\n        {\r\n          opcode: \"operator_add\",\r\n        },\r\n        {\r\n          opcode: \"operator_subtract\",\r\n        },\r\n        {\r\n          opcode: \"operator_multiply\",\r\n        },\r\n        noopSwitch,\r\n        {\r\n          opcode: \"operator_mod\",\r\n        },\r\n      ];\r\n      blockSwitches[\"operator_mod\"] = [\r\n        {\r\n          opcode: \"operator_add\",\r\n        },\r\n        {\r\n          opcode: \"operator_subtract\",\r\n        },\r\n        {\r\n          opcode: \"operator_multiply\",\r\n        },\r\n        {\r\n          opcode: \"operator_divide\",\r\n        },\r\n        noopSwitch,\r\n      ];\r\n      blockSwitches[\"operator_and\"] = [\r\n        noopSwitch,\r\n        {\r\n          opcode: \"operator_or\",\r\n        },\r\n      ];\r\n      blockSwitches[\"operator_or\"] = [\r\n        {\r\n          opcode: \"operator_and\",\r\n        },\r\n        noopSwitch,\r\n      ];\r\n    }\r\n\r\n    if (addon.settings.get(\"sensing\")) {\r\n      blockSwitches[\"sensing_mousex\"] = [\r\n        noopSwitch,\r\n        {\r\n          opcode: \"sensing_mousey\",\r\n        },\r\n      ];\r\n      blockSwitches[\"sensing_mousey\"] = [\r\n        {\r\n          opcode: \"sensing_mousex\",\r\n        },\r\n        noopSwitch,\r\n      ];\r\n    }\r\n\r\n    if (addon.settings.get(\"data\")) {\r\n      blockSwitches[\"data_setvariableto\"] = [\r\n        noopSwitch,\r\n        {\r\n          opcode: \"data_changevariableby\",\r\n          remapValueType: { VALUE: \"math_number\" },\r\n        },\r\n      ];\r\n      blockSwitches[\"data_changevariableby\"] = [\r\n        {\r\n          opcode: \"data_setvariableto\",\r\n          remapValueType: { VALUE: \"text\" },\r\n        },\r\n        noopSwitch,\r\n      ];\r\n      blockSwitches[\"data_showvariable\"] = [\r\n        noopSwitch,\r\n        {\r\n          opcode: \"data_hidevariable\",\r\n        },\r\n      ];\r\n      blockSwitches[\"data_hidevariable\"] = [\r\n        {\r\n          opcode: \"data_showvariable\",\r\n        },\r\n        noopSwitch,\r\n      ];\r\n      blockSwitches[\"data_showlist\"] = [\r\n        noopSwitch,\r\n        {\r\n          opcode: \"data_hidelist\",\r\n        },\r\n      ];\r\n      blockSwitches[\"data_hidelist\"] = [\r\n        {\r\n          opcode: \"data_showlist\",\r\n        },\r\n        noopSwitch,\r\n      ];\r\n      blockSwitches[\"data_replaceitemoflist\"] = [\r\n        noopSwitch,\r\n        {\r\n          opcode: \"data_insertatlist\",\r\n        },\r\n      ];\r\n      blockSwitches[\"data_insertatlist\"] = [\r\n        {\r\n          opcode: \"data_replaceitemoflist\",\r\n        },\r\n        noopSwitch,\r\n      ];\r\n    }\r\n\r\n    if (addon.settings.get(\"extension\")) {\r\n      blockSwitches[\"pen_penDown\"] = [\r\n        noopSwitch,\r\n        {\r\n          opcode: \"pen_penUp\",\r\n        },\r\n      ];\r\n      blockSwitches[\"pen_penUp\"] = [\r\n        {\r\n          opcode: \"pen_penDown\",\r\n        },\r\n        noopSwitch,\r\n      ];\r\n      blockSwitches[\"pen_setPenColorParamTo\"] = [\r\n        noopSwitch,\r\n        {\r\n          opcode: \"pen_changePenColorParamBy\",\r\n        },\r\n      ];\r\n      blockSwitches[\"pen_changePenColorParamBy\"] = [\r\n        {\r\n          opcode: \"pen_setPenColorParamTo\",\r\n        },\r\n        noopSwitch,\r\n      ];\r\n      blockSwitches[\"pen_setPenHueToNumber\"] = [\r\n        noopSwitch,\r\n        {\r\n          opcode: \"pen_changePenHueBy\",\r\n        },\r\n      ];\r\n      blockSwitches[\"pen_changePenHueBy\"] = [\r\n        {\r\n          opcode: \"pen_setPenHueToNumber\",\r\n        },\r\n        noopSwitch,\r\n      ];\r\n      blockSwitches[\"pen_setPenShadeToNumber\"] = [\r\n        noopSwitch,\r\n        {\r\n          opcode: \"pen_changePenShadeBy\",\r\n        },\r\n      ];\r\n      blockSwitches[\"pen_changePenShadeBy\"] = [\r\n        {\r\n          opcode: \"pen_setPenShadeToNumber\",\r\n        },\r\n        noopSwitch,\r\n      ];\r\n      blockSwitches[\"pen_setPenSizeTo\"] = [\r\n        noopSwitch,\r\n        {\r\n          opcode: \"pen_changePenSizeBy\",\r\n        },\r\n      ];\r\n      blockSwitches[\"pen_changePenSizeBy\"] = [\r\n        {\r\n          opcode: \"pen_setPenSizeTo\",\r\n        },\r\n        noopSwitch,\r\n      ];\r\n      blockSwitches[\"music_setTempo\"] = [\r\n        noopSwitch,\r\n        {\r\n          opcode: \"music_changeTempo\",\r\n        },\r\n      ];\r\n      blockSwitches[\"music_changeTempo\"] = [\r\n        {\r\n          opcode: \"music_setTempo\",\r\n        },\r\n        noopSwitch,\r\n      ];\r\n    }\r\n\r\n    if (addon.settings.get(\"sa\")) {\r\n      const logProc = \"\\u200B\\u200Blog\\u200B\\u200B %s\";\r\n      const warnProc = \"\\u200B\\u200Bwarn\\u200B\\u200B %s\";\r\n      const errorProc = \"\\u200B\\u200Berror\\u200B\\u200B %s\";\r\n      const logMessage = msg(\"debugger_log\");\r\n      const warnMessage = msg(\"debugger_warn\");\r\n      const errorMessage = msg(\"debugger_error\");\r\n      const logSwitch = {\r\n        mutate: {\r\n          proccode: logProc,\r\n        },\r\n        msg: logMessage,\r\n      };\r\n      const warnSwitch = {\r\n        mutate: {\r\n          proccode: warnProc,\r\n        },\r\n        msg: warnMessage,\r\n      };\r\n      const errorSwitch = {\r\n        mutate: {\r\n          proccode: errorProc,\r\n        },\r\n        msg: errorMessage,\r\n      };\r\n      procedureSwitches[logProc] = [\r\n        {\r\n          msg: logMessage,\r\n          isNoop: true,\r\n        },\r\n        warnSwitch,\r\n        errorSwitch,\r\n      ];\r\n      procedureSwitches[warnProc] = [\r\n        logSwitch,\r\n        {\r\n          msg: warnMessage,\r\n          isNoop: true,\r\n        },\r\n        errorSwitch,\r\n      ];\r\n      procedureSwitches[errorProc] = [\r\n        logSwitch,\r\n        warnSwitch,\r\n        {\r\n          msg: errorMessage,\r\n          isNoop: true,\r\n        },\r\n      ];\r\n    }\r\n\r\n    // Switching for these is implemented by Scratch. We only define them here to optionally add a border.\r\n    // Because we don't implement the switching ourselves, this is not controlled by the data category option.\r\n    blockSwitches[\"data_variable\"] = [];\r\n    blockSwitches[\"data_listcontents\"] = [];\r\n  };\r\n  buildSwitches();\r\n  addon.settings.addEventListener(\"change\", buildSwitches);\r\n\r\n  const menuCallbackFactory = (block, opcodeData) => () => {\r\n    if (opcodeData.isNoop) {\r\n      return;\r\n    }\r\n\r\n    if (opcodeData.fieldValue) {\r\n      block.setFieldValue(opcodeData.fieldValue, \"VALUE\");\r\n      return;\r\n    }\r\n\r\n    const workspace = block.workspace;\r\n\r\n    // Make a copy of the block with the proper type set.\r\n    // It doesn't seem to be possible to change a Block's type after it's created, so we'll just make a new block instead.\r\n    const xml = blockToDom(block);\r\n    if (opcodeData.opcode) {\r\n      xml.setAttribute(\"type\", opcodeData.opcode);\r\n    }\r\n\r\n    const id = block.id;\r\n    const parent = block.getParent();\r\n\r\n    let parentConnection;\r\n    let blockConnectionType;\r\n    if (parent) {\r\n      // If the block has a parent, find the parent -> child connection that will be reattached later.\r\n      const parentConnections = parent.getConnections_();\r\n      parentConnection = parentConnections.find((c) => c.targetConnection && c.targetConnection.sourceBlock_ === block);\r\n      // There's two types of connections from child -> parent. We need to figure out which one is used.\r\n      const blockConnections = block.getConnections_();\r\n      const blockToParentConnection = blockConnections.find(\r\n        (c) => c.targetConnection && c.targetConnection.sourceBlock_ === parent\r\n      );\r\n      blockConnectionType = blockToParentConnection.type;\r\n    }\r\n\r\n    const pasteSeparately = [];\r\n\r\n    // Apply input remappings.\r\n    if (opcodeData.remap) {\r\n      for (const child of Array.from(xml.children)) {\r\n        const oldName = child.getAttribute(\"name\");\r\n        const newName = opcodeData.remap[oldName];\r\n        if (newName) {\r\n          if (newName === \"split\") {\r\n            // This input will be split off into its own script.\r\n            const inputXml = child.firstChild;\r\n            const inputId = inputXml.id;\r\n            const inputBlock = workspace.getBlockById(inputId);\r\n            const position = inputBlock.getRelativeToSurfaceXY();\r\n            inputXml.setAttribute(\"x\", Math.round(workspace.RTL ? -position.x : position.x));\r\n            inputXml.setAttribute(\"y\", Math.round(position.y));\r\n            pasteSeparately.push(inputXml);\r\n            xml.removeChild(child);\r\n          } else {\r\n            child.setAttribute(\"name\", newName);\r\n          }\r\n        }\r\n      }\r\n    }\r\n    if (opcodeData.remapValueType) {\r\n      for (const child of Array.from(xml.children)) {\r\n        const name = child.getAttribute(\"name\");\r\n        const newType = opcodeData.remapValueType[name];\r\n        if (newType) {\r\n          const valueNode = child.firstChild;\r\n          const fieldNode = valueNode.firstChild;\r\n          valueNode.setAttribute(\"type\", newType);\r\n          fieldNode.setAttribute(\"name\", newType === \"text\" ? \"TEXT\" : \"NUM\");\r\n        }\r\n      }\r\n    }\r\n    if (opcodeData.mutate) {\r\n      const mutation = xml.querySelector(\"mutation\");\r\n      for (const [key, value] of Object.entries(opcodeData.mutate)) {\r\n        mutation.setAttribute(key, value);\r\n      }\r\n    }\r\n\r\n    try {\r\n      ScratchBlocks.Events.setGroup(true);\r\n\r\n      // Remove the old block and insert the new one.\r\n      block.dispose();\r\n      workspace.paste(xml);\r\n      for (const separateBlock of pasteSeparately) {\r\n        workspace.paste(separateBlock);\r\n      }\r\n      // The new block will have the same ID as the old one.\r\n      const newBlock = workspace.getBlockById(id);\r\n      if (parentConnection) {\r\n        // Search for the same type of connection on the new block as on the old block.\r\n        const newBlockConnections = newBlock.getConnections_();\r\n        const newBlockConnection = newBlockConnections.find((c) => c.type === blockConnectionType);\r\n        newBlockConnection.connect(parentConnection);\r\n      }\r\n    } finally {\r\n      ScratchBlocks.Events.setGroup(false);\r\n    }\r\n  };\r\n\r\n  const uniques = (array) => [...new Set(array)];\r\n\r\n  addon.tab.createBlockContextMenu(\r\n    (items, block) => {\r\n      if (!addon.self.disabled) {\r\n        const type = block.type;\r\n        let switches = blockSwitches[block.type] || [];\r\n\r\n        const customArgsMode = addon.settings.get(\"customargs\") ? addon.settings.get(\"customargsmode\") : \"off\";\r\n        if (\r\n          customArgsMode !== \"off\" &&\r\n          [\"argument_reporter_boolean\", \"argument_reporter_string_number\"].includes(type) &&\r\n          // if the arg is a shadow, it's in a procedures_prototype so we don't want it to be switchable\r\n          !block.isShadow()\r\n        ) {\r\n          const customBlocks = getCustomBlocks();\r\n          if (customArgsMode === \"all\") {\r\n            switch (type) {\r\n              case \"argument_reporter_string_number\":\r\n                switches = Object.values(customBlocks)\r\n                  .map((cb) => cb.stringArgs)\r\n                  .flat(1);\r\n                break;\r\n              case \"argument_reporter_boolean\":\r\n                switches = Object.values(customBlocks)\r\n                  .map((cb) => cb.boolArgs)\r\n                  .flat(1);\r\n                break;\r\n            }\r\n          } else if (customArgsMode === \"defOnly\") {\r\n            const root = block.getRootBlock();\r\n            if (root.type !== \"procedures_definition\") return items;\r\n            const customBlockObj = customBlocks[root.getChildren(true)[0].getProcCode()];\r\n            switch (type) {\r\n              case \"argument_reporter_string_number\":\r\n                switches = customBlockObj.stringArgs;\r\n                break;\r\n              case \"argument_reporter_boolean\":\r\n                switches = customBlockObj.boolArgs;\r\n                break;\r\n            }\r\n          }\r\n          const currentValue = block.getFieldValue(\"VALUE\");\r\n          switches = uniques(switches).map((i) => ({\r\n            isNoop: i === currentValue,\r\n            fieldValue: i,\r\n            msg: i,\r\n          }));\r\n        }\r\n\r\n        if (block.type === \"procedures_call\") {\r\n          const proccode = block.getProcCode();\r\n          if (procedureSwitches[proccode]) {\r\n            switches = procedureSwitches[proccode];\r\n          }\r\n        }\r\n\r\n        if (!addon.settings.get(\"noop\")) {\r\n          switches = switches.filter((i) => !i.isNoop);\r\n        }\r\n\r\n        switches.forEach((opcodeData, i) => {\r\n          const makeSpaceItemIndex = items.findIndex((obj) => obj._isDevtoolsFirstItem);\r\n          const insertBeforeIndex =\r\n            makeSpaceItemIndex !== -1\r\n              ? // If \"make space\" button exists, add own items before it\r\n                makeSpaceItemIndex\r\n              : // If there's no such button, insert at end\r\n                items.length;\r\n          const text = opcodeData.msg ? opcodeData.msg : opcodeData.opcode ? msg(opcodeData.opcode) : msg(block.type);\r\n          items.splice(insertBeforeIndex, 0, {\r\n            enabled: true,\r\n            text,\r\n            callback: menuCallbackFactory(block, opcodeData),\r\n            separator: addon.settings.get(\"border\") && i === 0,\r\n          });\r\n        });\r\n\r\n        if (addon.settings.get(\"border\") && (block.type === \"data_variable\" || block.type === \"data_listcontents\")) {\r\n          // Add top border to first variable (if it exists)\r\n          const delBlockIndex = items.findIndex((item) => item.text === ScratchBlocks.Msg.DELETE_BLOCK);\r\n          // firstVariableItem might be undefined, a variable to switch to,\r\n          // or an item added by editor-devtools (or any addon before this one)\r\n          const firstVariableItem = items[delBlockIndex + 1];\r\n          if (firstVariableItem) firstVariableItem.separator = true;\r\n        }\r\n      }\r\n      return items;\r\n    },\r\n    { blocks: true }\r\n  );\r\n\r\n  // https://github.com/LLK/scratch-blocks/blob/abbfe93136fef57fdfb9a077198b0bc64726f012/blocks_vertical/procedures.js#L207-L215\r\n  // Returns a list like [\"%s\", \"%d\"]\r\n  const parseArguments = (code) =>\r\n    code\r\n      .split(/(?=[^\\\\]%[nbs])/g)\r\n      .map((i) => i.trim())\r\n      .filter((i) => i.charAt(0) === \"%\")\r\n      .map((i) => i.substring(0, 2));\r\n\r\n  const getCustomBlocks = () => {\r\n    const customBlocks = {};\r\n    const target = vm.editingTarget;\r\n    Object.values(target.blocks._blocks)\r\n      .filter((block) => block.opcode === \"procedures_prototype\")\r\n      .forEach((block) => {\r\n        const procCode = block.mutation.proccode;\r\n        const argumentNames = JSON.parse(block.mutation.argumentnames);\r\n        // argumentdefaults is unreliable, so we have to parse the procedure code to determine argument types\r\n        const parsedArguments = parseArguments(procCode);\r\n        const stringArgs = [];\r\n        const boolArgs = [];\r\n        for (let i = 0; i < argumentNames.length; i++) {\r\n          if (parsedArguments[i] === \"%b\") {\r\n            boolArgs.push(argumentNames[i]);\r\n          } else {\r\n            stringArgs.push(argumentNames[i]);\r\n          }\r\n        }\r\n        customBlocks[procCode] = {\r\n          stringArgs,\r\n          boolArgs,\r\n        };\r\n      });\r\n    return customBlocks;\r\n  };\r\n}\r\n","/* generated by pull.js */\nimport _js from \"./userscript.js\";\nimport _css from \"!css-loader!./style.css\";\nexport const resources = {\n  \"userscript.js\": _js,\n  \"style.css\": _css,\n};\n","import { normalizeHex, getHexRegex } from \"../../libraries/common/cs/normalize-color.js\";\r\nimport RateLimiter from \"../../libraries/common/cs/rate-limiter.js\";\r\nimport tinycolor from \"../../libraries/thirdparty/cs/tinycolor-min.js\";\r\n\r\nexport default async ({ addon, console, msg }) => {\r\n  // 250-ms rate limit\r\n  const rateLimiter = new RateLimiter(250);\r\n  const getColor = (element) => {\r\n    const { children } = element.parentElement;\r\n    // h: 0 - 360\r\n    const h = children[1].getAttribute(\"aria-valuenow\");\r\n    // s: 0 - 1\r\n    const s = children[3].getAttribute(\"aria-valuenow\");\r\n    // v: 0 - 255, divide by 255\r\n    const vMultipliedBy255 = children[5].getAttribute(\"aria-valuenow\");\r\n    const v = Number(vMultipliedBy255) / 255;\r\n    return tinycolor(`hsv(${h}, ${s}, ${v || 0})`).toHexString();\r\n  };\r\n  const setColor = (hex, element) => {\r\n    hex = normalizeHex(hex);\r\n    if (!addon.tab.redux.state || !addon.tab.redux.state.scratchGui) return;\r\n    // The only way to reliably set color is to invoke eye dropper via click()\r\n    // then faking that the eye dropper reported the value.\r\n    const onEyeDropperClosed = ({ detail }) => {\r\n      if (detail.action.type !== \"scratch-gui/color-picker/DEACTIVATE_COLOR_PICKER\") return;\r\n      addon.tab.redux.removeEventListener(\"statechanged\", onEyeDropperClosed);\r\n      setTimeout(() => {\r\n        document.body.classList.remove(\"sa-hide-eye-dropper-background\");\r\n      }, 50);\r\n    };\r\n    const onEyeDropperOpened = ({ detail }) => {\r\n      if (detail.action.type !== \"scratch-gui/color-picker/ACTIVATE_COLOR_PICKER\") return;\r\n      addon.tab.redux.removeEventListener(\"statechanged\", onEyeDropperOpened);\r\n      addon.tab.redux.addEventListener(\"statechanged\", onEyeDropperClosed);\r\n      setTimeout(() => {\r\n        addon.tab.redux.dispatch({\r\n          type: \"scratch-gui/color-picker/DEACTIVATE_COLOR_PICKER\",\r\n          color: hex,\r\n        });\r\n      }, 50);\r\n    };\r\n    addon.tab.redux.addEventListener(\"statechanged\", onEyeDropperOpened);\r\n    document.body.classList.add(\"sa-hide-eye-dropper-background\");\r\n    element.click();\r\n  };\r\n  const addColorPicker = () => {\r\n    const element = document.querySelector(\"button.scratchEyedropper\");\r\n    rateLimiter.abort(false);\r\n    addon.tab.redux.initialize();\r\n    const defaultColor = getColor(element);\r\n    const saColorPicker = Object.assign(document.createElement(\"div\"), {\r\n      className: \"sa-color-picker sa-color-picker-code\",\r\n    });\r\n    addon.tab.displayNoneWhileDisabled(saColorPicker, { display: \"flex\" });\r\n    const saColorPickerColor = Object.assign(document.createElement(\"input\"), {\r\n      className: \"sa-color-picker-color sa-color-picker-code-color\",\r\n      type: \"color\",\r\n      value: defaultColor || \"#000000\",\r\n    });\r\n    const saColorPickerText = Object.assign(document.createElement(\"input\"), {\r\n      className: addon.tab.scratchClass(\"input_input-form\", {\r\n        others: \"sa-color-picker-text sa-color-picker-code-text\",\r\n      }),\r\n      type: \"text\",\r\n      pattern: \"^#?([0-9a-fA-F]{3}){1,2}$\",\r\n      placeholder: msg(\"hex\"),\r\n      value: defaultColor || \"\",\r\n    });\r\n    saColorPickerColor.addEventListener(\"input\", () =>\r\n      rateLimiter.limit(() => setColor((saColorPickerText.value = saColorPickerColor.value), element))\r\n    );\r\n    saColorPickerText.addEventListener(\"change\", () => {\r\n      const { value } = saColorPickerText;\r\n      if (!getHexRegex().test(value)) return;\r\n      setColor((saColorPickerColor.value = normalizeHex(value)), element);\r\n    });\r\n    saColorPicker.appendChild(saColorPickerColor);\r\n    saColorPicker.appendChild(saColorPickerText);\r\n    element.parentElement.insertBefore(saColorPicker, element);\r\n  };\r\n  const ScratchBlocks = await addon.tab.traps.getBlockly();\r\n  const originalShowEditor = ScratchBlocks.FieldColourSlider.prototype.showEditor_;\r\n  ScratchBlocks.FieldColourSlider.prototype.showEditor_ = function (...args) {\r\n    const r = originalShowEditor.call(this, ...args);\r\n    addColorPicker();\r\n    return r;\r\n  };\r\n};\r\n","import codeEditorHandler from \"./code-editor.js\";\r\n\r\nexport default async (api) => {\r\n  codeEditorHandler(api);\r\n};\r\n","/* generated by pull.js */\nimport _js from \"./userscript.js\";\nimport _css from \"!css-loader!./userstyle.css\";\nexport const resources = {\n  \"userscript.js\": _js,\n  \"userstyle.css\": _css,\n};\n","export default async function ({ addon, global, console }) {\r\n  const vm = addon.tab.traps.vm;\r\n\r\n  const updateStyles = () => {\r\n    previewInner.classList.toggle(\"sa-comment-preview-delay\", addon.settings.get(\"delay\") !== \"none\");\r\n    previewInner.classList.toggle(\"sa-comment-preview-reduce-transparency\", addon.settings.get(\"reduce-transparency\"));\r\n    previewInner.classList.toggle(\"sa-comment-preview-fade\", !addon.settings.get(\"reduce-animation\"));\r\n  };\r\n\r\n  const afterDelay = (cb) => {\r\n    if (!previewInner.classList.contains(\"sa-comment-preview-hidden\")) {\r\n      // If not hidden, updating immediately is preferred\r\n      cb();\r\n      return;\r\n    }\r\n    const delay = addon.settings.get(\"delay\");\r\n    if (delay === \"long\") return setTimeout(cb, 500);\r\n    if (delay === \"short\") return setTimeout(cb, 300);\r\n    cb();\r\n  };\r\n\r\n  let hoveredElement = null;\r\n  let showTimeout = null;\r\n  let mouseX = 0;\r\n  let mouseY = 0;\r\n  let doNotShowUntilMoveMouse = false;\r\n\r\n  const previewOuter = document.createElement(\"div\");\r\n  previewOuter.classList.add(\"sa-comment-preview-outer\");\r\n  const previewInner = document.createElement(\"div\");\r\n  previewInner.classList.add(\"sa-comment-preview-inner\");\r\n  previewInner.classList.add(\"sa-comment-preview-hidden\");\r\n  updateStyles();\r\n  addon.settings.addEventListener(\"change\", updateStyles);\r\n  previewOuter.appendChild(previewInner);\r\n  document.body.appendChild(previewOuter);\r\n\r\n  const getBlock = (id) => vm.editingTarget.blocks.getBlock(id) || vm.runtime.flyoutBlocks.getBlock(id);\r\n  const getComment = (block) => block && block.comment && vm.editingTarget.comments[block.comment];\r\n  const getProcedureDefinitionBlock = (procCode) => {\r\n    const procedurePrototype = Object.values(vm.editingTarget.blocks._blocks).find(\r\n      (i) => i.opcode === \"procedures_prototype\" && i.mutation.proccode === procCode\r\n    );\r\n    if (procedurePrototype) {\r\n      // Usually `parent` will exist but sometimes it doesn't\r\n      if (procedurePrototype.parent) {\r\n        return getBlock(procedurePrototype.parent);\r\n      }\r\n      const id = procedurePrototype.id;\r\n      return Object.values(vm.editingTarget.blocks._blocks).find(\r\n        (i) => i.opcode === \"procedures_definition\" && i.inputs.custom_block && i.inputs.custom_block.block === id\r\n      );\r\n    }\r\n    return null;\r\n  };\r\n\r\n  const setText = (text) => {\r\n    previewInner.innerText = text;\r\n    previewInner.classList.remove(\"sa-comment-preview-hidden\");\r\n    updateMousePosition();\r\n  };\r\n\r\n  const updateMousePosition = () => {\r\n    previewOuter.style.transform = `translate(${mouseX + 8}px, ${mouseY + 8}px)`;\r\n  };\r\n\r\n  const hidePreview = () => {\r\n    if (hoveredElement) {\r\n      hoveredElement = null;\r\n      previewInner.classList.add(\"sa-comment-preview-hidden\");\r\n    }\r\n  };\r\n\r\n  document.addEventListener(\"mouseover\", (e) => {\r\n    if (addon.self.disabled) {\r\n      return;\r\n    }\r\n    clearTimeout(showTimeout);\r\n    if (doNotShowUntilMoveMouse) {\r\n      return;\r\n    }\r\n\r\n    const el = e.target.closest(\".blocklyBubbleCanvas > g, .blocklyBlockCanvas .blocklyDraggable[data-id]\");\r\n    if (el === hoveredElement) {\r\n      // Nothing to do.\r\n      return;\r\n    }\r\n    if (!el) {\r\n      hidePreview();\r\n      return;\r\n    }\r\n\r\n    let text = null;\r\n    if (\r\n      addon.settings.get(\"hover-view\") &&\r\n      e.target.closest(\".blocklyBubbleCanvas > g\") &&\r\n      // Hovering over the thin line that connects comments to blocks should never show a preview\r\n      !e.target.closest(\"line\")\r\n    ) {\r\n      const collapsedText = el.querySelector(\"text.scratchCommentText\");\r\n      if (collapsedText.getAttribute(\"display\") !== \"none\") {\r\n        const textarea = el.querySelector(\"textarea\");\r\n        text = textarea.value;\r\n      }\r\n    } else if (e.target.closest(\".blocklyBlockCanvas .blocklyDraggable[data-id]\")) {\r\n      const id = el.dataset.id;\r\n      const block = getBlock(id);\r\n      const comment = getComment(block);\r\n      if (addon.settings.get(\"hover-view-block\") && comment) {\r\n        text = comment.text;\r\n      } else if (block && block.opcode === \"procedures_call\" && addon.settings.get(\"hover-view-procedure\")) {\r\n        const procCode = block.mutation.proccode;\r\n        const procedureDefinitionBlock = getProcedureDefinitionBlock(procCode);\r\n        const procedureComment = getComment(procedureDefinitionBlock);\r\n        if (procedureComment) {\r\n          text = procedureComment.text;\r\n        }\r\n      }\r\n    }\r\n\r\n    if (text !== null && text.trim() !== \"\") {\r\n      showTimeout = afterDelay(() => {\r\n        hoveredElement = el;\r\n        setText(text);\r\n      });\r\n    } else {\r\n      hidePreview();\r\n    }\r\n  });\r\n\r\n  document.addEventListener(\"mousemove\", (e) => {\r\n    mouseX = e.clientX;\r\n    mouseY = e.clientY;\r\n    doNotShowUntilMoveMouse = false;\r\n    if (addon.settings.get(\"follow-mouse\") && !previewInner.classList.contains(\"sa-comment-preview-hidden\")) {\r\n      updateMousePosition();\r\n    }\r\n  });\r\n\r\n  document.addEventListener(\r\n    \"mousedown\",\r\n    () => {\r\n      hidePreview();\r\n      doNotShowUntilMoveMouse = true;\r\n    },\r\n    {\r\n      capture: true,\r\n    }\r\n  );\r\n}\r\n","/**\r\n * Encapsulates a block (either in this sprite or another / Blockly, or native JSON block\r\n */\r\nexport default class BlockInstance {\r\n  constructor(target, block) {\r\n    this.targetId = target.id;\r\n    this.id = block.id;\r\n  }\r\n}\r\n","export default class BlockItem {\r\n  constructor(cls, procCode, labelID, y) {\r\n    this.cls = cls;\r\n    this.procCode = procCode;\r\n    this.labelID = labelID;\r\n    this.y = y;\r\n    this.lower = procCode.toLowerCase();\r\n    /**\r\n     * An Array of block ids\r\n     * @type {Array.<string>}\r\n     */\r\n    this.clones = null;\r\n    this.eventName = null;\r\n  }\r\n\r\n  /**\r\n   * True if the blockID matches a black represented by this BlockItem\r\n   * @param id\r\n   * @returns {boolean}\r\n   */\r\n  matchesID(id) {\r\n    if (this.labelID === id) {\r\n      return true;\r\n    }\r\n    if (this.clones) {\r\n      for (const cloneID of this.clones) {\r\n        if (cloneID === id) {\r\n          return true;\r\n        }\r\n      }\r\n    }\r\n    return false;\r\n  }\r\n}\r\n","// import ShowBroadcast from \"./show-broadcast.js\";\r\nimport Utils from \"./blockly/Utils.js\";\r\nimport DomHelpers from \"./DomHelpers.js\";\r\nimport BlockInstance from \"./BlockInstance.js\";\r\nimport XML from \"./XML.js\";\r\nimport BlockItem from \"./BlockItem.js\";\r\nimport UndoGroup from \"./blockly/UndoGroup.js\";\r\n\r\nexport default class DevTools {\r\n  constructor(addon, msg, m, helpHTML) {\r\n    this.addon = addon;\r\n    this.msg = msg;\r\n    this.m = m;\r\n    /**\r\n     * @type {VirtualMachine}\r\n     */\r\n    this.vm = addon.tab.traps.vm;\r\n    this.utils = new Utils(addon);\r\n    this.domHelpers = new DomHelpers(addon);\r\n    this.multi = new Multi(this.utils);\r\n\r\n    this._helpHTML = helpHTML;\r\n    this.find = null;\r\n    this.findInp = null;\r\n    this.ddOut = null;\r\n    this.dd = null;\r\n    this.codeTab = null;\r\n    this.costTab = null;\r\n    this.costTabBody = null;\r\n    this.selVarID = null;\r\n    this.floatInp = null;\r\n    this.blockCursor = null;\r\n    this.canShare = false;\r\n\r\n    this.mouseXY = { x: 0, y: 0 };\r\n  }\r\n\r\n  async init() {\r\n    this.addContextMenus();\r\n    while (true) {\r\n      const root = await this.addon.tab.waitForElement(\"ul[class*=gui_tab-list_]\", {\r\n        markAsSeen: true,\r\n        reduxEvents: [\r\n          \"scratch-gui/mode/SET_PLAYER\",\r\n          \"fontsLoaded/SET_FONTS_LOADED\",\r\n          \"scratch-gui/locales/SELECT_LOCALE\",\r\n        ],\r\n        reduxCondition: (state) => !state.scratchGui.mode.isPlayerOnly,\r\n      });\r\n      this.initInner(root);\r\n    }\r\n  }\r\n  async addContextMenus() {\r\n    const blockly = await this.addon.tab.traps.getBlockly();\r\n    const oldCleanUpFunc = blockly.WorkspaceSvg.prototype.cleanUp;\r\n    const self = this;\r\n    blockly.WorkspaceSvg.prototype.cleanUp = function () {\r\n      if (self.addon.settings.get(\"enableCleanUpPlus\")) {\r\n        self.doCleanUp();\r\n      } else {\r\n        oldCleanUpFunc.call(this);\r\n      }\r\n    };\r\n\r\n    let originalMsg = blockly.Msg.CLEAN_UP;\r\n    if (this.addon.settings.get(\"enableCleanUpPlus\")) blockly.Msg.CLEAN_UP = this.m(\"clean-plus\");\r\n    this.addon.settings.addEventListener(\"change\", () => {\r\n      if (this.addon.settings.get(\"enableCleanUpPlus\")) blockly.Msg.CLEAN_UP = this.m(\"clean-plus\");\r\n      else blockly.Msg.CLEAN_UP = originalMsg;\r\n    });\r\n\r\n    this.addon.tab.createBlockContextMenu(\r\n      (items, block) => {\r\n        items.push({\r\n          enabled: blockly.clipboardXml_,\r\n          text: this.m(\"paste\"),\r\n          separator: true,\r\n          _isDevtoolsFirstItem: true,\r\n          callback: () => {\r\n            let ids = this.getTopBlockIDs();\r\n\r\n            document.dispatchEvent(\r\n              new KeyboardEvent(\"keydown\", {\r\n                keyCode: 86,\r\n                ctrlKey: true,\r\n                griff: true,\r\n              })\r\n            );\r\n\r\n            setTimeout(() => {\r\n              this.beginDragOfNewBlocksNotInIDs(ids);\r\n            }, 10);\r\n          },\r\n        });\r\n        return items;\r\n      },\r\n      { workspace: true }\r\n    );\r\n    this.addon.tab.createBlockContextMenu(\r\n      (items, block) => {\r\n        items.push(\r\n          {\r\n            enabled: true,\r\n            text: this.m(\"make-space\"),\r\n            _isDevtoolsFirstItem: true,\r\n            callback: () => {\r\n              this.doCleanUp(block);\r\n            },\r\n            separator: true,\r\n          },\r\n          {\r\n            enabled: true,\r\n            text: this.m(\"copy-all\"),\r\n            callback: () => {\r\n              this.eventCopyClick(block);\r\n            },\r\n            separator: true,\r\n          },\r\n          {\r\n            enabled: true,\r\n            text: this.m(\"copy-block\"),\r\n            callback: () => {\r\n              this.eventCopyClick(block, 1);\r\n            },\r\n          },\r\n          {\r\n            enabled: true,\r\n            text: this.m(\"cut-block\"),\r\n            callback: () => {\r\n              this.eventCopyClick(block, 2);\r\n            },\r\n          }\r\n        );\r\n        // const BROADCAST_BLOCKS = [\"event_whenbroadcastreceived\", \"event_broadcast\", \"event_broadcastandwait\"];\r\n        // if (BROADCAST_BLOCKS.includes(block.type)) {\r\n        //   // Show Broadcast\r\n        //   const broadcastId = this.showBroadcastSingleton.getAssociatedBroadcastId(block.id);\r\n        //   if (broadcastId) {\r\n        //     [\"Senders\", \"Receivers\"].forEach((showKey, i) => {\r\n        //       items.push({\r\n        //         enabled: true,\r\n        //         text: this.msg(`show-${showKey}`.toLowerCase()),\r\n        //         callback: () => {\r\n        //           this.showBroadcastSingleton[`show${showKey}`](broadcastId);\r\n        //         },\r\n        //         separator: i == 0,\r\n        //       });\r\n        //     });\r\n        //   }\r\n        // }\r\n        return items;\r\n      },\r\n      { blocks: true }\r\n    );\r\n    this.addon.tab.createBlockContextMenu(\r\n      (items, block) => {\r\n        if (block.getCategory() === \"data\" || block.getCategory() === \"data-lists\") {\r\n          this.selVarID = block.getVars()[0];\r\n          items.push({\r\n            enabled: true,\r\n            text: this.m(\"swap\", { var: block.getCategory() === \"data\" ? this.m(\"variables\") : this.m(\"lists\") }),\r\n            callback: () => {\r\n              let wksp = this.utils.getWorkspace();\r\n              let v = wksp.getVariableById(this.selVarID);\r\n              let varName = window.prompt(this.msg(\"replace\", { name: v.name }));\r\n              if (varName) {\r\n                this.doReplaceVariable(this.selVarID, varName, v.type);\r\n              }\r\n            },\r\n            separator: true,\r\n          });\r\n        }\r\n        return items;\r\n      },\r\n      { blocks: true, flyout: true }\r\n    );\r\n  }\r\n\r\n  isScriptEditor() {\r\n    return this.codeTab.className.indexOf(\"gui_is-selected\") >= 0;\r\n  }\r\n\r\n  isCostumeEditor() {\r\n    return this.costTab.className.indexOf(\"gui_is-selected\") >= 0;\r\n  }\r\n\r\n  eventClickHelp(e) {\r\n    if (!document.getElementById(\"s3devHelpPop\")) {\r\n      document.body.insertAdjacentHTML(\"beforeend\", this._helpHTML);\r\n      document.getElementById(\"s3devHelpPop\").addEventListener(\"mousedown\", function (e) {\r\n        if (e.target.id === \"s3devHelpPop\") {\r\n          e.target.remove();\r\n        }\r\n      });\r\n      document.querySelector(\"#s3devHelpPop .close-button\").addEventListener(\"click\", function (e) {\r\n        document.getElementById(\"s3devHelpPop\").remove();\r\n      });\r\n    }\r\n    e.preventDefault();\r\n  }\r\n\r\n  getScratchCostumes() {\r\n    let costumes = this.costTabBody.querySelectorAll(\"div[class^='sprite-selector-item_sprite-name']\");\r\n    // this.costTab[0].click();\r\n\r\n    let myBlocks = [];\r\n    let myBlocksByProcCode = {};\r\n\r\n    /**\r\n     * @param cls\r\n     * @param txt\r\n     * @param root\r\n     * @returns BlockItem\r\n     */\r\n    function addBlock(cls, txt, root) {\r\n      let id = root.className;\r\n      let items = new BlockItem(cls, txt, id, 0);\r\n      myBlocks.push(items);\r\n      myBlocksByProcCode[txt] = items;\r\n      return items;\r\n    }\r\n\r\n    let i = 0;\r\n    for (const costume of costumes) {\r\n      addBlock(\"costume\", costume.innerText, costume).y = i;\r\n      i++;\r\n    }\r\n\r\n    return { procs: myBlocks };\r\n  }\r\n\r\n  /**\r\n   * Fetch the scratch 3 block list\r\n   * @returns jsonFetch object\r\n   */\r\n  getScratchBlocks() {\r\n    // Access Blockly!\r\n\r\n    let myBlocks = [];\r\n    let myBlocksByProcCode = {};\r\n\r\n    // todo - get blockly from an svg???\r\n\r\n    let wksp = this.utils.getWorkspace();\r\n    let topBlocks = wksp.getTopBlocks();\r\n\r\n    // console.log(topBlocks);\r\n\r\n    /**\r\n     * @param cls\r\n     * @param txt\r\n     * @param root\r\n     * @returns BlockItem\r\n     */\r\n    function addBlock(cls, txt, root) {\r\n      let id = root.id ? root.id : root.getId ? root.getId() : null;\r\n      let clone = myBlocksByProcCode[txt];\r\n      if (clone) {\r\n        if (!clone.clones) {\r\n          clone.clones = [];\r\n        }\r\n        clone.clones.push(id);\r\n        return clone;\r\n      }\r\n      let items = new BlockItem(cls, txt, id, 0);\r\n      items.y = root.getRelativeToSurfaceXY ? root.getRelativeToSurfaceXY().y : null;\r\n      myBlocks.push(items);\r\n      myBlocksByProcCode[txt] = items;\r\n      return items;\r\n    }\r\n\r\n    function getDescFromField(root) {\r\n      let fields = root.inputList[0];\r\n      let desc;\r\n      for (const fieldRow of fields.fieldRow) {\r\n        desc = (desc ? desc + \" \" : \"\") + fieldRow.getText();\r\n      }\r\n      return desc;\r\n    }\r\n\r\n    for (const root of topBlocks) {\r\n      if (root.type === \"procedures_definition\") {\r\n        const label = root.getChildren()[0];\r\n        const procCode = label.getProcCode();\r\n        if (!procCode) {\r\n          continue;\r\n        }\r\n        const indexOfLabel = root.inputList.findIndex((i) => i.fieldRow.length > 0);\r\n        if (indexOfLabel === -1) {\r\n          continue;\r\n        }\r\n        const translatedDefine = root.inputList[indexOfLabel].fieldRow[0].getText();\r\n        const message = indexOfLabel === 0 ? `${translatedDefine} ${procCode}` : `${procCode} ${translatedDefine}`;\r\n        addBlock(\"define\", message, root);\r\n        continue;\r\n      }\r\n\r\n      if (root.type === \"event_whenflagclicked\") {\r\n        addBlock(\"flag\", getDescFromField(root), root); // \"When Flag Clicked\"\r\n        continue;\r\n      }\r\n\r\n      if (root.type === \"event_whenbroadcastreceived\") {\r\n        try {\r\n          // let wksp2 = Blockly.getMainWorkspace().getTopBlocks()[2].inputList[0].fieldRow[1];\r\n          let fields = root.inputList[0];\r\n          // let typeDesc = fields.fieldRow[0].getText();\r\n          let eventName = fields.fieldRow[1].getText();\r\n          // addBlock('receive', typeDesc + ' ' + eventName, root).eventName = eventName;\r\n          addBlock(\"receive\", \"event \" + eventName, root).eventName = eventName;\r\n        } catch (e) {\r\n          // eat\r\n        }\r\n        continue;\r\n      }\r\n\r\n      if (root.type.substr(0, 10) === \"event_when\") {\r\n        addBlock(\"event\", getDescFromField(root), root); // \"When Flag Clicked\"\r\n        continue;\r\n      }\r\n\r\n      if (root.type === \"control_start_as_clone\") {\r\n        addBlock(\"event\", getDescFromField(root), root); // \"when I start as a clone\"\r\n        continue;\r\n      }\r\n    }\r\n\r\n    let map = wksp.getVariableMap();\r\n\r\n    let vars = map.getVariablesOfType(\"\");\r\n    for (const row of vars) {\r\n      addBlock(row.isLocal ? \"var\" : \"VAR\", (row.isLocal ? \"var \" : \"VAR \") + row.name, row);\r\n    }\r\n\r\n    let lists = map.getVariablesOfType(\"list\");\r\n    for (const row of lists) {\r\n      addBlock(row.isLocal ? \"list\" : \"LIST\", (row.isLocal ? \"list \" : \"LIST \") + row.name, row);\r\n    }\r\n\r\n    const events = this.getCallsToEvents();\r\n    for (const event of events) {\r\n      addBlock(\"receive\", \"event \" + event.eventName, event.block).eventName = event.eventName;\r\n    }\r\n\r\n    /*\r\n                  const runtime = vm.runtime;\r\n                  // Now let's also add event broadcasts (not just hat blocks)\r\n                  const target = runtime.getEditingTarget();\r\n                  const blocks = target.blocks;\r\n                  if (blocks._blocks) {\r\n                      for (const id in blocks._blocks) {\r\n                          if (!blocks._blocks.hasOwnProperty(id)) {\r\n                              continue;\r\n                          }\r\n                          const block = blocks._blocks[id];\r\n                          if (block.opcode === 'event_broadcast_menu') {\r\n\r\n                              debugger;\r\n\r\n                              // Now get the parent block that is the actual broadcast or broadcast and wait\r\n                              const broadcastBlock = blocks.getBlock(block.parent);\r\n                              let b = new BlockInstance(target, broadcastBlock);\r\n\r\n                              const fieldName = block.fields.BROADCAST_OPTION.value;\r\n                              addBlock('receive', 'event ' + fieldName, b).eventName = broadcastBlock.eventName;\r\n\r\n                              //\r\n                              // let fields = root.inputList[0];\r\n                              // let typeDesc = fields.fieldRow[0].getText();\r\n                              // let eventName = fields.fieldRow[1].getText();\r\n                              // addBlock('receive', 'event ' + eventName, root).eventName = eventName;\r\n                          }\r\n                      }\r\n                  }\r\n          */\r\n\r\n    const clsOrder = { flag: 0, receive: 1, event: 2, define: 3, var: 4, VAR: 5, list: 6, LIST: 7 };\r\n\r\n    myBlocks.sort((a, b) => {\r\n      let t = clsOrder[a.cls] - clsOrder[b.cls];\r\n      if (t !== 0) {\r\n        return t;\r\n      }\r\n      if (a.lower < b.lower) {\r\n        return -1;\r\n      }\r\n      if (a.lower > b.lower) {\r\n        return 1;\r\n      }\r\n      return a.y - b.y;\r\n    });\r\n\r\n    return { procs: myBlocks };\r\n  }\r\n\r\n  showDropDown(e, focusID, instanceBlock) {\r\n    clearTimeout(rhdd);\r\n    rhdd = 0;\r\n\r\n    if (!focusID && this.ddOut.classList.contains(\"vis\")) {\r\n      return;\r\n    }\r\n\r\n    // special '' vs null... - null forces a reevaluation\r\n    prevVal = focusID ? \"\" : null; // Clear the previous value of the input search\r\n\r\n    this.ddOut.classList.add(\"vis\");\r\n    let scratchBlocks = this.isCostumeEditor() ? this.getScratchCostumes() : this.getScratchBlocks();\r\n\r\n    this.dom_removeChildren(this.dd);\r\n\r\n    let foundLi = null;\r\n    /**\r\n     * @type {[BlockItem]}\r\n     */\r\n    const procs = scratchBlocks.procs;\r\n    for (const proc of procs) {\r\n      let li = document.createElement(\"li\");\r\n      li.innerText = proc.procCode;\r\n      li.data = proc;\r\n      li.className = proc.cls;\r\n      if (focusID) {\r\n        if (proc.matchesID(focusID)) {\r\n          foundLi = li;\r\n          li.classList.add(\"sel\");\r\n        } else {\r\n          li.style.display = \"none\";\r\n        }\r\n      }\r\n      this.dd.appendChild(li);\r\n    }\r\n\r\n    let label = document.getElementById(\"s3devFindLabel\");\r\n    this.utils.offsetX = this.ddOut.getBoundingClientRect().right - label.getBoundingClientRect().left + 26;\r\n    this.utils.offsetY = 32;\r\n\r\n    if (foundLi) {\r\n      this.clickDropDownRow(foundLi, this.utils.getWorkspace(), instanceBlock);\r\n    }\r\n  }\r\n\r\n  hideDropDown() {\r\n    clearTimeout(rhdd);\r\n    rhdd = setTimeout(() => this.reallyHideDropDown(), 250);\r\n  }\r\n\r\n  reallyHideDropDown() {\r\n    // Check focus of find box\r\n    if (this.findInp === document.activeElement) {\r\n      this.hideDropDown();\r\n      return;\r\n    }\r\n\r\n    // document.getElementById('s3devReplace').classList.add('s3devHide');\r\n\r\n    this.ddOut.classList.remove(\"vis\");\r\n    rhdd = 0;\r\n  }\r\n\r\n  hideFloatDropDown() {\r\n    clearTimeout(rhdd2);\r\n    rhdd2 = setTimeout(() => this.reallyHideFloatDropDown(), 50);\r\n  }\r\n\r\n  reallyHideFloatDropDown(force) {\r\n    // Check focus of find box\r\n    if (!force && this.floatInp === document.activeElement) {\r\n      this.hideFloatDropDown();\r\n      return;\r\n    }\r\n\r\n    let float = document.getElementById(\"s3devFloatingBar\");\r\n    if (float) {\r\n      float.remove();\r\n    }\r\n    this.floatInp = null;\r\n    rhdd2 = 0;\r\n  }\r\n\r\n  dom_removeChildren(myNode) {\r\n    while (myNode.firstChild) {\r\n      myNode.removeChild(myNode.firstChild);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * A nicely ordered version of the top blocks\r\n   * @returns {[Blockly.Block]}\r\n   */\r\n  getTopBlocks() {\r\n    let result = this.getOrderedTopBlockColumns();\r\n    let columns = result.cols;\r\n    /**\r\n     * @type {[[Blockly.Block]]}\r\n     */\r\n    let topBlocks = [];\r\n    for (const col of columns) {\r\n      topBlocks = topBlocks.concat(col.blocks);\r\n    }\r\n    return topBlocks;\r\n  }\r\n\r\n  /**\r\n   * A much nicer way of laying out the blocks into columns\r\n   */\r\n  doCleanUp(block) {\r\n    let workspace = this.utils.getWorkspace();\r\n    let makeSpaceForBlock = block && block.getRootBlock();\r\n\r\n    UndoGroup.startUndoGroup(workspace);\r\n\r\n    let result = this.getOrderedTopBlockColumns(true);\r\n    let columns = result.cols;\r\n    let orphanCount = result.orphans.blocks.length;\r\n    if (orphanCount > 0 && !block) {\r\n      let message = this.msg(\"orphaned\", {\r\n        count: orphanCount,\r\n      });\r\n      if (confirm(message)) {\r\n        for (const block of result.orphans.blocks) {\r\n          block.dispose();\r\n        }\r\n      } else {\r\n        columns.unshift(result.orphans);\r\n      }\r\n    }\r\n\r\n    let cursorX = 48;\r\n\r\n    let maxWidths = result.maxWidths;\r\n\r\n    for (const column of columns) {\r\n      let cursorY = 64;\r\n      let maxWidth = 0;\r\n\r\n      for (const block of column.blocks) {\r\n        let extraWidth = block === makeSpaceForBlock ? 380 : 0;\r\n        let extraHeight = block === makeSpaceForBlock ? 480 : 72;\r\n        let xy = block.getRelativeToSurfaceXY();\r\n        if (cursorX - xy.x !== 0 || cursorY - xy.y !== 0) {\r\n          block.moveBy(cursorX - xy.x, cursorY - xy.y);\r\n        }\r\n        let heightWidth = block.getHeightWidth();\r\n        cursorY += heightWidth.height + extraHeight;\r\n\r\n        let maxWidthWithComments = maxWidths[block.id] || 0;\r\n        maxWidth = Math.max(maxWidth, Math.max(heightWidth.width + extraWidth, maxWidthWithComments));\r\n      }\r\n\r\n      cursorX += maxWidth + 96;\r\n    }\r\n\r\n    let topComments = workspace.getTopComments();\r\n    for (const comment of topComments) {\r\n      if (comment.setVisible) {\r\n        comment.setVisible(false);\r\n        comment.needsAutoPositioning_ = true;\r\n        comment.setVisible(true);\r\n      }\r\n    }\r\n\r\n    setTimeout(() => {\r\n      // Locate unused local variables...\r\n      let workspace = this.utils.getWorkspace();\r\n      let map = workspace.getVariableMap();\r\n      let vars = map.getVariablesOfType(\"\");\r\n      let unusedLocals = [];\r\n\r\n      for (const row of vars) {\r\n        if (row.isLocal) {\r\n          let usages = map.getVariableUsesById(row.getId());\r\n          if (!usages || usages.length === 0) {\r\n            unusedLocals.push(row);\r\n          }\r\n        }\r\n      }\r\n\r\n      if (unusedLocals.length > 0) {\r\n        const unusedCount = unusedLocals.length;\r\n        let message = this.msg(\"unused-var\", {\r\n          count: unusedCount,\r\n        });\r\n        for (let i = 0; i < unusedLocals.length; i++) {\r\n          let orphan = unusedLocals[i];\r\n          if (i > 0) {\r\n            message += \", \";\r\n          }\r\n          message += orphan.name;\r\n        }\r\n        if (confirm(message)) {\r\n          for (const orphan of unusedLocals) {\r\n            workspace.deleteVariableById(orphan.getId());\r\n          }\r\n        }\r\n      }\r\n\r\n      // Locate unused local lists...\r\n      let lists = map.getVariablesOfType(\"list\");\r\n      let unusedLists = [];\r\n\r\n      for (const row of lists) {\r\n        if (row.isLocal) {\r\n          let usages = map.getVariableUsesById(row.getId());\r\n          if (!usages || usages.length === 0) {\r\n            unusedLists.push(row);\r\n          }\r\n        }\r\n      }\r\n      if (unusedLists.length > 0) {\r\n        const unusedCount = unusedLists.length;\r\n        let message = this.msg(\"unused-list\", {\r\n          count: unusedCount,\r\n        });\r\n        for (let i = 0; i < unusedLists.length; i++) {\r\n          let orphan = unusedLists[i];\r\n          if (i > 0) {\r\n            message += \", \";\r\n          }\r\n          message += orphan.name;\r\n        }\r\n        if (confirm(message)) {\r\n          for (const orphan of unusedLists) {\r\n            workspace.deleteVariableById(orphan.getId());\r\n          }\r\n        }\r\n      }\r\n\r\n      UndoGroup.endUndoGroup(workspace);\r\n    }, 100);\r\n  }\r\n\r\n  /**\r\n   * Badly Orphaned - might want to delete these!\r\n   * @param topBlock\r\n   * @returns {boolean}\r\n   */\r\n  isBlockAnOrphan(topBlock) {\r\n    return !!topBlock.outputConnection;\r\n  }\r\n\r\n  /**\r\n   * Split the top blocks into ordered columns\r\n   * @param separateOrphans true to keep all orphans separate\r\n   * @returns {{orphans: {blocks: [Block], x: number, count: number}, cols: [Col]}}\r\n   */\r\n  getOrderedTopBlockColumns(separateOrphans) {\r\n    let w = this.utils.getWorkspace();\r\n    let topBlocks = w.getTopBlocks();\r\n    let maxWidths = {};\r\n\r\n    if (separateOrphans) {\r\n      let topComments = w.getTopComments();\r\n\r\n      // todo: tie comments to blocks... find widths and width of block stack row...\r\n      for (const comment of topComments) {\r\n        // comment.autoPosition_();\r\n        // Hiding and showing repositions the comment right next to it's block - nice!\r\n        if (comment.setVisible) {\r\n          comment.setVisible(false);\r\n          comment.needsAutoPositioning_ = true;\r\n          comment.setVisible(true);\r\n\r\n          // let bb = comment.block_.svgPath_.getBBox();\r\n          let right = comment.getBoundingRectangle().bottomRight.x;\r\n\r\n          // Get top block for stack...\r\n          let root = comment.block_.getRootBlock();\r\n          let left = root.getBoundingRectangle().topLeft.x;\r\n          maxWidths[root.id] = Math.max(right - left, maxWidths[root.id] || 0);\r\n        }\r\n      }\r\n    }\r\n\r\n    // Default scratch ordering is horrid... Lets try something more clever.\r\n\r\n    /**\r\n     * @type {Col[]}\r\n     */\r\n    let cols = [];\r\n    const TOLERANCE = 256;\r\n    let orphans = { x: -999999, count: 0, blocks: [] };\r\n\r\n    for (const topBlock of topBlocks) {\r\n      // let r = b.getBoundingRectangle();\r\n      let position = topBlock.getRelativeToSurfaceXY();\r\n      /**\r\n       * @type {Col}\r\n       */\r\n      let bestCol = null;\r\n      let bestError = TOLERANCE;\r\n\r\n      if (separateOrphans && this.isBlockAnOrphan(topBlock)) {\r\n        orphans.blocks.push(topBlock);\r\n        continue;\r\n      }\r\n\r\n      // Find best columns\r\n      for (const col of cols) {\r\n        let err = Math.abs(position.x - col.x);\r\n        if (err < bestError) {\r\n          bestError = err;\r\n          bestCol = col;\r\n        }\r\n      }\r\n\r\n      if (bestCol) {\r\n        // We found a column that we fitted into\r\n        bestCol.x = (bestCol.x * bestCol.count + position.x) / ++bestCol.count; // re-average the columns as more items get added...\r\n        bestCol.blocks.push(topBlock);\r\n      } else {\r\n        // Create a new column\r\n        cols.push(new Col(position.x, 1, [topBlock]));\r\n      }\r\n    }\r\n\r\n    // if (orphans.blocks.length > 0) {\r\n    //     cols.push(orphans);\r\n    // }\r\n\r\n    // Sort columns, then blocks inside the columns\r\n    cols.sort((a, b) => a.x - b.x);\r\n    for (const col of cols) {\r\n      col.blocks.sort((a, b) => a.getRelativeToSurfaceXY().y - b.getRelativeToSurfaceXY().y);\r\n    }\r\n\r\n    return { cols: cols, orphans: orphans, maxWidths: maxWidths };\r\n  }\r\n\r\n  /**\r\n   * Find all the uses of a named variable.\r\n   * @param {string} id ID of the variable to find.\r\n   * @return {!Array.<!Blockly.Block>} Array of block usages.\r\n   */\r\n  getVariableUsesById(id) {\r\n    let uses = [];\r\n\r\n    let topBlocks = this.getTopBlocks(true); // todo: Confirm this was the right getTopBlocks?\r\n    for (const topBlock of topBlocks) {\r\n      /** @type {!Array<!Blockly.Block>} */\r\n      let kids = topBlock.getDescendants();\r\n      for (const block of kids) {\r\n        /** @type {!Array<!Blockly.VariableModel>} */\r\n        let blockVariables = block.getVarModels();\r\n        if (blockVariables) {\r\n          for (const blockVar of blockVariables) {\r\n            if (blockVar.getId() === id) {\r\n              uses.push(block);\r\n            }\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    return uses;\r\n  }\r\n\r\n  /**\r\n   * Find all the uses of a named procedure.\r\n   * @param {string} id ID of the variable to find.\r\n   * @return {!Array.<!Blockly.Block>} Array of block usages.\r\n   */\r\n  getCallsToProcedureById(id) {\r\n    let w = this.utils.getWorkspace();\r\n    let procBlock = w.getBlockById(id);\r\n    let label = procBlock.getChildren()[0];\r\n    let procCode = label.getProcCode();\r\n\r\n    let uses = [procBlock]; // Definition First, then calls to it\r\n    let topBlocks = this.getTopBlocks(true);\r\n    for (const topBlock of topBlocks) {\r\n      /** @type {!Array<!Blockly.Block>} */\r\n      let kids = topBlock.getDescendants();\r\n      for (const block of kids) {\r\n        if (block.type === \"procedures_call\") {\r\n          if (block.getProcCode() === procCode) {\r\n            uses.push(block);\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    return uses;\r\n  }\r\n\r\n  /**\r\n   * Find all the uses of a named procedure.\r\n   * @param {string} name name of the variable to find.\r\n   * @return {!Array.<!Blockly.Block>} Array of block usages.\r\n   */\r\n  getCallsToEventsByName(name) {\r\n    let uses = []; // Definition First, then calls to it\r\n\r\n    const runtime = this.vm.runtime;\r\n    const targets = runtime.targets; // The sprites / stage\r\n\r\n    for (const target of targets) {\r\n      if (!target.isOriginal) {\r\n        continue; // Skip clones\r\n      }\r\n\r\n      const blocks = target.blocks;\r\n      if (!blocks._blocks) {\r\n        continue;\r\n      }\r\n\r\n      for (const id of Object.keys(blocks._blocks)) {\r\n        const block = blocks._blocks[id];\r\n        // To find event broadcaster blocks, we look for the nested \"event_broadcast_menu\" blocks first that match the event name\r\n        if (block.opcode === \"event_broadcast_menu\" && block.fields.BROADCAST_OPTION.value === name) {\r\n          // Now get the parent block that is the actual broadcast or broadcast and wait\r\n          const broadcastBlock = blocks.getBlock(block.parent);\r\n          uses.push(new BlockInstance(target, broadcastBlock));\r\n        } else if (block.opcode === \"event_whenbroadcastreceived\" && block.fields.BROADCAST_OPTION.value === name) {\r\n          uses.push(new BlockInstance(target, block));\r\n        }\r\n      }\r\n    }\r\n\r\n    return uses;\r\n  }\r\n\r\n  /**\r\n   * Find all the event broadcasters.\r\n   * @return {[{eventName:string, block:Block}]} Array of event names and blocks.\r\n   */\r\n  getCallsToEvents() {\r\n    const uses = []; // Definition First, then calls to it\r\n    const found = {};\r\n\r\n    let topBlocks = this.getTopBlocks(true);\r\n    for (const topBlock of topBlocks) {\r\n      /** @type {!Array<!Blockly.Block>} */\r\n      let kids = topBlock.getDescendants();\r\n      for (const block of kids) {\r\n        if (block.type === \"event_broadcast\" || block.type === \"event_broadcastandwait\") {\r\n          const eventName = block.getChildren()[0].inputList[0].fieldRow[0].getText();\r\n          if (!found[eventName]) {\r\n            found[eventName] = block;\r\n            uses.push({ eventName: eventName, block: block });\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    return uses;\r\n  }\r\n\r\n  buildNavigationCarousel(nav, li, blocks, instanceBlock) {\r\n    if (nav && nav.parentNode === li) {\r\n      // Same control... click again to go to next\r\n      this.multi.navRight();\r\n    } else {\r\n      if (nav) {\r\n        nav.remove();\r\n      }\r\n      li.insertAdjacentHTML(\r\n        \"beforeend\",\r\n        `\r\n                    <span id=\"s3devMulti\" class=\"s3devMulti\">\r\n                        <span id=\"s3devMultiLeft\" class=\"s3devNav\">◀</span><span id=\"s3devMultiCount\"></span><span id=\"s3devMultiRight\" class=\"s3devNav\">▶</span>\r\n                    </span>\r\n                `\r\n      );\r\n      document.getElementById(\"s3devMultiLeft\").addEventListener(\"mousedown\", (...e) => this.multi.navLeft(...e));\r\n      document.getElementById(\"s3devMultiRight\").addEventListener(\"mousedown\", (...e) => this.multi.navRight(...e));\r\n\r\n      this.multi.idx = 0;\r\n\r\n      if (instanceBlock) {\r\n        for (let i = 0; i < blocks.length; i++) {\r\n          const block = blocks[i];\r\n          if (block.id === instanceBlock.id) {\r\n            this.multi.idx = i;\r\n            break;\r\n          }\r\n        }\r\n        // multi.idx = blocks.indexOf(instanceBlock);\r\n      }\r\n\r\n      this.multi.blocks = blocks;\r\n      this.multi.update();\r\n\r\n      if (this.multi.idx < blocks.length) {\r\n        this.centerTop(blocks[this.multi.idx]);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Move a costume to the top or bottom of the list\r\n   * @param top true for the top, false for the bottom\r\n   * @param selected optional parameter to pass in the costume div to be moved\r\n   */\r\n  moveCostumeTo(top, selected) {\r\n    let isSelected = !selected || selected.className.indexOf(\"sprite-selector-item_is-selected\") >= 0;\r\n    if (!selected) {\r\n      selected = this.costTabBody.querySelectorAll(\"div[class*='sprite-selector-item_is-selected']\");\r\n      if (selected.length === 0) {\r\n        return;\r\n      }\r\n      selected = selected[0].querySelectorAll(\"div[class^='sprite-selector-item_sprite-name']\")[0];\r\n    }\r\n    let costumes = this.costTabBody.querySelectorAll(\"div[class^='sprite-selector-item_sprite-name']\");\r\n\r\n    // First scroll sprite view to reveal top or bottom otherwise this won't work.\r\n    let scroller = selected.closest(\"div[class*=selector_list-area]\");\r\n    let lastScroll = scroller.scrollTop;\r\n    scroller.scrollTop = top ? 0 : scroller.scrollHeight;\r\n\r\n    this.domHelpers.triggerDragAndDrop(selected, costumes[top ? 0 : costumes.length - 1], undefined);\r\n    if (!isSelected) {\r\n      // Restore Scroll position\r\n      scroller.scrollTop = lastScroll;\r\n    }\r\n  }\r\n\r\n  /**\r\n   *\r\n   * @param li\r\n   * @param workspace\r\n   * @param instanceBlock the instance to be highlighted (or null)\r\n   */\r\n  clickDropDownRow(li, workspace, instanceBlock) {\r\n    let nav = document.getElementById(\"s3devMulti\");\r\n\r\n    let cls = li.data.cls;\r\n    if (cls === \"costume\") {\r\n      // Viewing costumes - jump to selected costume\r\n      let costumes = this.costTabBody.querySelectorAll(\"div[class^='sprite-selector-item_sprite-name']\");\r\n      let costume = costumes[li.data.y];\r\n      if (costume) {\r\n        costume.click();\r\n        setTimeout(() => {\r\n          let wrapper = costume.closest(\"div[class*=gui_flex-wrapper]\");\r\n          costume.parentElement.parentElement.scrollIntoView({\r\n            behavior: \"auto\",\r\n            block: \"center\",\r\n            inline: \"start\",\r\n          });\r\n          wrapper.scrollTop = 0;\r\n        }, 10);\r\n      }\r\n    } else if (cls === \"var\" || cls === \"VAR\" || cls === \"list\" || cls === \"LIST\") {\r\n      // Search now for all instances\r\n      // let wksp = getWorkspace();\r\n      // let blocks = wksp.getVariableUsesById(li.data.labelID);\r\n      let blocks = this.getVariableUsesById(li.data.labelID);\r\n      this.buildNavigationCarousel(nav, li, blocks, instanceBlock);\r\n    } else if (cls === \"define\") {\r\n      let blocks = this.getCallsToProcedureById(li.data.labelID);\r\n      this.buildNavigationCarousel(nav, li, blocks, instanceBlock);\r\n    } else if (cls === \"receive\") {\r\n      /*\r\n                          let blocks = [workspace.getBlockById(li.data.labelID)];\r\n                          if (li.data.clones) {\r\n                              for (const cloneID of li.data.clones) {\r\n                                  blocks.push(workspace.getBlockById(cloneID))\r\n                              }\r\n                          }\r\n                          blocks = blocks.concat(getCallsToEventsByName(li.data.eventName));\r\n              */\r\n      // Now, fetch the events from the scratch runtime instead of blockly\r\n      let blocks = this.getCallsToEventsByName(li.data.eventName);\r\n      if (!instanceBlock) {\r\n        // Can we start by selecting the first block on 'this' sprite\r\n        const currentTargetID = this.utils.getEditingTarget().id;\r\n        for (const block of blocks) {\r\n          if (block.targetId === currentTargetID) {\r\n            instanceBlock = block;\r\n            break;\r\n          }\r\n        }\r\n      }\r\n      this.buildNavigationCarousel(nav, li, blocks, instanceBlock);\r\n    } else if (li.data.clones) {\r\n      let blocks = [workspace.getBlockById(li.data.labelID)];\r\n      for (const cloneID of li.data.clones) {\r\n        blocks.push(workspace.getBlockById(cloneID));\r\n      }\r\n      this.buildNavigationCarousel(nav, li, blocks, instanceBlock);\r\n    } else {\r\n      this.multi.blocks = null;\r\n      this.centerTop(li.data.labelID);\r\n      if (nav) {\r\n        nav.remove();\r\n      }\r\n    }\r\n  }\r\n\r\n  dropDownClick(e) {\r\n    // console.log(e);\r\n    let workspace = this.utils.getWorkspace();\r\n\r\n    if (prevVal === null) {\r\n      prevVal = this.findInp.value; // Hack to stop filter change if not entered data into edt box, but clicked on row\r\n    }\r\n\r\n    let li = e.target;\r\n    for (;;) {\r\n      if (!li || li === this.dd) {\r\n        return;\r\n      }\r\n      if (li.data) {\r\n        break;\r\n      }\r\n      li = li.parentNode;\r\n    }\r\n\r\n    // If this was a mouse click, unselect the keyboard selection\r\n    // e.navKey is set when this is called from the keyboard handler...\r\n    if (!e.navKey) {\r\n      let sel = this.dd.getElementsByClassName(\"sel\");\r\n      sel = sel.length > 0 ? sel[0] : null;\r\n      if (sel && sel !== li) {\r\n        try {\r\n          sel.classList.remove(\"sel\");\r\n        } catch (e) {\r\n          console.log(sel);\r\n          console.error(e);\r\n        }\r\n      }\r\n      if (li !== sel) {\r\n        li.classList.add(\"sel\");\r\n      }\r\n    }\r\n\r\n    this.clickDropDownRow(li, workspace);\r\n    if (e && e.preventDefault) {\r\n      e.preventDefault();\r\n      e.cancelBubble = true;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  /**\r\n   * Based on wksp.centerOnBlock(li.data.labelID);\r\n   * @param e\r\n   * @param force if true, the view always moves, otherwise only move if the selected element is not entirely visible\r\n   */\r\n  centerTop(e, force) {\r\n    this.utils.scrollBlockIntoView(e, force);\r\n  }\r\n\r\n  inputChange(e) {\r\n    if (!this.ddOut.classList.contains(\"vis\")) {\r\n      this.showDropDown();\r\n      this.hideDropDown(); // Start timer to hide if not got focus\r\n    }\r\n\r\n    // Filter the list...\r\n    let val = (this.findInp.value || \"\").toLowerCase();\r\n    if (val === prevVal) {\r\n      // No change so don't re-filter\r\n      return;\r\n    }\r\n\r\n    prevVal = val;\r\n    this.multi.blocks = null;\r\n\r\n    //\r\n    // Hide items in list that do not contain filter text, and highlight the parts of words that match the filter text\r\n\r\n    let listLI = this.dd.getElementsByTagName(\"li\");\r\n    for (const li of listLI) {\r\n      let procCode = li.data.procCode;\r\n      let i = li.data.lower.indexOf(val);\r\n      if (i >= 0) {\r\n        li.style.display = \"block\";\r\n        this.dom_removeChildren(li);\r\n        if (i > 0) {\r\n          li.appendChild(document.createTextNode(procCode.substring(0, i)));\r\n        }\r\n        let bText = document.createElement(\"b\");\r\n        bText.appendChild(document.createTextNode(procCode.substr(i, val.length)));\r\n        li.appendChild(bText);\r\n        if (i + val.length < procCode.length) {\r\n          li.appendChild(document.createTextNode(procCode.substr(i + val.length)));\r\n        }\r\n        // li.innerHTML = enc(procCode.substring(0, i)) + '<b>' + enc(procCode.substr(i, val.length)) + \"</b>\" + enc(procCode.substr(i + val.length));\r\n      } else {\r\n        li.style.display = \"none\";\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Select previous or next item in the drop down filter list\r\n   * @param dir direction of navigation: -1=up, 1=down\r\n   */\r\n  navigateFilter(dir) {\r\n    let sel = this.dd.getElementsByClassName(\"sel\");\r\n    let nxt;\r\n    if (sel.length > 0 && sel[0].style.display !== \"none\") {\r\n      nxt = dir === -1 ? sel[0].previousSibling : sel[sel.length - 1].nextSibling;\r\n    } else {\r\n      nxt = this.dd.children[0];\r\n      dir = 1;\r\n    }\r\n    while (nxt && nxt.style.display === \"none\") {\r\n      nxt = dir === -1 ? nxt.previousSibling : nxt.nextSibling;\r\n    }\r\n    if (nxt) {\r\n      for (const i of sel) {\r\n        i.classList.remove(\"sel\");\r\n      }\r\n      nxt.classList.add(\"sel\");\r\n      this.dropDownClick({ target: nxt, navKey: true });\r\n      // centerTop(nxt.data.labelID);\r\n    }\r\n  }\r\n\r\n  inputKeyDown(e) {\r\n    // Up Arrow\r\n    if (e.keyCode === 38) {\r\n      this.navigateFilter(-1);\r\n      e.preventDefault();\r\n      return;\r\n    }\r\n\r\n    // Down Arrow\r\n    if (e.keyCode === 40) {\r\n      this.navigateFilter(1);\r\n      e.preventDefault();\r\n      return;\r\n    }\r\n\r\n    // Left Arrow\r\n    if (e.keyCode === 37) {\r\n      let sel = this.dd.getElementsByClassName(\"sel\");\r\n      if (sel && this.multi.blocks) {\r\n        this.multi.navLeft(e);\r\n      }\r\n    }\r\n\r\n    // Right Arrow\r\n    if (e.keyCode === 39) {\r\n      let sel = this.dd.getElementsByClassName(\"sel\");\r\n      if (sel && this.multi.blocks) {\r\n        this.multi.navRight(e);\r\n      }\r\n    }\r\n\r\n    // Enter\r\n    if (e.keyCode === 13) {\r\n      // Any selected on enter? if not select now\r\n      let sel = this.dd.getElementsByClassName(\"sel\");\r\n      if (sel.length === 0) {\r\n        this.navigateFilter(1);\r\n      }\r\n      // noinspection JSUnresolvedFunction\r\n      document.activeElement.blur();\r\n      e.preventDefault();\r\n      return;\r\n    }\r\n\r\n    // Escape\r\n    if (e.keyCode === 27) {\r\n      if (this.findInp.value.length > 0) {\r\n        this.findInp.value = \"\"; // Clear search first, then close on second press\r\n        this.inputChange(e);\r\n      } else {\r\n        // noinspection JSUnresolvedFunction\r\n        document.activeElement.blur();\r\n      }\r\n      e.preventDefault();\r\n      return;\r\n    }\r\n  }\r\n\r\n  /*\r\n    function deepSearch(e) {\r\n      document.body.insertAdjacentHTML(\r\n        \"beforeend\",\r\n        `\r\n              <div id=\"s3devOverlay\">\r\n              </div>\r\n          `\r\n      );\r\n\r\n      let overlay = document.getElementById(\"s3devOverlay\");\r\n      overlay.addEventListener(\"click\", function (e) {\r\n        overlay.remove();\r\n      });\r\n\r\n      // todo: use scratch runtime instead!\r\n\r\n      const runtime = vm.runtime;\r\n      const targets = runtime.targets; // The sprites / stage\r\n\r\n      let dict = {};\r\n\r\n      for (const target of targets) {\r\n        if (!target.isOriginal) {\r\n          continue; // Skip clones\r\n        }\r\n\r\n        const name = target.getName();\r\n        const isStage = target.isStage;\r\n        const blocks = target.blocks;\r\n        const scripts = blocks.getScripts();\r\n\r\n        let divElement = document.createElement(\"div\");\r\n        divElement.appendChild(document.createTextNode(\"Searching in \" + name));\r\n        divElement.appendChild(document.createTextNode(\", Top Scripts x\" + scripts.length));\r\n        overlay.appendChild(divElement);\r\n\r\n        const sprite = (dict[name] = {});\r\n        sprite.scripts = [];\r\n\r\n        for (const script of scripts) {\r\n          const block = blocks.getBlock(script);\r\n          const top = { id: script, opcode: block.opcode, block: block };\r\n          sprite.scripts.push(top);\r\n        }\r\n      }\r\n\r\n      e.preventDefault();\r\n      return true;\r\n    }\r\n  */\r\n\r\n  /**\r\n   * Quick and dirty replace all instances of one variable / list with another variable / list\r\n   * @param varId original variable name\r\n   * @param newVarName new variable name\r\n   * @param type type of variable (\"\" = variable, anything else is a list?\r\n   */\r\n  doReplaceVariable(varId, newVarName, type) {\r\n    let wksp = this.utils.getWorkspace();\r\n    let v = wksp.getVariable(newVarName, type);\r\n    if (!v) {\r\n      alert(this.msg(\"var-not-exist\"));\r\n      return;\r\n    }\r\n    let newVId = v.getId();\r\n\r\n    UndoGroup.startUndoGroup(wksp);\r\n    let blocks = this.getVariableUsesById(varId);\r\n    for (const block of blocks) {\r\n      try {\r\n        if (type === \"\") {\r\n          block.getField(\"VARIABLE\").setValue(newVId);\r\n        } else {\r\n          block.getField(\"LIST\").setValue(newVId);\r\n        }\r\n      } catch (e) {\r\n        // ignore\r\n      }\r\n    }\r\n    UndoGroup.endUndoGroup(wksp);\r\n  }\r\n\r\n  /*\r\n    function doInjectScripts(codeString) {\r\n      let w = getWorkspace();\r\n      let xml = new XML(); // document.implementation.createDocument(null, \"xml\");\r\n      let x = xml.xmlDoc.firstChild;\r\n\r\n      let tree = math.parse(codeString);\r\n      console.log(tree);\r\n\r\n      const binaryOperatorTypes = {\r\n        add: \"operator_add\",\r\n        subtract: \"operator_subtract\",\r\n        this.multiply: \"operator_multiply\",\r\n        divide: \"operator_divide\",\r\n      };\r\n\r\n      const BLOCK_TYPE = {\r\n        number: \"math_number\",\r\n        text: \"text\",\r\n      };\r\n\r\n      function translateMathToXml(x, tree, shadowType) {\r\n        let xShadowField = null;\r\n        if (shadowType) {\r\n          let xShadow = xml.newXml(x, \"shadow\", { type: shadowType });\r\n          if (shadowType === BLOCK_TYPE.number) {\r\n            xShadowField = xml.newXml(xShadow, \"field\", { name: \"NUM\" });\r\n          } else if (shadowType === BLOCK_TYPE.text) {\r\n            xShadowField = xml.newXml(xShadow, \"field\", { name: \"TEXT\" });\r\n          }\r\n        }\r\n\r\n        if (!tree || !tree.type) {\r\n          return;\r\n        }\r\n\r\n        if (tree.type === \"OperatorNode\") {\r\n          let operatorType = binaryOperatorTypes[tree.fn];\r\n          if (operatorType) {\r\n            let xOp = newXml(x, \"block\", { type: operatorType });\r\n            translateMathToXml(xml.newXml(xOp, \"value\", { name: \"NUM1\" }), tree.args[0], BLOCK_TYPE.number);\r\n            translateMathToXml(xml.newXml(xOp, \"value\", { name: \"NUM2\" }), tree.args[1], BLOCK_TYPE.number);\r\n            return;\r\n          }\r\n\r\n          return;\r\n        }\r\n\r\n        if (tree.type === \"ConstantNode\") {\r\n          // number or text in quotes\r\n          if (xShadowField) {\r\n            xml.setAttr(xShadowField, { text: tree.value });\r\n          }\r\n          return;\r\n        }\r\n\r\n        if (tree.type === \"SymbolNode\") {\r\n          // variable\r\n          let xVar = xml.newXml(x, \"block\", { type: \"data_variable\" });\r\n          xml.newXml(xVar, \"field\", { name: \"VARIABLE\", text: tree.name });\r\n          return;\r\n        }\r\n\r\n        if (tree.type === \"FunctionNode\") {\r\n          // Method Call\r\n          if (tree.fn.name === \"join\") {\r\n            let xOp = newXml(x, \"block\", { type: \"operator_join\" });\r\n            translateMathToXml(xml.newXml(xOp, \"value\", { name: \"STRING1\" }), tree.args[0], BLOCK_TYPE.text);\r\n            translateMathToXml(xml.newXml(xOp, \"value\", { name: \"STRING2\" }), tree.args[1], BLOCK_TYPE.text);\r\n            return;\r\n          }\r\n        }\r\n      }\r\n\r\n      translateMathToXml(x, tree);\r\n      console.log(x);\r\n\r\n      let ids = Blockly.Xml.domToWorkspace(x, w);\r\n      console.log(ids);\r\n    }\r\n     */\r\n  /*\r\n    function clickInject(e) {\r\n      let codeString = window.prompt(\"Griffpatch: Enter an expression (i.e. a+2*3)\");\r\n      if (codeString) {\r\n        doInjectScripts(codeString);\r\n      }\r\n      e.preventDefault();\r\n      return false;\r\n    }\r\n    */\r\n\r\n  /**\r\n   * Returns a Set of the top blocks in this workspace / sprite\r\n   * @returns {Set<any>} Set of top blocks\r\n   */\r\n  getTopBlockIDs() {\r\n    let wksp = this.utils.getWorkspace();\r\n    let topBlocks = wksp.getTopBlocks();\r\n    let ids = new Set();\r\n    for (const block of topBlocks) {\r\n      ids.add(block.id);\r\n    }\r\n    return ids;\r\n  }\r\n\r\n  /**\r\n   * Initiates a drag event for all block stacks except those in the set of ids.\r\n   * But why? - Because we know all the ids of the existing stacks before we paste / duplicate - so we can find the\r\n   * new stack by excluding all the known ones.\r\n   * @param ids Set of previously known ids\r\n   */\r\n  beginDragOfNewBlocksNotInIDs(ids) {\r\n    if (!this.addon.settings.get(\"enablePasteBlocksAtMouse\")) {\r\n      return;\r\n    }\r\n    let wksp = this.utils.getWorkspace();\r\n    let topBlocks = wksp.getTopBlocks();\r\n    for (const block of topBlocks) {\r\n      if (!ids.has(block.id)) {\r\n        // console.log(\"I found a new block!!! - \" + block.id);\r\n        // todo: move the block to the mouse pointer?\r\n        let mouseXYClone = { x: this.mouseXY.x, y: this.mouseXY.y };\r\n        block.setIntersects(true); // fixes offscreen block pasting in TurboWarp\r\n        this.domHelpers.triggerDragAndDrop(block.svgPath_, null, mouseXYClone);\r\n      }\r\n    }\r\n  }\r\n\r\n  updateMousePosition(e) {\r\n    this.mouseXY.x = e.clientX;\r\n    this.mouseXY.y = e.clientY;\r\n  }\r\n\r\n  eventMouseMove(e) {\r\n    this.updateMousePosition(e);\r\n  }\r\n\r\n  eventKeyDown(e) {\r\n    function switchCostume(up) {\r\n      // todo: select previous costume\r\n      let selected = this.costTabBody.querySelector(\"div[class*='sprite-selector-item_is-selected']\");\r\n      let node = up ? selected.parentNode.previousSibling : selected.parentNode.nextSibling;\r\n      if (node) {\r\n        let wrapper = node.closest(\"div[class*=gui_flex-wrapper]\");\r\n        node.querySelector(\"div[class^='sprite-selector-item_sprite-name']\").click();\r\n        node.scrollIntoView({\r\n          behavior: \"auto\",\r\n          block: \"center\",\r\n          inline: \"start\",\r\n        });\r\n        wrapper.scrollTop = 0;\r\n      }\r\n    }\r\n\r\n    if (document.URL.indexOf(\"editor\") <= 0) {\r\n      return;\r\n    }\r\n\r\n    let ctrlKey = e.ctrlKey || e.metaKey;\r\n\r\n    if (e.key === \"f\" && ctrlKey && !e.shiftKey) {\r\n      // Ctrl + F (Override default Ctrl+F find)\r\n      this.findInp.focus();\r\n      this.findInp.select();\r\n      e.cancelBubble = true;\r\n      e.preventDefault();\r\n      return true;\r\n    }\r\n\r\n    if (e.key === \" \" && ctrlKey) {\r\n      // Ctrl + Space (Inject Code)\r\n      this.middleClickWorkspace(e);\r\n      e.cancelBubble = true;\r\n      e.preventDefault();\r\n      return true;\r\n    }\r\n\r\n    if (e.keyCode === 37 && ctrlKey) {\r\n      // Ctrl + Left Arrow Key\r\n      if (document.activeElement.tagName === \"INPUT\") {\r\n        return;\r\n      }\r\n      // todo: if (!this.addon.settings.get(\"enableCtrlLeftRightNav\")) {\r\n      //         return;\r\n      //       }\r\n      if (this.isScriptEditor()) {\r\n        this.utils.navigationHistory.goBack();\r\n      } else if (this.isCostumeEditor()) {\r\n        switchCostume(true);\r\n      }\r\n      e.cancelBubble = true;\r\n      e.preventDefault();\r\n      return true;\r\n    }\r\n\r\n    if (e.keyCode === 39 && ctrlKey) {\r\n      // Ctrl + Right Arrow Key\r\n      if (document.activeElement.tagName === \"INPUT\") {\r\n        return;\r\n      }\r\n      // todo: if (!this.addon.settings.get(\"enableCtrlLeftRightNav\")) {\r\n      //         return;\r\n      //       }\r\n      if (this.isScriptEditor()) {\r\n        this.utils.navigationHistory.goForward();\r\n      } else if (this.isCostumeEditor()) {\r\n        switchCostume(false);\r\n      }\r\n      e.cancelBubble = true;\r\n      e.preventDefault();\r\n      return true;\r\n    }\r\n\r\n    if (e.keyCode === 86 && ctrlKey && !e.griff) {\r\n      // Ctrl + V\r\n      // Set a timeout so we can take control of the paste after the event\r\n      let ids = this.getTopBlockIDs();\r\n      setTimeout(() => {\r\n        this.beginDragOfNewBlocksNotInIDs(ids);\r\n      }, 10);\r\n    }\r\n\r\n    // if (e.keyCode === 220 && (!document.activeElement || document.activeElement.tagName === 'INPUT')) {\r\n    //\r\n    // }\r\n  }\r\n\r\n  eventCopyClick(block, blockOnly) {\r\n    let wksp = this.utils.getWorkspace();\r\n\r\n    if (block) {\r\n      block.select();\r\n      let next = blockOnly ? block.getNextBlock() : null;\r\n      if (next) {\r\n        next.unplug(false); // setParent(null);\r\n      }\r\n\r\n      // separate child temporarily\r\n      document.dispatchEvent(new KeyboardEvent(\"keydown\", { keyCode: 67, ctrlKey: true }));\r\n      if (next || blockOnly === 2) {\r\n        setTimeout(() => {\r\n          if (next) {\r\n            wksp.undo(); // undo the unplug above...\r\n          }\r\n          if (blockOnly === 2) {\r\n            UndoGroup.startUndoGroup(wksp);\r\n            block.dispose(true);\r\n            UndoGroup.endUndoGroup(wksp);\r\n          }\r\n        }, 0);\r\n      }\r\n    }\r\n  }\r\n\r\n  eventMouseDown(e) {\r\n    this.updateMousePosition(e);\r\n\r\n    if (this.ddOut && this.ddOut.classList.contains(\"vis\") && !e.target.closest(\"#s3devDDOut\")) {\r\n      // If we click outside the dropdown, then instigate the hide code...\r\n      this.hideDropDown();\r\n    }\r\n\r\n    if (this.floatInp && !e.target.closest(\"#s3devIDDOut\")) {\r\n      if (\r\n        !e.shiftKey ||\r\n        // Clicking on the code area should always make multi-inject work\r\n        (!document.getElementsByClassName(\"injectionDiv\")[0].contains(e.target) &&\r\n          // Focused inputs are not part of the injectionDiv, but to the user they are part of the code area so make multi-inject work there\r\n          !e.target.classList.contains(\"blocklyHtmlInput\")) ||\r\n        // This selector targets workspace buttons (Make a Block etc.) and the extension (!) buttons, which most commonly trigger a popup window so always close the dropdown\r\n        e.target.matches(\".blocklyFlyoutButton, .blocklyFlyoutButton *, .blocklyTouchTargetBackground\")\r\n      ) {\r\n        // If we click outside the dropdown, then instigate the hide code...\r\n        this.hideFloatDropDown();\r\n      }\r\n    }\r\n\r\n    if (e.button === 1 || e.shiftKey) {\r\n      // Wheel button...\r\n      try {\r\n        this.middleClick(e);\r\n      } catch (x) {\r\n        console.error(x);\r\n      }\r\n    } else if (e.button === 2) {\r\n      // Right click...\r\n      /*\r\n      let spriteSelector = e.target.closest(\"#react-tabs-3 div[class*='sprite-selector-item_sprite-selector-item']\");\r\n      if (spriteSelector) {\r\n        let contextMenu = spriteSelector.getElementsByTagName(\"nav\")[0];\r\n        if (!contextMenu.querySelector(\"div.s3devSTT\")) {\r\n          contextMenu.insertAdjacentHTML(\r\n            \"beforeend\",\r\n            `\r\n                            <div class=\"${this.addon.tab.scratchClass(\r\n                              \"context-menu_menu-item\",\r\n                              \"context-menu_menu-item-bordered\",\r\n                              {\r\n                                others: [\"react-contextmenu-item\", \"s3devSTT\"],\r\n                              }\r\n                            )}\" role=\"menuitem\"\r\n                                tabindex=\"-1\" aria-disabled=\"false\"><span>${this.m(\"top\")}</span></div>\r\n                            <div class=\"${this.addon.tab.scratchClass(\"context-menu_menu-item\", {\r\n                              others: [\"react-contextmenu-item\", \"s3devSTT\"],\r\n                            })}\" role=\"menuitem\"\r\n                                tabindex=\"-1\" aria-disabled=\"false\"><span>${this.m(\"bottom\")}</span></div>\r\n                        `\r\n          );\r\n        }\r\n      }\r\n      */\r\n    } else {\r\n      let chk = e.target;\r\n      if (chk && chk.tagName !== \"BUTTON\" && chk.getAttribute && !chk.getAttribute(\"role\")) {\r\n        chk = chk.parentNode;\r\n        if (chk && chk.tagName !== \"BUTTON\" && chk.getAttribute && !chk.getAttribute(\"role\")) {\r\n          chk = chk.parentNode;\r\n        }\r\n      }\r\n\r\n      if (chk && chk.className && chk.className.indexOf) {\r\n        if (!this.canShare && chk.className.indexOf(\"share-button\") >= 0) {\r\n          // Commented for ScratchAddons\r\n          /*e.cancelBubble = true;\r\n                      e.preventDefault();\r\n\r\n                      if (confirm(\"Griffpatch: Are you sure you want to share?\")) {\r\n                          // action the share!\r\n                          canShare = true;\r\n                          chk.click();\r\n                      }*/\r\n\r\n          return;\r\n        }\r\n      }\r\n\r\n      chk = e.target.tagName === \"SPAN\" ? e.target.parentNode : e.target;\r\n\r\n      if (chk.classList.contains(\"s3devSTT\")) {\r\n        if (chk.textContent === this.m(\"top\") || chk.textContent === this.m(\"bottom\")) {\r\n          let spriteSelector = e.target.closest(\"div[class*='sprite-selector-item_sprite-selector-item']\");\r\n          this.moveCostumeTo(chk.textContent === this.m(\"top\"), spriteSelector);\r\n          e.cancelBubble = true;\r\n          e.preventDefault();\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  eventMouseUp(e) {\r\n    this.updateMousePosition(e);\r\n\r\n    if (e.button === 1 && e.target.closest(\"svg.blocklySvg\")) {\r\n      // On Linux systems, middle click is often treated as a paste.\r\n      // We do not want this as we assign our own functionality to middle mouse.\r\n      e.preventDefault();\r\n    }\r\n  }\r\n\r\n  middleClickWorkspace(e) {\r\n    if (!this.isScriptEditor()) {\r\n      return;\r\n    }\r\n\r\n    // todo: if (!this.addon.settings.get(\"enableBlockInjector\")) {\r\n    //         return;\r\n    //       }\r\n\r\n    e.cancelBubble = true;\r\n    e.preventDefault();\r\n\r\n    let floatBar = document.getElementById(\"s3devFloatingBar\");\r\n    if (floatBar) {\r\n      floatBar.remove();\r\n    }\r\n\r\n    // Popup new input box for block injection\r\n    document.body.insertAdjacentHTML(\r\n      \"beforeend\",\r\n      `\r\n            <div id=\"s3devFloatingBar\" dir=\"${this.addon.tab.direction}\">\r\n                <label class='title s3devLabel' id=s3devInsertLabel>\r\n                    <span style=\"display:none;\">${this.m(\"insert\")} </span>\r\n                    <span id=s3devInsert class=\"s3devWrap\">\r\n                        <div id='s3devIDDOut' class=\"s3devDDOut\">\r\n                            <input id='s3devIInp' class=\"${this.addon.tab.scratchClass(\"input_input-form\", {\r\n                              others: \"s3devInp\",\r\n                            })}\" type='search' placeholder='${this.m(\"start-typing\")}' autocomplete='off'>\r\n                            <ul id='s3devIDD' class=\"s3devDD\"></ul>\r\n                        </div>\r\n                    </span>\r\n                </label>\r\n            </div>\r\n        `\r\n    );\r\n\r\n    floatBar = document.getElementById(\"s3devFloatingBar\");\r\n    floatBar.style.left = this.mouseXY.x + 16 + \"px\";\r\n    floatBar.style.top = this.mouseXY.y - 8 + \"px\";\r\n\r\n    this.floatInp = document.getElementById(\"s3devIInp\");\r\n    this.floatInp.focus();\r\n\r\n    // Build Filter List...\r\n\r\n    this.buildFloatingFilterList(e, floatBar);\r\n\r\n    const ddOut = document.getElementById(\"s3devIDDOut\");\r\n    ddOut.addEventListener(\"mousedown\", (...e) => this.dropDownFloatClick(...e));\r\n\r\n    this.floatInp.addEventListener(\"keyup\", (...e) => this.floatInputChange(...e));\r\n    this.floatInp.addEventListener(\"focus\", (...e) => this.floatInputChange(...e));\r\n    this.floatInp.addEventListener(\"keydown\", (...e) => this.floatInputKeyDown(...e));\r\n  }\r\n\r\n  middleClick(e) {\r\n    // Intercept clicks to allow jump to...?\r\n    let blockSvg = e.target.closest(\"[data-id]\");\r\n    if (!blockSvg) {\r\n      // Ok, so no selection... are we at least clicking on the workspace?\r\n      if (e.target.closest(\"svg.blocklySvg\")) {\r\n        this.blockCursor = null; // Clear the cursor if using the mouse\r\n        this.middleClickWorkspace(e);\r\n      }\r\n      return;\r\n    }\r\n\r\n    if (!this.addon.settings.get(\"enableMiddleClickFinder\")) {\r\n      return;\r\n    }\r\n\r\n    let w = this.utils.getWorkspace();\r\n    let dataId = blockSvg.getAttribute(\"data-id\");\r\n    let block = w.getBlockById(dataId);\r\n    if (!block) {\r\n      return;\r\n    }\r\n\r\n    // Move outwards until we reach a block we can take action on\r\n\r\n    for (; block; block = block.getSurroundParent()) {\r\n      if (block.type === \"procedures_call\") {\r\n        e.cancelBubble = true;\r\n        e.preventDefault();\r\n\r\n        // todo: navigate to definition\r\n        let findProcCode = block.getProcCode();\r\n\r\n        let wksp = this.utils.getWorkspace();\r\n        let topBlocks = wksp.getTopBlocks();\r\n        for (const root of topBlocks) {\r\n          if (root.type === \"procedures_definition\") {\r\n            let label = root.getChildren()[0];\r\n            let procCode = label.getProcCode();\r\n            if (procCode && procCode === findProcCode) {\r\n              // Found... navigate to it!\r\n              this.centerTop(root);\r\n              return;\r\n            }\r\n          }\r\n        }\r\n      }\r\n\r\n      if (block.type === \"procedures_definition\") {\r\n        let id = block.id ? block.id : block.getId ? block.getId() : null;\r\n\r\n        this.findInp.focus();\r\n        this.showDropDown(null, id);\r\n        // findInp.select();\r\n\r\n        e.cancelBubble = true;\r\n        e.preventDefault();\r\n        return;\r\n      }\r\n\r\n      if (\r\n        block.type === \"data_variable\" ||\r\n        block.type === \"data_changevariableby\" ||\r\n        block.type === \"data_setvariableto\"\r\n      ) {\r\n        let id = block.getVars()[0];\r\n\r\n        this.findInp.focus();\r\n        this.showDropDown(null, id, block);\r\n\r\n        // let button = document.getElementById('s3devReplace');\r\n\r\n        this.selVarID = id;\r\n        // button.classList.remove('s3devHide');\r\n\r\n        e.cancelBubble = true;\r\n        e.preventDefault();\r\n        return;\r\n      }\r\n\r\n      if (\r\n        block.type === \"event_whenbroadcastreceived\" ||\r\n        block.type === \"event_broadcastandwait\" ||\r\n        block.type === \"event_broadcast\"\r\n      ) {\r\n        // todo: actually index the broadcasts...!\r\n        let id = block.id;\r\n\r\n        this.findInp.focus();\r\n        this.showDropDown(null, id, block);\r\n\r\n        this.selVarID = id;\r\n\r\n        e.cancelBubble = true;\r\n        e.preventDefault();\r\n        return;\r\n      }\r\n    }\r\n\r\n    e.cancelBubble = true;\r\n    e.preventDefault();\r\n  }\r\n\r\n  getEdgeTypeClass(block) {\r\n    switch (block.edgeShape_) {\r\n      case 1:\r\n        return \"boolean\";\r\n      case 2:\r\n        return \"reporter\";\r\n      default:\r\n        return block.startHat_ ? \"hat\" : \"block\";\r\n    }\r\n  }\r\n\r\n  buildFloatingFilterList(e, floatBar) {\r\n    // todo: Iterate through the toolbox?\r\n\r\n    let options = [];\r\n\r\n    let t = this.utils.getWorkspace().getToolbox();\r\n\r\n    let blocks = t.flyout_.getWorkspace().getTopBlocks();\r\n    // 107 blocks, not in order... but we can sort by y value or description right :)\r\n\r\n    let fullDom = Blockly.Xml.workspaceToDom(t.flyout_.getWorkspace());\r\n    const doms = {};\r\n    for (const x of fullDom.children) {\r\n      if (x.tagName === \"BLOCK\") {\r\n        // let type = x.getAttribute('type');\r\n        let id = x.getAttribute(\"id\");\r\n        doms[id] = x;\r\n      }\r\n    }\r\n\r\n    for (const block of blocks) {\r\n      this.getBlockText(block, options, doms);\r\n    }\r\n\r\n    // Griffpatch - on second thoughts - lets sort blocks by length so that shortest ones appear at the top.\r\n    options.sort((a, b) =>\r\n      a.desc.length < b.desc.length ? -1 : a.desc.length > b.desc.length ? 1 : a.desc.localeCompare(b.desc)\r\n    );\r\n\r\n    // Previous sort was just alphabetical\r\n    // options.sort((a, b) => a.desc.localeCompare(b.desc));\r\n\r\n    const dd = document.getElementById(\"s3devIDD\");\r\n\r\n    let count = 0;\r\n    //DROPDOWN_BLOCK_LIST_MAX_ROWS\r\n\r\n    for (const option of options) {\r\n      const li = document.createElement(\"li\");\r\n      const desc = option.desc;\r\n\r\n      // bType = hat block reporter boolean\r\n\r\n      let bType = this.getEdgeTypeClass(option.block);\r\n\r\n      count++;\r\n\r\n      li.innerText = desc;\r\n      li.data = { text: desc, lower: \" \" + desc.toLowerCase(), option: option };\r\n      li.className =\r\n        \"var \" + (option.block.isScratchExtension ? \"extension\" : option.block.getCategory()) + \" \" + bType; // proc.cls;\r\n      if (count > DROPDOWN_BLOCK_LIST_MAX_ROWS) {\r\n        // Limit maximum number of rows to prevent lag when no filter is applied\r\n        li.style.display = \"none\";\r\n      }\r\n      dd.appendChild(li);\r\n    }\r\n\r\n    const ddOut = document.getElementById(\"s3devIDDOut\");\r\n    ddOut.classList.add(\"vis\");\r\n\r\n    // console.log(options);\r\n  }\r\n\r\n  /**\r\n   * Flesh out a blocks description - duplicate up blocks with contained picklists (like list drop downs)\r\n   * @param block\r\n   * @param options\r\n   * @param doms\r\n   * @returns {string}\r\n   */\r\n  getBlockText(block, options, doms) {\r\n    // block.type;  \"looks_nextbackdrop\"\r\n\r\n    let desc;\r\n    let picklist, pickField;\r\n\r\n    let dom = doms[block.id];\r\n\r\n    // dom = doms[block.type];\r\n\r\n    const process = (block) => {\r\n      for (const input of block.inputList) {\r\n        // input.name = \"\", input.type = 5\r\n        let fields = input.fieldRow;\r\n        for (const field of fields) {\r\n          // field --- Blockly.FieldLabel .className = \"blocklyText\"\r\n          // Blockly.FieldDropdown --- .className = \"blocklyText blocklyDropdownText\"\r\n\r\n          let text;\r\n\r\n          if (!picklist && field.className_ === \"blocklyText blocklyDropdownText\") {\r\n            picklist = field.getOptions();\r\n            pickField = field.name;\r\n            if (picklist && picklist.length > 0) {\r\n              text = \"^^\";\r\n            } else {\r\n              text = field.getText();\r\n            }\r\n          } else {\r\n            text = field.getText();\r\n          }\r\n\r\n          desc = (desc ? desc + \" \" : \"\") + text;\r\n        }\r\n\r\n        if (input.connection) {\r\n          let innerBlock = input.connection.targetBlock();\r\n          if (innerBlock) {\r\n            process(innerBlock); // Recursive process connected child blocks...\r\n          }\r\n        }\r\n      }\r\n    };\r\n\r\n    process(block);\r\n\r\n    if (picklist) {\r\n      for (const item of picklist) {\r\n        let code = item[1];\r\n        if (\r\n          typeof code !== \"string\" || // Audio Record is a function!\r\n          code === \"DELETE_VARIABLE_ID\" ||\r\n          code === \"RENAME_VARIABLE_ID\" ||\r\n          code === \"NEW_BROADCAST_MESSAGE_ID\" ||\r\n          code === \"NEW_BROADCAST_MESSAGE_ID\" ||\r\n          // editor-searchable-dropdowns compatibility\r\n          code === \"createGlobalVariable\" ||\r\n          code === \"createLocalVariable\" ||\r\n          code === \"createGlobalList\" ||\r\n          code === \"createLocalList\" ||\r\n          code === \"createBroadcast\"\r\n        ) {\r\n          continue; // Skip these\r\n        }\r\n        options.push({\r\n          desc: desc.replace(\"^^\", item[0]),\r\n          block: block,\r\n          dom: dom,\r\n          option: item,\r\n          pickField: pickField,\r\n        });\r\n      }\r\n    } else {\r\n      options.push({ desc: desc, block: block, dom: dom });\r\n    }\r\n\r\n    return desc;\r\n  }\r\n\r\n  floatInputKeyDown(e) {\r\n    if (e.keyCode === 38) {\r\n      this.navigateFloatFilter(-1);\r\n      e.preventDefault();\r\n      return;\r\n    }\r\n    if (e.keyCode === 40) {\r\n      this.navigateFloatFilter(1);\r\n      e.preventDefault();\r\n      return;\r\n    }\r\n    if (e.keyCode === 13) {\r\n      // Enter\r\n      let dd = document.getElementById(\"s3devIDD\");\r\n      let sel = dd.querySelector(\".sel\");\r\n      if (sel) {\r\n        this.dropDownFloatClick(e);\r\n      }\r\n      e.cancelBubble = true;\r\n      e.preventDefault();\r\n      return;\r\n    }\r\n    if (e.keyCode === 27) {\r\n      // Escape\r\n      let findInp = document.getElementById(\"s3devIInp\");\r\n      if (findInp.value.length > 0) {\r\n        findInp.value = \"\"; // Clear search first, then close on second press\r\n        this.floatInputChange(e);\r\n      } else {\r\n        this.reallyHideFloatDropDown(true);\r\n      }\r\n      e.preventDefault();\r\n      return;\r\n    }\r\n  }\r\n\r\n  navigateFloatFilter(dir) {\r\n    let dd = document.getElementById(\"s3devIDD\");\r\n    let sel = dd.getElementsByClassName(\"sel\");\r\n    let nxt;\r\n    if (sel.length > 0 && sel[0].style.display !== \"none\") {\r\n      nxt = dir === -1 ? sel[0].previousSibling : sel[sel.length - 1].nextSibling;\r\n    } else {\r\n      nxt = dd.children[0];\r\n      dir = 1;\r\n    }\r\n    while (nxt && nxt.style.display === \"none\") {\r\n      nxt = dir === -1 ? nxt.previousSibling : nxt.nextSibling;\r\n    }\r\n    if (nxt) {\r\n      for (const i of sel) {\r\n        i.classList.remove(\"sel\");\r\n      }\r\n      nxt.classList.add(\"sel\");\r\n      // centerTop(nxt.data.labelID);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * This is a feature in progress - can we have a virtual cursor that allows the next injected element position be automated\r\n   * @param block a blockly block\r\n   * @param typ type\r\n   */\r\n  findNextHole(block, typ) {\r\n    /*\r\n      const inputs = block.inputList;\r\n      if (inputs) {\r\n        /!** Blockly.Input *!/\r\n        for (const input of inputs) {\r\n          const fieldRow = input.fieldRow;\r\n          if (fieldRow) {\r\n            /!** Blockly.FieldNumber *!/\r\n            for (const field of fieldRow) {\r\n              if (field.argType_ && field.argType_.includes(typ)) {\r\n              }\r\n            }\r\n          }\r\n        }\r\n      }\r\n  */\r\n  }\r\n\r\n  /**\r\n   * Inject the selected block into the script\r\n   * @param e\r\n   */\r\n  dropDownFloatClick(e) {\r\n    e.cancelBubble = true;\r\n    if (!e.target.closest(\"input\")) {\r\n      e.preventDefault();\r\n    }\r\n\r\n    let wksp = this.utils.getWorkspace();\r\n\r\n    let sel = e && e.target;\r\n    if (sel.tagName === \"B\") {\r\n      sel = sel.parentNode;\r\n    }\r\n\r\n    if (e instanceof MouseEvent && sel.tagName !== \"LI\") {\r\n      // Mouse clicks need to be on a block...\r\n      return;\r\n    }\r\n\r\n    if (!sel || !sel.data) {\r\n      let dd = document.getElementById(\"s3devIDD\");\r\n      sel = dd.querySelector(\".sel\");\r\n    }\r\n\r\n    if (!sel) {\r\n      return;\r\n    }\r\n\r\n    const xml = new XML();\r\n    let x = xml.xmlDoc.firstChild;\r\n    let option = sel.data.option;\r\n    // block:option.block, dom:option.dom, option:option.option\r\n    if (option.option) {\r\n      // We need to tweak the dropdown in this xml...\r\n      let field = option.dom.querySelector(\"field[name=\" + option.pickField + \"]\");\r\n      if (field.getAttribute(\"id\")) {\r\n        field.innerText = option.option[0];\r\n        field.setAttribute(\"id\", option.option[1] + \"-\" + option.option[0]);\r\n      } else {\r\n        field.innerText = option.option[1]; // griffpatch - oops! option.option[1] not 0?\r\n      }\r\n\r\n      // Handle \"stop other scripts in sprite\"\r\n      if (option.option[1] === \"other scripts in sprite\") {\r\n        option.dom.querySelector(\"mutation\").setAttribute(\"hasnext\", \"true\");\r\n      }\r\n    }\r\n\r\n    x.appendChild(option.dom);\r\n\r\n    let ids = Blockly.Xml.domToWorkspace(x, wksp);\r\n\r\n    if (!e.shiftKey) {\r\n      this.reallyHideFloatDropDown(true);\r\n    }\r\n\r\n    let block = wksp.getBlockById(ids[0]);\r\n\r\n    if (this.blockCursor) {\r\n      // What sort of block did we just inject?\r\n      let typ = this.getEdgeTypeClass(option.block);\r\n      if (typ === \"boolean\") {\r\n        this.findNextHole(this.blockCursor, \"\");\r\n      } else if (typ === \"reporter\") {\r\n        this.findNextHole(this.blockCursor, typ);\r\n      }\r\n    }\r\n\r\n    this.domHelpers.triggerDragAndDrop(block.svgPath_, null, { x: this.mouseXY.x, y: this.mouseXY.y }, e.shiftKey);\r\n\r\n    if (e.shiftKey) {\r\n      document.getElementById(\"s3devIInp\").focus();\r\n    }\r\n\r\n    this.blockCursor = block;\r\n  }\r\n\r\n  floatInputChange(e) {\r\n    let ddOut = document.getElementById(\"s3devIDDOut\");\r\n\r\n    if (!ddOut.classList.contains(\"vis\")) {\r\n      // showDropDown();\r\n      // hideDropDown(); // Start timer to hide if not got focus\r\n    }\r\n\r\n    let findInp = document.getElementById(\"s3devIInp\");\r\n\r\n    // Filter the list...\r\n    let val = (findInp.value || \"\").toLowerCase();\r\n    if (val === prevVal) {\r\n      return;\r\n    }\r\n\r\n    prevVal = val;\r\n    this.multi.blocks = null;\r\n\r\n    let dd = document.getElementById(\"s3devIDD\");\r\n    let p = dd.parentNode;\r\n    dd.remove();\r\n\r\n    let count = 0;\r\n\r\n    let split = val.split(\" \");\r\n    let listLI = dd.getElementsByTagName(\"li\");\r\n    for (const li of listLI) {\r\n      const procCode = li.data.text;\r\n      const lower = li.data.lower;\r\n      // let i = li.data.lower.indexOf(val);\r\n      // let array = regExp.exec(li.data.lower);\r\n\r\n      let im = 0;\r\n      let match = [];\r\n      for (let si = 0; si < split.length; si++) {\r\n        let find = \" \" + split[si];\r\n        let idx = lower.indexOf(find, im);\r\n        if (idx === -1) {\r\n          match = null;\r\n          break;\r\n        }\r\n        match.push(idx);\r\n        im = idx + find.length;\r\n      }\r\n\r\n      if (count < DROPDOWN_BLOCK_LIST_MAX_ROWS && match) {\r\n        li.style.display = \"block\";\r\n        this.dom_removeChildren(li);\r\n\r\n        let i = 0;\r\n\r\n        for (let iM = 0; iM < match.length; iM++) {\r\n          let im = match[iM];\r\n          if (im > i) {\r\n            li.appendChild(document.createTextNode(procCode.substring(i, im)));\r\n            i = im;\r\n          }\r\n          let bText = document.createElement(\"b\");\r\n          let len = split[iM].length;\r\n          bText.appendChild(document.createTextNode(procCode.substr(i, len)));\r\n          li.appendChild(bText);\r\n          i += len;\r\n        }\r\n\r\n        if (i < procCode.length) {\r\n          li.appendChild(document.createTextNode(procCode.substr(i)));\r\n        }\r\n\r\n        if (count === 0) {\r\n          li.classList.add(\"sel\");\r\n        } else {\r\n          li.classList.remove(\"sel\");\r\n        }\r\n        count++;\r\n      } else {\r\n        li.style.display = \"none\";\r\n        li.classList.remove(\"sel\");\r\n      }\r\n    }\r\n    p.append(dd);\r\n  }\r\n\r\n  initInner(root) {\r\n    let guiTabs = root.childNodes;\r\n\r\n    if (this.codeTab && guiTabs[0] !== this.codeTab) {\r\n      // We have been CHANGED!!! - Happens when going to project page, and then back inside again!!!\r\n      this.domHelpers.unbindAllEvents();\r\n    }\r\n\r\n    this.codeTab = guiTabs[0];\r\n    this.costTab = guiTabs[1];\r\n    this.costTabBody = document.querySelector(\"div[aria-labelledby=\" + this.costTab.id + \"]\");\r\n\r\n    if (!document.getElementById(\"s3devFind\")) {\r\n      // noinspection JSUnresolvedVariable\r\n      root.insertAdjacentHTML(\r\n        \"beforeend\",\r\n        `\r\n                <div id=\"s3devToolBar\">\r\n                    <label class='title s3devLabel' id=s3devFindLabel>\r\n                        <span>${this.m(\"find\")} ${\r\n          this.addon.self._isDevtoolsExtension\r\n            ? \"\"\r\n            : '<a href=\"#\" class=\"s3devAction\" id=\"s3devHelp\" style=\"/*s-a*/ margin-left: 0; font-size: 10px; /*s-a*/\">(?)</a>'\r\n        } </span>\r\n                        <span id=s3devFind class=\"s3devWrap\">\r\n                            <div id='s3devDDOut' class=\"s3devDDOut\">\r\n                                <input id='s3devInp' class=\"${this.addon.tab.scratchClass(\"input_input-form\", {\r\n                                  others: \"s3devInp\",\r\n                                })}\" type='search' placeholder='${this.m(\"find-placeholder\")}' autocomplete='off'>\r\n                                <ul id='s3devDD' class=\"s3devDD\"></ul>\r\n                            </div>\r\n                        </span>\r\n                        <a id=\"s3devDeep\" class=\"s3devAction s3devHide\" href=\"#\">${this.m(\"deep\")}</a>\r\n                        <div ${\r\n                          this.addon.self._isDevtoolsExtension ? \"\" : 'style=\"display: none;\"'\r\n                        }><a href=\"#\" class=\"s3devAction\" id=\"s3devHelp\"><b>${this.m(\"help\")}</b></a>\r\n                        <a href=\"https://www.youtube.com/griffpatch\" class=\"s3devAction\" target=\"_blank\" id=\"s3devHelp\" rel=\"noreferrer noopener\">${this.m(\r\n                          \"tutorials\"\r\n                        )}</a></div>\r\n                    </label>\r\n                </div>\r\n            `\r\n      );\r\n\r\n      this.find = document.getElementById(\"s3devFind\");\r\n      this.findInp = document.getElementById(\"s3devInp\");\r\n      this.ddOut = document.getElementById(\"s3devDDOut\");\r\n      this.domHelpers.bindOnce(this.ddOut, \"mousedown\", (...e) => this.dropDownClick(...e), undefined);\r\n      this.dd = document.getElementById(\"s3devDD\");\r\n\r\n      // bindOnce(find, 'mouseenter', showDropDown);\r\n      // bindOnce(find, 'mouseleave', hideDropDown);\r\n      this.domHelpers.bindOnce(this.findInp, \"keyup\", (...e) => this.inputChange(...e), undefined);\r\n      this.domHelpers.bindOnce(this.findInp, \"keydown\", (...e) => this.inputKeyDown(...e), undefined);\r\n      this.domHelpers.bindOnce(this.findInp, \"focus\", (...e) => this.inputChange(...e), undefined);\r\n\r\n      this.domHelpers.bindOnce(\r\n        document.getElementById(\"s3devHelp\"),\r\n        \"click\",\r\n        (...e) => this.eventClickHelp(...e),\r\n        undefined\r\n      );\r\n\r\n      this.domHelpers.bindOnce(document, \"keydown\", (...e) => this.eventKeyDown(...e), true);\r\n    }\r\n\r\n    this.domHelpers.bindOnce(document, \"mousemove\", (...e) => this.eventMouseMove(...e), true);\r\n    this.domHelpers.bindOnce(document, \"mousedown\", (...e) => this.eventMouseDown(...e), true); // true to capture all mouse downs 'before' the dom events handle them\r\n    this.domHelpers.bindOnce(document, \"mouseup\", (...e) => this.eventMouseUp(...e), true);\r\n  }\r\n}\r\n\r\nclass Multi {\r\n  constructor(utils) {\r\n    this.idx = 0;\r\n    this.blocks = null;\r\n    this.selID = null;\r\n    /**\r\n     * @type {Utils}\r\n     */\r\n    this.utils = utils;\r\n  }\r\n\r\n  update() {\r\n    const count = document.getElementById(\"s3devMultiCount\");\r\n    count.innerText = this.blocks && this.blocks.length > 0 ? enc(this.idx + 1 + \" / \" + this.blocks.length) : \"0\";\r\n    this.selID = this.idx < this.blocks.length ? this.blocks[this.idx].id : null;\r\n  }\r\n\r\n  navLeft(e) {\r\n    return this.navSideways(e, -1);\r\n  }\r\n\r\n  navRight(e) {\r\n    return this.navSideways(e, 1);\r\n  }\r\n\r\n  navSideways(e, dir) {\r\n    if (this.blocks && this.blocks.length > 0) {\r\n      this.idx = (this.idx + dir + this.blocks.length) % this.blocks.length; // + length to fix negative modulo js issue.\r\n      this.update();\r\n      this.utils.scrollBlockIntoView(this.blocks[this.idx]);\r\n    }\r\n    if (e) {\r\n      e.cancelBubble = true;\r\n      e.preventDefault();\r\n    }\r\n    return false;\r\n  }\r\n}\r\n\r\nclass Col {\r\n  /**\r\n   * @param x {Number} x position (for ordering)\r\n   * @param count {Number}\r\n   * @param blocks {[Block]}\r\n   */\r\n  constructor(x, count, blocks) {\r\n    /**\r\n     * x position (for ordering)\r\n     * @type {Number}\r\n     */\r\n    this.x = x;\r\n    /**\r\n     * @type {Number}\r\n     */\r\n    this.count = count;\r\n    /**\r\n     * @type {[Blockly.Block]}\r\n     */\r\n    this.blocks = blocks;\r\n  }\r\n}\r\n\r\nconst DROPDOWN_BLOCK_LIST_MAX_ROWS = 25;\r\n\r\nlet rhdd = 0;\r\nlet rhdd2 = 0;\r\nlet prevVal = \"\";\r\n\r\nfunction enc(str) {\r\n  return String(str).replace(/&/g, \"&amp;\").replace(/</g, \"&lt;\").replace(/>/g, \"&gt;\").replace(/\"/g, \"&quot;\");\r\n}\r\n","export default class DomHelpers {\r\n  constructor(addon) {\r\n    this.addon = addon;\r\n    this.vm = addon.tab.traps.vm;\r\n    /**\r\n     * @type {eventDetails[]}\r\n     */\r\n    this.events = [];\r\n  }\r\n\r\n  /**\r\n   * Simulate a drag and drop programmatically through javascript\r\n   * @param selectorDrag\r\n   * @param selectorDrop\r\n   * @param mouseXY\r\n   * @param [shiftKey=false]\r\n   * @returns {boolean}\r\n   */\r\n  triggerDragAndDrop(selectorDrag, selectorDrop, mouseXY, shiftKey) {\r\n    // function for triggering mouse events\r\n    shiftKey = shiftKey || false;\r\n    let fireMouseEvent = function (type, elem, centerX, centerY) {\r\n      let evt = document.createEvent(\"MouseEvents\");\r\n      evt.initMouseEvent(type, true, true, window, 1, 1, 1, centerX, centerY, shiftKey, false, false, false, 0, elem);\r\n      elem.dispatchEvent(evt);\r\n    };\r\n\r\n    // fetch target elements\r\n    let elemDrag = selectorDrag; // document.querySelector(selectorDrag);\r\n    let elemDrop = selectorDrop; // document.querySelector(selectorDrop);\r\n    if (!elemDrag /* || !elemDrop*/) {\r\n      return false;\r\n    }\r\n\r\n    // calculate positions\r\n    let pos = elemDrag.getBoundingClientRect();\r\n    let center1X = Math.floor((pos.left + pos.right) / 2);\r\n    let center1Y = Math.floor((pos.top + pos.bottom) / 2);\r\n\r\n    // mouse over dragged element and mousedown\r\n    fireMouseEvent(\"mouseover\", elemDrag, center1X, center1Y);\r\n    fireMouseEvent(\"mousedown\", elemDrag, center1X, center1Y);\r\n\r\n    // start dragging process over to drop target\r\n    fireMouseEvent(\"dragstart\", elemDrag, center1X, center1Y);\r\n    fireMouseEvent(\"drag\", elemDrag, center1X, center1Y);\r\n    fireMouseEvent(\"mousemove\", elemDrag, center1X, center1Y);\r\n\r\n    if (!elemDrop) {\r\n      if (mouseXY) {\r\n        // console.log(mouseXY);\r\n        let center2X = mouseXY.x;\r\n        let center2Y = mouseXY.y;\r\n        fireMouseEvent(\"drag\", elemDrag, center2X, center2Y);\r\n        fireMouseEvent(\"mousemove\", elemDrag, center2X, center2Y);\r\n      }\r\n      return false;\r\n    }\r\n\r\n    pos = elemDrop.getBoundingClientRect();\r\n    let center2X = Math.floor((pos.left + pos.right) / 2);\r\n    let center2Y = Math.floor((pos.top + pos.bottom) / 2);\r\n\r\n    fireMouseEvent(\"drag\", elemDrag, center2X, center2Y);\r\n    fireMouseEvent(\"mousemove\", elemDrop, center2X, center2Y);\r\n\r\n    // trigger dragging process on top of drop target\r\n    fireMouseEvent(\"mouseenter\", elemDrop, center2X, center2Y);\r\n    fireMouseEvent(\"dragenter\", elemDrop, center2X, center2Y);\r\n    fireMouseEvent(\"mouseover\", elemDrop, center2X, center2Y);\r\n    fireMouseEvent(\"dragover\", elemDrop, center2X, center2Y);\r\n\r\n    // release dragged element on top of drop target\r\n    fireMouseEvent(\"drop\", elemDrop, center2X, center2Y);\r\n    fireMouseEvent(\"dragend\", elemDrag, center2X, center2Y);\r\n    fireMouseEvent(\"mouseup\", elemDrag, center2X, center2Y);\r\n\r\n    return true;\r\n  }\r\n\r\n  bindOnce(dom, event, func, capture) {\r\n    capture = !!capture;\r\n    dom.removeEventListener(event, func, capture);\r\n    dom.addEventListener(event, func, capture);\r\n    this.events.push(new eventDetails(dom, event, func, capture));\r\n  }\r\n\r\n  unbindAllEvents() {\r\n    for (const event of this.events) {\r\n      event.dom.removeEventListener(event.event, event.func, event.capture);\r\n    }\r\n    this.events = [];\r\n  }\r\n}\r\n\r\n/**\r\n * A record of an event\r\n */\r\nclass eventDetails {\r\n  constructor(dom, event, func, capture) {\r\n    this.dom = dom;\r\n    this.event = event;\r\n    this.func = func;\r\n    this.capture = capture;\r\n  }\r\n}\r\n","/**\r\n * A fake XML class to use in place of the real XML for faking things?\r\n */\r\nexport default class XML {\r\n  constructor() {\r\n    this.xmlDoc = document.implementation.createDocument(null, \"xml\");\r\n  }\r\n\r\n  newXml(x, tagName, attrs) {\r\n    let xAdd = this.xmlDoc.createElement(tagName);\r\n    x.appendChild(xAdd);\r\n    return this.setAttr(xAdd, attrs);\r\n  }\r\n\r\n  setAttr(x, attrs) {\r\n    if (attrs) {\r\n      for (const key of Object.keys(attrs)) {\r\n        if (key === \"text\") {\r\n          x.appendChild(this.xmlDoc.createTextNode(attrs[key]));\r\n        } else {\r\n          x.setAttribute(key, attrs[key]);\r\n        }\r\n      }\r\n    }\r\n    return x;\r\n  }\r\n}\r\n","/* generated by pull.js */\nimport _js from \"./userscript.js\";\nimport _css from \"!css-loader!./userscript.css\";\nexport const resources = {\n  \"userscript.js\": _js,\n  \"userscript.css\": _css,\n};\n","/**\r\n * Helper class to flash a Blockly scratch block in the users workspace\r\n */\r\nexport default class BlockFlasher {\r\n  /**\r\n   * FLash a block 3 times\r\n   * @param block the block to flash\r\n   */\r\n  static flash(block) {\r\n    if (myFlash.timerID > 0) {\r\n      clearTimeout(myFlash.timerID);\r\n      if (myFlash.block.svgPath_) {\r\n        myFlash.block.svgPath_.style.fill = \"\";\r\n      }\r\n    }\r\n\r\n    let count = 4;\r\n    let flashOn = true;\r\n    myFlash.block = block;\r\n\r\n    /**\r\n     * Internal method to switch the colour of a block between light yellow and it's original colour\r\n     * @private\r\n     */\r\n    function _flash() {\r\n      if (myFlash.block.svgPath_) {\r\n        myFlash.block.svgPath_.style.fill = flashOn ? \"#ffff80\" : \"\";\r\n      }\r\n      flashOn = !flashOn;\r\n      count--;\r\n      if (count > 0) {\r\n        myFlash.timerID = setTimeout(_flash, 200);\r\n      } else {\r\n        myFlash.timerID = 0;\r\n        myFlash.block = null;\r\n      }\r\n    }\r\n\r\n    _flash();\r\n  }\r\n}\r\n\r\nconst myFlash = { block: null, timerID: null };\r\n","/**\r\n * This class is dedicated to maintaining the Undo stack of Blockly\r\n * It allows us to initiate an undo group such that all subsequent operations are recorded as a single\r\n * undoable transaction.\r\n */\r\nexport default class UndoGroup {\r\n  /**\r\n   * Start an Undo group - begin recording\r\n   * @param workspace the workspace\r\n   */\r\n  static startUndoGroup(workspace) {\r\n    const undoStack = workspace.undoStack_;\r\n    if (undoStack.length) {\r\n      undoStack[undoStack.length - 1]._devtoolsLastUndo = true;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * End an Undo group - stops recording\r\n   * @param workspace the workspace\r\n   */\r\n  static endUndoGroup(workspace) {\r\n    const undoStack = workspace.undoStack_;\r\n    // Events (responsible for undoStack updates) are delayed with a setTimeout(f, 0)\r\n    // https://github.com/LLK/scratch-blocks/blob/f159a1779e5391b502d374fb2fdd0cb5ca43d6a2/core/events.js#L182\r\n    setTimeout(() => {\r\n      const group = generateUID();\r\n      for (let i = undoStack.length - 1; i >= 0 && !undoStack[i]._devtoolsLastUndo; i--) {\r\n        undoStack[i].group = group;\r\n      }\r\n    }, 0);\r\n  }\r\n}\r\n\r\n/**\r\n * https://github.com/LLK/scratch-blocks/blob/f159a1779e5391b502d374fb2fdd0cb5ca43d6a2/core/events.js#L182\r\n * @returns {string}\r\n * @private\r\n */\r\nfunction generateUID() {\r\n  const CHARACTERS = \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!#$%()*+,-./:;=?@[]^_`{|}~\";\r\n  let result = \"\";\r\n  for (let i = 0; i < 20; i++) {\r\n    result += CHARACTERS[Math.floor(Math.random() * CHARACTERS.length)];\r\n  }\r\n  return result;\r\n}\r\n","import BlockInstance from \"../BlockInstance.js\";\r\nimport BlockFlasher from \"./BlockFlasher.js\";\r\n\r\n// A file to split Editor Devtools by features.\r\n\r\nexport default class Utils {\r\n  constructor(addon) {\r\n    this.addon = addon;\r\n    this.addon.tab.traps.getBlockly().then((blockly) => {\r\n      this.blockly = blockly;\r\n    });\r\n    /**\r\n     * Scratch Virtual Machine\r\n     * @type {null|*}\r\n     */\r\n    this.vm = this.addon.tab.traps.vm;\r\n    // this._myFlash = { block: null, timerID: null, colour: null };\r\n    this.offsetX = 32;\r\n    this.offsetY = 32;\r\n    this.navigationHistory = new NavigationHistory(this);\r\n    /**\r\n     * The workspace\r\n     */\r\n    this._workspace = null;\r\n  }\r\n\r\n  /**\r\n   * Get the Scratch Editing Target\r\n   * @returns {?Target} the scratch editing target\r\n   */\r\n  getEditingTarget() {\r\n    return this.vm.runtime.getEditingTarget();\r\n  }\r\n\r\n  /**\r\n   * Set the current workspace (switches sprites)\r\n   * @param targetID {string}\r\n   */\r\n  setEditingTarget(targetID) {\r\n    if (this.getEditingTarget().id !== targetID) {\r\n      this.vm.setEditingTarget(targetID);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Returns the main workspace\r\n   * @returns !Blockly.Workspace\r\n   */\r\n  getWorkspace() {\r\n    const currentWorkspace = Blockly.getMainWorkspace();\r\n    if (currentWorkspace.getToolbox()) {\r\n      // Sadly get get workspace does not always return the 'real' workspace... Not sure how to get that at the moment,\r\n      //  but we can work out whether it's the right one by whether it has a toolbox.\r\n      this._workspace = currentWorkspace;\r\n    }\r\n    return this._workspace;\r\n  }\r\n\r\n  /**\r\n   * Based on wksp.centerOnBlock(li.data.labelID);\r\n   * @param blockOrId {Blockly.Block|{id}|BlockInstance} A Blockly Block, a block id, or a BlockInstance\r\n   */\r\n  scrollBlockIntoView(blockOrId) {\r\n    let workspace = this.getWorkspace();\r\n    /** @type {Blockly.Block} */\r\n    let block; // or is it really a Blockly.BlockSvg?\r\n\r\n    if (blockOrId instanceof BlockInstance) {\r\n      // Switch to sprite\r\n      this.setEditingTarget(blockOrId.targetId);\r\n      // Highlight the block!\r\n      block = workspace.getBlockById(blockOrId.id);\r\n    } else {\r\n      block = blockOrId && blockOrId.id ? blockOrId : workspace.getBlockById(blockOrId);\r\n    }\r\n\r\n    if (!block) {\r\n      return;\r\n    }\r\n\r\n    /**\r\n     * !Blockly.Block\r\n     */\r\n    let root = block.getRootBlock();\r\n    let base = this.getTopOfStackFor(block);\r\n    let ePos = base.getRelativeToSurfaceXY(), // Align with the top of the block\r\n      rPos = root.getRelativeToSurfaceXY(), // Align with the left of the block 'stack'\r\n      scale = workspace.scale,\r\n      x = rPos.x * scale,\r\n      y = ePos.y * scale,\r\n      xx = block.width + x, // Turns out they have their x & y stored locally, and they are the actual size rather than scaled or including children...\r\n      yy = block.height + y,\r\n      s = workspace.getMetrics();\r\n    if (\r\n      x < s.viewLeft + this.offsetX - 4 ||\r\n      xx > s.viewLeft + s.viewWidth ||\r\n      y < s.viewTop + this.offsetY - 4 ||\r\n      yy > s.viewTop + s.viewHeight\r\n    ) {\r\n      // sx = s.contentLeft + s.viewWidth / 2 - x,\r\n      let sx = x - s.contentLeft - this.offsetX,\r\n        // sy = s.contentTop - y + Math.max(Math.min(32, 32 * scale), (s.viewHeight - yh) / 2);\r\n        sy = y - s.contentTop - this.offsetY;\r\n\r\n      this.navigationHistory.storeView(this.navigationHistory.peek(), 64);\r\n\r\n      // workspace.hideChaff(),\r\n      workspace.scrollbar.set(sx, sy);\r\n      this.navigationHistory.storeView({ left: sx, top: sy }, 64);\r\n    }\r\n    this.blockly?.hideChaff();\r\n    BlockFlasher.flash(block);\r\n  }\r\n\r\n  /**\r\n   * Find the top stack block of a stack\r\n   * @param block a block in a stack\r\n   * @returns {*} a block that is the top of the stack of blocks\r\n   */\r\n  getTopOfStackFor(block) {\r\n    let base = block;\r\n    while (base.getOutputShape() && base.getSurroundParent()) {\r\n      base = base.getSurroundParent();\r\n    }\r\n    return base;\r\n  }\r\n}\r\n\r\nclass NavigationHistory {\r\n  constructor(utils) {\r\n    this.utils = utils;\r\n    this.views = [];\r\n    this.forward = [];\r\n  }\r\n\r\n  /**\r\n   * Keep a record of the scroll and zoom position\r\n   */\r\n  storeView(next, dist) {\r\n    this.forward = [];\r\n    let workspace = this.utils.getWorkspace(),\r\n      s = workspace.getMetrics();\r\n\r\n    let pos = { left: s.viewLeft, top: s.viewTop };\r\n    if (!next || distance(pos, next) > dist) {\r\n      this.views.push(pos);\r\n    }\r\n  }\r\n\r\n  peek() {\r\n    return this.views.length > 0 ? this.views[this.views.length - 1] : null;\r\n  }\r\n\r\n  goBack() {\r\n    const workspace = this.utils.getWorkspace(),\r\n      s = workspace.getMetrics();\r\n\r\n    let pos = { left: s.viewLeft, top: s.viewTop };\r\n    let view = this.peek();\r\n    if (!view) {\r\n      return;\r\n    }\r\n    if (distance(pos, view) < 64) {\r\n      // Go back to current if we are already far away from it\r\n      if (this.views.length > 1) {\r\n        this.views.pop();\r\n        this.forward.push(view);\r\n      }\r\n    }\r\n\r\n    view = this.peek();\r\n    if (!view) {\r\n      return;\r\n    }\r\n\r\n    let sx = view.left - s.contentLeft,\r\n      sy = view.top - s.contentTop;\r\n\r\n    // transform.setTranslate(-600,0);\r\n\r\n    workspace.scrollbar.set(sx, sy);\r\n\r\n    /*\r\n              let blocklySvg = document.getElementsByClassName('blocklySvg')[0];\r\n              let blocklyBlockCanvas = blocklySvg.getElementsByClassName('blocklyBlockCanvas')[0];\r\n              let transform = blocklyBlockCanvas.transform.baseVal.getItem(0);\r\n              let scale = blocklyBlockCanvas.transform.baseVal.getItem(1);\r\n\r\n              let transformMatrix = transform.matrix;\r\n              let scaleMatrix = scale.matrix;\r\n\r\n              console.log('Transform - getMetrics', s);\r\n              console.log('sx, sy: ', sx, sy);\r\n              console.log('left, top: ', view.left, view.top);\r\n              console.log('contentLeft, right:', s.contentLeft, s.contentTop);\r\n              console.log('transform, scale matrix: ', transformMatrix, scaleMatrix);\r\n  */\r\n  }\r\n\r\n  goForward() {\r\n    let view = this.forward.pop();\r\n    if (!view) {\r\n      return;\r\n    }\r\n    this.views.push(view);\r\n\r\n    let workspace = this.utils.getWorkspace(),\r\n      s = workspace.getMetrics();\r\n\r\n    let sx = view.left - s.contentLeft,\r\n      sy = view.top - s.contentTop;\r\n\r\n    workspace.scrollbar.set(sx, sy);\r\n  }\r\n}\r\n\r\nfunction distance(pos, next) {\r\n  return Math.sqrt(Math.pow(pos.left - next.left, 2) + Math.pow(pos.top - next.top, 2));\r\n}\r\n","/* inserted by pull.js */\nimport _twAsset0 from \"!url-loader!./icon--close.svg\";\nconst _twGetAsset = (path) => {\n  if (path === \"/icon--close.svg\") return _twAsset0;\n  throw new Error(`Unknown asset: ${path}`);\n};\n\nimport DevTools from \"./DevTools.js\";\r\n\r\nexport default async function ({ addon, global, console, msg, safeMsg: m }) {\r\n  const guiDirection = addon.tab.direction;\r\n  const helpHTML = `\r\n<div id=\"s3devHelpPop\" class=\"${addon.tab.scratchClass(\"modal_modal-overlay\")}\" dir=\"${guiDirection}\">\r\n<div class=\"${addon.tab.scratchClass(\"modal_modal-content\")}\">\r\n<div class=\"${addon.tab.scratchClass(\"modal_header\")}\">\r\n  <div class=\"${addon.tab.scratchClass(\"modal_header-item\", \"modal_header-item-title\")}\">${m(\"help-title\")}</div>\r\n  <div class=\"${addon.tab.scratchClass(\"modal_header-item\", \"modal_header-item-close\")}\">\r\n    <div class=\"${addon.tab.scratchClass(\"close-button_close-button\", \"close-button_large\", {\r\n      others: \"close-button\",\r\n    })}\">\r\n\t  <img class=\"${addon.tab.scratchClass(\"close-button_close-icon\")}\" src=\"${_twGetAsset(\"/icon--close.svg\")}\">\r\n\t</div>\r\n  </div>\r\n</div>\r\n<div id=\"s3devHelpContent\">\r\n<h2><strong>${m(\"code-tab-features\")}</strong></h2>\r\n<p dir=\"auto\"><strong>${m(\"interactive-find-bar\")}</strong> &ndash; ${m(\"interactive-find-bar-desc\")}</p>\r\n<p dir=\"auto\"><strong>${m(\"improved-tidy-up\")}</strong> &ndash; ${m(\"improved-tidy-up-desc\")}</p>\r\n<p dir=\"auto\"><strong>${m(\"help-make-space\")} ${m(\"help-new\")}</strong> &ndash; ${m(\"help-make-space-desc\")}</p>\r\n<p dir=\"auto\"><strong>${m(\"copy-to-clipboard\")}</strong> &ndash; ${m(\"copy-to-clipboard-desc\")}</p>\r\n<p dir=\"auto\"><strong>${m(\"paste-from-clipboard\")}</strong> &ndash; ${m(\"paste-from-clipboard-desc\")}</p>\r\n<p dir=\"auto\"><strong>${m(\"swap-variable\")}</strong> &ndash; ${m(\"swap-variable-desc\")}</p>\r\n<p dir=\"auto\"><strong>${m(\"middleclick\")}</strong> &ndash; ${m(\"middleclick-desc\")}</p>\r\n<p dir=\"auto\"><strong>${m(\"ctrl-lr\")}</strong> &ndash; ${m(\"ctrl-lr-desc\")}</p>\r\n<p dir=\"auto\"><strong>${m(\"ctrl-space\")}</strong> &ndash; ${m(\"ctrl-space-desc\")}</p>\r\n<hr />\r\n<h2><strong>${m(\"costume-tab-features\")}</strong></h2>\r\n<p dir=\"auto\"><strong>${m(\"find-bar\")}</strong> &ndash; ${m(\"find-bar-costume-desc\")}</p>\r\n<p dir=\"auto\"><strong>${m(\"ctrl-lr\")}</strong> &ndash; ${m(\"ctrl-lr-costume-desc\")}</p>\r\n<hr />\r\n<p>${m(\r\n    \"youtube\"\r\n  )} -&nbsp;<a target=\"_blank\" href=\"https://www.youtube.com/griffpatch\" rel=\"noopener noreferrer\">https://www.youtube.com/user/griffpatch</a></p>\r\n</div>\r\n</div>\r\n</div>\r\n`;\r\n\r\n  const devTools = new DevTools(addon, msg, m, helpHTML);\r\n  devTools.init();\r\n}\r\n","/* generated by pull.js */\nimport _js from \"./userscript.js\";\nimport _css from \"!css-loader!./userscript.css\";\nexport const resources = {\n  \"userscript.js\": _js,\n  \"userscript.css\": _css,\n};\n","export default async function ({ addon, global, console, msg }) {\r\n  const Blockly = await addon.tab.traps.getBlockly();\r\n  const vm = addon.tab.traps.vm;\r\n\r\n  const SCRATCH_ITEMS_TO_HIDE = [\"RENAME_VARIABLE_ID\", \"DELETE_VARIABLE_ID\", \"NEW_BROADCAST_MESSAGE_ID\"];\r\n  const ADDON_ITEMS = [\r\n    \"createGlobalVariable\",\r\n    \"createLocalVariable\",\r\n    \"createGlobalList\",\r\n    \"createLocalList\",\r\n    \"createBroadcast\",\r\n  ];\r\n\r\n  let blocklyDropDownContent = null;\r\n  let blocklyDropdownMenu = null;\r\n  let searchBar = null;\r\n  // Contains DOM and addon state\r\n  let items = [];\r\n  let searchedItems = [];\r\n  // Tracks internal Scratch state\r\n  let currentDropdownOptions = [];\r\n  let resultOfLastGetOptions = [];\r\n\r\n  const oldDropDownDivShow = Blockly.DropDownDiv.show;\r\n  Blockly.DropDownDiv.show = function (...args) {\r\n    blocklyDropdownMenu = document.querySelector(\".blocklyDropdownMenu\");\r\n    if (!blocklyDropdownMenu) {\r\n      return oldDropDownDivShow.call(this, ...args);\r\n    }\r\n\r\n    blocklyDropdownMenu.focus = () => {}; // no-op focus() so it can't steal it from the search bar\r\n\r\n    searchBar = document.createElement(\"input\");\r\n    addon.tab.displayNoneWhileDisabled(searchBar, { display: \"flex\" });\r\n    searchBar.type = \"text\";\r\n    searchBar.addEventListener(\"input\", updateSearch);\r\n    searchBar.addEventListener(\"keydown\", handleKeyDownEvent);\r\n    searchBar.classList.add(\"u-dropdown-searchbar\");\r\n    blocklyDropdownMenu.insertBefore(searchBar, blocklyDropdownMenu.firstChild);\r\n\r\n    items = Array.from(blocklyDropdownMenu.children)\r\n      .filter((child) => child.tagName !== \"INPUT\")\r\n      .map((element) => ({\r\n        element,\r\n        text: element.textContent,\r\n      }));\r\n    currentDropdownOptions = resultOfLastGetOptions;\r\n    updateSearch();\r\n\r\n    // Call the original show method after adding everything so that it can perform the correct size calculations\r\n    const ret = oldDropDownDivShow.call(this, ...args);\r\n\r\n    // Lock the size of the dropdown\r\n    blocklyDropDownContent = Blockly.DropDownDiv.getContentDiv();\r\n    blocklyDropDownContent.style.width = getComputedStyle(blocklyDropDownContent).width;\r\n    blocklyDropDownContent.style.height = getComputedStyle(blocklyDropDownContent).height;\r\n\r\n    // This is really strange, but if you don't reinsert the search bar into the DOM then focus() doesn't work\r\n    blocklyDropdownMenu.insertBefore(searchBar, blocklyDropdownMenu.firstChild);\r\n    searchBar.focus();\r\n\r\n    return ret;\r\n  };\r\n\r\n  const oldDropDownDivClearContent = Blockly.DropDownDiv.clearContent;\r\n  Blockly.DropDownDiv.clearContent = function () {\r\n    oldDropDownDivClearContent.call(this);\r\n    items = [];\r\n    searchedItems = [];\r\n    Blockly.DropDownDiv.content_.style.height = \"\";\r\n  };\r\n\r\n  const oldFieldDropdownGetOptions = Blockly.FieldDropdown.prototype.getOptions;\r\n  Blockly.FieldDropdown.prototype.getOptions = function () {\r\n    const options = oldFieldDropdownGetOptions.call(this);\r\n    const block = this.sourceBlock_;\r\n    const isStage = vm.editingTarget && vm.editingTarget.isStage;\r\n    if (block) {\r\n      if (block.category_ === \"data\") {\r\n        options.push(getMenuItemMessage(\"createGlobalVariable\"));\r\n        if (!isStage) {\r\n          options.push(getMenuItemMessage(\"createLocalVariable\"));\r\n        }\r\n      } else if (block.category_ === \"data-lists\") {\r\n        options.push(getMenuItemMessage(\"createGlobalList\"));\r\n        if (!isStage) {\r\n          options.push(getMenuItemMessage(\"createLocalList\"));\r\n        }\r\n      } else if (block.type === \"event_broadcast_menu\" || block.type === \"event_whenbroadcastreceived\") {\r\n        options.push(getMenuItemMessage(\"createBroadcast\"));\r\n      }\r\n    }\r\n    // Options aren't normally stored anywhere, so we'll store them ourselves.\r\n    resultOfLastGetOptions = options;\r\n    return options;\r\n  };\r\n\r\n  const oldFieldVariableOnItemSelected = Blockly.FieldVariable.prototype.onItemSelected;\r\n  Blockly.FieldVariable.prototype.onItemSelected = function (menu, menuItem) {\r\n    const sourceBlock = this.sourceBlock_;\r\n    if (sourceBlock && sourceBlock.workspace && searchBar.value.length !== 0) {\r\n      const workspace = sourceBlock.workspace;\r\n      const id = menuItem.getValue();\r\n      switch (id) {\r\n        case \"createGlobalVariable\": {\r\n          Blockly.Events.setGroup(true);\r\n          const variable = workspace.createVariable(searchBar.value);\r\n          // Creating a variable can cause blocks in the flyout to be disposed and recreated\r\n          // That could cause setValue to throw\r\n          if (this.sourceBlock_) this.setValue(variable.getId());\r\n          Blockly.Events.setGroup(false);\r\n          return;\r\n        }\r\n        case \"createLocalVariable\": {\r\n          Blockly.Events.setGroup(true);\r\n          const variable = workspace.createVariable(searchBar.value, \"\", null, true);\r\n          if (this.sourceBlock_) this.setValue(variable.getId());\r\n          Blockly.Events.setGroup(false);\r\n          return;\r\n        }\r\n        case \"createGlobalList\": {\r\n          Blockly.Events.setGroup(true);\r\n          const variable = workspace.createVariable(searchBar.value, \"list\");\r\n          if (this.sourceBlock_) this.setValue(variable.getId());\r\n          Blockly.Events.setGroup(false);\r\n          return;\r\n        }\r\n        case \"createLocalList\": {\r\n          Blockly.Events.setGroup(true);\r\n          const variable = workspace.createVariable(searchBar.value, \"list\", null, true);\r\n          if (this.sourceBlock_) this.setValue(variable.getId());\r\n          Blockly.Events.setGroup(false);\r\n          return;\r\n        }\r\n        case \"createBroadcast\": {\r\n          Blockly.Events.setGroup(true);\r\n          const variable = workspace.createVariable(searchBar.value, \"broadcast_msg\");\r\n          this.setValue(variable.getId());\r\n          Blockly.Events.setGroup(false);\r\n          return;\r\n        }\r\n      }\r\n    }\r\n    return oldFieldVariableOnItemSelected.call(this, menu, menuItem);\r\n  };\r\n\r\n  function selectItem(item, click) {\r\n    // You can't just use click() or focus() because Blockly uses mousedown and mouseup handlers, not click handlers.\r\n    item.dispatchEvent(new MouseEvent(\"mousedown\", { relatedTarget: item, bubbles: true }));\r\n    if (click) item.dispatchEvent(new MouseEvent(\"mouseup\", { relatedTarget: item, bubbles: true }));\r\n\r\n    // Scroll the item into view if it is offscreen.\r\n    const itemTop = item.offsetTop;\r\n    const itemEnd = itemTop + item.offsetHeight;\r\n\r\n    const scrollTop = blocklyDropDownContent.scrollTop;\r\n    const scrollHeight = blocklyDropDownContent.offsetHeight;\r\n    const scrollEnd = scrollTop + scrollHeight;\r\n\r\n    if (scrollTop > itemTop) {\r\n      blocklyDropDownContent.scrollTop = itemTop;\r\n    } else if (itemEnd > scrollEnd) {\r\n      blocklyDropDownContent.scrollTop = itemEnd - scrollHeight;\r\n    }\r\n  }\r\n\r\n  function performSearch() {\r\n    const query = searchBar.value.toLowerCase().trim();\r\n    const rank = (item, index) => {\r\n      // Negative number will hide\r\n      // Higher numbers will appear first\r\n      const option = currentDropdownOptions[index];\r\n      if (SCRATCH_ITEMS_TO_HIDE.includes(option[1])) {\r\n        return query ? -1 : 0;\r\n      } else if (ADDON_ITEMS.includes(option[1])) {\r\n        item.element.lastChild.lastChild.textContent = getMenuItemMessage(option[1])[0];\r\n        return query ? 0 : -1;\r\n      }\r\n      const itemText = item.text.toLowerCase();\r\n      if (query === itemText) {\r\n        return 2;\r\n      }\r\n      if (itemText.startsWith(query)) {\r\n        return 1;\r\n      }\r\n      if (itemText.includes(query)) {\r\n        return 0;\r\n      }\r\n      return -1;\r\n    };\r\n    return items\r\n      .map((item, index) => ({\r\n        item,\r\n        score: rank(item, index),\r\n      }))\r\n      .sort(({ score: scoreA }, { score: scoreB }) => Math.max(0, scoreB) - Math.max(0, scoreA));\r\n  }\r\n\r\n  function updateSearch() {\r\n    const previousSearchedItems = searchedItems;\r\n    searchedItems = performSearch();\r\n    let needToUpdateDOM = previousSearchedItems.length !== searchedItems.length;\r\n    if (!needToUpdateDOM) {\r\n      for (let i = 0; i < searchedItems.length; i++) {\r\n        if (searchedItems[i].item !== previousSearchedItems[i].item) {\r\n          needToUpdateDOM = true;\r\n          break;\r\n        }\r\n      }\r\n    }\r\n    if (needToUpdateDOM && previousSearchedItems.length > 0) {\r\n      for (const { item } of previousSearchedItems) {\r\n        item.element.remove();\r\n      }\r\n      for (const { item } of searchedItems) {\r\n        blocklyDropdownMenu.appendChild(item.element);\r\n      }\r\n    }\r\n    for (const { item, score } of searchedItems) {\r\n      item.element.hidden = score < 0;\r\n    }\r\n  }\r\n\r\n  function handleKeyDownEvent(event) {\r\n    if (event.key === \"Enter\") {\r\n      // Reimplement enter to select item to account for hidden items and default to the top item.\r\n      event.stopPropagation();\r\n      event.preventDefault();\r\n\r\n      const selectedItem = document.querySelector(\".goog-menuitem-highlight\");\r\n      if (selectedItem && !selectedItem.hidden) {\r\n        selectItem(selectedItem, true);\r\n        return;\r\n      }\r\n\r\n      const selectedBlock = Blockly.selected;\r\n      if (searchBar.value === \"\" && selectedBlock) {\r\n        if (\r\n          selectedBlock.type === \"event_broadcast\" ||\r\n          selectedBlock.type === \"event_broadcastandwait\" ||\r\n          selectedBlock.type === \"event_whenbroadcastreceived\"\r\n        ) {\r\n          // The top item of these dropdowns is always \"New message\"\r\n          // When pressing enter on an empty search bar, we close the dropdown instead of making a new broadcast.\r\n          Blockly.DropDownDiv.hide();\r\n          return;\r\n        }\r\n      }\r\n      for (const { item } of searchedItems) {\r\n        if (!item.element.hidden) {\r\n          selectItem(item.element, true);\r\n          break;\r\n        }\r\n      }\r\n      // If there is no top value, do nothing and leave the dropdown open\r\n    } else if (event.key === \"Escape\") {\r\n      Blockly.DropDownDiv.hide();\r\n    } else if (event.key === \"ArrowDown\" || event.key === \"ArrowUp\") {\r\n      // Reimplement keyboard navigation to account for hidden items.\r\n      event.preventDefault();\r\n      event.stopPropagation();\r\n\r\n      const items = searchedItems.filter((i) => i.score >= 0).map((i) => i.item);\r\n      if (items.length === 0) {\r\n        return;\r\n      }\r\n\r\n      let selectedIndex = -1;\r\n      for (let i = 0; i < items.length; i++) {\r\n        if (items[i].element.classList.contains(\"goog-menuitem-highlight\")) {\r\n          selectedIndex = i;\r\n          break;\r\n        }\r\n      }\r\n\r\n      const lastIndex = items.length - 1;\r\n      let newIndex = 0;\r\n      if (event.key === \"ArrowDown\") {\r\n        if (selectedIndex === -1 || selectedIndex === lastIndex) {\r\n          newIndex = 0;\r\n        } else {\r\n          newIndex = selectedIndex + 1;\r\n        }\r\n      } else {\r\n        if (selectedIndex === -1 || selectedIndex === 0) {\r\n          newIndex = lastIndex;\r\n        } else {\r\n          newIndex = selectedIndex - 1;\r\n        }\r\n      }\r\n\r\n      selectItem(items[newIndex].element, false);\r\n    }\r\n  }\r\n\r\n  function getMenuItemMessage(message) {\r\n    // Format used internally by Scratch:\r\n    // [human readable name, internal name]\r\n    return [msg(message, { name: searchBar?.value || \"\" }), message];\r\n  }\r\n}\r\n","/* generated by pull.js */\nimport _js from \"./userscript.js\";\nimport _css from \"!css-loader!./style.css\";\nexport const resources = {\n  \"userscript.js\": _js,\n  \"style.css\": _css,\n};\n","/* inserted by pull.js */\nimport _twAsset0 from \"!url-loader!./folder.svg\";\nconst _twGetAsset = (path) => {\n  if (path === \"/folder.svg\") return _twAsset0;\n  throw new Error(`Unknown asset: ${path}`);\n};\n\nexport default async function ({ addon, global, console, msg }) {\r\n  // The basic premise of how this addon works is relative simple.\r\n  // scratch-gui renders the sprite selectors and asset selectors in a hierarchy like this:\r\n  // <SelectorHOC>\r\n  //   <SpriteSelectorItem />\r\n  //   <SpriteSelectorItem />\r\n  //   <SpriteSelectorItem />\r\n  //   <SpriteSelectorItem />\r\n  //   ...\r\n  // </SelectorHOC>\r\n  // It's obviously more complicated than that, but there are two important parts:\r\n  // SelectorHOC - We override this to change which items are displayed\r\n  // SpriteSelectorItem - We override this to change how items are displayed.\r\n  //    Folders are just items rendered differently\r\n  // These two components communicate through the `name` property of the items.\r\n  // We touch some things on the VM to make dragging items work properly.\r\n\r\n  const REACT_INTERNAL_PREFIX = \"__reactInternalInstance$\";\r\n\r\n  const TYPE_SPRITES = 1;\r\n  const TYPE_ASSETS = 2;\r\n\r\n  // We run too early, will be set later\r\n  let vm;\r\n\r\n  let reactInternalKey;\r\n\r\n  let currentSpriteFolder;\r\n  let currentAssetFolder;\r\n\r\n  let currentSpriteItems;\r\n  let currentAssetItems;\r\n\r\n  const DIVIDER = \"//\";\r\n\r\n  /**\r\n   * getFolderFromName(\"B\") === null\r\n   * getFolderFromName(\"A//b\") === \"A\"\r\n   */\r\n  const getFolderFromName = (name) => {\r\n    const idx = name.indexOf(DIVIDER);\r\n    if (idx === -1 || idx === 0) {\r\n      return null;\r\n    }\r\n    return name.substr(0, idx);\r\n  };\r\n\r\n  /**\r\n   * getNameWithoutFolder(\"B\") === \"B\"\r\n   * getNameWithoutFolder(\"A//b\") === \"b\"\r\n   */\r\n  const getNameWithoutFolder = (name) => {\r\n    const idx = name.indexOf(DIVIDER);\r\n    if (idx === -1 || idx === 0) {\r\n      return name;\r\n    }\r\n    return name.substr(idx + DIVIDER.length);\r\n  };\r\n\r\n  /**\r\n   * setFolderOfName(\"B\", \"y\") === \"y//B\"\r\n   * setFolderOfName(\"c//B\", \"y\") === \"y//B\"\r\n   * setFolderOfName(\"B\", null) === \"B\"\r\n   * setFolderOfName(\"c//B\", null) === \"B\"\r\n   */\r\n  const setFolderOfName = (name, folder) => {\r\n    const basename = getNameWithoutFolder(name);\r\n    if (folder) {\r\n      return `${folder}${DIVIDER}${basename}`;\r\n    }\r\n    return basename;\r\n  };\r\n\r\n  const isValidFolderName = (name) => {\r\n    return !name.includes(DIVIDER) && !name.endsWith(\"/\");\r\n  };\r\n\r\n  const RESERVED_NAMES = [\"_mouse_\", \"_stage_\", \"_edge_\", \"_myself_\", \"_random_\"];\r\n  const ensureNotReserved = (name) => {\r\n    if (name === \"\") return \"2\";\r\n    if (RESERVED_NAMES.includes(name)) return `${name}2`;\r\n    return name;\r\n  };\r\n\r\n  const untilInEditor = () => {\r\n    if (addon.tab.editorMode === \"editor\") return;\r\n    return new Promise((resolve, reject) => {\r\n      const handler = () => {\r\n        if (addon.tab.editorMode === \"editor\") {\r\n          resolve();\r\n          addon.tab.removeEventListener(\"urlChange\", handler);\r\n        }\r\n      };\r\n      addon.tab.addEventListener(\"urlChange\", handler);\r\n    });\r\n  };\r\n\r\n  const getSortableHOCFromElement = (el) => {\r\n    const nearestSpriteSelector = el.closest(\"[class*='sprite-selector_sprite-selector']\");\r\n    if (nearestSpriteSelector) {\r\n      return nearestSpriteSelector[reactInternalKey].child.sibling.child.stateNode;\r\n    }\r\n    const nearestAssetPanelWrapper = el.closest('[class*=\"asset-panel_wrapper\"]');\r\n    if (nearestAssetPanelWrapper) {\r\n      return nearestAssetPanelWrapper[reactInternalKey].child.child.stateNode;\r\n    }\r\n    throw new Error(\"cannot find SortableHOC\");\r\n  };\r\n\r\n  const getBackpackFromElement = (el) => {\r\n    const gui = el.closest('[class*=\"gui_editor-wrapper\"]');\r\n    if (!gui) throw new Error(\"cannot find Backpack\");\r\n    return gui[reactInternalKey].child.sibling.child.child.stateNode;\r\n  };\r\n\r\n  const clamp = (n, min, max) => {\r\n    return Math.min(Math.max(n, min), max);\r\n  };\r\n\r\n  /**\r\n   * @typedef {Object} ItemData\r\n   * @property {string} realName\r\n   * @property {number} realIndex\r\n   * @property {string} inFolder\r\n   * @property {string} folder\r\n   * @property {boolean} folderOpen\r\n   */\r\n\r\n  /**\r\n   * @returns {ItemData|null}\r\n   */\r\n  const getItemData = (item) => {\r\n    if (item && item.name && typeof item.name === \"object\") {\r\n      return item.name;\r\n    }\r\n    return null;\r\n  };\r\n\r\n  const openFolderAsset = {\r\n    assetId: \"&__sa_folders_folder\",\r\n    encodeDataURI() {\r\n      // Doesn't actually need to be a data: URI\r\n      return _twGetAsset(\"/folder.svg\");\r\n    },\r\n  };\r\n\r\n  // https://github.com/LLK/scratch-gui/blob/develop/src/components/asset-panel/icon--sound.svg\r\n  const imageIconSource = `<?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n<svg width=\"100px\" height=\"100px\" viewBox=\"0 0 20 20\" version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\">\r\n    <g id=\"Sound\" stroke=\"none\" stroke-width=\"1\" fill=\"none\" fill-rule=\"evenodd\">\r\n        <path d=\"M12.4785058,12.6666667 C12.3144947,12.6666667 12.1458852,12.6272044 11.9926038,12.5440517 C11.537358,12.2960031 11.3856094,11.7562156 11.6553847,11.3376335 C12.1688774,10.5371131 12.1688774,9.54491867 11.6553847,8.74580756 C11.3856094,8.32581618 11.537358,7.78602861 11.9926038,7.53798001 C12.452448,7.29275014 13.0379829,7.43086811 13.3046926,7.84804076 C14.1737981,9.20103311 14.1737981,10.8809986 13.3046926,12.233991 C13.1268862,12.5130457 12.806528,12.6666667 12.4785058,12.6666667 Z M15.3806784,13.8333333 C15.2408902,13.8333333 15.0958763,13.796281 14.9665396,13.7182064 C14.5785295,13.485306 14.4491928,12.9784829 14.6791247,12.5854634 C15.5949331,11.0160321 15.5949331,9.065491 14.6791247,7.49738299 C14.4491928,7.10436352 14.5785295,6.59621712 14.9665396,6.36331669 C15.3558562,6.13438616 15.8549129,6.26274605 16.0848448,6.65444223 C17.3050517,8.74260632 17.3050517,11.3389168 16.0848448,13.4270809 C15.9319924,13.6890939 15.6602547,13.8333333 15.3806784,13.8333333 Z M10.3043478,5.62501557 L10.3043478,13.873675 C10.3043478,14.850934 9.10969849,15.3625101 8.36478311,14.7038052 L6.7566013,13.2797607 C6.18712394,12.7762834 5.44499329,12.4968737 4.67362297,12.4968737 L4.3923652,12.4968737 C3.62377961,12.4968737 3,11.8935108 3,11.1470686 L3,8.36646989 C3,7.62137743 3.62377961,7.01666471 4.3923652,7.01666471 L4.65830695,7.01666471 C5.42967727,7.01666471 6.17180792,6.73725504 6.74128529,6.23377771 L8.36478311,4.79623519 C9.10969849,4.13753026 10.3043478,4.64910643 10.3043478,5.62501557 Z\" id=\"Combined-Shape\" fill=\"#575E75\"></path>\r\n    </g>\r\n</svg>`;\r\n  const soundIconHref = `data:image/svg+xml;base64,${btoa(imageIconSource)}`;\r\n\r\n  let folderColorStylesheet = null;\r\n  const folderColors = Object.create(null);\r\n  const getFolderColorClass = (folderName) => {\r\n    const mulberry32 = (a) => {\r\n      // https://stackoverflow.com/a/47593316\r\n      return function () {\r\n        var t = (a += 0x6d2b79f5);\r\n        t = Math.imul(t ^ (t >>> 15), t | 1);\r\n        t ^= t + Math.imul(t ^ (t >>> 7), t | 61);\r\n        return ((t ^ (t >>> 14)) >>> 0) / 4294967296;\r\n      };\r\n    };\r\n\r\n    const hashCode = (str) => {\r\n      // Based on Java's String.hashCode\r\n      // https://hg.openjdk.java.net/jdk8/jdk8/jdk/file/687fd7c7986d/src/share/classes/java/lang/String.java#l1452\r\n      let hash = 0;\r\n      for (let i = 0; i < str.length; i++) {\r\n        hash = 31 * hash + str.charCodeAt(i);\r\n        hash = hash | 0;\r\n      }\r\n      return hash;\r\n    };\r\n\r\n    const random = (str) => {\r\n      const seed = hashCode(str);\r\n      const rng = mulberry32(seed);\r\n      // Run RNG a few times to get more random numbers, otherwise similar seeds tend to give somewhat similar results\r\n      rng();\r\n      rng();\r\n      rng();\r\n      rng();\r\n      return rng();\r\n    };\r\n\r\n    if (!folderColors[folderName]) {\r\n      if (!folderColorStylesheet) {\r\n        folderColorStylesheet = document.createElement(\"style\");\r\n        document.head.appendChild(folderColorStylesheet);\r\n      }\r\n      const hue = random(folderName) * 360;\r\n      const color = `hsla(${hue}deg, 100%, 85%, 0.5)`;\r\n      const id = Object.keys(folderColors).length;\r\n      const className = `sa-folders-color-${id}`;\r\n      folderColors[folderName] = className;\r\n      folderColorStylesheet.textContent += `.${className}{background-color:${color} !important;}`;\r\n      folderColorStylesheet.textContent += `.${className}[class*=\"sprite-selector_raised\"]:not([class*=\"sa-folders-folder\"]){background-color:hsla(${hue}deg, 100%, 77%, 1) !important;}`;\r\n    }\r\n    return folderColors[folderName];\r\n  };\r\n\r\n  const fixOrderOfItemsInFolders = (items) => {\r\n    const folders = Object.create(null);\r\n    const result = [];\r\n    for (const item of items) {\r\n      const name = item.getName ? item.getName() : item.name;\r\n      const folder = getFolderFromName(name);\r\n      if (typeof folder === \"string\") {\r\n        if (!folders[folder]) {\r\n          folders[folder] = [];\r\n          result.push(folders[folder]);\r\n        }\r\n        folders[folder].push(item);\r\n      } else {\r\n        result.push(item);\r\n      }\r\n    }\r\n    const flatResult = result.flat();\r\n    for (let i = 0; i < items.length; i++) {\r\n      if (result[i] !== items[i]) {\r\n        return { items: flatResult, changed: true };\r\n      }\r\n    }\r\n    return { items: flatResult, changed: false };\r\n  };\r\n\r\n  const fixTargetOrder = () => {\r\n    const { items, changed } = fixOrderOfItemsInFolders(vm.runtime.targets);\r\n    if (changed) {\r\n      vm.runtime.targets = items;\r\n      vm.emitTargetsUpdate();\r\n    }\r\n  };\r\n\r\n  const fixCostumeOrder = (target = vm.editingTarget) => {\r\n    const { items, changed } = fixOrderOfItemsInFolders(target.sprite.costumes);\r\n    if (changed) {\r\n      target.sprite.costumes = items;\r\n      vm.emitTargetsUpdate();\r\n    }\r\n  };\r\n\r\n  const fixSoundOrder = (target = vm.editingTarget) => {\r\n    const { items, changed } = fixOrderOfItemsInFolders(target.sprite.sounds);\r\n    if (changed) {\r\n      target.sprite.sounds = items;\r\n      vm.emitTargetsUpdate();\r\n    }\r\n  };\r\n\r\n  const verifySortableHOC = (sortableHOCInstance) => {\r\n    const SortableHOC = sortableHOCInstance.constructor;\r\n    if (\r\n      Array.isArray(sortableHOCInstance.props.items) &&\r\n      (typeof sortableHOCInstance.props.selectedId === \"string\" ||\r\n        typeof sortableHOCInstance.props.selectedItemIndex === \"number\") &&\r\n      typeof sortableHOCInstance.containerBox !== \"undefined\" &&\r\n      typeof SortableHOC.prototype.componentDidMount === \"undefined\" &&\r\n      typeof SortableHOC.prototype.componentDidUpdate === \"undefined\" &&\r\n      typeof SortableHOC.prototype.handleAddSortable === \"function\" &&\r\n      typeof SortableHOC.prototype.handleRemoveSortable === \"function\" &&\r\n      typeof SortableHOC.prototype.setRef === \"function\"\r\n    )\r\n      return;\r\n    throw new Error(\"Can not comprehend SortableHOC\");\r\n  };\r\n\r\n  const verifySpriteSelectorItem = (spriteSelectorItemInstance) => {\r\n    const SpriteSelectorItem = spriteSelectorItemInstance.constructor;\r\n    if (\r\n      typeof spriteSelectorItemInstance.props.asset === \"object\" &&\r\n      typeof spriteSelectorItemInstance.props.name === \"string\" &&\r\n      typeof spriteSelectorItemInstance.props.dragType === \"string\" &&\r\n      typeof SpriteSelectorItem.prototype.handleClick === \"function\" &&\r\n      typeof SpriteSelectorItem.prototype.setRef === \"function\" &&\r\n      typeof SpriteSelectorItem.prototype.handleDrag === \"function\" &&\r\n      typeof SpriteSelectorItem.prototype.handleDragEnd === \"function\" &&\r\n      typeof SpriteSelectorItem.prototype.handleDelete === \"function\" &&\r\n      typeof SpriteSelectorItem.prototype.handleDuplicate === \"function\" &&\r\n      typeof SpriteSelectorItem.prototype.handleExport === \"function\"\r\n    )\r\n      return;\r\n    throw new Error(\"Can not comprehend SpriteSelectorItem\");\r\n  };\r\n\r\n  const verifyVM = (vm) => {\r\n    const target = vm.runtime.targets[0];\r\n    if (\r\n      typeof vm.installTargets === \"function\" &&\r\n      typeof vm.reorderTarget === \"function\" &&\r\n      typeof target.reorderCostume === \"function\" &&\r\n      typeof target.reorderSound === \"function\" &&\r\n      typeof target.addCostume === \"function\" &&\r\n      typeof target.addSound === \"function\"\r\n    )\r\n      return;\r\n    throw new Error(\"Can not comprehend VM\");\r\n  };\r\n\r\n  const verifyBackpack = (backpackInstance) => {\r\n    const Backpack = backpackInstance.constructor;\r\n    if (\r\n      typeof Backpack.prototype.handleDrop === \"function\" &&\r\n      typeof Backpack.prototype.componentDidUpdate === \"undefined\"\r\n    ) {\r\n      return;\r\n    }\r\n    throw new Error(\"Can not comprehend Backpack\");\r\n  };\r\n\r\n  class Cache {\r\n    constructor() {\r\n      this.cache = new Map();\r\n      this.usedThisTick = new Set();\r\n    }\r\n\r\n    has(id) {\r\n      return this.cache.has(id);\r\n    }\r\n\r\n    get(id) {\r\n      this.usedThisTick.add(id);\r\n      return this.cache.get(id);\r\n    }\r\n\r\n    set(id, value) {\r\n      this.usedThisTick.add(id);\r\n      this.cache.set(id, value);\r\n    }\r\n\r\n    startTick() {\r\n      this.usedThisTick.clear();\r\n    }\r\n\r\n    endTick() {\r\n      for (const id of Array.from(this.cache.keys())) {\r\n        if (!this.usedThisTick.has(id)) {\r\n          this.cache.delete(id);\r\n        }\r\n      }\r\n    }\r\n\r\n    clear() {\r\n      this.usedThisTick.clear();\r\n      this.cache.clear();\r\n    }\r\n  }\r\n\r\n  const patchSortableHOC = (SortableHOC, type) => {\r\n    // SortableHOC should be: https://github.com/LLK/scratch-gui/blob/29d9851778febe4e69fa5111bf7559160611e366/src/lib/sortable-hoc.jsx#L8\r\n\r\n    const itemCache = new Cache();\r\n    const folderItemCache = new Cache();\r\n    const folderAssetCache = new Cache();\r\n\r\n    const PREVIEW_SIZE = 80;\r\n    const PREVIEW_POSITIONS = [\r\n      // x, y\r\n      [0, 0],\r\n      [PREVIEW_SIZE / 2, 0],\r\n      [0, PREVIEW_SIZE / 2],\r\n      [PREVIEW_SIZE / 2, PREVIEW_SIZE / 2],\r\n    ];\r\n\r\n    const createFolderPreview = (items) => {\r\n      // Directly generate a string instead of using DOM API for performance as we deal with very large inlined images\r\n      // Because the result is only used as an img src, XSS shouldn't be a concern\r\n      let result = `data:image/svg+xml;,<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"${PREVIEW_SIZE}\" height=\"${PREVIEW_SIZE}\">`;\r\n      for (let i = 0; i < Math.min(PREVIEW_POSITIONS.length, items.length); i++) {\r\n        const item = items[i];\r\n        const width = PREVIEW_SIZE / 2;\r\n        const height = PREVIEW_SIZE / 2;\r\n        const [x, y] = PREVIEW_POSITIONS[i];\r\n        let src;\r\n        if (item.asset) {\r\n          src = item.asset.encodeDataURI();\r\n        } else if (item.costume && item.costume.asset) {\r\n          src = item.costume.asset.encodeDataURI();\r\n        } else if (item.url) {\r\n          src = soundIconHref;\r\n        }\r\n        if (src) {\r\n          result += `<image width=\"${width}\" height=\"${height}\" x=\"${x}\" y=\"${y}\" href=\"${src}\"/>`;\r\n        }\r\n      }\r\n      result += '</svg>';\r\n      return result;\r\n    };\r\n\r\n    const getUniqueIdOfFolderItems = (items) => {\r\n      let id = \"sa_folder&&\";\r\n      for (let i = 0; i < Math.min(PREVIEW_POSITIONS.length, items.length); i++) {\r\n        const item = items[i];\r\n        if (item.asset) {\r\n          id += item.asset.assetId;\r\n        } else if (item.costume && item.costume.asset) {\r\n          id += item.costume.asset.assetId;\r\n        } else if (item.url) {\r\n          id += item.url;\r\n        }\r\n        id += \"&&\";\r\n      }\r\n      return id;\r\n    };\r\n\r\n    const processItems = (openFolders, props) => {\r\n      const processItem = (item) => {\r\n        const itemId = item.name;\r\n\r\n        let newItem;\r\n        let itemData;\r\n        if (itemCache.has(itemId)) {\r\n          newItem = itemCache.get(itemId);\r\n          itemData = newItem.name;\r\n        } else {\r\n          itemData = {\r\n            toString() {\r\n              return `_${item.name}`;\r\n            },\r\n          };\r\n          newItem = {};\r\n          itemCache.set(itemId, newItem);\r\n        }\r\n\r\n        const itemFolderName = getFolderFromName(item.name);\r\n\r\n        Object.assign(newItem, item);\r\n        itemData.realName = item.name;\r\n        itemData.realIndex = i;\r\n        itemData.inFolder = itemFolderName;\r\n        newItem.name = itemData;\r\n\r\n        return {\r\n          newItem,\r\n          itemData,\r\n        };\r\n      };\r\n\r\n      itemCache.startTick();\r\n      folderItemCache.startTick();\r\n      folderAssetCache.startTick();\r\n\r\n      const folderOccurrences = new Map();\r\n      const items = [];\r\n      const result = {\r\n        items,\r\n      };\r\n\r\n      let i = 0;\r\n      while (i < props.items.length) {\r\n        const item = props.items[i];\r\n        const folderName = getFolderFromName(item.name);\r\n\r\n        if (folderName === null) {\r\n          items.push(processItem(item).newItem);\r\n          if (type === TYPE_ASSETS) {\r\n            const isSelected = props.selectedItemIndex === i;\r\n            if (isSelected) {\r\n              result.selectedItemIndex = items.length - 1;\r\n            }\r\n          }\r\n        } else {\r\n          const isOpen = openFolders.indexOf(folderName) !== -1;\r\n          const folderItems = [];\r\n          while (i < props.items.length) {\r\n            const childItem = props.items[i];\r\n            const processedItem = processItem(childItem);\r\n            if (getFolderFromName(childItem.name) !== folderName) {\r\n              break;\r\n            }\r\n            folderItems.push(processedItem.newItem);\r\n            if (type === TYPE_ASSETS) {\r\n              const isSelected = props.selectedItemIndex === i;\r\n              if (isSelected) {\r\n                if (isOpen) {\r\n                  result.selectedItemIndex = items.length + folderItems.length;\r\n                } else {\r\n                  result.selectedItemIndex = -1;\r\n                }\r\n              }\r\n            }\r\n            i++;\r\n          }\r\n          i--;\r\n\r\n          const occurrence = folderOccurrences.get(folderName) || 0;\r\n          folderOccurrences.set(folderName, occurrence + 1);\r\n          const baseUniqueId = getUniqueIdOfFolderItems(folderItems);\r\n          const itemUniqueId = `${isOpen}&${occurrence}&${folderName}&${baseUniqueId}&`;\r\n          const reactKey = `&__${occurrence}_${folderName}`;\r\n          const assetUniqueId = baseUniqueId;\r\n\r\n          let folderItem;\r\n          let folderData;\r\n          if (folderItemCache.has(itemUniqueId)) {\r\n            folderItem = folderItemCache.get(itemUniqueId);\r\n            folderData = folderItem.name;\r\n          } else {\r\n            folderItem = {\r\n              // Can be used as a react key\r\n              id: {\r\n                toString() {\r\n                  return reactKey;\r\n                },\r\n              },\r\n            };\r\n            folderData = {\r\n              // Can be used as a react key\r\n              toString() {\r\n                return reactKey;\r\n              },\r\n            };\r\n            folderItemCache.set(itemUniqueId, folderItem);\r\n          }\r\n\r\n          folderData.folder = folderName;\r\n          folderData.folderOpen = isOpen;\r\n          folderItem.items = folderItems;\r\n          folderItem.name = folderData;\r\n\r\n          let folderAsset;\r\n          if (isOpen) {\r\n            folderAsset = openFolderAsset;\r\n          } else {\r\n            if (folderAssetCache.has(assetUniqueId)) {\r\n              folderAsset = folderAssetCache.get(assetUniqueId);\r\n            } else {\r\n              folderAsset = {\r\n                assetId: assetUniqueId,\r\n                encodeDataURI() {\r\n                  return createFolderPreview(folderItems);\r\n                },\r\n              };\r\n              folderAssetCache.set(assetUniqueId, folderAsset);\r\n            }\r\n          }\r\n\r\n          if (type === TYPE_SPRITES) {\r\n            if (!folderItem.costume) folderItem.costume = {};\r\n            folderItem.costume.asset = folderAsset;\r\n            // For sprite items, `id` is used as the drag payload and toString is used as a React key\r\n            if (!folderItem.id) folderItem.id = {};\r\n            folderItem.id.sa_folder_items = folderItems;\r\n            folderItem.id.toString = () => reactKey;\r\n          } else {\r\n            folderItem.asset = folderAsset;\r\n            if (!folderItem.dragPayload) folderItem.dragPayload = {};\r\n            folderItem.dragPayload.sa_folder_items = folderItems;\r\n          }\r\n\r\n          items.push(folderItem);\r\n          if (isOpen) {\r\n            for (const item of folderItems) {\r\n              items.push(item);\r\n            }\r\n          }\r\n        }\r\n\r\n        i++;\r\n      }\r\n\r\n      itemCache.endTick();\r\n      folderItemCache.endTick();\r\n      folderAssetCache.endTick();\r\n\r\n      return result;\r\n    };\r\n\r\n    const getSelectedItem = (sortable) => {\r\n      if (type === TYPE_SPRITES) {\r\n        const selectedItem = sortable.props.items.find((i) => i.id === sortable.props.selectedId);\r\n        return selectedItem;\r\n      } else if (type === TYPE_ASSETS) {\r\n        const selectedItem = sortable.props.items[sortable.props.selectedItemIndex];\r\n        return selectedItem;\r\n      }\r\n      return null;\r\n    };\r\n\r\n    SortableHOC.prototype.saInitialSetup = function () {\r\n      itemCache.clear();\r\n      folderItemCache.clear();\r\n      folderAssetCache.clear();\r\n      const folders = [];\r\n      const selectedItem = getSelectedItem(this);\r\n      if (selectedItem && !selectedItem.isStage) {\r\n        const folder = getFolderFromName(selectedItem.name);\r\n        folders.push(folder);\r\n        if (type === TYPE_SPRITES) {\r\n          currentSpriteFolder = folder;\r\n        } else if (type === TYPE_ASSETS) {\r\n          currentAssetFolder = folder;\r\n        }\r\n      }\r\n      this.setState({\r\n        folders,\r\n      });\r\n    };\r\n\r\n    SortableHOC.prototype.componentDidMount = function () {\r\n      // Do part of componentDidUpdate on mount as well\r\n      const selectedItem = getSelectedItem(this);\r\n      if (selectedItem) {\r\n        const folder = getFolderFromName(selectedItem.name);\r\n        if (type === TYPE_SPRITES) {\r\n          currentSpriteFolder = folder;\r\n        } else if (type === TYPE_ASSETS) {\r\n          currentAssetFolder = folder;\r\n        }\r\n      }\r\n      this.saInitialSetup();\r\n    };\r\n\r\n    SortableHOC.prototype.componentDidUpdate = function (prevProps, prevState) {\r\n      const selectedItem = getSelectedItem(this);\r\n      if (selectedItem) {\r\n        const folder = getFolderFromName(selectedItem.name);\r\n        const currentFolder = this.state.folders.includes(folder) ? folder : null;\r\n        if (type === TYPE_SPRITES) {\r\n          currentSpriteFolder = currentFolder;\r\n        } else if (type === TYPE_ASSETS) {\r\n          currentAssetFolder = currentFolder;\r\n        }\r\n        let selectedItemChanged;\r\n        if (this.props.selectedId) {\r\n          selectedItemChanged = this.props.selectedId !== prevProps.selectedId;\r\n        } else {\r\n          selectedItemChanged =\r\n            this.props.items[this.props.selectedItemIndex] &&\r\n            prevProps.items[prevProps.selectedItemIndex] &&\r\n            this.props.items[this.props.selectedItemIndex].name !== prevProps.items[prevProps.selectedItemIndex].name;\r\n        }\r\n        if (selectedItemChanged) {\r\n          if (!selectedItem.isStage) {\r\n            if (typeof folder === \"string\" && !this.state.folders.includes(folder)) {\r\n              this.setState((prevState) => ({\r\n                folders: [...prevState.folders, folder],\r\n              }));\r\n            }\r\n          }\r\n        }\r\n      }\r\n    };\r\n\r\n    const originalSortableHOCRender = SortableHOC.prototype.render;\r\n    SortableHOC.prototype.render = function () {\r\n      const originalProps = this.props;\r\n      this.props = {\r\n        ...this.props,\r\n        ...processItems((this.state && this.state.folders) || [], this.props),\r\n      };\r\n\r\n      if (type === TYPE_SPRITES) {\r\n        currentSpriteItems = this.props.items;\r\n      } else if (type === TYPE_ASSETS) {\r\n        currentAssetItems = this.props.items;\r\n      }\r\n      const result = originalSortableHOCRender.call(this);\r\n      this.props = originalProps;\r\n      return result;\r\n    };\r\n  };\r\n\r\n  const getAllFolders = (component) => {\r\n    const result = new Set();\r\n    let items;\r\n    if (component.props.dragType === \"SPRITE\") {\r\n      items = currentSpriteItems;\r\n    } else {\r\n      items = currentAssetItems;\r\n    }\r\n    for (const item of items) {\r\n      const data = getItemData(item);\r\n      if (typeof data.folder === \"string\") {\r\n        result.add(data.folder);\r\n      }\r\n    }\r\n    return Array.from(result);\r\n  };\r\n\r\n  const isFolderOpen = (component, folder) => {\r\n    const sortableHOCInstance = getSortableHOCFromElement(component.ref);\r\n    const folders = (sortableHOCInstance.state && sortableHOCInstance.state.folders) || [];\r\n    return folders.includes(folder);\r\n  };\r\n\r\n  const setFolderOpen = (component, folder, open) => {\r\n    const sortableHOCInstance = getSortableHOCFromElement(component.ref);\r\n    sortableHOCInstance.setState((prevState) => {\r\n      let folders = (prevState && prevState.folders) || [];\r\n      folders = folders.filter((i) => i !== folder);\r\n      if (open) {\r\n        return {\r\n          folders: [...folders, folder],\r\n        };\r\n      }\r\n      return {\r\n        folders,\r\n      };\r\n    });\r\n  };\r\n\r\n  addon.tab.createEditorContextMenu((ctxType, ctx) => {\r\n    if (ctxType !== \"sprite\" && ctxType !== \"costume\" && ctxType !== \"sound\") return;\r\n    const component = ctx.target[addon.tab.traps.getInternalKey(ctx.target)].return.return.return.stateNode;\r\n    const data = getItemData(component.props);\r\n    if (!data) return;\r\n    if (typeof data.folder === \"string\") {\r\n      ctx.target.setAttribute(\"sa-folders-context-type\", \"folder\");\r\n\r\n      const renameItems = (newName) => {\r\n        const isOpen = isFolderOpen(component, data.folder);\r\n        setFolderOpen(component, data.folder, false);\r\n        if (isOpen && typeof newName === \"string\") {\r\n          setFolderOpen(component, newName, true);\r\n        }\r\n        if (component.props.dragType === \"SPRITE\") {\r\n          for (const target of vm.runtime.targets) {\r\n            if (target.isOriginal) {\r\n              if (getFolderFromName(target.getName()) === data.folder) {\r\n                vm.renameSprite(target.id, ensureNotReserved(setFolderOfName(target.getName(), newName)));\r\n              }\r\n            }\r\n          }\r\n          vm.emitWorkspaceUpdate();\r\n          fixTargetOrder();\r\n        } else if (component.props.dragType === \"COSTUME\") {\r\n          for (let i = 0; i < vm.editingTarget.sprite.costumes.length; i++) {\r\n            const costume = vm.editingTarget.sprite.costumes[i];\r\n            if (getFolderFromName(costume.name) === data.folder) {\r\n              vm.renameCostume(i, setFolderOfName(costume.name, newName));\r\n            }\r\n          }\r\n          fixCostumeOrder();\r\n        } else if (component.props.dragType === \"SOUND\") {\r\n          for (let i = 0; i < vm.editingTarget.sprite.sounds.length; i++) {\r\n            const sound = vm.editingTarget.sprite.sounds[i];\r\n            if (getFolderFromName(sound.name) === data.folder) {\r\n              vm.renameSound(i, setFolderOfName(sound.name, newName));\r\n            }\r\n          }\r\n          fixSoundOrder();\r\n        }\r\n      };\r\n      const renameFolder = () => {\r\n        let newName = prompt(msg(\"rename-folder-prompt\"), data.folder);\r\n        // Prompt cancelled, do not rename\r\n        if (newName === null) {\r\n          return;\r\n        }\r\n        if (!isValidFolderName(newName)) {\r\n          alert(msg(\"name-not-allowed\"));\r\n          return;\r\n        }\r\n        // Empty name will remove the folder\r\n        if (!newName) {\r\n          newName = null;\r\n        }\r\n        renameItems(newName);\r\n      };\r\n\r\n      const removeFolder = () => {\r\n        renameItems(null);\r\n      };\r\n      return [\r\n        {\r\n          className: \"sa-folders-rename-folder\",\r\n          label: msg(\"rename-folder\"),\r\n          callback: renameFolder,\r\n          position: \"assetContextMenuAfterDelete\",\r\n          order: 10,\r\n        },\r\n        {\r\n          className: \"sa-folders-remove-folder\",\r\n          label: msg(\"remove-folder\"),\r\n          callback: removeFolder,\r\n          position: \"assetContextMenuAfterDelete\",\r\n          order: 11,\r\n        },\r\n      ];\r\n    } else {\r\n      ctx.target.setAttribute(\"sa-folders-context-type\", \"asset\");\r\n      const setFolder = (folder) => {\r\n        if (component.props.dragType === \"SPRITE\") {\r\n          const target = vm.runtime.getTargetById(component.props.id);\r\n          vm.renameSprite(component.props.id, ensureNotReserved(setFolderOfName(target.getName(), folder)));\r\n          fixTargetOrder();\r\n          vm.emitWorkspaceUpdate();\r\n        } else if (component.props.dragType === \"COSTUME\") {\r\n          const data = getItemData(component.props);\r\n          const index = data.realIndex;\r\n          const asset = vm.editingTarget.sprite.costumes[index];\r\n          vm.renameCostume(vm.editingTarget.sprite.costumes.indexOf(asset), setFolderOfName(asset.name, folder));\r\n          fixCostumeOrder();\r\n        } else if (component.props.dragType === \"SOUND\") {\r\n          const data = getItemData(component.props);\r\n          const index = data.realIndex;\r\n          const asset = vm.editingTarget.sprite.sounds[index];\r\n          vm.renameSound(vm.editingTarget.sprite.sounds.indexOf(asset), setFolderOfName(asset.name, folder));\r\n          fixSoundOrder();\r\n        }\r\n      };\r\n\r\n      const createFolder = () => {\r\n        const name = prompt(msg(\"name-prompt\"), getNameWithoutFolder(data.realName));\r\n        if (name === null) {\r\n          return;\r\n        }\r\n        if (!isValidFolderName(name)) {\r\n          alert(msg(\"name-not-allowed\"));\r\n          return;\r\n        }\r\n        setFolder(name);\r\n      };\r\n      const base = [\r\n        {\r\n          border: true,\r\n          className: \"sa-folders-create-folder\",\r\n          label: msg(\"create-folder\"),\r\n          callback: createFolder,\r\n          position: \"assetContextMenuAfterDelete\",\r\n          order: 13,\r\n        },\r\n      ];\r\n      const currentFolder = data.inFolder;\r\n      if (typeof currentFolder === \"string\") {\r\n        base.push({\r\n          className: \"sa-folders-remove-from-folder\",\r\n          label: msg(\"remove-from-folder\"),\r\n          callback: () => setFolder(null),\r\n          position: \"assetContextMenuAfterDelete\",\r\n          order: 14,\r\n        });\r\n      }\r\n      return base.concat(\r\n        getAllFolders(component)\r\n          .filter((folder) => folder !== currentFolder)\r\n          .map((folder, i) => {\r\n            return {\r\n              className: \"sa-folders-add-to-folder\",\r\n              label: msg(\"add-to-folder\", {\r\n                folder,\r\n              }),\r\n              callback: () => setFolder(folder),\r\n              position: \"assetContextMenuAfterDelete\",\r\n              order: 20 + i,\r\n            };\r\n          })\r\n      );\r\n    }\r\n  });\r\n\r\n  const patchSpriteSelectorItem = (SpriteSelectorItem) => {\r\n    for (const method of [\"handleDelete\", \"handleDuplicate\", \"handleExport\"]) {\r\n      const original = SpriteSelectorItem.prototype[method];\r\n      SpriteSelectorItem.prototype[method] = function (...args) {\r\n        if (typeof this.props.id === \"number\") {\r\n          const itemData = getItemData(this.props);\r\n          if (itemData) {\r\n            const originalProps = this.props;\r\n            this.props = {\r\n              ...originalProps,\r\n              id: itemData.realIndex,\r\n            };\r\n            const ret = original.call(this, ...args);\r\n            this.props = originalProps;\r\n            return ret;\r\n          }\r\n        }\r\n        return original.call(this, ...args);\r\n      };\r\n    }\r\n\r\n    const originalHandleDragEnd = SpriteSelectorItem.prototype.handleDragEnd;\r\n    SpriteSelectorItem.prototype.handleDragEnd = function (...args) {\r\n      const itemData = getItemData(this.props);\r\n      if (itemData) {\r\n        if (typeof itemData.realIndex === \"number\" && this.props.dragging) {\r\n          // If the item is being dragged onto another group (eg. costume list -> sprite list)\r\n          // then we fake a drag event to make the `index` be the real index\r\n          const originalIndex = this.props.index;\r\n          const realIndex = itemData.realIndex;\r\n          if (originalIndex !== realIndex) {\r\n            const currentOffset = addon.tab.redux.state.scratchGui.assetDrag.currentOffset;\r\n            const sortableHOCInstance = getSortableHOCFromElement(this.ref);\r\n            if (currentOffset && sortableHOCInstance && sortableHOCInstance.getMouseOverIndex() === null) {\r\n              this.props.index = realIndex;\r\n              this.handleDrag(currentOffset);\r\n              this.props.index = originalIndex;\r\n            }\r\n          }\r\n        }\r\n      }\r\n      return originalHandleDragEnd.call(this, ...args);\r\n    };\r\n\r\n    const originalHandleClick = SpriteSelectorItem.prototype.handleClick;\r\n    SpriteSelectorItem.prototype.handleClick = function (...args) {\r\n      const e = args[0];\r\n      if (e && !this.noClick) {\r\n        const itemData = getItemData(this.props);\r\n        if (itemData) {\r\n          if (typeof itemData.folder === \"string\") {\r\n            e.preventDefault();\r\n            setFolderOpen(this, itemData.folder, !isFolderOpen(this, itemData.folder));\r\n            return;\r\n          }\r\n          if (typeof this.props.number === \"number\" && typeof itemData.realIndex === \"number\") {\r\n            e.preventDefault();\r\n            if (this.props.onClick) {\r\n              this.props.onClick(itemData.realIndex);\r\n            }\r\n            return;\r\n          }\r\n        }\r\n      }\r\n      return originalHandleClick.call(this, ...args);\r\n    };\r\n\r\n    const originalRender = SpriteSelectorItem.prototype.render;\r\n    SpriteSelectorItem.prototype.render = function () {\r\n      const itemData = getItemData(this.props);\r\n      if (itemData) {\r\n        const originalProps = this.props;\r\n        this.props = {\r\n          ...this.props,\r\n        };\r\n\r\n        if (typeof itemData.realName === \"string\") {\r\n          this.props.name = getNameWithoutFolder(itemData.realName);\r\n        }\r\n        if (typeof this.props.number === \"number\" && typeof itemData.realIndex === \"number\") {\r\n          // Convert 0-indexed to 1-indexed\r\n          this.props.number = itemData.realIndex + 1;\r\n        }\r\n        if (typeof itemData.folder === \"string\") {\r\n          this.props.name = itemData.folder;\r\n          if (itemData.folderOpen) {\r\n            this.props.details = msg(\"open-folder\");\r\n          } else {\r\n            this.props.details = msg(\"closed-folder\");\r\n          }\r\n          this.props.selected = false;\r\n          this.props.number = null;\r\n          this.props.className += ` ${getFolderColorClass(itemData.folder)} sa-folders-folder`;\r\n        }\r\n        if (typeof itemData.inFolder === \"string\") {\r\n          this.props.className += ` ${getFolderColorClass(itemData.inFolder)}`;\r\n        }\r\n\r\n        const result = originalRender.call(this);\r\n\r\n        this.props = originalProps;\r\n        return result;\r\n      }\r\n      return originalRender.call(this);\r\n    };\r\n  };\r\n\r\n  const patchVM = () => {\r\n    const RenderedTarget = vm.runtime.targets[0].constructor;\r\n\r\n    const originalInstallTargets = vm.installTargets;\r\n    vm.installTargets = function (...args) {\r\n      if (currentSpriteFolder !== null) {\r\n        const targets = args[0];\r\n        const wholeProject = args[2];\r\n        if (Array.isArray(targets) && !wholeProject) {\r\n          for (const target of targets) {\r\n            if (target.sprite) {\r\n              target.sprite.name = setFolderOfName(target.sprite.name, currentSpriteFolder);\r\n            }\r\n          }\r\n        }\r\n      }\r\n      return originalInstallTargets.call(this, ...args).then((r) => {\r\n        fixTargetOrder();\r\n        return r;\r\n      });\r\n    };\r\n\r\n    const originalAddCostume = RenderedTarget.prototype.addCostume;\r\n    RenderedTarget.prototype.addCostume = function (...args) {\r\n      if (currentAssetFolder !== null) {\r\n        const costume = args[0];\r\n        if (costume && typeof getFolderFromName(costume.name) !== \"string\") {\r\n          costume.name = setFolderOfName(costume.name, currentAssetFolder);\r\n        }\r\n      }\r\n      const r = originalAddCostume.call(this, ...args);\r\n      fixCostumeOrder(this);\r\n      return r;\r\n    };\r\n\r\n    const originalAddSound = RenderedTarget.prototype.addSound;\r\n    RenderedTarget.prototype.addSound = function (...args) {\r\n      if (currentAssetFolder !== null) {\r\n        const sound = args[0];\r\n        if (sound && typeof getFolderFromName(sound.name) !== \"string\") {\r\n          sound.name = setFolderOfName(sound.name, currentAssetFolder);\r\n        }\r\n      }\r\n      const r = originalAddSound.call(this, ...args);\r\n      fixSoundOrder(this);\r\n      return r;\r\n    };\r\n\r\n    const abstractReorder = (\r\n      { guiItems, getAll, set, rename, getVMItemFromGUIItem, zeroIndexed, onFolderChanged },\r\n      itemIndex,\r\n      newIndex\r\n    ) => {\r\n      // First index depends on zeroIndexed\r\n      itemIndex = clamp(itemIndex, zeroIndexed ? 0 : 1, zeroIndexed ? guiItems.length - 1 : guiItems.length);\r\n      newIndex = clamp(newIndex, zeroIndexed ? 0 : 1, zeroIndexed ? guiItems.length - 1 : guiItems.length);\r\n      if (itemIndex === newIndex) {\r\n        return false;\r\n      }\r\n\r\n      let assets = getAll();\r\n      const originalAssets = getAll();\r\n\r\n      const targetItem = guiItems[itemIndex - (zeroIndexed ? 0 : 1)];\r\n      const itemAtNewIndex = guiItems[newIndex - (zeroIndexed ? 0 : 1)];\r\n      const targetItemData = getItemData(targetItem);\r\n      const itemAtNewIndexData = getItemData(itemAtNewIndex);\r\n\r\n      if (!targetItemData || !itemAtNewIndexData) {\r\n        console.warn(\"should never happen\");\r\n        return false;\r\n      }\r\n\r\n      const reorderingItems = typeof targetItemData.folder === \"string\" ? targetItem.items : [targetItem];\r\n      const reorderingAssets = reorderingItems.map((i) => getVMItemFromGUIItem(i, assets)).filter((i) => i);\r\n      if (typeof itemAtNewIndexData.realIndex === \"number\") {\r\n        const newTarget = getVMItemFromGUIItem(itemAtNewIndex, assets);\r\n        if (!newTarget || reorderingAssets.includes(newTarget)) {\r\n          // Dragging folder into itself or target doesn't exist. Ignore.\r\n          return false;\r\n        }\r\n      }\r\n\r\n      let newFolder = null;\r\n\r\n      assets = assets.filter((i) => !reorderingAssets.includes(i));\r\n\r\n      let realNewIndex;\r\n      if (newIndex === (zeroIndexed ? 0 : 1)) {\r\n        realNewIndex = zeroIndexed ? 0 : 1;\r\n      } else if (newIndex === guiItems.length - (zeroIndexed ? 1 : 0)) {\r\n        realNewIndex = assets.length;\r\n      } else if (typeof itemAtNewIndexData.realIndex === \"number\") {\r\n        newFolder = typeof itemAtNewIndexData.inFolder === \"string\" ? itemAtNewIndexData.inFolder : null;\r\n        let newAsset = getVMItemFromGUIItem(itemAtNewIndex, assets);\r\n        if (!newAsset) {\r\n          console.warn(\"should never happen\");\r\n          return false;\r\n        }\r\n        realNewIndex = assets.indexOf(newAsset);\r\n        if (newIndex > itemIndex) {\r\n          realNewIndex++;\r\n        }\r\n      } else if (typeof itemAtNewIndexData.folder === \"string\") {\r\n        let item;\r\n        let offset = 0;\r\n        if (newIndex < itemIndex) {\r\n          // A B [C D E] F G\r\n          //    ^----------*\r\n          // A B C [D] E F G\r\n          //      ^--------*\r\n          item = itemAtNewIndex.items[0];\r\n        } else if (itemAtNewIndexData.folderOpen) {\r\n          // A B [C D E] F G\r\n          //   *---^\r\n          item = itemAtNewIndex.items[0];\r\n          newFolder = itemAtNewIndexData.folder;\r\n        } else {\r\n          // A B [C] D E F G\r\n          //   *----^\r\n          item = itemAtNewIndex.items[itemAtNewIndex.items.length - 1];\r\n          offset = 1;\r\n        }\r\n        let newAsset = getVMItemFromGUIItem(item, assets);\r\n        if (newAsset) {\r\n          realNewIndex = assets.indexOf(newAsset) + offset;\r\n        } else {\r\n          // Edge case: Dragging the first item of a list on top of the folder item\r\n          // A B [C D E] F G\r\n          //    ^---*\r\n          newAsset = getVMItemFromGUIItem(item, originalAssets);\r\n          if (!newAsset) {\r\n            console.warn(\"should never happen\");\r\n            return false;\r\n          }\r\n          realNewIndex = originalAssets.indexOf(newAsset) + offset;\r\n        }\r\n      } else {\r\n        console.warn(\"should never happen\");\r\n        return false;\r\n      }\r\n\r\n      if (typeof targetItemData.folder === \"string\" && newFolder !== null) {\r\n        // Cannot drag a folder into another folder\r\n        return;\r\n      }\r\n\r\n      if (realNewIndex < (zeroIndexed ? 0 : 1) || realNewIndex > assets.length) {\r\n        console.warn(\"should never happen\");\r\n        return false;\r\n      }\r\n\r\n      assets.splice(realNewIndex, 0, ...reorderingAssets);\r\n      set(assets);\r\n\r\n      // If the folder has changed, update item names to match.\r\n      if (typeof targetItemData.folder !== \"string\" && targetItemData.inFolder !== newFolder) {\r\n        for (const asset of reorderingAssets) {\r\n          const name = asset.getName ? asset.getName() : asset.name;\r\n          rename(asset, setFolderOfName(name, newFolder));\r\n        }\r\n        if (onFolderChanged) {\r\n          onFolderChanged();\r\n        }\r\n      }\r\n\r\n      return true;\r\n    };\r\n\r\n    vm.constructor.prototype.reorderTarget = function (targetIndex, newIndex) {\r\n      return abstractReorder(\r\n        {\r\n          getAll: () => {\r\n            return this.runtime.targets;\r\n          },\r\n          set: (targets) => {\r\n            this.runtime.targets = targets;\r\n            this.emitTargetsUpdate();\r\n          },\r\n          rename: (item, name) => {\r\n            this.renameSprite(item.id, ensureNotReserved(name));\r\n          },\r\n          getVMItemFromGUIItem: (item, targets) => {\r\n            return targets.find((i) => i.id === item.id);\r\n          },\r\n          onFolderChanged: () => {\r\n            this.emitWorkspaceUpdate();\r\n          },\r\n          guiItems: currentSpriteItems,\r\n          zeroIndexed: false,\r\n        },\r\n        targetIndex,\r\n        newIndex\r\n      );\r\n    };\r\n\r\n    RenderedTarget.prototype.reorderCostume = function (costumeIndex, newIndex) {\r\n      return abstractReorder(\r\n        {\r\n          getAll: () => {\r\n            return this.sprite.costumes;\r\n          },\r\n          set: (assets) => {\r\n            this.sprite.costumes = assets;\r\n          },\r\n          rename: (item, name) => {\r\n            this.renameCostume(this.sprite.costumes.indexOf(item), name);\r\n          },\r\n          getVMItemFromGUIItem: (item, costumes) => {\r\n            const itemData = getItemData(item);\r\n            return costumes.find((c) => c.name === itemData.realName);\r\n          },\r\n          guiItems: currentAssetItems,\r\n          zeroIndexed: true,\r\n        },\r\n        costumeIndex,\r\n        newIndex\r\n      );\r\n    };\r\n\r\n    RenderedTarget.prototype.reorderSound = function (soundIndex, newIndex) {\r\n      return abstractReorder(\r\n        {\r\n          getAll: () => {\r\n            return this.sprite.sounds;\r\n          },\r\n          set: (assets) => {\r\n            this.sprite.sounds = assets;\r\n          },\r\n          rename: (item, name) => {\r\n            this.renameSound(this.sprite.sounds.indexOf(item), name);\r\n          },\r\n          getVMItemFromGUIItem: (item, sounds) => {\r\n            const itemData = getItemData(item);\r\n            return sounds.find((c) => c.name === itemData.realName);\r\n          },\r\n          guiItems: currentAssetItems,\r\n          zeroIndexed: true,\r\n        },\r\n        soundIndex,\r\n        newIndex\r\n      );\r\n    };\r\n  };\r\n\r\n  const patchBackpack = (backpackInstance) => {\r\n    const Backpack = backpackInstance.constructor;\r\n    Backpack.prototype.sa_loadNextItem = function () {\r\n      if (!this.sa_queuedItems) return;\r\n      const item = this.sa_queuedItems.pop();\r\n      if (item) {\r\n        let payload;\r\n        let type;\r\n        if (item.dragPayload) {\r\n          if (item.url) {\r\n            type = \"SOUND\";\r\n          } else {\r\n            type = \"COSTUME\";\r\n          }\r\n          payload = item.dragPayload;\r\n        } else if (item.id) {\r\n          type = \"SPRITE\";\r\n          payload = item.id;\r\n        }\r\n        if (type && payload) {\r\n          originalHandleDrop.call(this, {\r\n            dragType: type,\r\n            payload: payload,\r\n          });\r\n        }\r\n      }\r\n    };\r\n\r\n    Backpack.prototype.componentDidUpdate = function (prevProps, prevState) {\r\n      if (!this.state.loading && prevState.loading && !this.state.error) {\r\n        this.sa_loadNextItem();\r\n      }\r\n    };\r\n\r\n    const originalHandleDrop = Backpack.prototype.handleDrop;\r\n    Backpack.prototype.handleDrop = function (...args) {\r\n      // When a folder is dropped into the backpack, upload all the items in the folder.\r\n      const dragInfo = args[0];\r\n      const folderItems = dragInfo && dragInfo.payload && dragInfo.payload.sa_folder_items;\r\n      if (Array.isArray(folderItems)) {\r\n        if (confirm(msg(\"confirm-backpack-folder\"))) {\r\n          this.sa_queuedItems = folderItems;\r\n          this.sa_loadNextItem();\r\n        }\r\n        return;\r\n      }\r\n      return originalHandleDrop.call(this, ...args);\r\n    };\r\n    backpackInstance.handleDrop = Backpack.prototype.handleDrop.bind(backpackInstance);\r\n  };\r\n\r\n  await untilInEditor();\r\n\r\n  // Backpack\r\n  {\r\n    const clickListener = (e) => {\r\n      if (!e.target.closest('[class*=\"backpack_backpack-header_\"]')) {\r\n        return;\r\n      }\r\n      setTimeout(() => {\r\n        const backpackContainer = document.querySelector(\"[class^='backpack_backpack-list_']\");\r\n        if (!backpackContainer) {\r\n          return;\r\n        }\r\n        document.removeEventListener(\"click\", clickListener);\r\n        const backpackInstance = getBackpackFromElement(backpackContainer);\r\n        verifyBackpack(backpackInstance);\r\n        patchBackpack(backpackInstance);\r\n      });\r\n    };\r\n    document.addEventListener(\"click\", clickListener, true);\r\n  }\r\n\r\n  // Sprite list\r\n  {\r\n    const spriteSelectorItemElement = await addon.tab.waitForElement(\"[class^='sprite-selector_sprite-wrapper']\", {\r\n      reduxCondition: (state) => !state.scratchGui.mode.isPlayerOnly,\r\n    });\r\n    vm = addon.tab.traps.vm;\r\n    reactInternalKey = Object.keys(spriteSelectorItemElement).find((i) => i.startsWith(REACT_INTERNAL_PREFIX));\r\n    const sortableHOCInstance = getSortableHOCFromElement(spriteSelectorItemElement);\r\n    const spriteSelectorItemInstance = spriteSelectorItemElement[reactInternalKey].child.child.child.stateNode;\r\n    verifySortableHOC(sortableHOCInstance);\r\n    verifySpriteSelectorItem(spriteSelectorItemInstance);\r\n    verifyVM(vm);\r\n    patchSortableHOC(sortableHOCInstance.constructor, TYPE_SPRITES);\r\n    patchSpriteSelectorItem(spriteSelectorItemInstance.constructor);\r\n    sortableHOCInstance.saInitialSetup();\r\n    patchVM();\r\n  }\r\n\r\n  // Costume and sound list\r\n  {\r\n    const selectorListItem = await addon.tab.waitForElement(\"[class*='selector_list-item']\", {\r\n      reduxCondition: (state) => state.scratchGui.editorTab.activeTabIndex !== 0 && !state.scratchGui.mode.isPlayerOnly,\r\n    });\r\n    const sortableHOCInstance = getSortableHOCFromElement(selectorListItem);\r\n    verifySortableHOC(sortableHOCInstance);\r\n    patchSortableHOC(sortableHOCInstance.constructor, TYPE_ASSETS);\r\n    sortableHOCInstance.saInitialSetup();\r\n  }\r\n}\r\n","/* generated by pull.js */\nimport _js from \"./userscript.js\";\nexport const resources = {\n  \"userscript.js\": _js,\n};\n","export default async ({ addon, console, msg }) => {\r\n  const types = [\"sound\", \"costume\"];\r\n\r\n  addon.tab.createEditorContextMenu(\r\n    (ctx) => {\r\n      const target = addon.tab.traps.vm.editingTarget;\r\n      if (ctx.type === \"sound\") {\r\n        target.reorderSound(ctx.index, 0);\r\n      } else {\r\n        target.reorderCostume(ctx.index, 0);\r\n      }\r\n      queueMicrotask(() => {\r\n        addon.tab.traps.vm.emitTargetsUpdate();\r\n        addon.tab.traps.vm.runtime.emitProjectChanged();\r\n        ctx.target.click();\r\n      });\r\n    },\r\n    {\r\n      types,\r\n      position: \"assetContextMenuAfterExport\",\r\n      order: 1,\r\n      label: msg(\"top\"),\r\n      condition: (ctx) => ctx.index !== 0,\r\n    }\r\n  );\r\n  addon.tab.createEditorContextMenu(\r\n    (ctx) => {\r\n      const target = addon.tab.traps.vm.editingTarget;\r\n      if (ctx.type === \"sound\") {\r\n        target.reorderSound(ctx.index, Infinity);\r\n      } else {\r\n        target.reorderCostume(ctx.index, Infinity);\r\n      }\r\n      queueMicrotask(() => {\r\n        addon.tab.traps.vm.emitTargetsUpdate();\r\n        addon.tab.traps.vm.runtime.emitProjectChanged();\r\n        ctx.target.click();\r\n      });\r\n    },\r\n    {\r\n      types,\r\n      position: \"assetContextMenuAfterExport\",\r\n      order: 2,\r\n      label: msg(\"bottom\"),\r\n      condition: (ctx) => ctx.index !== ctx.target.parentNode.parentNode.childElementCount - 1,\r\n    }\r\n  );\r\n};\r\n","/* generated by pull.js */\nimport _js from \"./userscript.js\";\nimport _css from \"!css-loader!./style.css\";\nexport const resources = {\n  \"userscript.js\": _js,\n  \"style.css\": _css,\n};\n","/* inserted by pull.js */\nimport _twAsset0 from \"!url-loader!./decrement.svg\";\nimport _twAsset1 from \"!url-loader!./increment.svg\";\nimport _twAsset2 from \"!url-loader!./settings.svg\";\nimport _twAsset3 from \"!url-loader!./toggle.svg\";\nconst _twGetAsset = (path) => {\n  if (path === \"/decrement.svg\") return _twAsset0;\n  if (path === \"/increment.svg\") return _twAsset1;\n  if (path === \"/settings.svg\") return _twAsset2;\n  if (path === \"/toggle.svg\") return _twAsset3;\n  throw new Error(`Unknown asset: ${path}`);\n};\n\nexport default async function ({ addon, global, console, msg }) {\r\n  const paper = await addon.tab.traps.getPaper();\r\n\r\n  const paintEditorCanvasContainer = await addon.tab.waitForElement(\"[class^='paint-editor_canvas-container']\");\r\n  try {\r\n    if (!(\"colorIndex\" in addon.tab.redux.state.scratchPaint.fillMode)) {\r\n      console.error(\"Detected new paint editor; this will be supported in future versions.\");\r\n      return;\r\n    }\r\n  } catch (_) {\r\n    // The check can technically fail when Redux isn't supported (rare cases)\r\n    // Just ignore in this case\r\n  }\r\n  const paperCanvas =\r\n    paintEditorCanvasContainer[addon.tab.traps.getInternalKey(paintEditorCanvasContainer)].child.child.child.stateNode;\r\n\r\n  const storedOnionLayers = [];\r\n\r\n  const parseHexColor = (color) => {\r\n    const hexString = color.substr(1);\r\n    const hexNumber = parseInt(hexString, 16);\r\n    return [\r\n      (hexNumber >> 16) & 0xff, // R\r\n      (hexNumber >> 8) & 0xff, // G\r\n      hexNumber & 0xff, // B\r\n    ];\r\n  };\r\n\r\n  const settings = {\r\n    enabled: addon.settings.get(\"default\") && !addon.self.disabled,\r\n    previous: +addon.settings.get(\"previous\"),\r\n    next: +addon.settings.get(\"next\"),\r\n    opacity: +addon.settings.get(\"opacity\"),\r\n    opacityStep: +addon.settings.get(\"opacityStep\"),\r\n    layering: addon.settings.get(\"layering\"),\r\n    mode: addon.settings.get(\"mode\"),\r\n    beforeTint: parseHexColor(addon.settings.get(\"beforeTint\")),\r\n    afterTint: parseHexColor(addon.settings.get(\"afterTint\")),\r\n  };\r\n\r\n  const getPaperCenter = () => {\r\n    const backgroundGuideLayer = paper.project.layers.find((i) => i.data.isBackgroundGuideLayer);\r\n    return backgroundGuideLayer.children[0].position;\r\n  };\r\n\r\n  const injectPaper = () => {\r\n    // When background guide layer is added, show onion layers.\r\n    // https://github.com/LLK/scratch-paint/blob/cdf0afc217633e6cfb8ba90ea4ae38b79882cf6c/src/helper/layer.js#L145\r\n    const originalAddLayer = paper.Project.prototype.addLayer;\r\n    paper.Project.prototype.addLayer = function (layer) {\r\n      const result = originalAddLayer.call(this, layer);\r\n      if (layer.data.isBackgroundGuideLayer) {\r\n        let onion;\r\n        while ((onion = storedOnionLayers.shift())) {\r\n          originalAddLayer.call(this, onion);\r\n        }\r\n        relayerOnionLayers();\r\n      }\r\n      return result;\r\n    };\r\n\r\n    // Scratch uses importJSON to undo or redo\r\n    // https://github.com/LLK/scratch-paint/blob/cdf0afc217633e6cfb8ba90ea4ae38b79882cf6c/src/helper/undo.js#L37\r\n    // The code prior to this will remove our onion layers, so we have to manually add them back.\r\n    const originalImportJSON = paper.Project.prototype.importJSON;\r\n    paper.Project.prototype.importJSON = function (json) {\r\n      const result = originalImportJSON.call(this, json);\r\n      if (settings.enabled) {\r\n        updateOnionLayers();\r\n      }\r\n      return result;\r\n    };\r\n\r\n    // https://github.com/LLK/scratch-paint/blob/cdf0afc217633e6cfb8ba90ea4ae38b79882cf6c/src/helper/layer.js#L114\r\n    // When background guide layer is removed, hide onion layers.\r\n    const originalRemoveLayer = paper.Layer.prototype.remove;\r\n    paper.Layer.prototype.remove = function () {\r\n      if (this.data.isBackgroundGuideLayer) {\r\n        for (const layer of paper.project.layers) {\r\n          if (layer.data.sa_isOnionLayer) {\r\n            storedOnionLayers.push(layer);\r\n          }\r\n        }\r\n        for (const layer of storedOnionLayers) {\r\n          layer.remove();\r\n        }\r\n      }\r\n      return originalRemoveLayer.call(this);\r\n    };\r\n  };\r\n\r\n  const injectPaperCanvas = () => {\r\n    let expectingImport = false;\r\n\r\n    const PaperCanvas = paperCanvas.constructor;\r\n\r\n    // importImage is called to start loading an image.\r\n    // https://github.com/LLK/scratch-paint/blob/cdf0afc217633e6cfb8ba90ea4ae38b79882cf6c/src/containers/paper-canvas.jsx#L124\r\n    const originalImportImage = PaperCanvas.prototype.importImage;\r\n    PaperCanvas.prototype.importImage = function (...args) {\r\n      expectingImport = true;\r\n      removeOnionLayers();\r\n      return originalImportImage.call(this, ...args);\r\n    };\r\n\r\n    // recalibrateSize is called when the canvas finishes loading an image.\r\n    // all paths of importImage will result in a call to this method.\r\n    // https://github.com/LLK/scratch-paint/blob/cdf0afc217633e6cfb8ba90ea4ae38b79882cf6c/src/containers/paper-canvas.jsx#L310-L327\r\n    // We use this to know when to add layers.\r\n    const originalRecalibrateSize = PaperCanvas.prototype.recalibrateSize;\r\n    PaperCanvas.prototype.recalibrateSize = function (callback) {\r\n      return originalRecalibrateSize.call(this, () => {\r\n        if (callback) callback();\r\n        if (expectingImport) {\r\n          expectingImport = false;\r\n          if (settings.enabled) {\r\n            updateOnionLayers();\r\n          }\r\n        }\r\n      });\r\n    };\r\n\r\n    // Prototype overrides will work for all future instances, but Scratch manually binds some methods to `this`\r\n    // so we have to manually copy them for the current instance (but not future instances)\r\n    paperCanvas.recalibrateSize = PaperCanvas.prototype.recalibrateSize.bind(paperCanvas);\r\n    paperCanvas.importImage = PaperCanvas.prototype.importImage.bind(paperCanvas);\r\n  };\r\n\r\n  const createOnionLayer = () => {\r\n    const layer = new paper.Layer();\r\n    layer.locked = true;\r\n    layer.guide = true;\r\n    layer.data.sa_isOnionLayer = true;\r\n    return layer;\r\n  };\r\n\r\n  // Each onion layer update is given an ID\r\n  // Because updating layers is async, we need this to cancel all but the most recent update\r\n  let globalUpdateId = 0;\r\n  const cancelOngoingUpdatesAndGetNewId = () => ++globalUpdateId;\r\n\r\n  const removeOnionLayers = () => {\r\n    cancelOngoingUpdatesAndGetNewId();\r\n\r\n    const project = paper.project;\r\n    if (!project) {\r\n      return;\r\n    }\r\n\r\n    storedOnionLayers.length = 0;\r\n    const layers = project.layers;\r\n    // Iterate downward because we remove items mid-iteration\r\n    for (let i = layers.length - 1; i >= 0; i--) {\r\n      const layer = layers[i];\r\n      if (layer.data.sa_isOnionLayer) {\r\n        layer.remove();\r\n      }\r\n    }\r\n  };\r\n\r\n  const relayerOnionLayers = () => {\r\n    const project = paper.project;\r\n    if (!project) {\r\n      return;\r\n    }\r\n    const onionLayer = project.layers.find((i) => i.data.sa_isOnionLayer);\r\n    if (!onionLayer) {\r\n      return;\r\n    }\r\n    if (settings.layering === \"front\") {\r\n      project.addLayer(onionLayer);\r\n    } else {\r\n      const rasterLayer = project.layers.find((i) => i.data.isRasterLayer);\r\n      if (rasterLayer.index === 0) {\r\n        project.insertLayer(0, onionLayer);\r\n      } else {\r\n        project.insertLayer(1, onionLayer);\r\n      }\r\n    }\r\n  };\r\n\r\n  const recursePaperItem = (item, callback) => {\r\n    if (item.children) {\r\n      for (const child of item.children) {\r\n        recursePaperItem(child, callback);\r\n      }\r\n    }\r\n    callback(item);\r\n  };\r\n\r\n  const getTint = (red, green, blue, isBefore) => {\r\n    const referenceColor = isBefore ? settings.beforeTint : settings.afterTint;\r\n    const colorAverage = (red + green + blue) / 3 / 255;\r\n    const WEIGHT = 1.5;\r\n    const weighted = colorAverage / WEIGHT + (1 - 1 / WEIGHT);\r\n    return [referenceColor[0] * weighted, referenceColor[1] * weighted, referenceColor[2] * weighted];\r\n  };\r\n\r\n  const toHexColor = ([red, green, blue]) => {\r\n    const r = Math.round(red).toString(16).padStart(2, \"0\");\r\n    const g = Math.round(green).toString(16).padStart(2, \"0\");\r\n    const b = Math.round(blue).toString(16).padStart(2, \"0\");\r\n    return `#${r}${g}${b}`;\r\n  };\r\n\r\n  const getPaperColorTint = (color, isBefore) =>\r\n    toHexColor(getTint(color.red * 255, color.green * 255, color.blue * 255, isBefore));\r\n\r\n  const tintRaster = (raster, isBefore) => {\r\n    const { width, height } = raster.canvas;\r\n    const context = raster.context;\r\n    // TODO: check to see if this is a performance issue\r\n    const imageData = context.getImageData(0, 0, width, height);\r\n    const data = imageData.data;\r\n    for (let i = 0; i < data.length; i += 4 /* RGBA */) {\r\n      const red = data[i + 0];\r\n      const green = data[i + 1];\r\n      const blue = data[i + 2];\r\n      const alpha = data[i + 3];\r\n      if (alpha === 0) {\r\n        continue;\r\n      }\r\n      const newTint = getTint(red, green, blue, isBefore);\r\n      data[i + 0] = newTint[0];\r\n      data[i + 1] = newTint[1];\r\n      data[i + 2] = newTint[2];\r\n    }\r\n    context.putImageData(imageData, 0, 0);\r\n  };\r\n\r\n  const waitForAllRastersToLoad = (root) => {\r\n    const promises = [];\r\n    recursePaperItem(root, (item) => {\r\n      if (item instanceof paper.Raster) {\r\n        promises.push(\r\n          new Promise((resolve, reject) => {\r\n            item.on(\"load\", () => resolve());\r\n            item.on(\"error\", () => reject(new Error(\"Raster inside SVG failed to load\")));\r\n          })\r\n        );\r\n      }\r\n    });\r\n    return Promise.all(promises);\r\n  };\r\n\r\n  const rasterizeVector = (root) => {\r\n    const bounds = root.strokeBounds;\r\n    const { width, height } = bounds;\r\n\r\n    // Some browsers experience extremely poor performance when this value exceeds 3840.\r\n    const MAX_SIZE = 3000;\r\n    const maxScale = Math.min(MAX_SIZE / width, MAX_SIZE / height);\r\n\r\n    const raster = new paper.Raster(new paper.Size(width, height));\r\n    raster.remove();\r\n    raster.smoothing = true;\r\n\r\n    raster.guide = true;\r\n    raster.locked = true;\r\n\r\n    let renderedAtScale = 0;\r\n    const originalDraw = raster.draw;\r\n    raster.draw = function (...args) {\r\n      const displayedSize = this.getView().getZoom() * window.devicePixelRatio;\r\n      const newScale = Math.max(1, Math.min(maxScale, 2 ** Math.ceil(Math.log2(displayedSize))));\r\n      if (newScale > renderedAtScale) {\r\n        renderedAtScale = newScale;\r\n        const canvas = this.canvas;\r\n        const ctx = this.context;\r\n\r\n        // Based on https://github.com/LLK/paper.js/blob/16d5ff0267e3a0ef647c25e58182a27300afad20/src/item/Item.js#L1761\r\n        const scaledWidth = width * newScale;\r\n        const scaledHeight = height * newScale;\r\n        canvas.width = scaledWidth;\r\n        canvas.height = scaledHeight;\r\n\r\n        this._size = new paper.Size(scaledWidth, scaledHeight);\r\n        const topLeft = bounds.getTopLeft();\r\n        const bottomRight = bounds.getBottomRight();\r\n        const size = new paper.Size(bottomRight.subtract(topLeft));\r\n        const matrix = new paper.Matrix().scale(newScale).translate(topLeft.negate());\r\n        ctx.save();\r\n        matrix.applyToContext(ctx);\r\n        root.draw(\r\n          ctx,\r\n          new paper.Base({\r\n            matrices: [matrix],\r\n          })\r\n        );\r\n        ctx.restore();\r\n        this.matrix.reset();\r\n        this.transform(new paper.Matrix().translate(topLeft.add(size.divide(2))).scale(1 / newScale));\r\n      }\r\n\r\n      return originalDraw.call(this, ...args);\r\n    };\r\n\r\n    return raster;\r\n  };\r\n\r\n  const makeVectorOnion = (opacity, costume, asset, isBefore) =>\r\n    new Promise((resolve, reject) => {\r\n      const { rotationCenterX, rotationCenterY } = costume;\r\n      // https://github.com/LLK/scratch-paint/blob/cdf0afc217633e6cfb8ba90ea4ae38b79882cf6c/src/containers/paper-canvas.jsx#L196-L218\r\n      asset = asset.split(/<\\s*svg:/).join(\"<\");\r\n      asset = asset.split(/<\\/\\s*svg:/).join(\"</\");\r\n      const svgAttrs = asset.match(/<svg [^>]*>/);\r\n      if (svgAttrs && svgAttrs[0].indexOf(\"xmlns=\") === -1) {\r\n        asset = asset.replace(\"<svg \", '<svg xmlns=\"http://www.w3.org/2000/svg\" ');\r\n      }\r\n      const parser = new DOMParser();\r\n      const svgDom = parser.parseFromString(asset, \"text/xml\");\r\n      const viewBox = svgDom.documentElement.attributes.viewBox\r\n        ? svgDom.documentElement.attributes.viewBox.value.match(/\\S+/g)\r\n        : null;\r\n      if (viewBox) {\r\n        for (let i = 0; i < viewBox.length; i++) {\r\n          viewBox[i] = parseFloat(viewBox[i]);\r\n        }\r\n      }\r\n\r\n      const handleLoad = (root) => {\r\n        root.opacity = opacity;\r\n\r\n        // https://github.com/LLK/scratch-paint/blob/cdf0afc217633e6cfb8ba90ea4ae38b79882cf6c/src/containers/paper-canvas.jsx#L274-L275\r\n        recursePaperItem(root, (i) => {\r\n          if (i.className === \"PathItem\") {\r\n            i.clockwise = true;\r\n          }\r\n          if (i.className !== \"PointText\" && !i.children) {\r\n            if (i.strokeWidth) {\r\n              i.strokeWidth = i.strokeWidth * 2;\r\n            }\r\n          }\r\n          i.locked = true;\r\n          i.guide = true;\r\n        });\r\n        root.scale(2, new paper.Point(0, 0));\r\n\r\n        if (settings.mode === \"tint\") {\r\n          const gradients = new Set();\r\n          recursePaperItem(root, (i) => {\r\n            if (i.strokeColor) {\r\n              i.strokeColor = getPaperColorTint(i.strokeColor, isBefore);\r\n            }\r\n            if (i.fillColor) {\r\n              const gradient = i.fillColor.gradient;\r\n              if (gradient) {\r\n                if (gradients.has(gradient)) return;\r\n                gradients.add(gradient);\r\n                for (const stop of gradient.stops) {\r\n                  stop.color = getPaperColorTint(stop.color, isBefore);\r\n                }\r\n              } else {\r\n                i.fillColor = getPaperColorTint(i.fillColor, isBefore);\r\n              }\r\n            }\r\n            if (i.canvas) {\r\n              tintRaster(i, isBefore);\r\n            }\r\n          });\r\n        }\r\n\r\n        const paperCenter = getPaperCenter();\r\n        // https://github.com/LLK/scratch-paint/blob/cdf0afc217633e6cfb8ba90ea4ae38b79882cf6c/src/containers/paper-canvas.jsx#L277-L287\r\n        if (typeof rotationCenterX !== \"undefined\" && typeof rotationCenterY !== \"undefined\") {\r\n          let rotationPoint = new paper.Point(rotationCenterX, rotationCenterY);\r\n          if (viewBox && viewBox.length >= 2 && !isNaN(viewBox[0]) && !isNaN(viewBox[1])) {\r\n            rotationPoint = rotationPoint.subtract(viewBox[0], viewBox[1]);\r\n          }\r\n          root.translate(paperCenter.subtract(rotationPoint.multiply(2)));\r\n        } else {\r\n          root.translate(paperCenter.subtract(root.bounds.width, root.bounds.height));\r\n        }\r\n\r\n        return rasterizeVector(root);\r\n      };\r\n\r\n      paper.project.importSVG(asset, {\r\n        expandShapes: true,\r\n        insert: false,\r\n        onLoad: (root) => {\r\n          if (!root) {\r\n            reject(new Error(\"could not load onion skin\"));\r\n            return;\r\n          }\r\n          resolve(waitForAllRastersToLoad(root).then(() => handleLoad(root)));\r\n        },\r\n      });\r\n    });\r\n\r\n  const makeRasterOnion = (opacity, costume, asset, isBefore) =>\r\n    new Promise((resolve, reject) => {\r\n      let { rotationCenterX, rotationCenterY } = costume;\r\n\r\n      const image = new Image();\r\n      image.onload = () => {\r\n        const paperCenter = getPaperCenter();\r\n        const width = Math.min(paperCenter.x * 2, image.width);\r\n        const height = Math.min(paperCenter.y * 2, image.height);\r\n\r\n        // https://github.com/LLK/scratch-paint/blob/cdf0afc217633e6cfb8ba90ea4ae38b79882cf6c/src/containers/paper-canvas.jsx#L151-L156\r\n        if (typeof rotationCenterX === \"undefined\") {\r\n          rotationCenterX = width / 2;\r\n        }\r\n        if (typeof rotationCenterY === \"undefined\") {\r\n          rotationCenterY = height / 2;\r\n        }\r\n\r\n        const raster = new paper.Raster(image);\r\n        raster.opacity = opacity;\r\n        raster.guide = true;\r\n        raster.locked = true;\r\n        const x = width / 2 + (paperCenter.x - rotationCenterX);\r\n        const y = height / 2 + (paperCenter.y - rotationCenterY);\r\n        raster.position = new paper.Point(x, y);\r\n        raster.remove();\r\n\r\n        if (settings.mode === \"tint\") {\r\n          tintRaster(raster, isBefore);\r\n        }\r\n\r\n        resolve(raster);\r\n      };\r\n      image.onerror = () => {\r\n        reject(new Error(\"could not load image\"));\r\n      };\r\n      image.src = asset;\r\n    });\r\n\r\n  const getSelectedCostumeIndex = () => {\r\n    const item = document.querySelector(\"[class*='selector_list-item'][class*='sprite-selector-item_is-selected']\");\r\n    if (!item) return -1;\r\n    const numberEl = item.querySelector(\"[class*='sprite-selector-item_number']\");\r\n    if (!numberEl) return -1;\r\n    return +numberEl.textContent - 1;\r\n  };\r\n\r\n  const updateOnionLayers = async () => {\r\n    const project = paper.project;\r\n    if (!project) {\r\n      return;\r\n    }\r\n\r\n    const selectedCostumeIndex = getSelectedCostumeIndex();\r\n    if (selectedCostumeIndex === -1) {\r\n      return;\r\n    }\r\n\r\n    removeOnionLayers();\r\n\r\n    const localUpdateId = cancelOngoingUpdatesAndGetNewId();\r\n\r\n    const vm = addon.tab.traps.vm;\r\n    if (!vm) {\r\n      return;\r\n    }\r\n    const originalActiveLayer = project.activeLayer;\r\n    const costumes = vm.editingTarget.sprite.costumes;\r\n\r\n    const startIndex = Math.max(0, selectedCostumeIndex - settings.previous);\r\n    const endIndex = Math.min(costumes.length - 1, selectedCostumeIndex + settings.next);\r\n\r\n    try {\r\n      const layersToCreate = [];\r\n      for (let i = startIndex; i <= endIndex; i++) {\r\n        if (i === selectedCostumeIndex) {\r\n          continue;\r\n        }\r\n        const isBefore = i < selectedCostumeIndex;\r\n        const distance = Math.abs(i - selectedCostumeIndex) - 1;\r\n        const opacity = (settings.opacity - settings.opacityStep * distance) / 100;\r\n        if (opacity <= 0) {\r\n          continue;\r\n        }\r\n        layersToCreate.push({\r\n          index: i,\r\n          isBefore,\r\n          opacity,\r\n        });\r\n      }\r\n\r\n      const onions = await Promise.all(\r\n        layersToCreate.map(({ index, isBefore, opacity }) => {\r\n          const onionCostume = costumes[index];\r\n          const onionAsset = vm.getCostume(index);\r\n\r\n          if (onionCostume.dataFormat === \"svg\") {\r\n            return makeVectorOnion(opacity, onionCostume, onionAsset, isBefore);\r\n          } else if (onionCostume.dataFormat === \"png\" || onionCostume.dataFormat === \"jpg\") {\r\n            return makeRasterOnion(opacity, onionCostume, onionAsset, isBefore);\r\n          } else {\r\n            throw new Error(`Unknown data format: ${onionCostume.dataFormat}`);\r\n          }\r\n        })\r\n      );\r\n\r\n      // Make sure we haven't been cancelled\r\n      if (globalUpdateId === localUpdateId) {\r\n        const layer = createOnionLayer();\r\n        for (const item of onions) {\r\n          layer.addChild(item);\r\n        }\r\n        relayerOnionLayers();\r\n      }\r\n    } catch (e) {\r\n      console.error(e);\r\n    }\r\n\r\n    // We must make sure to always reset the active layer to avoid corruption.\r\n    originalActiveLayer.activate();\r\n  };\r\n\r\n  const setEnabled = (_enabled) => {\r\n    if (settings.enabled === _enabled) {\r\n      return;\r\n    }\r\n    settings.enabled = _enabled;\r\n    if (settings.enabled) {\r\n      if (settings.next === 0 && settings.previous === 0) {\r\n        settings.previous = 1;\r\n        layerInputs.previous.value = settings.previous;\r\n      }\r\n      if (settings.opacity === 0) {\r\n        settings.opacity = 25;\r\n        layerInputs.opacity.value = settings.opacity;\r\n      }\r\n      updateOnionLayers();\r\n    } else {\r\n      removeOnionLayers();\r\n    }\r\n    toggleButton.dataset.enabled = settings.enabled;\r\n  };\r\n\r\n  //\r\n  // Controls below editor\r\n  //\r\n\r\n  const settingsChanged = (onlyRelayerNeeded) => {\r\n    if ((settings.previous === 0 && settings.next === 0) || settings.opacity === 0) {\r\n      setEnabled(false);\r\n      return;\r\n    }\r\n    if (settings.enabled) {\r\n      if (onlyRelayerNeeded) {\r\n        relayerOnionLayers();\r\n      } else {\r\n        updateOnionLayers();\r\n      }\r\n    } else if (settings.previous > 0 || settings.next > 0) {\r\n      setEnabled(true);\r\n    }\r\n  };\r\n\r\n  const createGroup = () => {\r\n    const el = document.createElement(\"div\");\r\n    el.className = \"sa-onion-group\";\r\n    return el;\r\n  };\r\n\r\n  const createButton = ({ useButtonTag } = {}) => {\r\n    const el = document.createElement(useButtonTag ? \"button\" : \"span\");\r\n    el.className = \"sa-onion-button\";\r\n    el.setAttribute(\"role\", \"button\");\r\n    return el;\r\n  };\r\n\r\n  const createButtonImage = (name) => {\r\n    const el = document.createElement(\"img\");\r\n    el.className = \"sa-onion-image\";\r\n    el.draggable = false;\r\n    el.dataset.image = name;\r\n    el.loading = \"lazy\";\r\n    el.src = _twGetAsset(\"/\" + name + \".svg\");\r\n    return el;\r\n  };\r\n\r\n  const paintEditorControlsContainer = document.createElement(\"div\");\r\n  paintEditorControlsContainer.className = \"sa-onion-controls-container\";\r\n  paintEditorControlsContainer.dir = \"\";\r\n\r\n  const toggleControlsGroup = createGroup();\r\n  addon.tab.displayNoneWhileDisabled(toggleControlsGroup, { display: \"flex\" });\r\n\r\n  const toggleButton = createButton();\r\n  toggleButton.dataset.enabled = settings.enabled;\r\n  toggleButton.addEventListener(\"click\", () => setEnabled(!settings.enabled));\r\n  toggleButton.title = msg(\"toggle\");\r\n  toggleButton.appendChild(createButtonImage(\"toggle\"));\r\n  toggleControlsGroup.appendChild(toggleButton);\r\n\r\n  const settingButton = createButton();\r\n  settingButton.addEventListener(\"click\", () => setSettingsOpen(!areSettingsOpen()));\r\n  settingButton.title = msg(\"settings\");\r\n  settingButton.appendChild(createButtonImage(\"settings\"));\r\n  toggleControlsGroup.appendChild(settingButton);\r\n\r\n  paintEditorControlsContainer.appendChild(toggleControlsGroup);\r\n\r\n  //\r\n  // Settings page\r\n  //\r\n\r\n  const settingsPage = document.createElement(\"div\");\r\n  settingsPage.className = \"sa-onion-settings\";\r\n\r\n  const setSettingsOpen = (open) => {\r\n    settingButton.dataset.enabled = open;\r\n    settingsPage.dataset.visible = open;\r\n  };\r\n  const areSettingsOpen = () => settingsPage.dataset.visible === \"true\";\r\n\r\n  const layerInputs = {};\r\n  for (const type of [\"previous\", \"next\", \"opacity\", \"opacityStep\"]) {\r\n    const container = document.createElement(\"label\");\r\n    container.className = \"sa-onion-settings-line\";\r\n\r\n    const label = document.createElement(\"div\");\r\n    label.className = \"sa-onion-settings-label\";\r\n    label.textContent = msg(type);\r\n    container.appendChild(label);\r\n\r\n    const group = createGroup();\r\n    const currentButton = createButton();\r\n\r\n    const filler = document.createElement(\"div\");\r\n    filler.style.width = \"20px\";\r\n    currentButton.appendChild(filler);\r\n\r\n    const currentInput = document.createElement(\"input\");\r\n    layerInputs[type] = currentInput;\r\n    currentInput.className = \"sa-onion-settings-input\";\r\n    currentInput.type = \"number\";\r\n    currentInput.step = \"1\";\r\n    currentInput.min = \"0\";\r\n    currentInput.max = \"100\";\r\n    currentInput.value = settings[type];\r\n    currentInput.addEventListener(\"input\", (e) => {\r\n      if (currentInput.value.length === 0) {\r\n        settings[type] = 0;\r\n        settingsChanged();\r\n        return;\r\n      }\r\n      let value = +currentInput.value;\r\n      if (value > +currentInput.max) {\r\n        value = +currentInput.max;\r\n      } else if (value < 0) {\r\n        value = 0;\r\n      }\r\n      currentInput.value = value;\r\n      settings[type] = value;\r\n      settingsChanged();\r\n    });\r\n    currentInput.addEventListener(\"blur\", () => {\r\n      if (!currentInput.value) {\r\n        currentInput.value = \"0\";\r\n      }\r\n    });\r\n    currentButton.appendChild(currentInput);\r\n\r\n    const decrementButton = createButton();\r\n    decrementButton.appendChild(createButtonImage(\"decrement\"));\r\n    decrementButton.addEventListener(\"click\", () => {\r\n      if (settings[type] > 0) {\r\n        settings[type]--;\r\n        currentInput.value = settings[type];\r\n        settingsChanged();\r\n      }\r\n    });\r\n\r\n    const incrementButton = createButton();\r\n    incrementButton.appendChild(createButtonImage(\"increment\"));\r\n    incrementButton.addEventListener(\"click\", () => {\r\n      if (settings[type] < +currentInput.max) {\r\n        settings[type]++;\r\n        currentInput.value = settings[type];\r\n        settingsChanged();\r\n      }\r\n    });\r\n\r\n    group.appendChild(decrementButton);\r\n    group.appendChild(currentButton);\r\n    group.appendChild(incrementButton);\r\n    container.appendChild(group);\r\n    settingsPage.appendChild(container);\r\n  }\r\n\r\n  const modeContainer = document.createElement(\"div\");\r\n  modeContainer.className = \"sa-onion-settings-line\";\r\n  const modeLabel = document.createElement(\"div\");\r\n  modeLabel.className = \"sa-onion-settings-label\";\r\n  modeLabel.textContent = msg(\"mode\");\r\n  const modeGroup = createGroup();\r\n  modeContainer.appendChild(modeLabel);\r\n  const modeMergeButton = createButton({ useButtonTag: true });\r\n  modeMergeButton.appendChild(document.createTextNode(msg(\"merge\")));\r\n  modeGroup.appendChild(modeMergeButton);\r\n  modeMergeButton.addEventListener(\"click\", (e) => {\r\n    settings.mode = \"merge\";\r\n    modeTintButton.dataset.enabled = false;\r\n    modeMergeButton.dataset.enabled = true;\r\n    settingsChanged();\r\n  });\r\n  modeMergeButton.dataset.enabled = settings.mode === \"merge\";\r\n  const modeTintButton = createButton({ useButtonTag: true });\r\n  modeTintButton.appendChild(document.createTextNode(msg(\"tint\")));\r\n  modeGroup.appendChild(modeTintButton);\r\n  modeTintButton.addEventListener(\"click\", (e) => {\r\n    settings.mode = \"tint\";\r\n    modeTintButton.dataset.enabled = true;\r\n    modeMergeButton.dataset.enabled = false;\r\n    settingsChanged();\r\n  });\r\n  modeTintButton.dataset.enabled = settings.mode === \"tint\";\r\n  modeContainer.appendChild(modeGroup);\r\n  settingsPage.appendChild(modeContainer);\r\n\r\n  const layeringContainer = document.createElement(\"div\");\r\n  layeringContainer.className = \"sa-onion-settings-line\";\r\n  const layeringLabel = document.createElement(\"div\");\r\n  layeringLabel.className = \"sa-onion-settings-label\";\r\n  layeringLabel.textContent = msg(\"layering\");\r\n  const layeringGroup = createGroup();\r\n  layeringContainer.appendChild(layeringLabel);\r\n  const layeringFrontButton = createButton({ useButtonTag: true });\r\n  layeringFrontButton.appendChild(document.createTextNode(msg(\"front\")));\r\n  layeringGroup.appendChild(layeringFrontButton);\r\n  layeringFrontButton.addEventListener(\"click\", (e) => {\r\n    settings.layering = \"front\";\r\n    layeringBehindButton.dataset.enabled = false;\r\n    layeringFrontButton.dataset.enabled = true;\r\n    settingsChanged(true);\r\n  });\r\n  layeringFrontButton.dataset.enabled = settings.layering === \"front\";\r\n  const layeringBehindButton = createButton({ useButtonTag: true });\r\n  layeringBehindButton.appendChild(document.createTextNode(msg(\"behind\")));\r\n  layeringGroup.appendChild(layeringBehindButton);\r\n  layeringBehindButton.addEventListener(\"click\", (e) => {\r\n    settings.layering = \"behind\";\r\n    layeringBehindButton.dataset.enabled = true;\r\n    layeringFrontButton.dataset.enabled = false;\r\n    settingsChanged(true);\r\n  });\r\n  layeringBehindButton.dataset.enabled = settings.layering === \"behind\";\r\n  layeringContainer.appendChild(layeringGroup);\r\n  settingsPage.appendChild(layeringContainer);\r\n\r\n  const SVG_NS = \"http://www.w3.org/2000/svg\";\r\n  const settingsTip = document.createElementNS(SVG_NS, \"svg\");\r\n  settingsTip.setAttribute(\"class\", \"sa-onion-settings-tip\");\r\n  settingsTip.setAttribute(\"width\", \"14\");\r\n  settingsTip.setAttribute(\"height\", \"7\");\r\n  const settingsTipShape = document.createElementNS(SVG_NS, \"polygon\");\r\n  settingsTipShape.setAttribute(\"class\", \"sa-onion-settings-polygon\");\r\n  settingsTipShape.setAttribute(\"points\", \"0,0 7,7, 14,0\");\r\n  settingsTip.appendChild(settingsTipShape);\r\n  settingsPage.appendChild(settingsTip);\r\n\r\n  let oldEnabled = null;\r\n  addon.self.addEventListener(\"disabled\", () => {\r\n    setSettingsOpen(false);\r\n    oldEnabled = settings.enabled;\r\n    setEnabled(false);\r\n  });\r\n  addon.self.addEventListener(\"reenabled\", () => {\r\n    setEnabled(oldEnabled);\r\n  });\r\n\r\n  const controlsLoop = async () => {\r\n    let hasRunOnce = false;\r\n    while (true) {\r\n      const canvasControls = await addon.tab.waitForElement(\"[class^='paint-editor_canvas-controls']\", {\r\n        markAsSeen: true,\r\n        reduxEvents: [\"scratch-gui/navigation/ACTIVATE_TAB\", \"scratch-gui/mode/SET_PLAYER\"],\r\n        reduxCondition: (state) =>\r\n          state.scratchGui.editorTab.activeTabIndex === 1 && !state.scratchGui.mode.isPlayerOnly,\r\n      });\r\n      const zoomControlsContainer = canvasControls.querySelector(\"[class^='paint-editor_zoom-controls']\");\r\n      const canvasContainer = document.querySelector(\"[class^='paint-editor_canvas-container']\");\r\n\r\n      // TODO: when leaving the paint editor, references to the old zoom controls are kept around by our DOM\r\n      // Need to investigate whether this leaks memory or other issues.\r\n      const oldZoomControlsContainer = paintEditorControlsContainer.querySelector(\r\n        \"[class^='paint-editor_zoom-controls']\"\r\n      );\r\n      if (oldZoomControlsContainer) {\r\n        oldZoomControlsContainer.parentNode.removeChild(oldZoomControlsContainer);\r\n      }\r\n\r\n      paintEditorControlsContainer.appendChild(zoomControlsContainer);\r\n      canvasControls.appendChild(paintEditorControlsContainer);\r\n      canvasContainer.appendChild(settingsPage);\r\n\r\n      if (!hasRunOnce) {\r\n        hasRunOnce = true;\r\n        const groupClass = zoomControlsContainer.firstChild.className;\r\n        const buttonClass = zoomControlsContainer.firstChild.firstChild.className;\r\n        const imageClass = zoomControlsContainer.firstChild.firstChild.firstChild.className;\r\n        for (const el of document.querySelectorAll(\".sa-onion-group\")) {\r\n          el.className += \" \" + groupClass;\r\n        }\r\n        for (const el of document.querySelectorAll(\".sa-onion-button\")) {\r\n          el.className += \" \" + buttonClass;\r\n        }\r\n        for (const el of document.querySelectorAll(\".sa-onion-image\")) {\r\n          el.className += \" \" + imageClass;\r\n        }\r\n      }\r\n\r\n      if (settings.enabled) {\r\n        updateOnionLayers();\r\n      }\r\n    }\r\n  };\r\n\r\n  injectPaper();\r\n  injectPaperCanvas();\r\n  controlsLoop();\r\n}\r\n","export const getHexRegex = () => /^#?[0-9a-fA-F]{3,8}$/;\r\n\r\nexport const normalizeHex = (input) => {\r\n  let hex = String(input);\r\n  if (!getHexRegex().test(hex)) return \"#000000\";\r\n  if (!hex.startsWith(\"#\")) hex = `#${hex}`;\r\n  if (hex.length === 4) {\r\n    const [_, r, g, b] = hex;\r\n    hex = `#${r}${r}${g}${g}${b}${b}`;\r\n  }\r\n  return hex.toLowerCase();\r\n};\r\n","export default class RateLimiter {\r\n  constructor(wait) {\r\n    this.timeout = null;\r\n    this.callback = null;\r\n    this.wait = wait;\r\n  }\r\n\r\n  abort(call = true) {\r\n    if (this.timeout) {\r\n      clearTimeout(this.timeout);\r\n      if (call) this.callback();\r\n      this.timeout = this.callback = null;\r\n    }\r\n  }\r\n\r\n  limit(callback) {\r\n    this.abort(false);\r\n    this.callback = callback;\r\n    this.timeout = setTimeout(() => {\r\n      this.timeout = this.callback = null;\r\n      callback();\r\n    }, this.wait);\r\n  }\r\n}\r\n","// TinyColor v1.4.2\r\n// https://github.com/bgrins/TinyColor\r\n// Brian Grinstead, MIT License\r\n// Modified to use ES6 export\r\n\r\nconst tinycolor = (function(Math) {\r\n\r\nvar trimLeft = /^\\s+/,\r\n    trimRight = /\\s+$/,\r\n    tinyCounter = 0,\r\n    mathRound = Math.round,\r\n    mathMin = Math.min,\r\n    mathMax = Math.max,\r\n    mathRandom = Math.random;\r\n\r\nfunction tinycolor (color, opts) {\r\n\r\n    color = (color) ? color : '';\r\n    opts = opts || { };\r\n\r\n    // If input is already a tinycolor, return itself\r\n    if (color instanceof tinycolor) {\r\n       return color;\r\n    }\r\n    // If we are called as a function, call using new instead\r\n    if (!(this instanceof tinycolor)) {\r\n        return new tinycolor(color, opts);\r\n    }\r\n\r\n    var rgb = inputToRGB(color);\r\n    this._originalInput = color,\r\n    this._r = rgb.r,\r\n    this._g = rgb.g,\r\n    this._b = rgb.b,\r\n    this._a = rgb.a,\r\n    this._roundA = mathRound(100*this._a) / 100,\r\n    this._format = opts.format || rgb.format;\r\n    this._gradientType = opts.gradientType;\r\n\r\n    // Don't let the range of [0,255] come back in [0,1].\r\n    // Potentially lose a little bit of precision here, but will fix issues where\r\n    // .5 gets interpreted as half of the total, instead of half of 1\r\n    // If it was supposed to be 128, this was already taken care of by `inputToRgb`\r\n    if (this._r < 1) { this._r = mathRound(this._r); }\r\n    if (this._g < 1) { this._g = mathRound(this._g); }\r\n    if (this._b < 1) { this._b = mathRound(this._b); }\r\n\r\n    this._ok = rgb.ok;\r\n    this._tc_id = tinyCounter++;\r\n}\r\n\r\ntinycolor.prototype = {\r\n    isDark: function() {\r\n        return this.getBrightness() < 128;\r\n    },\r\n    isLight: function() {\r\n        return !this.isDark();\r\n    },\r\n    isValid: function() {\r\n        return this._ok;\r\n    },\r\n    getOriginalInput: function() {\r\n      return this._originalInput;\r\n    },\r\n    getFormat: function() {\r\n        return this._format;\r\n    },\r\n    getAlpha: function() {\r\n        return this._a;\r\n    },\r\n    getBrightness: function() {\r\n        //http://www.w3.org/TR/AERT#color-contrast\r\n        var rgb = this.toRgb();\r\n        return (rgb.r * 299 + rgb.g * 587 + rgb.b * 114) / 1000;\r\n    },\r\n    getLuminance: function() {\r\n        //http://www.w3.org/TR/2008/REC-WCAG20-20081211/#relativeluminancedef\r\n        var rgb = this.toRgb();\r\n        var RsRGB, GsRGB, BsRGB, R, G, B;\r\n        RsRGB = rgb.r/255;\r\n        GsRGB = rgb.g/255;\r\n        BsRGB = rgb.b/255;\r\n\r\n        if (RsRGB <= 0.03928) {R = RsRGB / 12.92;} else {R = Math.pow(((RsRGB + 0.055) / 1.055), 2.4);}\r\n        if (GsRGB <= 0.03928) {G = GsRGB / 12.92;} else {G = Math.pow(((GsRGB + 0.055) / 1.055), 2.4);}\r\n        if (BsRGB <= 0.03928) {B = BsRGB / 12.92;} else {B = Math.pow(((BsRGB + 0.055) / 1.055), 2.4);}\r\n        return (0.2126 * R) + (0.7152 * G) + (0.0722 * B);\r\n    },\r\n    setAlpha: function(value) {\r\n        this._a = boundAlpha(value);\r\n        this._roundA = mathRound(100*this._a) / 100;\r\n        return this;\r\n    },\r\n    toHsv: function() {\r\n        var hsv = rgbToHsv(this._r, this._g, this._b);\r\n        return { h: hsv.h * 360, s: hsv.s, v: hsv.v, a: this._a };\r\n    },\r\n    toHsvString: function() {\r\n        var hsv = rgbToHsv(this._r, this._g, this._b);\r\n        var h = mathRound(hsv.h * 360), s = mathRound(hsv.s * 100), v = mathRound(hsv.v * 100);\r\n        return (this._a == 1) ?\r\n          \"hsv(\"  + h + \", \" + s + \"%, \" + v + \"%)\" :\r\n          \"hsva(\" + h + \", \" + s + \"%, \" + v + \"%, \"+ this._roundA + \")\";\r\n    },\r\n    toHsl: function() {\r\n        var hsl = rgbToHsl(this._r, this._g, this._b);\r\n        return { h: hsl.h * 360, s: hsl.s, l: hsl.l, a: this._a };\r\n    },\r\n    toHslString: function() {\r\n        var hsl = rgbToHsl(this._r, this._g, this._b);\r\n        var h = mathRound(hsl.h * 360), s = mathRound(hsl.s * 100), l = mathRound(hsl.l * 100);\r\n        return (this._a == 1) ?\r\n          \"hsl(\"  + h + \", \" + s + \"%, \" + l + \"%)\" :\r\n          \"hsla(\" + h + \", \" + s + \"%, \" + l + \"%, \"+ this._roundA + \")\";\r\n    },\r\n    toHex: function(allow3Char) {\r\n        return rgbToHex(this._r, this._g, this._b, allow3Char);\r\n    },\r\n    toHexString: function(allow3Char) {\r\n        return '#' + this.toHex(allow3Char);\r\n    },\r\n    toHex8: function(allow4Char) {\r\n        return rgbaToHex(this._r, this._g, this._b, this._a, allow4Char);\r\n    },\r\n    toHex8String: function(allow4Char) {\r\n        return '#' + this.toHex8(allow4Char);\r\n    },\r\n    toRgb: function() {\r\n        return { r: mathRound(this._r), g: mathRound(this._g), b: mathRound(this._b), a: this._a };\r\n    },\r\n    toRgbString: function() {\r\n        return (this._a == 1) ?\r\n          \"rgb(\"  + mathRound(this._r) + \", \" + mathRound(this._g) + \", \" + mathRound(this._b) + \")\" :\r\n          \"rgba(\" + mathRound(this._r) + \", \" + mathRound(this._g) + \", \" + mathRound(this._b) + \", \" + this._roundA + \")\";\r\n    },\r\n    toPercentageRgb: function() {\r\n        return { r: mathRound(bound01(this._r, 255) * 100) + \"%\", g: mathRound(bound01(this._g, 255) * 100) + \"%\", b: mathRound(bound01(this._b, 255) * 100) + \"%\", a: this._a };\r\n    },\r\n    toPercentageRgbString: function() {\r\n        return (this._a == 1) ?\r\n          \"rgb(\"  + mathRound(bound01(this._r, 255) * 100) + \"%, \" + mathRound(bound01(this._g, 255) * 100) + \"%, \" + mathRound(bound01(this._b, 255) * 100) + \"%)\" :\r\n          \"rgba(\" + mathRound(bound01(this._r, 255) * 100) + \"%, \" + mathRound(bound01(this._g, 255) * 100) + \"%, \" + mathRound(bound01(this._b, 255) * 100) + \"%, \" + this._roundA + \")\";\r\n    },\r\n    toName: function() {\r\n        if (this._a === 0) {\r\n            return \"transparent\";\r\n        }\r\n\r\n        if (this._a < 1) {\r\n            return false;\r\n        }\r\n\r\n        return hexNames[rgbToHex(this._r, this._g, this._b, true)] || false;\r\n    },\r\n    toFilter: function(secondColor) {\r\n        var hex8String = '#' + rgbaToArgbHex(this._r, this._g, this._b, this._a);\r\n        var secondHex8String = hex8String;\r\n        var gradientType = this._gradientType ? \"GradientType = 1, \" : \"\";\r\n\r\n        if (secondColor) {\r\n            var s = tinycolor(secondColor);\r\n            secondHex8String = '#' + rgbaToArgbHex(s._r, s._g, s._b, s._a);\r\n        }\r\n\r\n        return \"progid:DXImageTransform.Microsoft.gradient(\"+gradientType+\"startColorstr=\"+hex8String+\",endColorstr=\"+secondHex8String+\")\";\r\n    },\r\n    toString: function(format) {\r\n        var formatSet = !!format;\r\n        format = format || this._format;\r\n\r\n        var formattedString = false;\r\n        var hasAlpha = this._a < 1 && this._a >= 0;\r\n        var needsAlphaFormat = !formatSet && hasAlpha && (format === \"hex\" || format === \"hex6\" || format === \"hex3\" || format === \"hex4\" || format === \"hex8\" || format === \"name\");\r\n\r\n        if (needsAlphaFormat) {\r\n            // Special case for \"transparent\", all other non-alpha formats\r\n            // will return rgba when there is transparency.\r\n            if (format === \"name\" && this._a === 0) {\r\n                return this.toName();\r\n            }\r\n            return this.toRgbString();\r\n        }\r\n        if (format === \"rgb\") {\r\n            formattedString = this.toRgbString();\r\n        }\r\n        if (format === \"prgb\") {\r\n            formattedString = this.toPercentageRgbString();\r\n        }\r\n        if (format === \"hex\" || format === \"hex6\") {\r\n            formattedString = this.toHexString();\r\n        }\r\n        if (format === \"hex3\") {\r\n            formattedString = this.toHexString(true);\r\n        }\r\n        if (format === \"hex4\") {\r\n            formattedString = this.toHex8String(true);\r\n        }\r\n        if (format === \"hex8\") {\r\n            formattedString = this.toHex8String();\r\n        }\r\n        if (format === \"name\") {\r\n            formattedString = this.toName();\r\n        }\r\n        if (format === \"hsl\") {\r\n            formattedString = this.toHslString();\r\n        }\r\n        if (format === \"hsv\") {\r\n            formattedString = this.toHsvString();\r\n        }\r\n\r\n        return formattedString || this.toHexString();\r\n    },\r\n    clone: function() {\r\n        return tinycolor(this.toString());\r\n    },\r\n\r\n    _applyModification: function(fn, args) {\r\n        var color = fn.apply(null, [this].concat([].slice.call(args)));\r\n        this._r = color._r;\r\n        this._g = color._g;\r\n        this._b = color._b;\r\n        this.setAlpha(color._a);\r\n        return this;\r\n    },\r\n    lighten: function() {\r\n        return this._applyModification(lighten, arguments);\r\n    },\r\n    brighten: function() {\r\n        return this._applyModification(brighten, arguments);\r\n    },\r\n    darken: function() {\r\n        return this._applyModification(darken, arguments);\r\n    },\r\n    desaturate: function() {\r\n        return this._applyModification(desaturate, arguments);\r\n    },\r\n    saturate: function() {\r\n        return this._applyModification(saturate, arguments);\r\n    },\r\n    greyscale: function() {\r\n        return this._applyModification(greyscale, arguments);\r\n    },\r\n    spin: function() {\r\n        return this._applyModification(spin, arguments);\r\n    },\r\n\r\n    _applyCombination: function(fn, args) {\r\n        return fn.apply(null, [this].concat([].slice.call(args)));\r\n    },\r\n    analogous: function() {\r\n        return this._applyCombination(analogous, arguments);\r\n    },\r\n    complement: function() {\r\n        return this._applyCombination(complement, arguments);\r\n    },\r\n    monochromatic: function() {\r\n        return this._applyCombination(monochromatic, arguments);\r\n    },\r\n    splitcomplement: function() {\r\n        return this._applyCombination(splitcomplement, arguments);\r\n    },\r\n    triad: function() {\r\n        return this._applyCombination(triad, arguments);\r\n    },\r\n    tetrad: function() {\r\n        return this._applyCombination(tetrad, arguments);\r\n    }\r\n};\r\n\r\n// If input is an object, force 1 into \"1.0\" to handle ratios properly\r\n// String input requires \"1.0\" as input, so 1 will be treated as 1\r\ntinycolor.fromRatio = function(color, opts) {\r\n    if (typeof color == \"object\") {\r\n        var newColor = {};\r\n        for (var i in color) {\r\n            if (color.hasOwnProperty(i)) {\r\n                if (i === \"a\") {\r\n                    newColor[i] = color[i];\r\n                }\r\n                else {\r\n                    newColor[i] = convertToPercentage(color[i]);\r\n                }\r\n            }\r\n        }\r\n        color = newColor;\r\n    }\r\n\r\n    return tinycolor(color, opts);\r\n};\r\n\r\n// Given a string or object, convert that input to RGB\r\n// Possible string inputs:\r\n//\r\n//     \"red\"\r\n//     \"#f00\" or \"f00\"\r\n//     \"#ff0000\" or \"ff0000\"\r\n//     \"#ff000000\" or \"ff000000\"\r\n//     \"rgb 255 0 0\" or \"rgb (255, 0, 0)\"\r\n//     \"rgb 1.0 0 0\" or \"rgb (1, 0, 0)\"\r\n//     \"rgba (255, 0, 0, 1)\" or \"rgba 255, 0, 0, 1\"\r\n//     \"rgba (1.0, 0, 0, 1)\" or \"rgba 1.0, 0, 0, 1\"\r\n//     \"hsl(0, 100%, 50%)\" or \"hsl 0 100% 50%\"\r\n//     \"hsla(0, 100%, 50%, 1)\" or \"hsla 0 100% 50%, 1\"\r\n//     \"hsv(0, 100%, 100%)\" or \"hsv 0 100% 100%\"\r\n//\r\nfunction inputToRGB(color) {\r\n\r\n    var rgb = { r: 0, g: 0, b: 0 };\r\n    var a = 1;\r\n    var s = null;\r\n    var v = null;\r\n    var l = null;\r\n    var ok = false;\r\n    var format = false;\r\n\r\n    if (typeof color == \"string\") {\r\n        color = stringInputToObject(color);\r\n    }\r\n\r\n    if (typeof color == \"object\") {\r\n        if (isValidCSSUnit(color.r) && isValidCSSUnit(color.g) && isValidCSSUnit(color.b)) {\r\n            rgb = rgbToRgb(color.r, color.g, color.b);\r\n            ok = true;\r\n            format = String(color.r).substr(-1) === \"%\" ? \"prgb\" : \"rgb\";\r\n        }\r\n        else if (isValidCSSUnit(color.h) && isValidCSSUnit(color.s) && isValidCSSUnit(color.v)) {\r\n            s = convertToPercentage(color.s);\r\n            v = convertToPercentage(color.v);\r\n            rgb = hsvToRgb(color.h, s, v);\r\n            ok = true;\r\n            format = \"hsv\";\r\n        }\r\n        else if (isValidCSSUnit(color.h) && isValidCSSUnit(color.s) && isValidCSSUnit(color.l)) {\r\n            s = convertToPercentage(color.s);\r\n            l = convertToPercentage(color.l);\r\n            rgb = hslToRgb(color.h, s, l);\r\n            ok = true;\r\n            format = \"hsl\";\r\n        }\r\n\r\n        if (color.hasOwnProperty(\"a\")) {\r\n            a = color.a;\r\n        }\r\n    }\r\n\r\n    a = boundAlpha(a);\r\n\r\n    return {\r\n        ok: ok,\r\n        format: color.format || format,\r\n        r: mathMin(255, mathMax(rgb.r, 0)),\r\n        g: mathMin(255, mathMax(rgb.g, 0)),\r\n        b: mathMin(255, mathMax(rgb.b, 0)),\r\n        a: a\r\n    };\r\n}\r\n\r\n\r\n// Conversion Functions\r\n// --------------------\r\n\r\n// `rgbToHsl`, `rgbToHsv`, `hslToRgb`, `hsvToRgb` modified from:\r\n// <http://mjijackson.com/2008/02/rgb-to-hsl-and-rgb-to-hsv-color-model-conversion-algorithms-in-javascript>\r\n\r\n// `rgbToRgb`\r\n// Handle bounds / percentage checking to conform to CSS color spec\r\n// <http://www.w3.org/TR/css3-color/>\r\n// *Assumes:* r, g, b in [0, 255] or [0, 1]\r\n// *Returns:* { r, g, b } in [0, 255]\r\nfunction rgbToRgb(r, g, b){\r\n    return {\r\n        r: bound01(r, 255) * 255,\r\n        g: bound01(g, 255) * 255,\r\n        b: bound01(b, 255) * 255\r\n    };\r\n}\r\n\r\n// `rgbToHsl`\r\n// Converts an RGB color value to HSL.\r\n// *Assumes:* r, g, and b are contained in [0, 255] or [0, 1]\r\n// *Returns:* { h, s, l } in [0,1]\r\nfunction rgbToHsl(r, g, b) {\r\n\r\n    r = bound01(r, 255);\r\n    g = bound01(g, 255);\r\n    b = bound01(b, 255);\r\n\r\n    var max = mathMax(r, g, b), min = mathMin(r, g, b);\r\n    var h, s, l = (max + min) / 2;\r\n\r\n    if(max == min) {\r\n        h = s = 0; // achromatic\r\n    }\r\n    else {\r\n        var d = max - min;\r\n        s = l > 0.5 ? d / (2 - max - min) : d / (max + min);\r\n        switch(max) {\r\n            case r: h = (g - b) / d + (g < b ? 6 : 0); break;\r\n            case g: h = (b - r) / d + 2; break;\r\n            case b: h = (r - g) / d + 4; break;\r\n        }\r\n\r\n        h /= 6;\r\n    }\r\n\r\n    return { h: h, s: s, l: l };\r\n}\r\n\r\n// `hslToRgb`\r\n// Converts an HSL color value to RGB.\r\n// *Assumes:* h is contained in [0, 1] or [0, 360] and s and l are contained [0, 1] or [0, 100]\r\n// *Returns:* { r, g, b } in the set [0, 255]\r\nfunction hslToRgb(h, s, l) {\r\n    var r, g, b;\r\n\r\n    h = bound01(h, 360);\r\n    s = bound01(s, 100);\r\n    l = bound01(l, 100);\r\n\r\n    function hue2rgb(p, q, t) {\r\n        if(t < 0) t += 1;\r\n        if(t > 1) t -= 1;\r\n        if(t < 1/6) return p + (q - p) * 6 * t;\r\n        if(t < 1/2) return q;\r\n        if(t < 2/3) return p + (q - p) * (2/3 - t) * 6;\r\n        return p;\r\n    }\r\n\r\n    if(s === 0) {\r\n        r = g = b = l; // achromatic\r\n    }\r\n    else {\r\n        var q = l < 0.5 ? l * (1 + s) : l + s - l * s;\r\n        var p = 2 * l - q;\r\n        r = hue2rgb(p, q, h + 1/3);\r\n        g = hue2rgb(p, q, h);\r\n        b = hue2rgb(p, q, h - 1/3);\r\n    }\r\n\r\n    return { r: r * 255, g: g * 255, b: b * 255 };\r\n}\r\n\r\n// `rgbToHsv`\r\n// Converts an RGB color value to HSV\r\n// *Assumes:* r, g, and b are contained in the set [0, 255] or [0, 1]\r\n// *Returns:* { h, s, v } in [0,1]\r\nfunction rgbToHsv(r, g, b) {\r\n\r\n    r = bound01(r, 255);\r\n    g = bound01(g, 255);\r\n    b = bound01(b, 255);\r\n\r\n    var max = mathMax(r, g, b), min = mathMin(r, g, b);\r\n    var h, s, v = max;\r\n\r\n    var d = max - min;\r\n    s = max === 0 ? 0 : d / max;\r\n\r\n    if(max == min) {\r\n        h = 0; // achromatic\r\n    }\r\n    else {\r\n        switch(max) {\r\n            case r: h = (g - b) / d + (g < b ? 6 : 0); break;\r\n            case g: h = (b - r) / d + 2; break;\r\n            case b: h = (r - g) / d + 4; break;\r\n        }\r\n        h /= 6;\r\n    }\r\n    return { h: h, s: s, v: v };\r\n}\r\n\r\n// `hsvToRgb`\r\n// Converts an HSV color value to RGB.\r\n// *Assumes:* h is contained in [0, 1] or [0, 360] and s and v are contained in [0, 1] or [0, 100]\r\n// *Returns:* { r, g, b } in the set [0, 255]\r\n function hsvToRgb(h, s, v) {\r\n\r\n    h = bound01(h, 360) * 6;\r\n    s = bound01(s, 100);\r\n    v = bound01(v, 100);\r\n\r\n    var i = Math.floor(h),\r\n        f = h - i,\r\n        p = v * (1 - s),\r\n        q = v * (1 - f * s),\r\n        t = v * (1 - (1 - f) * s),\r\n        mod = i % 6,\r\n        r = [v, q, p, p, t, v][mod],\r\n        g = [t, v, v, q, p, p][mod],\r\n        b = [p, p, t, v, v, q][mod];\r\n\r\n    return { r: r * 255, g: g * 255, b: b * 255 };\r\n}\r\n\r\n// `rgbToHex`\r\n// Converts an RGB color to hex\r\n// Assumes r, g, and b are contained in the set [0, 255]\r\n// Returns a 3 or 6 character hex\r\nfunction rgbToHex(r, g, b, allow3Char) {\r\n\r\n    var hex = [\r\n        pad2(mathRound(r).toString(16)),\r\n        pad2(mathRound(g).toString(16)),\r\n        pad2(mathRound(b).toString(16))\r\n    ];\r\n\r\n    // Return a 3 character hex if possible\r\n    if (allow3Char && hex[0].charAt(0) == hex[0].charAt(1) && hex[1].charAt(0) == hex[1].charAt(1) && hex[2].charAt(0) == hex[2].charAt(1)) {\r\n        return hex[0].charAt(0) + hex[1].charAt(0) + hex[2].charAt(0);\r\n    }\r\n\r\n    return hex.join(\"\");\r\n}\r\n\r\n// `rgbaToHex`\r\n// Converts an RGBA color plus alpha transparency to hex\r\n// Assumes r, g, b are contained in the set [0, 255] and\r\n// a in [0, 1]. Returns a 4 or 8 character rgba hex\r\nfunction rgbaToHex(r, g, b, a, allow4Char) {\r\n\r\n    var hex = [\r\n        pad2(mathRound(r).toString(16)),\r\n        pad2(mathRound(g).toString(16)),\r\n        pad2(mathRound(b).toString(16)),\r\n        pad2(convertDecimalToHex(a))\r\n    ];\r\n\r\n    // Return a 4 character hex if possible\r\n    if (allow4Char && hex[0].charAt(0) == hex[0].charAt(1) && hex[1].charAt(0) == hex[1].charAt(1) && hex[2].charAt(0) == hex[2].charAt(1) && hex[3].charAt(0) == hex[3].charAt(1)) {\r\n        return hex[0].charAt(0) + hex[1].charAt(0) + hex[2].charAt(0) + hex[3].charAt(0);\r\n    }\r\n\r\n    return hex.join(\"\");\r\n}\r\n\r\n// `rgbaToArgbHex`\r\n// Converts an RGBA color to an ARGB Hex8 string\r\n// Rarely used, but required for \"toFilter()\"\r\nfunction rgbaToArgbHex(r, g, b, a) {\r\n\r\n    var hex = [\r\n        pad2(convertDecimalToHex(a)),\r\n        pad2(mathRound(r).toString(16)),\r\n        pad2(mathRound(g).toString(16)),\r\n        pad2(mathRound(b).toString(16))\r\n    ];\r\n\r\n    return hex.join(\"\");\r\n}\r\n\r\n// `equals`\r\n// Can be called with any tinycolor input\r\ntinycolor.equals = function (color1, color2) {\r\n    if (!color1 || !color2) { return false; }\r\n    return tinycolor(color1).toRgbString() == tinycolor(color2).toRgbString();\r\n};\r\n\r\ntinycolor.random = function() {\r\n    return tinycolor.fromRatio({\r\n        r: mathRandom(),\r\n        g: mathRandom(),\r\n        b: mathRandom()\r\n    });\r\n};\r\n\r\n\r\n// Modification Functions\r\n// ----------------------\r\n// Thanks to less.js for some of the basics here\r\n// <https://github.com/cloudhead/less.js/blob/master/lib/less/functions.js>\r\n\r\nfunction desaturate(color, amount) {\r\n    amount = (amount === 0) ? 0 : (amount || 10);\r\n    var hsl = tinycolor(color).toHsl();\r\n    hsl.s -= amount / 100;\r\n    hsl.s = clamp01(hsl.s);\r\n    return tinycolor(hsl);\r\n}\r\n\r\nfunction saturate(color, amount) {\r\n    amount = (amount === 0) ? 0 : (amount || 10);\r\n    var hsl = tinycolor(color).toHsl();\r\n    hsl.s += amount / 100;\r\n    hsl.s = clamp01(hsl.s);\r\n    return tinycolor(hsl);\r\n}\r\n\r\nfunction greyscale(color) {\r\n    return tinycolor(color).desaturate(100);\r\n}\r\n\r\nfunction lighten (color, amount) {\r\n    amount = (amount === 0) ? 0 : (amount || 10);\r\n    var hsl = tinycolor(color).toHsl();\r\n    hsl.l += amount / 100;\r\n    hsl.l = clamp01(hsl.l);\r\n    return tinycolor(hsl);\r\n}\r\n\r\nfunction brighten(color, amount) {\r\n    amount = (amount === 0) ? 0 : (amount || 10);\r\n    var rgb = tinycolor(color).toRgb();\r\n    rgb.r = mathMax(0, mathMin(255, rgb.r - mathRound(255 * - (amount / 100))));\r\n    rgb.g = mathMax(0, mathMin(255, rgb.g - mathRound(255 * - (amount / 100))));\r\n    rgb.b = mathMax(0, mathMin(255, rgb.b - mathRound(255 * - (amount / 100))));\r\n    return tinycolor(rgb);\r\n}\r\n\r\nfunction darken (color, amount) {\r\n    amount = (amount === 0) ? 0 : (amount || 10);\r\n    var hsl = tinycolor(color).toHsl();\r\n    hsl.l -= amount / 100;\r\n    hsl.l = clamp01(hsl.l);\r\n    return tinycolor(hsl);\r\n}\r\n\r\n// Spin takes a positive or negative amount within [-360, 360] indicating the change of hue.\r\n// Values outside of this range will be wrapped into this range.\r\nfunction spin(color, amount) {\r\n    var hsl = tinycolor(color).toHsl();\r\n    var hue = (hsl.h + amount) % 360;\r\n    hsl.h = hue < 0 ? 360 + hue : hue;\r\n    return tinycolor(hsl);\r\n}\r\n\r\n// Combination Functions\r\n// ---------------------\r\n// Thanks to jQuery xColor for some of the ideas behind these\r\n// <https://github.com/infusion/jQuery-xcolor/blob/master/jquery.xcolor.js>\r\n\r\nfunction complement(color) {\r\n    var hsl = tinycolor(color).toHsl();\r\n    hsl.h = (hsl.h + 180) % 360;\r\n    return tinycolor(hsl);\r\n}\r\n\r\nfunction triad(color) {\r\n    var hsl = tinycolor(color).toHsl();\r\n    var h = hsl.h;\r\n    return [\r\n        tinycolor(color),\r\n        tinycolor({ h: (h + 120) % 360, s: hsl.s, l: hsl.l }),\r\n        tinycolor({ h: (h + 240) % 360, s: hsl.s, l: hsl.l })\r\n    ];\r\n}\r\n\r\nfunction tetrad(color) {\r\n    var hsl = tinycolor(color).toHsl();\r\n    var h = hsl.h;\r\n    return [\r\n        tinycolor(color),\r\n        tinycolor({ h: (h + 90) % 360, s: hsl.s, l: hsl.l }),\r\n        tinycolor({ h: (h + 180) % 360, s: hsl.s, l: hsl.l }),\r\n        tinycolor({ h: (h + 270) % 360, s: hsl.s, l: hsl.l })\r\n    ];\r\n}\r\n\r\nfunction splitcomplement(color) {\r\n    var hsl = tinycolor(color).toHsl();\r\n    var h = hsl.h;\r\n    return [\r\n        tinycolor(color),\r\n        tinycolor({ h: (h + 72) % 360, s: hsl.s, l: hsl.l}),\r\n        tinycolor({ h: (h + 216) % 360, s: hsl.s, l: hsl.l})\r\n    ];\r\n}\r\n\r\nfunction analogous(color, results, slices) {\r\n    results = results || 6;\r\n    slices = slices || 30;\r\n\r\n    var hsl = tinycolor(color).toHsl();\r\n    var part = 360 / slices;\r\n    var ret = [tinycolor(color)];\r\n\r\n    for (hsl.h = ((hsl.h - (part * results >> 1)) + 720) % 360; --results; ) {\r\n        hsl.h = (hsl.h + part) % 360;\r\n        ret.push(tinycolor(hsl));\r\n    }\r\n    return ret;\r\n}\r\n\r\nfunction monochromatic(color, results) {\r\n    results = results || 6;\r\n    var hsv = tinycolor(color).toHsv();\r\n    var h = hsv.h, s = hsv.s, v = hsv.v;\r\n    var ret = [];\r\n    var modification = 1 / results;\r\n\r\n    while (results--) {\r\n        ret.push(tinycolor({ h: h, s: s, v: v}));\r\n        v = (v + modification) % 1;\r\n    }\r\n\r\n    return ret;\r\n}\r\n\r\n// Utility Functions\r\n// ---------------------\r\n\r\ntinycolor.mix = function(color1, color2, amount) {\r\n    amount = (amount === 0) ? 0 : (amount || 50);\r\n\r\n    var rgb1 = tinycolor(color1).toRgb();\r\n    var rgb2 = tinycolor(color2).toRgb();\r\n\r\n    var p = amount / 100;\r\n\r\n    var rgba = {\r\n        r: ((rgb2.r - rgb1.r) * p) + rgb1.r,\r\n        g: ((rgb2.g - rgb1.g) * p) + rgb1.g,\r\n        b: ((rgb2.b - rgb1.b) * p) + rgb1.b,\r\n        a: ((rgb2.a - rgb1.a) * p) + rgb1.a\r\n    };\r\n\r\n    return tinycolor(rgba);\r\n};\r\n\r\n\r\n// Readability Functions\r\n// ---------------------\r\n// <http://www.w3.org/TR/2008/REC-WCAG20-20081211/#contrast-ratiodef (WCAG Version 2)\r\n\r\n// `contrast`\r\n// Analyze the 2 colors and returns the color contrast defined by (WCAG Version 2)\r\ntinycolor.readability = function(color1, color2) {\r\n    var c1 = tinycolor(color1);\r\n    var c2 = tinycolor(color2);\r\n    return (Math.max(c1.getLuminance(),c2.getLuminance())+0.05) / (Math.min(c1.getLuminance(),c2.getLuminance())+0.05);\r\n};\r\n\r\n// `isReadable`\r\n// Ensure that foreground and background color combinations meet WCAG2 guidelines.\r\n// The third argument is an optional Object.\r\n//      the 'level' property states 'AA' or 'AAA' - if missing or invalid, it defaults to 'AA';\r\n//      the 'size' property states 'large' or 'small' - if missing or invalid, it defaults to 'small'.\r\n// If the entire object is absent, isReadable defaults to {level:\"AA\",size:\"small\"}.\r\n\r\n// *Example*\r\n//    tinycolor.isReadable(\"#000\", \"#111\") => false\r\n//    tinycolor.isReadable(\"#000\", \"#111\",{level:\"AA\",size:\"large\"}) => false\r\ntinycolor.isReadable = function(color1, color2, wcag2) {\r\n    var readability = tinycolor.readability(color1, color2);\r\n    var wcag2Parms, out;\r\n\r\n    out = false;\r\n\r\n    wcag2Parms = validateWCAG2Parms(wcag2);\r\n    switch (wcag2Parms.level + wcag2Parms.size) {\r\n        case \"AAsmall\":\r\n        case \"AAAlarge\":\r\n            out = readability >= 4.5;\r\n            break;\r\n        case \"AAlarge\":\r\n            out = readability >= 3;\r\n            break;\r\n        case \"AAAsmall\":\r\n            out = readability >= 7;\r\n            break;\r\n    }\r\n    return out;\r\n\r\n};\r\n\r\n// `mostReadable`\r\n// Given a base color and a list of possible foreground or background\r\n// colors for that base, returns the most readable color.\r\n// Optionally returns Black or White if the most readable color is unreadable.\r\n// *Example*\r\n//    tinycolor.mostReadable(tinycolor.mostReadable(\"#123\", [\"#124\", \"#125\"],{includeFallbackColors:false}).toHexString(); // \"#112255\"\r\n//    tinycolor.mostReadable(tinycolor.mostReadable(\"#123\", [\"#124\", \"#125\"],{includeFallbackColors:true}).toHexString();  // \"#ffffff\"\r\n//    tinycolor.mostReadable(\"#a8015a\", [\"#faf3f3\"],{includeFallbackColors:true,level:\"AAA\",size:\"large\"}).toHexString(); // \"#faf3f3\"\r\n//    tinycolor.mostReadable(\"#a8015a\", [\"#faf3f3\"],{includeFallbackColors:true,level:\"AAA\",size:\"small\"}).toHexString(); // \"#ffffff\"\r\ntinycolor.mostReadable = function(baseColor, colorList, args) {\r\n    var bestColor = null;\r\n    var bestScore = 0;\r\n    var readability;\r\n    var includeFallbackColors, level, size ;\r\n    args = args || {};\r\n    includeFallbackColors = args.includeFallbackColors ;\r\n    level = args.level;\r\n    size = args.size;\r\n\r\n    for (var i= 0; i < colorList.length ; i++) {\r\n        readability = tinycolor.readability(baseColor, colorList[i]);\r\n        if (readability > bestScore) {\r\n            bestScore = readability;\r\n            bestColor = tinycolor(colorList[i]);\r\n        }\r\n    }\r\n\r\n    if (tinycolor.isReadable(baseColor, bestColor, {\"level\":level,\"size\":size}) || !includeFallbackColors) {\r\n        return bestColor;\r\n    }\r\n    else {\r\n        args.includeFallbackColors=false;\r\n        return tinycolor.mostReadable(baseColor,[\"#fff\", \"#000\"],args);\r\n    }\r\n};\r\n\r\n\r\n// Big List of Colors\r\n// ------------------\r\n// <http://www.w3.org/TR/css3-color/#svg-color>\r\nvar names = tinycolor.names = {\r\n    aliceblue: \"f0f8ff\",\r\n    antiquewhite: \"faebd7\",\r\n    aqua: \"0ff\",\r\n    aquamarine: \"7fffd4\",\r\n    azure: \"f0ffff\",\r\n    beige: \"f5f5dc\",\r\n    bisque: \"ffe4c4\",\r\n    black: \"000\",\r\n    blanchedalmond: \"ffebcd\",\r\n    blue: \"00f\",\r\n    blueviolet: \"8a2be2\",\r\n    brown: \"a52a2a\",\r\n    burlywood: \"deb887\",\r\n    burntsienna: \"ea7e5d\",\r\n    cadetblue: \"5f9ea0\",\r\n    chartreuse: \"7fff00\",\r\n    chocolate: \"d2691e\",\r\n    coral: \"ff7f50\",\r\n    cornflowerblue: \"6495ed\",\r\n    cornsilk: \"fff8dc\",\r\n    crimson: \"dc143c\",\r\n    cyan: \"0ff\",\r\n    darkblue: \"00008b\",\r\n    darkcyan: \"008b8b\",\r\n    darkgoldenrod: \"b8860b\",\r\n    darkgray: \"a9a9a9\",\r\n    darkgreen: \"006400\",\r\n    darkgrey: \"a9a9a9\",\r\n    darkkhaki: \"bdb76b\",\r\n    darkmagenta: \"8b008b\",\r\n    darkolivegreen: \"556b2f\",\r\n    darkorange: \"ff8c00\",\r\n    darkorchid: \"9932cc\",\r\n    darkred: \"8b0000\",\r\n    darksalmon: \"e9967a\",\r\n    darkseagreen: \"8fbc8f\",\r\n    darkslateblue: \"483d8b\",\r\n    darkslategray: \"2f4f4f\",\r\n    darkslategrey: \"2f4f4f\",\r\n    darkturquoise: \"00ced1\",\r\n    darkviolet: \"9400d3\",\r\n    deeppink: \"ff1493\",\r\n    deepskyblue: \"00bfff\",\r\n    dimgray: \"696969\",\r\n    dimgrey: \"696969\",\r\n    dodgerblue: \"1e90ff\",\r\n    firebrick: \"b22222\",\r\n    floralwhite: \"fffaf0\",\r\n    forestgreen: \"228b22\",\r\n    fuchsia: \"f0f\",\r\n    gainsboro: \"dcdcdc\",\r\n    ghostwhite: \"f8f8ff\",\r\n    gold: \"ffd700\",\r\n    goldenrod: \"daa520\",\r\n    gray: \"808080\",\r\n    green: \"008000\",\r\n    greenyellow: \"adff2f\",\r\n    grey: \"808080\",\r\n    honeydew: \"f0fff0\",\r\n    hotpink: \"ff69b4\",\r\n    indianred: \"cd5c5c\",\r\n    indigo: \"4b0082\",\r\n    ivory: \"fffff0\",\r\n    khaki: \"f0e68c\",\r\n    lavender: \"e6e6fa\",\r\n    lavenderblush: \"fff0f5\",\r\n    lawngreen: \"7cfc00\",\r\n    lemonchiffon: \"fffacd\",\r\n    lightblue: \"add8e6\",\r\n    lightcoral: \"f08080\",\r\n    lightcyan: \"e0ffff\",\r\n    lightgoldenrodyellow: \"fafad2\",\r\n    lightgray: \"d3d3d3\",\r\n    lightgreen: \"90ee90\",\r\n    lightgrey: \"d3d3d3\",\r\n    lightpink: \"ffb6c1\",\r\n    lightsalmon: \"ffa07a\",\r\n    lightseagreen: \"20b2aa\",\r\n    lightskyblue: \"87cefa\",\r\n    lightslategray: \"789\",\r\n    lightslategrey: \"789\",\r\n    lightsteelblue: \"b0c4de\",\r\n    lightyellow: \"ffffe0\",\r\n    lime: \"0f0\",\r\n    limegreen: \"32cd32\",\r\n    linen: \"faf0e6\",\r\n    magenta: \"f0f\",\r\n    maroon: \"800000\",\r\n    mediumaquamarine: \"66cdaa\",\r\n    mediumblue: \"0000cd\",\r\n    mediumorchid: \"ba55d3\",\r\n    mediumpurple: \"9370db\",\r\n    mediumseagreen: \"3cb371\",\r\n    mediumslateblue: \"7b68ee\",\r\n    mediumspringgreen: \"00fa9a\",\r\n    mediumturquoise: \"48d1cc\",\r\n    mediumvioletred: \"c71585\",\r\n    midnightblue: \"191970\",\r\n    mintcream: \"f5fffa\",\r\n    mistyrose: \"ffe4e1\",\r\n    moccasin: \"ffe4b5\",\r\n    navajowhite: \"ffdead\",\r\n    navy: \"000080\",\r\n    oldlace: \"fdf5e6\",\r\n    olive: \"808000\",\r\n    olivedrab: \"6b8e23\",\r\n    orange: \"ffa500\",\r\n    orangered: \"ff4500\",\r\n    orchid: \"da70d6\",\r\n    palegoldenrod: \"eee8aa\",\r\n    palegreen: \"98fb98\",\r\n    paleturquoise: \"afeeee\",\r\n    palevioletred: \"db7093\",\r\n    papayawhip: \"ffefd5\",\r\n    peachpuff: \"ffdab9\",\r\n    peru: \"cd853f\",\r\n    pink: \"ffc0cb\",\r\n    plum: \"dda0dd\",\r\n    powderblue: \"b0e0e6\",\r\n    purple: \"800080\",\r\n    rebeccapurple: \"663399\",\r\n    red: \"f00\",\r\n    rosybrown: \"bc8f8f\",\r\n    royalblue: \"4169e1\",\r\n    saddlebrown: \"8b4513\",\r\n    salmon: \"fa8072\",\r\n    sandybrown: \"f4a460\",\r\n    seagreen: \"2e8b57\",\r\n    seashell: \"fff5ee\",\r\n    sienna: \"a0522d\",\r\n    silver: \"c0c0c0\",\r\n    skyblue: \"87ceeb\",\r\n    slateblue: \"6a5acd\",\r\n    slategray: \"708090\",\r\n    slategrey: \"708090\",\r\n    snow: \"fffafa\",\r\n    springgreen: \"00ff7f\",\r\n    steelblue: \"4682b4\",\r\n    tan: \"d2b48c\",\r\n    teal: \"008080\",\r\n    thistle: \"d8bfd8\",\r\n    tomato: \"ff6347\",\r\n    turquoise: \"40e0d0\",\r\n    violet: \"ee82ee\",\r\n    wheat: \"f5deb3\",\r\n    white: \"fff\",\r\n    whitesmoke: \"f5f5f5\",\r\n    yellow: \"ff0\",\r\n    yellowgreen: \"9acd32\"\r\n};\r\n\r\n// Make it easy to access colors via `hexNames[hex]`\r\nvar hexNames = tinycolor.hexNames = flip(names);\r\n\r\n\r\n// Utilities\r\n// ---------\r\n\r\n// `{ 'name1': 'val1' }` becomes `{ 'val1': 'name1' }`\r\nfunction flip(o) {\r\n    var flipped = { };\r\n    for (var i in o) {\r\n        if (o.hasOwnProperty(i)) {\r\n            flipped[o[i]] = i;\r\n        }\r\n    }\r\n    return flipped;\r\n}\r\n\r\n// Return a valid alpha value [0,1] with all invalid values being set to 1\r\nfunction boundAlpha(a) {\r\n    a = parseFloat(a);\r\n\r\n    if (isNaN(a) || a < 0 || a > 1) {\r\n        a = 1;\r\n    }\r\n\r\n    return a;\r\n}\r\n\r\n// Take input from [0, n] and return it as [0, 1]\r\nfunction bound01(n, max) {\r\n    if (isOnePointZero(n)) { n = \"100%\"; }\r\n\r\n    var processPercent = isPercentage(n);\r\n    n = mathMin(max, mathMax(0, parseFloat(n)));\r\n\r\n    // Automatically convert percentage into number\r\n    if (processPercent) {\r\n        n = parseInt(n * max, 10) / 100;\r\n    }\r\n\r\n    // Handle floating point rounding errors\r\n    if ((Math.abs(n - max) < 0.000001)) {\r\n        return 1;\r\n    }\r\n\r\n    // Convert into [0, 1] range if it isn't already\r\n    return (n % max) / parseFloat(max);\r\n}\r\n\r\n// Force a number between 0 and 1\r\nfunction clamp01(val) {\r\n    return mathMin(1, mathMax(0, val));\r\n}\r\n\r\n// Parse a base-16 hex value into a base-10 integer\r\nfunction parseIntFromHex(val) {\r\n    return parseInt(val, 16);\r\n}\r\n\r\n// Need to handle 1.0 as 100%, since once it is a number, there is no difference between it and 1\r\n// <http://stackoverflow.com/questions/7422072/javascript-how-to-detect-number-as-a-decimal-including-1-0>\r\nfunction isOnePointZero(n) {\r\n    return typeof n == \"string\" && n.indexOf('.') != -1 && parseFloat(n) === 1;\r\n}\r\n\r\n// Check to see if string passed in is a percentage\r\nfunction isPercentage(n) {\r\n    return typeof n === \"string\" && n.indexOf('%') != -1;\r\n}\r\n\r\n// Force a hex value to have 2 characters\r\nfunction pad2(c) {\r\n    return c.length == 1 ? '0' + c : '' + c;\r\n}\r\n\r\n// Replace a decimal with it's percentage value\r\nfunction convertToPercentage(n) {\r\n    if (n <= 1) {\r\n        n = (n * 100) + \"%\";\r\n    }\r\n\r\n    return n;\r\n}\r\n\r\n// Converts a decimal to a hex value\r\nfunction convertDecimalToHex(d) {\r\n    return Math.round(parseFloat(d) * 255).toString(16);\r\n}\r\n// Converts a hex value to a decimal\r\nfunction convertHexToDecimal(h) {\r\n    return (parseIntFromHex(h) / 255);\r\n}\r\n\r\nvar matchers = (function() {\r\n\r\n    // <http://www.w3.org/TR/css3-values/#integers>\r\n    var CSS_INTEGER = \"[-\\\\+]?\\\\d+%?\";\r\n\r\n    // <http://www.w3.org/TR/css3-values/#number-value>\r\n    var CSS_NUMBER = \"[-\\\\+]?\\\\d*\\\\.\\\\d+%?\";\r\n\r\n    // Allow positive/negative integer/number.  Don't capture the either/or, just the entire outcome.\r\n    var CSS_UNIT = \"(?:\" + CSS_NUMBER + \")|(?:\" + CSS_INTEGER + \")\";\r\n\r\n    // Actual matching.\r\n    // Parentheses and commas are optional, but not required.\r\n    // Whitespace can take the place of commas or opening paren\r\n    var PERMISSIVE_MATCH3 = \"[\\\\s|\\\\(]+(\" + CSS_UNIT + \")[,|\\\\s]+(\" + CSS_UNIT + \")[,|\\\\s]+(\" + CSS_UNIT + \")\\\\s*\\\\)?\";\r\n    var PERMISSIVE_MATCH4 = \"[\\\\s|\\\\(]+(\" + CSS_UNIT + \")[,|\\\\s]+(\" + CSS_UNIT + \")[,|\\\\s]+(\" + CSS_UNIT + \")[,|\\\\s]+(\" + CSS_UNIT + \")\\\\s*\\\\)?\";\r\n\r\n    return {\r\n        CSS_UNIT: new RegExp(CSS_UNIT),\r\n        rgb: new RegExp(\"rgb\" + PERMISSIVE_MATCH3),\r\n        rgba: new RegExp(\"rgba\" + PERMISSIVE_MATCH4),\r\n        hsl: new RegExp(\"hsl\" + PERMISSIVE_MATCH3),\r\n        hsla: new RegExp(\"hsla\" + PERMISSIVE_MATCH4),\r\n        hsv: new RegExp(\"hsv\" + PERMISSIVE_MATCH3),\r\n        hsva: new RegExp(\"hsva\" + PERMISSIVE_MATCH4),\r\n        hex3: /^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,\r\n        hex6: /^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/,\r\n        hex4: /^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,\r\n        hex8: /^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/\r\n    };\r\n})();\r\n\r\n// `isValidCSSUnit`\r\n// Take in a single string / number and check to see if it looks like a CSS unit\r\n// (see `matchers` above for definition).\r\nfunction isValidCSSUnit(color) {\r\n    return !!matchers.CSS_UNIT.exec(color);\r\n}\r\n\r\n// `stringInputToObject`\r\n// Permissive string parsing.  Take in a number of formats, and output an object\r\n// based on detected format.  Returns `{ r, g, b }` or `{ h, s, l }` or `{ h, s, v}`\r\nfunction stringInputToObject(color) {\r\n\r\n    color = color.replace(trimLeft,'').replace(trimRight, '').toLowerCase();\r\n    var named = false;\r\n    if (names[color]) {\r\n        color = names[color];\r\n        named = true;\r\n    }\r\n    else if (color == 'transparent') {\r\n        return { r: 0, g: 0, b: 0, a: 0, format: \"name\" };\r\n    }\r\n\r\n    // Try to match string input using regular expressions.\r\n    // Keep most of the number bounding out of this function - don't worry about [0,1] or [0,100] or [0,360]\r\n    // Just return an object and let the conversion functions handle that.\r\n    // This way the result will be the same whether the tinycolor is initialized with string or object.\r\n    var match;\r\n    if ((match = matchers.rgb.exec(color))) {\r\n        return { r: match[1], g: match[2], b: match[3] };\r\n    }\r\n    if ((match = matchers.rgba.exec(color))) {\r\n        return { r: match[1], g: match[2], b: match[3], a: match[4] };\r\n    }\r\n    if ((match = matchers.hsl.exec(color))) {\r\n        return { h: match[1], s: match[2], l: match[3] };\r\n    }\r\n    if ((match = matchers.hsla.exec(color))) {\r\n        return { h: match[1], s: match[2], l: match[3], a: match[4] };\r\n    }\r\n    if ((match = matchers.hsv.exec(color))) {\r\n        return { h: match[1], s: match[2], v: match[3] };\r\n    }\r\n    if ((match = matchers.hsva.exec(color))) {\r\n        return { h: match[1], s: match[2], v: match[3], a: match[4] };\r\n    }\r\n    if ((match = matchers.hex8.exec(color))) {\r\n        return {\r\n            r: parseIntFromHex(match[1]),\r\n            g: parseIntFromHex(match[2]),\r\n            b: parseIntFromHex(match[3]),\r\n            a: convertHexToDecimal(match[4]),\r\n            format: named ? \"name\" : \"hex8\"\r\n        };\r\n    }\r\n    if ((match = matchers.hex6.exec(color))) {\r\n        return {\r\n            r: parseIntFromHex(match[1]),\r\n            g: parseIntFromHex(match[2]),\r\n            b: parseIntFromHex(match[3]),\r\n            format: named ? \"name\" : \"hex\"\r\n        };\r\n    }\r\n    if ((match = matchers.hex4.exec(color))) {\r\n        return {\r\n            r: parseIntFromHex(match[1] + '' + match[1]),\r\n            g: parseIntFromHex(match[2] + '' + match[2]),\r\n            b: parseIntFromHex(match[3] + '' + match[3]),\r\n            a: convertHexToDecimal(match[4] + '' + match[4]),\r\n            format: named ? \"name\" : \"hex8\"\r\n        };\r\n    }\r\n    if ((match = matchers.hex3.exec(color))) {\r\n        return {\r\n            r: parseIntFromHex(match[1] + '' + match[1]),\r\n            g: parseIntFromHex(match[2] + '' + match[2]),\r\n            b: parseIntFromHex(match[3] + '' + match[3]),\r\n            format: named ? \"name\" : \"hex\"\r\n        };\r\n    }\r\n\r\n    return false;\r\n}\r\n\r\nfunction validateWCAG2Parms(parms) {\r\n    // return valid WCAG2 parms for isReadable.\r\n    // If input parms are invalid, return {\"level\":\"AA\", \"size\":\"small\"}\r\n    var level, size;\r\n    parms = parms || {\"level\":\"AA\", \"size\":\"small\"};\r\n    level = (parms.level || \"AA\").toUpperCase();\r\n    size = (parms.size || \"small\").toLowerCase();\r\n    if (level !== \"AA\" && level !== \"AAA\") {\r\n        level = \"AA\";\r\n    }\r\n    if (size !== \"small\" && size !== \"large\") {\r\n        size = \"small\";\r\n    }\r\n    return {\"level\":level, \"size\":size};\r\n}\r\n\r\n/*// Node: Export function\r\nif (typeof module !== \"undefined\" && module.exports) {\r\n    module.exports = tinycolor;\r\n}\r\n// AMD/requirejs: Define the module\r\nelse if (typeof define === 'function' && define.amd) {\r\n    define(function () {return tinycolor;});\r\n}\r\n// Browser: Expose to window\r\nelse {\r\n    window.tinycolor = tinycolor;\r\n}*/\r\n\r\nreturn tinycolor;\r\n\r\n})(Math);\r\n\r\nexport default tinycolor;\r\n"],"mappings":";;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;ACPA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;ACPA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;ACPA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;ACPA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;ACPA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACPA;AAAA;;;;;;;;;;;;ACAA;AAAA;;;;;;;;;;;;ACAA;AAAA;;;;;;;;;;;;ACAA;AAAA;;;;;;;;;;;;ACAA;AAAA;;;;;;;;;;;;ACAA;AAAA;;;;;;;;;;;;ACAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AADA;;;;;;;;;;;;ACFA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAIA;AACA;;;;;;;;;;;;AClBA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AADA;;;;;;;;;;;;ACFA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAEA;AACA;AAGA;AACA;AAEA;AADA;AACA;AAKA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAEA;AACA;AAAA;AAEA;AACA;AACA;AAhBA;AAAA;AAAA;AACA;AAeA;AACA;AACA;;;;;;;;;;;;AClCA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AADA;;;;;;;;;;;;ACFA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AAOA;AACA;AACA;AACA;AACA;AAAA;AAEA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAxCA;AAAA;AAAA;AACA;AAuCA;AACA;AACA;;;;;;;;;;;;AC9CA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AADA;;;;;;;;;;;;ACFA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AAAA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AADA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AAAA;AACA;AAEA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;AC9PA;AAAA;AAAA;AAEA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AAEA;AACA;AACA;AACA;AADA;AACA;AAGA;AACA;AACA;AACA;AACA;AACA;AAGA;AADA;AAIA;AAEA;AADA;AAKA;AAGA;AACA;AAAA;AAAA;AAFA;AAKA;AACA;AAAA;AAAA;AAFA;AAKA;AACA;AAAA;AAAA;AAFA;AAKA;AAEA;AACA;AAAA;AAAA;AAFA;AAMA;AACA;AAAA;AAAA;AAFA;AAKA;AACA;AAAA;AAAA;AAFA;AAKA;AAEA;AACA;AAAA;AAAA;AAFA;AAKA;AACA;AAAA;AAAA;AAFA;AAMA;AACA;AAAA;AAAA;AAFA;AAKA;AAEA;AACA;AAAA;AAAA;AAFA;AAKA;AACA;AAAA;AAAA;AAFA;AAKA;AACA;AAAA;AAAA;AAFA;AAMA;AAGA;AADA;AAIA;AAEA;AADA;AAKA;AACA;AACA;AACA;AAGA;AACA;AAAA;AAAA;AAFA;AAKA;AAEA;AACA;AAAA;AAAA;AAFA;AAMA;AAGA;AACA;AAAA;AAAA;AAFA;AAKA;AAEA;AACA;AAAA;AAAA;AAFA;AAMA;AAGA;AADA;AAIA;AAEA;AADA;AAKA;AAGA;AADA;AAIA;AAEA;AADA;AAKA;AAGA;AADA;AAIA;AAEA;AADA;AAKA;AAGA;AADA;AAIA;AAEA;AADA;AAKA;AAGA;AADA;AAIA;AAEA;AADA;AAKA;AAGA;AADA;AAIA;AAEA;AADA;AAKA;AACA;AACA;AACA;AAGA;AADA;AAIA;AAEA;AADA;AAKA;AAGA;AADA;AAIA;AAEA;AADA;AAKA;AAGA;AADA;AAIA;AAEA;AADA;AAKA;AACA;AACA;AACA;AAGA;AADA;AAIA;AAEA;AADA;AAKA;AACA;AACA;AACA;AAGA;AADA;AAIA;AAEA;AACA;AAAA;AAAA;AAFA;AAMA;AAGA;AACA;AAAA;AAAA;AAFA;AAKA;AACA;AAAA;AAAA;AAFA;AAKA;AAEA;AADA;AAKA;AAEA;AADA;AAKA;AACA;AACA;AACA;AAEA;AADA;AAKA;AADA;AAIA;AAGA;AADA;AAIA;AADA;AAIA;AAEA;AADA;AAIA;AADA;AAKA;AAGA;AADA;AAIA;AADA;AAIA;AADA;AAIA;AADA;AAIA;AAEA;AADA;AAKA;AADA;AAIA;AADA;AAIA;AADA;AAIA;AAEA;AADA;AAIA;AADA;AAKA;AADA;AAIA;AADA;AAIA;AAEA;AADA;AAIA;AADA;AAIA;AADA;AAKA;AADA;AAIA;AAEA;AADA;AAIA;AADA;AAIA;AADA;AAIA;AADA;AAKA;AAGA;AADA;AAIA;AAEA;AADA;AAKA;AACA;AACA;AACA;AAGA;AADA;AAIA;AAEA;AADA;AAKA;AACA;AACA;AACA;AAGA;AACA;AAAA;AAAA;AAFA;AAKA;AAEA;AACA;AAAA;AAAA;AAFA;AAMA;AAGA;AADA;AAIA;AAEA;AADA;AAKA;AAGA;AADA;AAIA;AAEA;AADA;AAKA;AAGA;AADA;AAIA;AAEA;AADA;AAKA;AACA;AACA;AACA;AAGA;AADA;AAIA;AAEA;AADA;AAKA;AAGA;AADA;AAIA;AAEA;AADA;AAKA;AAGA;AADA;AAIA;AAEA;AADA;AAKA;AAGA;AADA;AAIA;AAEA;AADA;AAKA;AAGA;AADA;AAIA;AAEA;AADA;AAKA;AAGA;AADA;AAIA;AAEA;AADA;AAKA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AADA;AAGA;AAJA;AAMA;AACA;AACA;AADA;AAGA;AAJA;AAMA;AACA;AACA;AADA;AAGA;AAJA;AAMA;AAEA;AACA;AAFA;AAOA;AAGA;AACA;AAFA;AAMA;AAIA;AACA;AAFA;AAKA;AAGA;AACA;AACA;AADA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAGA;AACA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAGA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AAAA;AAIA;AAEA;AACA;AAAA;AACA;AACA;AACA;AAGA;AACA;AAAA;AACA;AAGA;AAVA;AAYA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AANA;AAQA;AACA;AAAA;AACA;AACA;AACA;AACA;AAHA;AAKA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAGA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAJA;AAMA;AACA;AACA;AACA;AACA;AAEA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAAA;AAIA;AACA;AAAA;AACA;AAMA;AACA;AACA;AACA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAFA;AAIA;AACA;AACA;AACA;;;;;;;;;;;;AC90BA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AAFA;;;;;;;;;;;;ACHA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AAEA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AAAA;AACA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAEA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAFA;AAIA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AADA;AAGA;AAAA;AAAA;AACA;AACA;AACA;AACA;AAHA;AAKA;AACA;AACA;AADA;AAGA;AACA;AACA;AACA;AAPA;AASA;AAGA;AACA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;;;;;;;;;;;;ACvFA;AAAA;AAAA;AAEA;AACA;AACA;;;;;;;;;;;;ACJA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AAFA;;;;;;;;;;;;ACHA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AAAA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AAGA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAIA;AAEA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAEA;AAGA;AACA;AACA;AAEA;AADA;AAIA;;;;;;;;;;;;ACrJA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AALA;;;;;;;;;;;;ACHA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AADA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAjCA;;;;;;;;;;;;ACAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAKA;AAPA;AASA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AAHA;AAOA;AACA;AACA;AACA;AAnBA;AAqBA;AACA;AACA;AAAA;AAEA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAPA;AAUA;AACA;AACA;AACA;AACA;AACA;AANA;AASA;AACA;AACA;AACA;AACA;AALA;AAQA;AACA;AACA;AACA;AACA;AALA;AASA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAAA;AAEA;AAEA;AACA;AACA;AACA;AACA;AAAA;AAAA;AACA;AACA;AACA;AACA;AAAA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AAXA;AAaA;AACA;AAAA;AACA;AACA;AAAA;AAAA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AADA;AACA;AAEA;AACA;AACA;AAGA;AACA;AACA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAEA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAIA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AAEA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AADA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AAEA;AACA;AACA;AACA;AACA;AADA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AAAA;AACA;AACA;AADA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AADA;AACA;AAEA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AADA;AACA;AAEA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AADA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AADA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAGA;AACA;AACA;AACA;AACA;AADA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAGA;AACA;AAEA;AACA;AACA;AADA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AADA;AACA;AAEA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AADA;AACA;AACA;AACA;AACA;AAEA;AACA;AAAA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AADA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AADA;AACA;AACA;AAAA;AAEA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAQA;AAAA;AAAA;AACA;AAAA;AAAA;AAEA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AADA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AAEA;AACA;AACA;AAEA;AACA;AAAA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AADA;AACA;AAEA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAHA;AAKA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AAGA;AACA;AACA;AADA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AADA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAGA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AADA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AAAA;AAAA;AAAA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAWA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AADA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AAEA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAAA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAYA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AADA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AADA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAHA;AAKA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AADA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AADA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAGA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAGA;AAEA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AAAA;AACA;AACA;AAGA;AACA;AACA;AACA;AAAA;AACA;AAEA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AASA;AADA;AAWA;AACA;AACA;AAEA;AACA;AACA;AAGA;AAEA;AACA;AAAA;AAAA;AAEA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAKA;AAEA;AACA;AACA;AAGA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAKA;AACA;AAEA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AANA;AAQA;AACA;AACA;AACA;AAEA;AAEA;AAEA;AACA;AAEA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAKA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AAGA;AAEA;AAEA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAGA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AADA;AACA;AAEA;AACA;AAEA;AACA;AAGA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAEA;AAKA;AAMA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AALA;AAOA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AADA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AADA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAEA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AAEA;AACA;AACA;AAAA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAaA;AADA;AAkBA;AACA;AACA;AACA;AAAA;AAAA;AACA;AAGA;AACA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AAEA;AAGA;AAAA;AAIA;AAAA;AAAA;AACA;AACA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AACA;AACA;AA/rEA;AACA;AAgsEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AArCA;AACA;AAsCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AArBA;AACA;AAsBA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;AC/wEA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AADA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AA7FA;AA+FA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAPA;;;;;;;;;;;;AClGA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAvBA;;;;;;;;;;;;ACHA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AAFA;;;;;;;;;;;;ACHA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AArCA;AAuCA;AAAA;AAAA;AAAA;;;;;;;;;;;;AC1CA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AADA;AACA;AAEA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AA3BA;AA6BA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;;;;;;;;;;;;AC9CA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AADA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AADA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AADA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AADA;AAAA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AADA;AACA;AACA;AAAA;AACA;AADA;AAEA;AAFA;AAAA;AAAA;AAAA;AAMA;AANA;AACA;AAOA;AAMA;AACA;AAAA;AAEA;AAEA;AACA;AAEA;AACA;AAAA;AAAA;AAAA;AACA;AACA;AAAA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AADA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AAzHA;AACA;AA0HA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AADA;AACA;AACA;AAAA;AAGA;AAAA;AAAA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAGA;AAAA;AAAA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AAIA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAGA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AAEA;AAAA;AAGA;AAAA;AAGA;AACA;AACA;AAtFA;AACA;AAuFA;AACA;AACA;;;;;;;;;;;;AC1NA;AAAA;AAAA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAEA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AAOA;AADA;AA+BA;AACA;AACA;;;;;;;;;;;;AClDA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AAFA;;;;;;;;;;;;ACHA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AAEA;AACA;AAQA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAAA;AACA;AACA;AAFA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AAEA;AAGA;AACA;AAFA;AAIA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AAAA;AACA;AACA;AAEA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AArCA;AAuCA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AAAA;AAEA;AACA;AAFA;AAIA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AAAA;AAAA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AAKA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AAAA;AACA;AACA;AAAA;AAAA;AACA;AACA;;;;;;;;;;;;AC5SA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AAFA;;;;;;;;;;;;;;;;;;;;ACHA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AAEA;AAEA;AAEA;AACA;AAEA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AADA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AADA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AADA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AANA;AACA;AAQA;AAMA;AAEA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AAAA;AACA;AACA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AAAA;AAAA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AAAA;AAAA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAYA;AACA;AACA;AACA;AACA;AACA;AAaA;AACA;AACA;AACA;AACA;AACA;AASA;AACA;AACA;AACA;AACA;AACA;AAAA;AAIA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AApCA;AACA;AAqCA;AACA;AAEA;AACA;AACA;AAEA;AACA;AAEA;AACA;AAKA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAJA;AAKA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAFA;AAIA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AADA;AAIA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAAA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAJA;AAFA;AAQA;AACA;AACA;AACA;AACA;AACA;AALA;AAMA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AALA;AAMA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AADA;AAGA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AAAA;AACA;AACA;AACA;AAIA;AACA;AAAA;AACA;AACA;AACA;AACA;AADA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAIA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AADA;AAGA;AACA;AAAA;AACA;AADA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAEA;AACA;AACA;AACA;AACA;AALA;AAQA;AACA;AACA;AACA;AACA;AALA;AAQA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAAA;AAEA;AACA;AACA;AACA;AACA;AACA;AANA;AASA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AALA;AAOA;AACA;AAAA;AAIA;AACA;AACA;AACA;AADA;AAGA;AACA;AACA;AAPA;AASA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AAEA;AAFA;AAIA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAnBA;AAAA;AAAA;AACA;AAkBA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AAGA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAIA;AAHA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAIA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAlBA;AAuBA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAfA;AAoBA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAfA;AAoBA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAFA;AAIA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAEA;AACA;AACA;AADA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AADA;AAGA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;ACryCA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AADA;;;;;;;;;;;;ACFA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAEA;AAEA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AALA;AAQA;AAEA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AALA;AAQA;;;;;;;;;;;;AC/CA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AAFA;;;;;;;;;;;;ACHA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAEA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAAA;AAGA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAHA;AAKA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AATA;AACA;AAWA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AAGA;AACA;AACA;AACA;AADA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AAGA;AACA;AACA;AADA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAEA;AAGA;AACA;AAAA;AACA;AAAA;AACA;AACA;AACA;AAHA;AAAA;AAAA;AACA;AAEA;AACA;AAGA;AACA;AACA;AACA;AACA;AADA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAGA;AACA;AACA;AADA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAGA;AACA;AACA;AADA;AACA;AAAA;AACA;AACA;AACA;AAEA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AACA;AAEA;AACA;AAEA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAGA;AADA;AAIA;AACA;AACA;AACA;AACA;AA/BA;AAAA;AAAA;AACA;AA+BA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AATA;AAWA;AACA;AACA;AAEA;AAAA;AAAA;AAAA;AAEA;AACA;AAAA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAHA;AAKA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAGA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AAGA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAAA;AAAA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAHA;AAMA;AACA;AAGA;AACA;AAAA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;AC/zBA;AAAA;AAAA;AAAA;AAEA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;;;;;;;;;;;;ACXA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAvBA;;;;;;;;;;;;ACAA;AAAA;AACA;AACA;AACA;AAEA;AAEA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAOA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAOA;AAGA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AAAA;AAAA;AACA;AAGA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AAAA;AAAA;AACA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AAGA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAvNA;AA2NA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AADA;AAEA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AANA;AAQA;AAIA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AADA;AACA;AACA;AACA;AACA;AAHA;AAKA;AAGA;AACA;AACA;AACA;AACA;AADA;AAEA;AACA;AACA;AAEA;AAAA;AACA;AAAA;AAAA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAHA;AACA;AAKA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AAGA;AACA;AACA;AACA;AACA;AADA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AAGA;AACA;AACA;AACA;AACA;AADA;AAEA;AACA;AACA;AAEA;AAAA;AACA;AAAA;AAAA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAHA;AACA;AAIA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAGA;AACA;AACA;AACA;AACA;AADA;AAEA;AACA;AACA;AAEA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAUA;AAAA;AAAA;AAAA;AAAA;AACA;AAGA;AACA;AACA;AACA;AACA;AADA;AAEA;AACA;AAMA;AACA;AACA;AACA;AACA;AACA;AAGA;AACA;AACA;AACA;AACA;AADA;AAEA;AACA;AAOA;AACA;AACA;AACA;AACA;AACA;AAGA;AACA;AACA;AACA;AADA;AAEA;AAOA;AACA;AAGA;AACA;AACA;AADA;AACA;AAAA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAHA;AAKA;AAIA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAGA;AACA;AACA;AADA;AACA;AACA;AACA;AACA;AACA;AAGA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AAGA;AACA;AACA;AAAA;AACA;AAEA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AAJA;AAOA;AACA;AAIA;AACA;AAEA;AACA;AACA;AACA;AADA;AACA;AACA;AACA;AACA;AAGA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AADA;AACA;AACA;AAEA;AAEA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AAVA;AACA;AAWA;AAEA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AADA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AACA;AACA;AAEA;AACA;AACA;AACA;AAIA;AACA;AACA;AACA;AADA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AArJA;AACA;AAwJA;AAIA;AAEA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAGA;AACA;AACA;AADA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AAEA;AAGA;AACA;AACA;AAAA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAXA;AAaA;AAGA;AACA;AACA;AACA;AADA;AACA;AACA;AAGA;AACA;AACA;AACA;AADA;AAEA;AACA;AACA;AAAA;AACA;AACA;AACA;AAEA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAGA;AACA;AACA;AACA;AACA;AADA;AACA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AALA;AAOA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAJA;AAMA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AALA;AAOA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAJA;AAMA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAEA;AACA;AACA;;;;A","sourceRoot":""}