{"version":3,"file":"js/addon-entry-fullscreen.js","sources":["webpack://GUI/./src/addons/addons/fullscreen/hideOverflow.css","webpack://GUI/./src/addons/addons/fullscreen/hideToolbar.css","webpack://GUI/./src/addons/addons/fullscreen/removeBorder.css","webpack://GUI/./src/addons/addons/fullscreen/resizeWindow.css","webpack://GUI/./src/addons/addons/fullscreen/resizeWindow_noToolbar.css","webpack://GUI/./src/addons/addons/fullscreen/_runtime_entry.js","webpack://GUI/./src/addons/addons/fullscreen/userscript.js"],"sourcesContent":["exports = module.exports = require(\"../../../../node_modules/css-loader/lib/css-base.js\")(false);\n// imports\n\n\n// module\nexports.push([module.id, \".sa-fullscreen.sa-body-editor {\\r\\n  overflow: hidden !important;\\r\\n}\\r\\n\", \"\"]);\n\n// exports\n","exports = module.exports = require(\"../../../../node_modules/css-loader/lib/css-base.js\")(false);\n// imports\n\n\n// module\nexports.push([module.id, \"[class*=\\\"stage-wrapper_full-screen\\\"] [class*=\\\"stage-header_stage-header-wrapper-overlay\\\"] {\\r\\n  display: none;\\r\\n}\\r\\n\\r\\n[class*=\\\"stage-wrapper_full-screen\\\"] {\\r\\n  top: 0rem !important;\\r\\n}\\r\\n\", \"\"]);\n\n// exports\n","exports = module.exports = require(\"../../../../node_modules/css-loader/lib/css-base.js\")(false);\n// imports\n\n\n// module\nexports.push([module.id, \"[class*=\\\"stage-wrapper_full-screen\\\"] [class*=\\\"stage_full-screen\\\"],\\r\\n[class*=\\\"stage-wrapper_full-screen\\\"] [class*=\\\"stage_green-flag-overlay-wrapper\\\"] {\\r\\n  border: 0 !important;\\r\\n  border-radius: 0 !important;\\r\\n}\\r\\n\", \"\"]);\n\n// exports\n","exports = module.exports = require(\"../../../../node_modules/css-loader/lib/css-base.js\")(false);\n// imports\n\n\n// module\nexports.push([module.id, \"[class*=\\\"stage-wrapper_full-screen\\\"] [class*=\\\"stage-wrapper_stage-canvas-wrapper\\\"],\\r\\n[class*=\\\"stage-wrapper_full-screen\\\"] [class*=\\\"stage_stage\\\"],\\r\\n[class*=\\\"stage-wrapper_full-screen\\\"] [class*=\\\"stage-header_stage-menu-wrapper\\\"],\\r\\n[class*=\\\"stage-wrapper_full-screen\\\"] canvas {\\r\\n  width: min(calc((100vh - 44px) * var(--sa-fullscreen-width) / var(--sa-fullscreen-height)), 100vw) !important;\\r\\n}\\r\\n\\r\\n[class*=\\\"stage-wrapper_full-screen\\\"] [class*=\\\"stage-wrapper_stage-canvas-wrapper\\\"],\\r\\n[class*=\\\"stage-wrapper_full-screen\\\"] [class*=\\\"stage_stage\\\"],\\r\\n[class*=\\\"stage-wrapper_full-screen\\\"] [class*=\\\"stage_green-flag-overlay-wrapper\\\"],\\r\\n[class*=\\\"stage-wrapper_full-screen\\\"] canvas {\\r\\n  height: min(calc(100vh - 44px), calc(100vw * var(--sa-fullscreen-height) / var(--sa-fullscreen-width))) !important;\\r\\n}\\r\\n\\r\\n[class*=\\\"stage-wrapper_full-screen\\\"] {\\r\\n  padding: 0rem !important;\\r\\n}\\r\\n\\r\\n[class*=\\\"stage-wrapper_full-screen\\\"] [class*=\\\"monitor-list_monitor-list\\\"] {\\r\\n  overflow: visible;\\r\\n}\\r\\n\\r\\n[class*=\\\"stage-wrapper_full-screen\\\"] [class*=\\\"stage_question-wrapper\\\"] {\\r\\n  width: auto !important;\\r\\n}\\r\\n\", \"\"]);\n\n// exports\n","exports = module.exports = require(\"../../../../node_modules/css-loader/lib/css-base.js\")(false);\n// imports\n\n\n// module\nexports.push([module.id, \"[class*=\\\"stage-wrapper_full-screen\\\"] [class*=\\\"stage-wrapper_stage-canvas-wrapper\\\"],\\r\\n[class*=\\\"stage-wrapper_full-screen\\\"] [class*=\\\"stage_stage\\\"],\\r\\n[class*=\\\"stage-wrapper_full-screen\\\"] [class*=\\\"stage-header_stage-menu-wrapper\\\"],\\r\\n[class*=\\\"stage-wrapper_full-screen\\\"] canvas {\\r\\n  width: min(calc(100vh * var(--sa-fullscreen-width) / var(--sa-fullscreen-height)), 100vw) !important;\\r\\n}\\r\\n\\r\\n[class*=\\\"stage-wrapper_full-screen\\\"] [class*=\\\"stage-wrapper_stage-canvas-wrapper\\\"],\\r\\n[class*=\\\"stage-wrapper_full-screen\\\"] [class*=\\\"stage_stage\\\"],\\r\\n[class*=\\\"stage-wrapper_full-screen\\\"] [class*=\\\"stage_green-flag-overlay-wrapper\\\"],\\r\\n[class*=\\\"stage-wrapper_full-screen\\\"] canvas {\\r\\n  height: min(100vh, calc(100vw * var(--sa-fullscreen-height) / var(--sa-fullscreen-width))) !important;\\r\\n}\\r\\n\\r\\n[class*=\\\"stage-wrapper_full-screen\\\"] {\\r\\n  padding: 0rem !important;\\r\\n}\\r\\n\\r\\n[class*=\\\"stage-wrapper_full-screen\\\"] [class*=\\\"monitor-list_monitor-list\\\"] {\\r\\n  overflow: visible;\\r\\n}\\r\\n\\r\\n[class*=\\\"stage-wrapper_full-screen\\\"] [class*=\\\"stage_question-wrapper\\\"] {\\r\\n  width: auto !important;\\r\\n}\\r\\n\", \"\"]);\n\n// exports\n","/* generated by pull.js */\nimport _js from \"./userscript.js\";\nimport _css from \"!css-loader!./hideOverflow.css\";\nimport _css2 from \"!css-loader!./removeBorder.css\";\nimport _css3 from \"!css-loader!./resizeWindow.css\";\nimport _css4 from \"!css-loader!./resizeWindow_noToolbar.css\";\nimport _css5 from \"!css-loader!./hideToolbar.css\";\nexport const resources = {\n  \"userscript.js\": _js,\n  \"hideOverflow.css\": _css,\n  \"removeBorder.css\": _css2,\n  \"resizeWindow.css\": _css3,\n  \"resizeWindow_noToolbar.css\": _css4,\n  \"hideToolbar.css\": _css5,\n};\n","/**\r\n * Used for the automatic browser full screen setting\r\n * and for hiding the scrollbar in full screen.\r\n */\r\nexport default async function ({ addon, global, console }) {\r\n  const vm = addon.tab.traps.vm;\r\n  const updateStageSize = () => {\r\n    document.documentElement.style.setProperty('--sa-fullscreen-width', vm.runtime.stageWidth);\r\n    document.documentElement.style.setProperty('--sa-fullscreen-height', vm.runtime.stageHeight);\r\n  };\r\n  updateStageSize();\r\n  vm.on('STAGE_SIZE_CHANGED', updateStageSize);\r\n\r\n  // \"Browser fullscreen\" is defined as the mode that hides the browser UI.\r\n  function updateBrowserFullscreen() {\r\n    if (addon.settings.get(\"browserFullscreen\") && !addon.self.disabled) {\r\n      // If Scratch fullscreen is enabled, then browser fullscreen should also\r\n      // be enabled, and vice versa for disabling.\r\n      if (addon.tab.redux.state.scratchGui.mode.isFullScreen && document.fullscreenElement === null) {\r\n        document.documentElement.requestFullscreen();\r\n      } else if (!addon.tab.redux.state.scratchGui.mode.isFullScreen && document.fullscreenElement !== null) {\r\n        document.exitFullscreen();\r\n      }\r\n    }\r\n  }\r\n\r\n  // \"Scratch fullscreen\" is defined as the mode normally toggled by the\r\n  // rightmost button above the stage.\r\n  function updateScratchFullscreen() {\r\n    if (addon.settings.get(\"browserFullscreen\") && !addon.self.disabled) {\r\n      // If browser fullscreen is disabled, then Scratch fullscreen should also\r\n      // be disabled.\r\n      if (document.fullscreenElement === null && addon.tab.redux.state.scratchGui.mode.isFullScreen) {\r\n        addon.tab.redux.dispatch({\r\n          type: \"scratch-gui/mode/SET_FULL_SCREEN\",\r\n          isFullScreen: false,\r\n        });\r\n      }\r\n    }\r\n  }\r\n\r\n  async function setPageScrollbar() {\r\n    const body = await addon.tab.waitForElement(\".sa-body-editor\");\r\n    if (addon.tab.redux.state.scratchGui.mode.isFullScreen) {\r\n      body.classList.add(\"sa-fullscreen\");\r\n    } else {\r\n      body.classList.remove(\"sa-fullscreen\");\r\n    }\r\n  }\r\n\r\n  // Properly scale variable monitors on stage resize.\r\n  let monitorScaler, resizeObserver, stage;\r\n  async function initScaler() {\r\n    monitorScaler = await addon.tab.waitForElement(\"[class*=monitor-list_monitor-list-scaler]\");\r\n    stage = await addon.tab.waitForElement('[class*=\"stage-wrapper_full-screen\"] [class*=\"stage_stage\"]');\r\n    resizeObserver = new ResizeObserver(() => {\r\n      // Scratch uses the `transform` CSS property on a stage overlay element\r\n      // to control the scaling of variable monitors.\r\n      const scale = stage.getBoundingClientRect().width / 480;\r\n      monitorScaler.style.transform = `scale(${scale}, ${scale})`;\r\n    });\r\n    resizeObserver.observe(stage);\r\n  }\r\n\r\n  initScaler();\r\n\r\n  // Running this on page load handles the case of the project initially\r\n  // loading in Scratch fullscreen mode.\r\n  setPageScrollbar();\r\n  updateBrowserFullscreen();\r\n\r\n  // Changing to or from Scratch fullscreen is signified by a state change\r\n  // (URL change doesn't work when editing project without project page)\r\n  addon.tab.redux.initialize();\r\n  addon.tab.redux.addEventListener(\"statechanged\", (e) => {\r\n    if (e.detail.action.type === \"scratch-gui/mode/SET_FULL_SCREEN\") {\r\n      initScaler();\r\n      updateBrowserFullscreen();\r\n      setPageScrollbar();\r\n    }\r\n  });\r\n  // Changing to or from browser fullscreen is signified by a window resize.\r\n  window.addEventListener(\"resize\", () => {\r\n    updateScratchFullscreen();\r\n  });\r\n  // Handles the case of F11 full screen AND document full screen being enabled\r\n  // at the same time.\r\n  document.addEventListener(\"fullscreenchange\", () => {\r\n    if (document.fullscreenElement === null && addon.tab.redux.state.scratchGui.mode.isFullScreen) {\r\n      addon.tab.redux.dispatch({\r\n        type: \"scratch-gui/mode/SET_FULL_SCREEN\",\r\n        isFullScreen: false,\r\n      });\r\n    }\r\n  });\r\n  // These handle the case of the user already being in Scratch fullscreen\r\n  // (without being in browser fullscreen) when the addon or sync option are\r\n  // dynamically enabled.\r\n  addon.settings.addEventListener(\"change\", () => {\r\n    updateBrowserFullscreen();\r\n  });\r\n  addon.self.addEventListener(\"disabled\", () => {\r\n    resizeObserver.disconnect();\r\n  });\r\n  addon.self.addEventListener(\"reenabled\", () => {\r\n    resizeObserver.observe(stage);\r\n    updateBrowserFullscreen();\r\n  });\r\n}\r\n"],"mappings":";;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;ACPA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;ACPA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;ACPA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;ACPA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACPA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AANA;;;;;;;;;;;;ACPA;AAAA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAGA;AACA;AACA;AADA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAFA;AAIA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAGA;AACA;AAAA;AACA;AAGA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAAA;AACA;AACA;AACA;AACA;AAFA;AAIA;AACA;AAEA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;A","sourceRoot":""}